(function(){var a=SVMX.Package("com.servicemax.client.installigence.conflict");a.init=function(){a.Class("Conflict",com.servicemax.client.lib.api.Object,{__config:null,__data:null,__store:null,__grid:null,__win:null,__root:null,__constructor:function(b){this.__config=b;this.__root=b.root;},show:function(){var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCE.GET_SYNC_CONFLICTS",this,{request:{context:this}});com.servicemax.client.installigence.impl.EventBus.getInstance().triggerEvent(b);},onGetSyncConflictsComplete:function(b){this.__data=b;this.__showUI();},__showUI:function(){this.__win=this.__getUI();this.__store.setData(this.__data);this.__win.show(this.__config.sourceComponent);},__save:function(){var c=[];for(var d=0;d<this.__store.getCount();d++){var e=this.__store.getAt(d);c.push({Id:e.get("Id"),Action:e.get("Action")});}var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCE.UPDATE_SYNC_CONFLICTS",this,{request:{context:this,records:c}});com.servicemax.client.installigence.impl.EventBus.getInstance().triggerEvent(b);},__startSync:function(){this.__syncing=true;this.__save();},__selectTreeNode:function(b){this.__root.selectTreeNode(b);},onUpdateSyncConflictsComplete:function(e,d,f){if(this.__syncing){this.__root.handleIncrementalSync();delete this.__syncing;}},__getUI:function(){var j=this;var f=[{disp:"Select action",val:""},{disp:"Apply online changes",val:"SERVER_OVERRIDE"}];var h=[{disp:"Select action",val:""},{disp:"Delete record",val:"CLIENT_DELETE"},{disp:"Retry",val:"CLIENT_OVERRIDE"}];var c=[{disp:"Select action",val:""},{disp:"Restore record from online",val:"SERVER_OVERRIDE"},{disp:"Retry",val:"CLIENT_OVERRIDE"}];var e=function(m,l,k){k.removeAll();if(m=="conflict"){k.add(f);}else{if(m=="error"&&l=="insert"){k.add(h);}else{if(m=="error"){k.add(c);}}}};var i=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{valueField:"val",displayField:"disp",queryMode:"local",store:{xtype:"svmx.store",fields:["val","disp"],data:[]},listeners:{beforequery:function(m,o){var n=j.__win.items.get(0);var k=n.selModel.getSelection()[0].get("Type");var l=n.selModel.getSelection()[0].get("Operation");e(k,l,i.store);}}});var d=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["Id","Message","CreatedDate","Action","record"],data:[]});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXGrid",{flex:1,width:"100%",store:d,selModel:"cellmodel",plugins:{ptype:"cellediting",clicksToEdit:1},columns:[{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG089,"Record"),dataIndex:"Id",flex:1.5,renderer:SVMX.proxy(this,this.__nameFieldRenderer)},{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG120,"Message"),dataIndex:"Message",flex:2,renderer:function(k){return'<div style="white-space: pre-wrap">'+k+"</div>";}},{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG091,"Action"),dataIndex:"Action",flex:1.5,editor:i,readOnly:false,queryCaching:false,renderer:function(o,p,m){var l=m.get("Type");var n=m.get("Operation");e(l,n,i.store);var k=i.store.find(i.valueField,o);var q=i.store.getAt(k);return q?q.get(i.displayField):"<b><i>Select action...</i></b>";}}]});var g=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXWindow",{layout:{type:"vbox"},height:400,width:800,title:$TR.__getValueFromTag($TR.PRODIQ001_TAG088,"Synchronization Conflicts/Errors"),maximizable:false,closable:false,items:[b],modal:true,buttons:[{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG063,"Retry"),handler:function(){j.__startSync();g.close();}},{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG093,"Hold"),handler:function(){j.__save();g.close();}},{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG094,"Close"),handler:function(){g.close();}}]});this.__store=d;this.__grid=b;return g;},__nameFieldRenderer:function(f,g,c){var e=this;var i=Ext.id();var h=c.get("record");var d=h.Id||f;var b=h.CaseNumber||h.Name;if(b!==false){b=b||"New Record";Ext.defer(function(){$("<a>",{text:b,href:"javascript:void(0);",click:function(){e.__selectTreeNode(d);e.__win.close();}}).appendTo("#"+i);},25);return Ext.String.format('<div id="{0}"></div>',i);}else{return"--None--";}}},{});};})();