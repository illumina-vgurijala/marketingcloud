(function(){var a=SVMX.Package("com.servicemax.client.installigence.findandget");a.init=function(){Ext.define("com.servicemax.client.installigence.findandget.FindAndGet",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",alias:"widget.installigence.findandget",cls:"installigence-findandget",meta:null,root:null,grid:null,__params:null,__searchStatus:null,__inited:null,__config:null,__fieldsMap:null,__objectInfo:null,__config:null,__store:null,constructor:function(b){this.__inited=false;this.meta=b.meta;this.root=b.root;var c=this;this.__init();this.meta.bind("MODEL.UPDATE",function(d){this.__init();},this);b=Ext.apply({title:'<span class="title-text">'+$TR.__getValueFromTag($TR.PRODIQ001_TAG027,"Find & Get")+"</span>",titleAlign:"center",collapsible:false,height:SVMX.getWindowInnerHeight()-2,toolPosition:0,tools:[{type:"backbtn",cls:"svmx-back-btn",handler:function(h,g,d,f){c.__handeNavigateBack();}}],layout:"fit",border:false,items:this.__getUI(),dockedItems:this.__getDockedUI()},b||{});this.callParent([b]);},__init:function(){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.installigence.sync").getInstance(),c=this;b.getSObjectInfo(SVMX.getCustomObjectName("Installed_Product")).done(function(f){c.__objectInfo=f;c.__fieldsMap={};var e=0,d=f?f.fields.length:0;for(e=0;e<d;e++){if(f.fields[e].name=="Id"){f.fields[e].label="Id";}c.__fieldsMap[f.fields[e].name]=f.fields[e];}c.__initComplete();});},__getDisplayColumns:function(){var d=[];var e=$TR.__getValueFromTag($TR.PRODIQ001_TAG040,"Installed Product ID");var f=this.meta.ibDisplayFields&&this.meta.ibDisplayFields.length>0?this.meta.ibDisplayFields:[{name:"Name",priority:"1"}];if(this.__fieldsMap&&this.__fieldsMap.Name){var c=0,b=f.length;for(c=0;c<b;c++){d.push(this.__fieldsMap[f[c].name].label);}}else{d.push(e);}if(d.indexOf("Id")<0){d.push("Id");}return d;},__getAPIColumns:function(){var e=this.meta.ibDisplayFields&&this.meta.ibDisplayFields.length>0?this.meta.ibDisplayFields:[{name:"Name",priority:"1"}];var d=[],c,b=e.length;for(c=0;c<b;c++){d.push(e[c].name);}if(d.indexOf("Id")<0){d.push("Id");}return d;},__getSearchColumns:function(){var e=this.meta.ibSearchFields&&this.meta.ibSearchFields.length>0?this.meta.ibSearchFields:[{name:"Name",priority:"1"}];var d=[],c,b=e.length;for(c=0;c<b;c++){d.push(e[c].name);}return d;},__initComplete:function(){this.__inited=true;var f=this.__getDisplayColumns();var c=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:f,data:[]});this.__store.fields=f;var e=0,b=f.length,d=[];for(e=0;e<b;e++){if(f[e]=="Id"){continue;}d.push({text:f[e],dataIndex:f[e],flex:1});}this.grid.columns=d;this.grid.reconfigure(this.__store,d);},__getDockedUI:function(){var d=this;var e=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{width:"25%",emptyText:$TR.__getValueFromTag($TR.PRODIQ001_TAG053,"Search"),enableKeyEvents:true,listeners:{keyup:function(g,h,f){if(h.getKey()==h.ENTER){d.find(this.getValue(),c.actionId);}}}});var c=null;c=SVMX.create("Ext.button.Split",{text:$TR.__getValueFromTag($TR.PRODIQ001_TAG035,"Find by Top-Level IB"),actionId:"FIND_BY_IB",handler:function(){d.find(e.getValue(),this.actionId);},__update:function(f){this.setText(f.text);this.actionId=f.actionId;this.handler();},menu:SVMX.create("com.servicemax.client.installigence.ui.components.Menu",{cls:"findget-filter-findbytoplevel-menu",showSeparator:false,items:[{actionId:"FIND_BY_IB",text:$TR.__getValueFromTag($TR.PRODIQ001_TAG035,"Find by Top-Level IB"),handler:function(f){c.__update(f);}},{actionId:"FIND_BY_TEMPLATE",disabled:true,text:$TR.__getValueFromTag($TR.PRODIQ001_TAG036,"Find By Template"),handler:function(f){c.__update(f);}},{actionId:"FIND_BY_PRODUCT",disabled:true,text:$TR.__getValueFromTag($TR.PRODIQ001_TAG037,"Find By Product"),handler:function(f){c.__update(f);}}]})});this.__searchStatus=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXDisplayField",{});var b=[{dock:"top",xtype:"toolbar",margin:"0",cls:"findget-toolbar-search",items:[e,c,this.__searchStatus,"->",{xtype:"button",text:$TR.__getValueFromTag($TR.PRODIQ001_TAG038,"Get"),handler:function(){d.getIBs();}}]}];return b;},findLMIBs:function(){this.root.blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCE.GET_LM_TOP_LEVEL_IBS",this,{request:{context:this,ids:[],params:this.__params}});com.servicemax.client.installigence.impl.EventBus.getInstance().triggerEvent(b);},onGetLMTopLevelIBsComplete:function(b){this.root.unblockUI();var c="FIND_BY_IB";if(b.length>0){this.find("",c,b,true);}else{if(this.__findingLMIBs){this.getIBs();}}},getIBs:function(){var g=this.grid.getSelectionModel().getSelection();if(!this.__findingLMIBs&&g.length==0){return;}var e=[],c,b=g.length;for(c=0;c<b;c++){e.push(g[c].getData().Id);}this.root.blockUI();var d=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.installigence.sync").getInstance();var f={IBs:e,type:this.__params?this.__params.syncType:"ib"};
d.start(f);},resetLocalIBs:function(){this.root.blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCE.GET_TOP_LEVEL_IBS",this,{request:{context:this}});com.servicemax.client.installigence.impl.EventBus.getInstance().triggerEvent(b);},onGetTopLevelIBsComplete:function(e){var d=[];for(var b=0;b<e.ibs.length;b++){var g=e.ibs[b].Id;if(g.indexOf("transient-")===0){continue;}d.push(g);}var f={IBs:d,type:"reset"};var c=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.installigence.sync").getInstance();c.start(f);},handleFocus:function(c){var b=this;this.__params=c;this.grid.getStore().loadData([]);this.__searchStatus.setValue("");if(c&&(c.syncType==="initial"||c.syncType==="reset")){this.__checkLaptopMobileExists().done(function(d){if(d){b.__findingLMIBs=true;}b.findLMIBs();});}},__checkLaptopMobileExists:function(){var f=SVMX.Deferred();var c={appName:"LaptopMobile"};var e=SVMX.getCurrentApplication().getNativeServiceRequest();var b=e.createCheckExternalRequest();b.bind("REQUEST_COMPLETED",function(d){var g=d.data.data;var h=SVMX.toObject(d.data.data);f.resolve(h[0].Installed==="true");},this);b.bind("REQUEST_ERROR",function(d){f.resolve({});},this);b.execute(c);return f;},find:function(g,e,c,d){this.root.blockUI();if(this.__inited==false){this.__init();}else{var f=this.__fieldsMap&&this.__fieldsMap.Name?this.__fieldsMap:{Name:{label:$TR.__getValueFromTag($TR.PRODIQ001_TAG040,"Installed Product ID"),type:"text"},Id:{label:"Id",type:"text"}};var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCE."+e,this,{request:{context:this,text:g,params:this.__params,locationIds:c,selectAll:d,fields:this.__getAPIColumns(),searchFields:this.__getSearchColumns(),fieldsDescribe:f}});com.servicemax.client.installigence.impl.EventBus.getInstance().triggerEvent(b);}},onSearchByIBComplete:function(b){this.root.unblockUI();this.__searchStatus.setValue(b.data.length+(b.hasMoreRecords?"+":"")+" record(s) found.");this.grid.getStore().loadData(b.data);if(b.selectAll||this.__findingLMIBs){var c=this.grid.getSelectionModel();c.selectAll(false);}if(this.__findingLMIBs){this.getIBs();delete this.__findingLMIBs;}},onSearchByIBError:function(){this.root.unblockUI();},__getUI:function(){var d=[];var g=this.__getDisplayColumns();var c=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:g,data:[]});this.__store=c;var f=0,b=g.length,e=[];for(f=0;f<b;f++){if(g[f]=="Id"){continue;}e.push({text:g[f],dataIndex:g[f],flex:1});}this.grid=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXGrid",{store:c,border:false,selModel:{selType:"checkboxmodel",renderer:function(m,j,i,n,l,k,h){if(false&&i.get("availableInDB")){return"";}else{return'<div class="x-grid-row-checker installigence-findget-grid-column" role="presentation">&#160;</div>';}},listeners:{beforeselect:function(k,h,i,j){return true;}},checkOnly:true},columns:e,height:"100%",cls:"findget-grid",width:"100%",scroll:"vertical",viewConfig:{getRowClass:function(h,i){if(h.get("availableInDB")){return"svmx-disabled-row";}}}});d.push(this.grid);return d;},__handeNavigateBack:function(){this.root.handleNavigateBack();}});};})();