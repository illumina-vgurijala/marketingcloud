(function(){var a=SVMX.Package("com.servicemax.client.sal.sfmsearch.model.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{useJsr:false,__logger:null,__constructor:function(){this.__base();this.__self.instance=this;this.__logger=SVMX.getLoggingService().getLogger("SAL-SEARCH-MODEL");},beforeInitialize:function(){com.servicemax.client.sal.model.sfmsearchdelivery.operations.init();},initialize:function(){var b=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if(b&&b===true){this.useJsr=true;this.__logger.info("JSR is enabled. Will use this for server communication.");}else{this.useJsr=false;}},setUserInfo:function(b){var d=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.cache").getInstance();var c=b.UserId+"-SFMSEARCHDELIVERY-USERLANGUAGE",f=d.getItem(c);if(f){if(f!=b.Language){this.__logger.info("User language OR User login has changed. Will clear cache");this.clearCache();}}if(UserContext){var e=UserContext.timeFormat;b.TimeFormat=e;}a.ModelState.getInstance().add("userInfo",b);d.setItem(c,b.Language);SVMX.getCurrentApplication().setUserInfo(b);},clearCache:function(){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.cache");var c=b.getInstance();this.__logger.info("Clearing cache...");c.reset();},registerForSALEvents:function(b,c){if(!c){SVMX.getLoggingService().getLogger().warn("registerForSALEvents was invoked without operationObj!");}b.bind("REQUEST_ERROR",function(g){var d="";try{d+="::"+g.data.xhr.statusText+"=>"+g.data.xhr.responseText;}catch(f){}this.__logger.error(d);},this);},createServiceRequest:function(d,c){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sal.service.factory");b.getInstanceAsync({handler:function(e){var f=d.options||{};var h={type:f.type||"REST",endPoint:f.endPoint||"SFMSearchDeliveryServiceIntf",nameSpace:f.namespace===null?null:SVMX.OrgNamespace};var i=e.createServiceManager(h);var g=i.createService();this.registerForSALEvents(g,c);d.handler.call(d.context,g);},context:this});},checkResponseStatus:function(c,d,b,e){return true;}},{instance:null});a.Class("ModelState",com.servicemax.client.lib.api.Object,{__state:null,__constructor:function(){this.__state={};},add:function(b,c){this.__state[b]=c;},get:function(b){return this.__state[b];},remove:function(b){var d=null;try{d=this.__state[b];}catch(c){}this.__state[b]=null;return d;}},{getInstance:function(){if(this.__instance==null){this.__instance=new a.ModelState();}return this.__instance;},__instance:null});a.Class("PlatformSpecifics",com.servicemax.client.lib.api.Object,{__constructor:function(){},showRecord:function(c){var b=SVMX.getClient().getApplicationParameter("svmx-base-url")||"";if(b&&b.indexOf("/")!=0){b="/"+b;}SVMX.openInBrowserWindow(b+"/"+c.key+"?isdtp=");}},{});})();(function(){var a=SVMX.Package("com.servicemax.client.sal.model.sfmsearchdelivery.operations");a.init=function(){var c=com.servicemax.client.sal.sfmsearch.model.impl.Module;var b;a.Class("GetSearchInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(g,d){var e=c.instance,f=this;if(window.svmx_sfmsearch_delivery_search_info!=undefined&&window.svmx_sfmsearch_delivery_search_info!=null){setTimeout(function(){var h=window.svmx_sfmsearch_delivery_search_info;h=SVMX.toObject(h);window.svmx_sfmsearch_delivery_search_info=null;f.__handleResponse(g,d,h);},1);}else{if(e.useJsr){SVMXJsr.JsrGetSearchInfo(g,function(h,i){this.__handleResponse(g,d,h);},this);}else{e.createServiceRequest({handler:function(h){h.bind("REQUEST_COMPLETED",function(i){this.__handleResponse(g,d,i.data);},this);h.callMethodAsync({methodName:"getSearchInfo",data:{}});},context:this},this);}}},__handleResponse:function(f,d,g){var e=c.instance;if(e.checkResponseStatus("GetSearchInfo",g,false,this)==true){b=SVMX.cloneObject(g);d.result(g);}}},{});a.Class("GetUserInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,d){if(window.svmx_sfmsearch_delivery_userinfo!=undefined&&window.svmx_sfmsearch_delivery_userinfo!=null){setTimeout(function(){ret=window.svmx_sfmsearch_delivery_userinfo;ret=SVMX.toObject(ret);c.instance.setUserInfo(ret);d.result(ret);},1);}else{c.instance.createServiceRequest({handler:function(f){f.bind("REQUEST_COMPLETED",function(g){c.instance.setUserInfo(g.data);d.result(g.data);});f.callMethodAsync({methodName:"getUserInfo",data:e});},context:this},this);}}},{});a.Class("GetSearchResults",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(g,d){var f=c.instance;var e={ProcessId:g.ProcessId,ProcessName:g.ProcessName,ObjectId:g.ObjectId,KeyWord:g.KeyWord,Operator:g.Operator,RecordLimit:g.RecordLimit};if(f.useJsr){SVMXJsr.JsrGetSearchResult(e,function(h,i){this.__handleResponse(g,d,h);},this);}else{f.createServiceRequest({handler:function(h){h.bind("REQUEST_COMPLETED",function(i){this.__handleResponse(g,d,i.data);
},this);h.callMethodAsync({methodName:"getSearchResult",data:e});},context:this},this);}},__getSearchDef:function(e){var f=SVMX.array.get(b.lstSearchInfo,function(g){return g.searchDef.Id==e.ProcessId;});var d=SVMX.array.get(f.searchDetails,function(g){return g.objectDetails.Id==e.ObjectId;});return d;},__getSearchObjectFromDef:function(d){return d.objectDetails[SVMX.OrgNamespace+"__Target_Object_Name__c"];},__handleResponse:function(f,d,g){var e=c.instance;if(e.checkResponseStatus("GetSearchResult",g,false,this)==true){this.__convertResponse(f,d,g);d.result(g);}},__convertResponse:function(g,e,h){var m=h.MapStringMap;if(m){var l=this.__getSearchDef(g);var n=this.__getSearchObjectFromDef(l);var o=l.fields;for(var k=0;k<m.length;k++){var d=m[k].valueMap;for(var f=0;f<d.length;f++){this.__convertResponseItem(d[f],o[f],n);}}}},__convertResponseItem:function(d,h,e){var f=h[SVMX.OrgNamespace+"__Object_Name2__c"];var i=h[SVMX.OrgNamespace+"__Field_Name__c"];var g=h[SVMX.OrgNamespace+"__Lookup_Field_API_Name__c"];if(f&&f!=e){d.key=g+"-"+i;}else{d.key=i;}if(d.type=="DATETIME"){d.value=(d.value=="--"||d.value=="")?"--":this.__getDateTimeInSaveFormat(d.value);}else{if(d.type=="DATE"){d.value=(d.value=="--"||d.value=="")?"--":this.__getDateInSaveFormat(d.value);}}},__getDateTimeInSaveFormat:function(f){var d=com.servicemax.client.lib.datetimeutils.DatetimeUtil;var e=d.parseGMTDate(f,d.getDefaultDatetimeFormat());return d.convertToTimezone(e,null,true);},__getDateInSaveFormat:function(f){var d=com.servicemax.client.lib.datetimeutils.DatetimeUtil;var e=d.parseDate(f,d.getDefaultDateFormat());return d.getFormattedDatetime(e,d.getSaveFormat("date"));}},{});a.Class("GetSearchResultLimitSettings",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,d){d.result({maxLimit:null,defaultLimit:null});}},{});};})();