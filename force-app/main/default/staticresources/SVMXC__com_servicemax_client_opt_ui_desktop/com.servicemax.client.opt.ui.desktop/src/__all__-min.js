(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.api");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("OPT");Ext.define("com.servicemax.client.opt.ui.desktop.api.RootContainer",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",cls:"apft-root-container opt-root-container",layout:"fit",width:"100%",height:720,__parent:this,__resultsViewPanel:null,__runOpts:null,constructor:function(c){var d=c.deliveryEngine;c=Ext.apply({header:{items:[{xtype:"svmx.button",itemId:"BackButton",padding:"0",text:b.T("TAG029","Back To Setup Home"),handler:function(k,h,f,g){var j="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";window.location.href=j;}}]},items:[{margin:"20 0 0 0",layout:"column",columnWidth:0.25,cls:"opt-container-box",items:[{items:[{xtype:"svmx.tabpanel",anchor:"100% 100%",border:false,cls:"opt-tabs-left",tabPosition:"left",itemId:"opt-general-tab-items-container",defaults:{autoScroll:true,frame:false,border:false,padding:"0 0 0 0"},activeTab:0,items:[{xtype:"svmx.tabpanel",border:false,title:b.T("TAG072","Technician Utilization"),activeTab:0,defaults:{autoScroll:true,frame:false,border:false,padding:"0 0 0 0"}}]}]},{columnWidth:0.75,items:[{xtype:"svmx.tabpanel",itemId:"opt-horizontal-tab-container",defaults:{autoScroll:true,border:false,frame:false},width:875,activeTab:0,border:false,minHeight:850,items:[{xtype:"svmx.setting",margin:"20 0 0 0",border:false,__parent:this,engine:d},{xtype:"svmx.execution",id:"getreportdata",margin:"20 0 0 0",border:false,__parent:this,engine:d},{xtype:"svmx.purge",margin:"20 0 0 0",border:false,__parent:this,engine:d}],tabBar:{items:[{xtype:"tbfill"},{iconCls:"svmx-spm-help-icon ",cursor:"pointer",scale:"small",cls:"svmx-ent-help-opt",tooltip:b.T("TAG069","OPT Help"),href:b.T("TAG070","http://userdocs.servicemax.com:8080/ServiceMaxHelp/Spring16/en_us/svmx_redirector.htm?uid=SPM|SPMConfiguration_Setup"),closable:false}]}}]}]}],collapsible:false,title:SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")?"":b.T("TAG071","Scheduled Service Performance Metrics"),titleAlign:"center",layout:{type:"border"}},c||{});this.callParent([c]);},reportLatestRuns:function(c){Ext.MessageBox.alert("Status",c);Ext.getCmp("opt-report-latest-run-btn").enable();},purgeLatestRun:function(d){var c=Ext.getCmp("getpurgedatagrid");Ext.MessageBox.alert("Status",d);Ext.getCmp("opt-purge-latest-run-btn").enable();},getJobListForPurge:function(c){if(c.data!=null){var d=Ext.getCmp("getpurgedatagrid");var e=d.getStore();e.loadData(c.data);}else{Ext.MessageBox.alert("Status",c.message);}Ext.getCmp("opt-find-run-purge").enable();purgeTable.getSelectionModel().selectAll();},getJobListForExecution:function(c){if(c.data!=null){var d=Ext.getCmp("getexecutiondatagrid");var e=d.getStore();e.loadData(c.data);}else{Ext.MessageBox.alert("Status",c.message);}Ext.getCmp("opt-find-run-btn").enable();executionTable.getSelectionModel().selectAll();},purgeSelectedRuns:function(c){Ext.MessageBox.alert("Status",c);Ext.getCmp("purge-selected-run-btn").enable();},executionSelectedRuns:function(c){Ext.MessageBox.alert("Status",c);Ext.getCmp("execution-selected-run-btn").enable();},loadDispatchProcessNames:function(h){var f=[];for(var j=0;j<h.processList.length;j++){f.push({label:h.processList[j],name:"None"});}var k=Ext.getCmp("dispatch-process-name-execution");var d=k.getStore();d.loadData(f);k.setValue(f[0].label);var k=Ext.getCmp("dispatch-process-name-purge");var d=k.getStore();d.loadData(f);k.setValue(f[0].label);var l=[];for(var j=0;j<h.productiveHoursList.length;j++){l.push({label:h.productiveHoursList[j],name:j});}var k=Ext.getCmp("productive-hours-computation");var d=k.getStore();d.loadData(l);if(h.data!=null||h.data!=undefined){if(h.data.settings.productiveHours!=""){var e=h.data.settings.productiveHours.split(",");k.setValue(e);}}var g=[];for(var j=0;j<h.availableHoursList.length;j++){g.push({label:h.availableHoursList[j],name:j});}var k=Ext.getCmp("available-hours-computation");var d=k.getStore();d.loadData(g);if(h.data!=null||h.data!=undefined){if(h.data.settings.availableHours!=""){var c=h.data.settings.availableHours.split(",");k.setValue(c);}}var m=Ext.getCmp("notification-email-opt");if(h.data!=null||h.data!=undefined){m.setValue(h.data.settings.emailId);}},saveOptConfiguration:function(c){Ext.MessageBox.alert("Status",c.message);Ext.getCmp("opt-save-configuration-btn").enable();}});};})();(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.api.execution");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("OPT");Ext.create("Ext.data.Store",{storeId:"jobsStoreExecution",fields:["jobId","processName","startDate","endDate"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.create("Ext.data.ArrayStore",{storeId:"dispatchProcessName",fields:["name","label"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});
Ext.define("com.servicemax.client.opt.ui.execution.execution",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.svmx.execution",layout:"column",title:b.T("TAG080","Execution"),__runOpts:null,constructor:function(d){var c=d.engine;d=Ext.apply({items:[{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"button",text:b.T("TAG095","Report Latest Run"),cls:"spm-opt-button",id:"opt-report-latest-run-btn",deliveryEngine:c,handler:function(){this.deliveryEngine.processLatestRunHandler();Ext.getCmp("opt-report-latest-run-btn").disable();}}]},{margin:"10 0 8 0",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"label",text:"-"+b.T("TAG082","Or")+"-"}]},{margin:"0 0 20 10",columnWidth:1,xtype:"fieldset",title:b.T("TAG083","Report by Timeframe"),layout:"anchor",minHeight:551,defaultType:"textfield",items:[{margin:"10 0 20 0",width:812,padding:"10 10 10 10",xtype:"fieldset",title:b.T("TAG084","Select Filters"),items:[{layout:"column",border:false,items:[{columnWidth:0.5,xtype:"datefield",anchor:"100%",fieldLabel:b.T("TAG089","Start Date"),cls:"spm-opt-config-start-date",margin:"0 30 0 0",name:"from_date",format:"Y-m-d",maxValue:new Date(),id:"execution_from_date",value:new Date()},{columnWidth:0.5,xtype:"datefield",anchor:"100%",fieldLabel:b.T("TAG090","End Date"),cls:"spm-opt-config-end-date",margin:"0 30 0 0",id:"execution_to_date",format:"Y-m-d",name:"to_date",value:new Date()}]},{layout:"column",border:false,items:[{margin:"30 30 20 0",columnWidth:1,xtype:"combobox",fieldLabel:b.T("TAG085","Dispatch Process Name"),displayField:"label",valueField:"name",cls:"spm-opt-dispatch-process",labelWidth:150,id:"dispatch-process-name-execution",deliveryEngine:c,name:"label",labelField:"label",valueField:"name",displayField:"label",queryMode:"local",editable:false,getLoader:function(){this.deliveryEngine.loadDispatchProcessNamesHandler();},store:Ext.data.StoreManager.lookup("dispatchProcessName")}]},{xtype:"fieldset",columnWidth:1,border:false,margin:"0 20 0 0",layout:{type:"vbox",align:"right"},items:[{xtype:"svmx.button",text:b.T("TAG086","Find Runs"),id:"opt-find-run-btn",cls:"spm-opt-button",deliveryEngine:c,handler:function(){var e=Ext.getCmp("execution_from_date").getSubmitValue();var f=Ext.getCmp("execution_to_date").getSubmitValue();if(Ext.getCmp("dispatch-process-name-execution").displayTplData!=undefined||Ext.getCmp("dispatch-process-name-execution").displayTplData!=null){var g=Ext.getCmp("dispatch-process-name-execution").displayTplData[0].label;}param={startDate:e,endDate:f,processName:g,isPurge:"fasle"};if((Date.parse(e)>Date.parse(f))){Ext.MessageBox.alert("Status",b.T("TAG097","Start Date should be earlier that End Date"));return false;}else{if(e==""){Ext.MessageBox.alert("Status",b.T("TAG098","Select Start Date"));return false;}else{if(f==""){Ext.MessageBox.alert("Status",b.T("TAG099","Select End Date"));return false;}}}this.deliveryEngine.getJobListForExecutionHandler(param);Ext.getCmp("opt-find-run-btn").disable();}}]}]},executionTable=Ext.create("Ext.grid.Panel",{title:b.T("TAG096","All Runs"),selType:"checkboxmodel",minHeight:250,height:250,width:812,selModel:{checkOnly:false,mode:"MULTI",columnSelect:true,checkboxSelect:true,pruneRemoved:false},id:"getexecutiondatagrid",xtype:"checkboxgroup",store:Ext.data.StoreManager.lookup("jobsStoreExecution"),columns:[{text:b.T("TAG087","Job Id"),dataIndex:"jobId",width:110,sortable:false,menuDisabled:true},{text:b.T("TAG088","Dispatch Process Name"),dataIndex:"processName",width:300,sortable:false,menuDisabled:true},{text:b.T("TAG089","Start Date"),dataIndex:"startDate",width:200,sortable:false,menuDisabled:true},{text:b.T("TAG090","End Date"),dataIndex:"endDate",width:200,sortable:false,menuDisabled:true}]}),executionTable.on("viewready",function(){executionTable.getSelectionModel().selectAll();}),{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"right"},items:[{xtype:"button",text:b.T("TAG081","Report Selected Runs"),id:"execution-selected-run-btn",cls:"spm-opt-button",deliveryEngine:c,handler:function(){var f=Ext.getCmp("getexecutiondatagrid");var h=f.getSelectionModel();var e=[];for(i=0;i<f.store.getCount();i++){if(h.isSelected(i)){e.push(f.store.getAt(i).data.jobId);}}var g=e.toString();param={jobsId:g};if(e.length<=0){Ext.MessageBox.alert("Status",b.T("TAG100","Select one or more job(s)"));return false;}this.deliveryEngine.executionSelectedRunsHandler(param);Ext.getCmp("execution-selected-run-btn").disable();}}]}]}]},d||{});this.callParent([d]);}});};})();(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__constructor:function(){this.__base();},beforeInitialize:function(){com.servicemax.client.opt.ui.desktop.api.setting.init();com.servicemax.client.opt.ui.desktop.api.execution.init();com.servicemax.client.opt.ui.desktop.api.purge.init();
},initialize:function(){},afterInitialize:function(){com.servicemax.client.opt.ui.desktop.api.init();}},{instance:null});})();(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.api.purge");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("OPT");Ext.create("Ext.data.Store",{storeId:"jobsStorePurge",fields:["jobId","processName","startDate","endDate"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.create("Ext.data.ArrayStore",{storeId:"dispatchProcessNamePurge",fields:["name","label"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.define("com.servicemax.client.opt.ui.purge.purge",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.svmx.purge",layout:"column",title:b.T("TAG096","Purge"),__runOpts:null,constructor:function(d){var c=d.engine;d=Ext.apply({items:[{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"button",text:b.T("TAG091","Purge Latest Run"),cls:"spm-opt-button",id:"opt-purge-latest-run-btn",deliveryEngine:c,handler:function(){var e=this;Ext.MessageBox.confirm({title:b.T("101","Confirm"),msg:b.T("102","Are you sure ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:b.T("103","Yes"),no:b.T("104","No")},icon:Ext.MessageBox.QUESTION,fn:function(f,g){if(f=="yes"){e.deliveryEngine.purgeLatestRunHandler();Ext.getCmp("opt-purge-latest-run-btn").disable();}}});}}]},{margin:"10 0 8 0",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"label",text:"-"+b.T("TAG082","Or")+"-"}]},{margin:"0 0 20 10",columnWidth:1,xtype:"fieldset",title:b.T("TAG092","Purge by Timeframe"),layout:"anchor",minHeight:551,height:"100%",defaultType:"textfield",items:[{margin:"10 0 20 0",padding:"10 10 10 10",width:812,xtype:"fieldset",title:b.T("TAG084","Select Filters"),items:[{layout:"column",border:false,items:[{xtype:"datefield",columnWidth:0.5,anchor:"100%",fieldLabel:b.T("TAG089","Start Date"),cls:"spm-opt-config-start-date",margin:"0 30 0 0",name:"from_date",format:"Y-m-d",maxValue:new Date(),id:"purge_from_date",value:new Date()},{xtype:"datefield",columnWidth:0.5,anchor:"100%",fieldLabel:b.T("TAG090","End Date"),cls:"spm-opt-config-end-date",margin:"0 30 0 0",id:"purge_to_date",format:"Y-m-d",name:"to_date",value:new Date()}]},{layout:"column",border:false,items:[{margin:"30 30 20 0",columnWidth:1,xtype:"combobox",fieldLabel:b.T("TAG085","Dispatch Process Name"),displayField:"label",valueField:"name",cls:"spm-opt-dispatch-process",id:"dispatch-process-name-purge",labelWidth:150,editable:false,deliveryEngine:c,name:"label",labelField:"label",valueField:"name",displayField:"label",queryMode:"local",store:Ext.data.StoreManager.lookup("dispatchProcessNamePurge")}]},{xtype:"fieldset",columnWidth:1,border:false,margin:"0 20 0 0",layout:{type:"vbox",align:"right"},items:[{xtype:"svmx.button",text:b.T("TAG086","Find Runs"),cls:"spm-opt-button",id:"opt-find-run-purge",deliveryEngine:c,handler:function(){var g=Ext.getCmp("purge_from_date").getSubmitValue();var f=Ext.getCmp("purge_to_date").getSubmitValue();if(Ext.getCmp("dispatch-process-name-purge").displayTplData[0]!=undefined){var e=Ext.getCmp("dispatch-process-name-purge").displayTplData[0].label;}param={startDate:g,endDate:f,processName:e,isPurge:"true"};if((Date.parse(g)>Date.parse(f))){Ext.MessageBox.alert("Status",b.T("TAG097","Start Date should be earlier that End Date"));return false;}else{if(g==""){Ext.MessageBox.alert("Status",b.T("TAG098","Select Start Date"));return false;}else{if(f==""){Ext.MessageBox.alert("Status",b.T("TAG099","Select End date"));return false;}}}this.deliveryEngine.getJobListForPurgeHandler(param);Ext.getCmp("opt-find-run-purge").disable();}}]}]},purgeTable=Ext.create("Ext.grid.Panel",{title:b.T("TAG096","All Runs"),selType:"checkboxmodel",minHeight:250,height:250,width:812,selModel:{checkOnly:false,mode:"MULTI",columnSelect:true,checkboxSelect:true,pruneRemoved:false},id:"getpurgedatagrid",xtype:"checkboxgroup",store:Ext.data.StoreManager.lookup("jobsStorePurge"),columns:[{text:b.T("TAG087","Job Id"),dataIndex:"jobId",width:110,sortable:false,menuDisabled:true},{text:b.T("TAG088","Dispatch Process Name"),dataIndex:"processName",width:300,sortable:false,menuDisabled:true},{text:b.T("TAG089","Start Date"),dataIndex:"startDate",width:200,sortable:false,menuDisabled:true},{text:b.T("TAG090","End Date"),dataIndex:"endDate",width:200,sortable:false,menuDisabled:true}]}),purgeTable.on("viewready",function(){purgeTable.getSelectionModel().selectAll();}),{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"right"},items:[{xtype:"button",text:b.T("TAG093","Purge Selected Runs"),cls:"spm-opt-button",id:"purge-selected-run-btn",deliveryEngine:c,handler:function(){var g=Ext.getCmp("getpurgedatagrid");var j=g.getSelectionModel();var e=[];for(i=0;
i<g.store.getCount();i++){if(j.isSelected(i)){e.push(g.store.getAt(i).data.jobId);}}var h=e.toString();param={jobsId:h};if(e.length<=0){Ext.MessageBox.alert("Status",b.T("TAG100","Select one or more job(s)"));return false;}var f=this;Ext.MessageBox.confirm({title:b.T("101","Confirm"),msg:b.T("102","Are you sure ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:b.T("103","Yes"),no:b.T("104","No")},icon:Ext.MessageBox.QUESTION,fn:function(k,l){if(k=="yes"){f.deliveryEngine.purgeSelectedRunsHandler(param);Ext.getCmp("purge-selected-run-btn").disable();}}});}}]}]}]},d||{});this.callParent([d]);}});};})();(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.api.setting");a.init=function(){var d=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("OPT");var e=Ext.create("Ext.data.ArrayStore",{storeId:"productiveHoursComputation",fields:["name","label"],autoLoad:true,data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.create("Ext.data.ArrayStore",{storeId:"availableHoursComputation",fields:["name","label"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});function b(g,f){differenceInArr=[];coupledArr=g.concat(f);for(i=0;i<=coupledArr.length;i++){current=coupledArr[i];if(coupledArr.indexOf(current)==coupledArr.lastIndexOf(current)){if(current!==undefined){differenceInArr.push(current);}}}return differenceInArr;}function c(f,h){var g=f.length;while(g--){if(f[g]===h){return true;}}return false;}Ext.define("com.servicemax.client.opt.ui.settings.setting",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.svmx.setting",layout:"column",id:"opt-right-container",title:d.T("TAG073","Settings"),__runOpts:null,constructor:function(g){var f=g.engine;g=Ext.apply({items:[{margin:"0 0 0 10",columnWidth:0.5,xtype:"fieldset",title:d.T("TAG074","Productive Hours Computation"),layout:"anchor",defaultType:"textfield",items:[{xtype:"combobox",margin:"-8 0 1 0",editable:false,columnWidth:1,width:350,padding:10,id:"productive-hours-computation",fieldLabel:d.T("TAG078","Select one or more type(s) of activity for Productive Hour Computation"),labelAlign:"top",multiSelect:true,name:"label",labelField:"label",valueField:"name",displayField:"label",queryMode:"local",deliveryEngine:f,store:Ext.data.StoreManager.lookup("productiveHoursComputation"),valueField:"label",listeners:{change:function(h,n,m){var j=Ext.getCmp("available-hours-computation");var l=j.getValue();var r=b(n,m);if(m!==undefined){if(r!="Drive Time"){if(l.length!=0){var q=n;copyOfproductiveHourValues=q.slice(0);for(var k=0;k<copyOfproductiveHourValues.length;k++){if(copyOfproductiveHourValues[k]==="Drive Time"){copyOfproductiveHourValues.splice(k,1);break;}}var p=l.concat(copyOfproductiveHourValues);var o=p.filter(function(s,t){return p.indexOf(s)==t;});j.setValue(o);}else{for(var k=0;k<n.length;k++){if(n[k]==="Drive Time"){n.splice(k,1);break;}}j.setValue(n);}}}else{if(r!="Drive Time"){if(l.length!=0){var q=n;var p=l.concat(q);var o=p.filter(function(s,t){return p.indexOf(s)==t;});j.setValue(o);}else{j.setValue(n);}}}}}}]},{fieldDefaults:{labelAlign:"left",labelWidth:90,anchor:"100%",msgTarget:"side"},margin:"0 10 0 10",xtype:"fieldset",columnWidth:0.5,title:d.T("TAG075","Available Hours Computation"),layout:"anchor",defaultType:"textfield",items:[{xtype:"combobox",editable:false,columnWidth:1,width:350,padding:10,margin:"-8 0 1 0",id:"available-hours-computation",cls:"spm-opt-config-date",fieldLabel:d.T("TAG079","Select one or more type(s) of activity for Available Hour Computation"),labelAlign:"top",multiSelect:true,name:"label",labelField:"label",valueField:"name",displayField:"label",queryMode:"local",deliveryEngine:f,store:Ext.data.StoreManager.lookup("availableHoursComputation"),valueField:"label",listeners:{change:function(h,o,n){var l=Ext.getCmp("productive-hours-computation");var k=Ext.getCmp("available-hours-computation");var m=k.getValue();var q=l.getValue();var m=o;if(n!==undefined){var r=b(o,n);var p=c(n,r[0]);if(p){var s=c(q,r[0]);if(s){m.push(r[0]);var j=m.filter(function(t,u){return m.indexOf(t)==u;});k.setValue(m);}}}}}}]},{margin:"30 11 0 10",padding:"20 0 20 20",xtype:"fieldset",columnWidth:1,layout:"anchor",items:[{xtype:"component",cls:"text-strong",html:d.T("TAG022","Send success notifications to this email address:"),margin:"0 0 10 0",anchor:"90%"},{xtype:"textfield",id:"notification-email-opt",name:"email",anchor:"60%",vtype:"email",msgTarget:"start",allowBlank:false}]},{margin:"30 0 0 10",xtype:"fieldset",columnWidth:1,layout:"anchor",border:false,align:"right",layout:{type:"vbox",align:"right"},items:[{xtype:"tbfill"},{xtype:"svmx.button",text:d.T("TAG094","Save"),cls:"spm-opt-button",id:"opt-save-configuration-btn",deliveryEngine:f,handler:function(){var j=[];var h=Ext.getCmp("available-hours-computation").displayTplData;for(var l=0;l<h.length;l++){j.push(h[l].label);}var m=[];var n=Ext.getCmp("productive-hours-computation").displayTplData;
for(var l=0;l<n.length;l++){m.push(n[l].label);}var k=Ext.getCmp("notification-email-opt").getValue();configurationParam={settings:{emailId:k,availableHours:j.toString(),productiveHours:m.toString()}};this.deliveryEngine.saveOptConfigurationHandler(configurationParam);Ext.getCmp("opt-save-configuration-btn").disable();}}]}]},g||{});this.callParent([g]);}});};})();