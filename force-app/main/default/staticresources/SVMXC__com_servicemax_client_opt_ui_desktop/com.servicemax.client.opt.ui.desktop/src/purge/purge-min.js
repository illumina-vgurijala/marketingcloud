(function(){var a=SVMX.Package("com.servicemax.client.opt.ui.desktop.api.purge");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("OPT");Ext.create("Ext.data.Store",{storeId:"jobsStorePurge",fields:["jobId","processName","startDate","endDate"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.create("Ext.data.ArrayStore",{storeId:"dispatchProcessNamePurge",fields:["name","label"],data:{},proxy:{type:"memory",reader:{type:"json",root:"items"}}});Ext.define("com.servicemax.client.opt.ui.purge.purge",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.svmx.purge",layout:"column",title:b.T("TAG096","Purge"),__runOpts:null,constructor:function(d){var c=d.engine;d=Ext.apply({items:[{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"button",text:b.T("TAG091","Purge Latest Run"),cls:"spm-opt-button",id:"opt-purge-latest-run-btn",deliveryEngine:c,handler:function(){var e=this;Ext.MessageBox.confirm({title:b.T("101","Confirm"),msg:b.T("102","Are you sure ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:b.T("103","Yes"),no:b.T("104","No")},icon:Ext.MessageBox.QUESTION,fn:function(f,g){if(f=="yes"){e.deliveryEngine.purgeLatestRunHandler();Ext.getCmp("opt-purge-latest-run-btn").disable();}}});}}]},{margin:"10 0 8 0",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"center"},items:[{xtype:"label",text:"-"+b.T("TAG082","Or")+"-"}]},{margin:"0 0 20 10",columnWidth:1,xtype:"fieldset",title:b.T("TAG092","Purge by Timeframe"),layout:"anchor",minHeight:551,height:"100%",defaultType:"textfield",items:[{margin:"10 0 20 0",padding:"10 10 10 10",width:812,xtype:"fieldset",title:b.T("TAG084","Select Filters"),items:[{layout:"column",border:false,items:[{xtype:"datefield",columnWidth:0.5,anchor:"100%",fieldLabel:b.T("TAG089","Start Date"),cls:"spm-opt-config-start-date",margin:"0 30 0 0",name:"from_date",format:"Y-m-d",maxValue:new Date(),id:"purge_from_date",value:new Date()},{xtype:"datefield",columnWidth:0.5,anchor:"100%",fieldLabel:b.T("TAG090","End Date"),cls:"spm-opt-config-end-date",margin:"0 30 0 0",id:"purge_to_date",format:"Y-m-d",name:"to_date",value:new Date()}]},{layout:"column",border:false,items:[{margin:"30 30 20 0",columnWidth:1,xtype:"combobox",fieldLabel:b.T("TAG085","Dispatch Process Name"),displayField:"label",valueField:"name",cls:"spm-opt-dispatch-process",id:"dispatch-process-name-purge",labelWidth:150,editable:false,deliveryEngine:c,name:"label",labelField:"label",valueField:"name",displayField:"label",queryMode:"local",store:Ext.data.StoreManager.lookup("dispatchProcessNamePurge")}]},{xtype:"fieldset",columnWidth:1,border:false,margin:"0 20 0 0",layout:{type:"vbox",align:"right"},items:[{xtype:"svmx.button",text:b.T("TAG086","Find Runs"),cls:"spm-opt-button",id:"opt-find-run-purge",deliveryEngine:c,handler:function(){var g=Ext.getCmp("purge_from_date").getSubmitValue();var f=Ext.getCmp("purge_to_date").getSubmitValue();if(Ext.getCmp("dispatch-process-name-purge").displayTplData[0]!=undefined){var e=Ext.getCmp("dispatch-process-name-purge").displayTplData[0].label;}param={startDate:g,endDate:f,processName:e,isPurge:"true"};if((Date.parse(g)>Date.parse(f))){Ext.MessageBox.alert("Status",b.T("TAG097","Start Date should be earlier that End Date"));return false;}else{if(g==""){Ext.MessageBox.alert("Status",b.T("TAG098","Select Start Date"));return false;}else{if(f==""){Ext.MessageBox.alert("Status",b.T("TAG099","Select End date"));return false;}}}this.deliveryEngine.getJobListForPurgeHandler(param);Ext.getCmp("opt-find-run-purge").disable();}}]}]},purgeTable=Ext.create("Ext.grid.Panel",{title:b.T("TAG096","All Runs"),selType:"checkboxmodel",minHeight:250,height:250,width:812,selModel:{checkOnly:false,mode:"MULTI",columnSelect:true,checkboxSelect:true,pruneRemoved:false},id:"getpurgedatagrid",xtype:"checkboxgroup",store:Ext.data.StoreManager.lookup("jobsStorePurge"),columns:[{text:b.T("TAG087","Job Id"),dataIndex:"jobId",width:110,sortable:false,menuDisabled:true},{text:b.T("TAG088","Dispatch Process Name"),dataIndex:"processName",width:300,sortable:false,menuDisabled:true},{text:b.T("TAG089","Start Date"),dataIndex:"startDate",width:200,sortable:false,menuDisabled:true},{text:b.T("TAG090","End Date"),dataIndex:"endDate",width:200,sortable:false,menuDisabled:true}]}),purgeTable.on("viewready",function(){purgeTable.getSelectionModel().selectAll();}),{margin:"10 20 0 10",xtype:"fieldset",columnWidth:1,border:false,layout:{type:"vbox",align:"right"},items:[{xtype:"button",text:b.T("TAG093","Purge Selected Runs"),cls:"spm-opt-button",id:"purge-selected-run-btn",deliveryEngine:c,handler:function(){var g=Ext.getCmp("getpurgedatagrid");var j=g.getSelectionModel();var e=[];for(i=0;i<g.store.getCount();i++){if(j.isSelected(i)){e.push(g.store.getAt(i).data.jobId);}}var h=e.toString();param={jobsId:h};if(e.length<=0){Ext.MessageBox.alert("Status",b.T("TAG100","Select one or more job(s)"));
return false;}var f=this;Ext.MessageBox.confirm({title:b.T("101","Confirm"),msg:b.T("102","Are you sure ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:b.T("103","Yes"),no:b.T("104","No")},icon:Ext.MessageBox.QUESTION,fn:function(k,l){if(k=="yes"){f.deliveryEngine.purgeSelectedRunsHandler(param);Ext.getCmp("purge-selected-run-btn").disable();}}});}}]}]}]},d||{});this.callParent([d]);}});};})();