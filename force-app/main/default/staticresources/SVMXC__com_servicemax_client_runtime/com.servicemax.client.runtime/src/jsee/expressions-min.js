(function(){var JSEE=function(){function $LC(a){return(typeof a==="string")?a.toLowerCase():a;}function $ADD(a,b){return a+b;}function $SUB(a,b){return a-b;}function $ISNULL(a){if(a||a===0||a===false){return false;}else{return true;}}function $ISNOTNULL(a){if(a||a===0||a===false){return true;}else{return false;}}function $EQ(a,b,allowNull){if(!allowNull&&a!==b&&($ISNULL(a)||$ISNULL(b))){return CONSTANTS.INVALID;}if(a instanceof Date){a=a.getTime();}if(b instanceof Date){b=b.getTime();}return $LC(a)===$LC(b);}function $NE(a,b){if($ISNULL(a)||$ISNULL(b)){return false;}var result=$EQ(a,b,true);return !result;}function $GT(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return $LC(a)>$LC(b);}function $LT(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return $LC(a)<$LC(b);}function $GE(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return $LC(a)>=$LC(b);}function $LE(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return $LC(a)<=$LC(b);}function $STARTS(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return String(a).toLowerCase().indexOf($LC(b))===0;}function $CONTAINS(a,b){if($ISNULL(a)||$ISNULL(b)){return CONSTANTS.INVALID;}return String(a).toLowerCase().indexOf($LC(b))!==-1;}function $NOTCONTAINS(a,b){return String(a).toLowerCase().indexOf($LC(b))===-1;}function $IN(inList,inValue){if($ISNULL(inValue)||$ISNULL(inList)){return CONSTANTS.INVALID;}var tmpArray=String(inList).toLowerCase().split(/[,;]/);return SVMX.array.indexOf(tmpArray,String(inValue).toLowerCase())!==-1;}function $NOTIN(inList,inValue){var result=$IN(inList,inValue);if(result===0){return CONSTANTS.INVALID;}return !result;}function $NUMBER(inValue){if($ISNULL(inValue)){return null;}return Number(inValue);}function $BOOLEAN(inValue){if(!inValue){return false;}var value=String(inValue).toLowerCase();if(value==="false"){return false;}return true;}function $DATE(inValue){if($ISNULL(inValue)){return null;}return com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDate(inValue);}function $LOCALDATETIME(inValue){if($ISNULL(inValue)){return null;}var rst=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseGMTDate(inValue);return rst;}function $TIMEZONEDATE(inValue){if($ISNULL(inValue)){return null;}var rst=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(com.servicemax.client.lib.datetimeutils.DatetimeUtil.getFormattedDatetime(inValue,"YYYY-MM-DD HH:mm:ss"),com.servicemax.client.lib.datetimeutils.DatetimeUtil.getLocalUTCOffset()*-1,false);return rst;}function $DISPLAYDATETIME(inValue){if($ISNULL(inValue)){return null;}return com.servicemax.client.lib.datetimeutils.DatetimeUtil.getFormattedDatetime(inValue,"YYYY-MM-DD","HH:mm:ss");}function $DATEEQ(a,b){if(!a||!b){return CONSTANTS.INVALID;}a=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(a);b=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(b);return a.getTime()===b.getTime();}function $DATENE(a,b){if(!a||!b){return CONSTANTS.INVALID;}return !$DATEEQ(a,b);}function $DATEGT(a,b){if(!a||!b){return CONSTANTS.INVALID;}a=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(a);b=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(b);return a.getTime()>b.getTime();}function $DATEGE(a,b){if(!a||!b){return CONSTANTS.INVALID;}a=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(a);b=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(b);return a.getTime()>=b.getTime();}function $DATELT(a,b){if(!a||!b){return CONSTANTS.INVALID;}a=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(a);b=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(b);return a.getTime()<b.getTime();}function $DATELE(a,b){if(!a||!b){return CONSTANTS.INVALID;}a=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(a);b=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(b);return a.getTime()<=b.getTime();}function $DATETODAY(){var today=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime("today","YYYY-MM-DD","HH:mm:ss");today=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(today);return today;}function $DATETOMORROW(){var tomorrow=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime("tomorrow","YYYY-MM-DD","HH:mm:ss");tomorrow=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(tomorrow);return tomorrow;}function $DATEYESTERDAY(){var yesterday=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime("yesterday","YYYY-MM-DD","HH:mm:ss");yesterday=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseDateOnly(yesterday);return yesterday;}function $DATENOW(){var now=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime("now","YYYY-MM-DD","HH:mm:ss");now=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseGMTDate(now);return now;}function $SORT(items,fieldOrFunc){if(typeof(fieldOrFunc)!="string"){return;
}var i,l=items.length;if(l<2){return items;}for(i=0;i<(l-1);){var k=0;for(;k<(l-1);k++){if(items[k][fieldOrFunc]>items[k+1][fieldOrFunc]){var temp=items[k];items[k]=items[k+1];items[k+1]=temp;}}l--;}return items;}function $FORMAT(){return SVMX.format(arguments);}this.evalExpressions=function(exprs,context,callback,callbackContext,async){var bReturned=false,results=[];function $RETURN(value){if(bReturned){throw new Error("Attempted to RETURN twice in the same expression!");}bReturned=true;callback.call(callbackContext,value);}(function(exprs,context,callback,callbackContext,async){context=SVMX.toObject(context);var scopeExpr=[];for(var key in context){if(context.hasOwnProperty(key)){scopeExpr.push("var "+key+" = context."+key+";");}}eval(scopeExpr.join("\n"));SVMX.array.forEach(exprs,function(expr,i){results[i]=eval(expr);logger.info(expr+" = "+results[i]);});})(exprs,context,callback,callbackContext,async);if(!async&&callback){callback.call(callbackContext,results);}return results;};};var expressionEngine=new JSEE();var logger=SVMX.getLoggingService().getLogger("SVMX-expressions");SVMX.executeExpressions=function(exprs,context,callback,callbackContext,async){try{var ret=expressionEngine.evalExpressions($.isArray(exprs)?exprs:[exprs],context,callback,callbackContext,async);}catch(e){logger.error("executeExpression: error in expression: "+exprs);}return $.isArray(exprs)?ret:ret[0];};var CONSTANTS={INVALID:0};SVMX.executeExpressionsResultInvalid=function(result){return result===CONSTANTS.INVALID;};})();