(function(){var a=SVMX.Package("com.servicemax.client.admin.appfilters.engine");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("APFT");a.Class("DeliveryEngineImpl",com.servicemax.client.sfmconsole.api.AbstractDeliveryEngine,{__root:null,__loadMask:null,__isContainerExternal:null,__parent:null,__translation:null,__view:null,__constructor:function(){this.__base();this.__isContainerExternal=false;},initAsync:function(c){var d=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.admin.appfilters.impl.APFTEngineEventBus",{});d.createNamedInstanceAsync("CONTROLLER",{handler:function(e){d.createNamedInstanceAsync("MODEL",{handler:function(f){e.setModel(f);d.createNamedInstanceAsync("APFT.VIEW",{handler:function(g){this.__view=g;c.handler.call(c.context);},context:this,additionalParams:{eventBus:this.getEventBus()}});},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});},getEventBus:function(){return this.__eventBus;},translate:function(c){return b.T(c);},getAllTranslation:function(){return this.__translation;},__appCurrentState:"",changeApplicationState:function(c){if(this.__appCurrentState===c){return;}this.__appCurrentState=c;if(c=="block"){if(!this.__loadMask){this.__loadMask=new com.servicemax.client.ui.components.utils.LoadMask({parent:this.__root});}this.__loadMask.show({});this.__loadMask.setZIndex(50000);}else{if(c=="unblock"&&this.__loadMask!==null){if(this.__loadMask!==null){this.__loadMask.hide();}}}},reset:function(){this.getRoot().destroy();this.__root=null;this.run(this.options);},triggerEvent:function(c){this.__eventBus.triggerEvent(c);},run:function(e){this.options=e||{};var d=SVMX.create("com.servicemax.client.admin.appfilters.responders.GetSupportedRecordTypesResponder",this);var f={};var c=SVMX.create("com.servicemax.client.lib.api.Event","APFT.GET_SUPPORTED_RECORD_TYPES",this,{request:f,responder:d});this.triggerEvent(c);},onGetSupportedRecordTypesCompleted:function(c){var f=c.objectInfoList;var g=[{label:b.T("TAG003","--None--"),name:"None"}];for(var d=0;d<f.length;d++){g.push(f[d]);}this.__metaModel=SVMX.create("com.servicemax.client.admin.appfilters.engine.APFTMetaModel",this,g);this.__metaModel.initialize();this.__root=this.__view.createComponent("ROOTCONTAINER",{metaModel:this.__metaModel,deliveryEngine:this});this.__root.run({});this.__root.render(SVMX.getDisplayRootId());var e=(this.__isContainerExternal)?Ext.getDom("client_display_root").parentNode.clientHeight:Ext.getBody().getViewSize().height;if(!SVMX.getClient().getApplicationParameter("svmx-sfm-no-window-resize")){SVMX.onWindowResize(function(){var h=Ext.getBody().getViewSize().height;var j=Ext.getBody().getViewSize().width;if(this.__isContainerExternal){if(!!this.__parent){h=Math.max(document.documentElement.clientHeight,window.innerHeight||0);j=Math.max(document.documentElement.clientWidth,window.innerWidth||0);h=(h>0)?(h-this.__parent.heightOffset):h;j=(j>0)?(j-this.__parent.widthOffset):j;}else{h=Ext.getDom("client_display_root").parentNode.clientHeight;j=Ext.getDom("client_display_root").parentNode.clientWidth;}}var i={width:j,height:h};this.onResize(i);},this);}this.__root.setHeight(e);if(this.options.onReady){this.options.onReady.handler.call(this.options.onReady.context||this);}},getAllSourceObjects:function(f){this.changeApplicationState("block");var e={recordTypeName:f};var d=SVMX.create("com.servicemax.client.admin.appfilters.responders.GetAllSourceObjectsResponder",this);var c=SVMX.create("com.servicemax.client.lib.api.Event","APFT.GET_ALL_SOURCE_OBJECTS",this,{request:e,responder:d});this.triggerEvent(c);},onGetAllSourceObjectsCompleted:function(c){if(!c.success){this.showMessage(c.message,b.T("TAG018","Failure"));this.changeApplicationState("unblock");return;}var e=c.objectInfoList;var f=[{label:b.T("TAG003","--None--"),name:"None"}];for(var d=0;d<e.length;d++){f.push(e[d]);}this.__root.__objectListStore.loadData(f);this.changeApplicationState("unblock");},getApplicationFilter:function(e,g){this.changeApplicationState("block");var f={recordTypeName:e,sourceObjectName:g};var d=SVMX.create("com.servicemax.client.admin.appfilters.responders.GetApplicationFilterResponder",this);var c=SVMX.create("com.servicemax.client.lib.api.Event","APFT.GET_APPLICATION_FILTER",this,{request:f,responder:d});this.triggerEvent(c);},onGetApplicationFilterCompleted:function(c){if(!c.success){this.showMessage(c.message,b.T("TAG018","Failure"));this.changeApplicationState("unblock");return;}var d=c.filterInfoList;this.__root.__lastModifiedDateOfRecords=c.lastModifiedOn;this.__root.__tableStore.loadData(d);this.__root.__searchtext.setValue("");this.__root.__resultsViewPanel.store.sync();this.changeApplicationState("unblock");},saveApplicationFilter:function(c){this.changeApplicationState("block");var f=this.transformModifiedRecordsInRequest(c);
var e=SVMX.create("com.servicemax.client.admin.appfilters.responders.SaveApplicationFilterResponder",this);var d=SVMX.create("com.servicemax.client.lib.api.Event","APFT.SAVE_APPLICATION_FILTER",this,{request:f,responder:e});this.triggerEvent(d);},onSaveApplicationFilterCompleted:function(c){this.changeApplicationState("unblock");if(c.success){this.__root.__lastModifiedDateOfRecords=c.lastModifiedOn;this.__root.__searchtext.setValue("");this.__root.__resultsViewPanel.store.sync();this.__root.__saveButton.setDisabled(true);this.showMessage(c.message,b.T("TAG017","Success"));}else{this.showMessage(c.message,b.T("TAG018","Failure"));}},transformModifiedRecordsInRequest:function(d){var f=[];var h=this.__root.__lastModifiedDateOfRecords;var c=this.__root.__filterListDropDown.getValue();for(var e=0;e<d.length;e++){if(d[e].dirty){f.push(SVMX.cloneObject(d[e].data));f[e].processId=Ext.String.htmlDecode(f[e].processId);}}var g={lastModifiedOn:h,recordTypeName:c,filterInfoList:f};return g;},showMessage:function(c,d){c=Ext.String.htmlEncode(c);Ext.Msg.show({title:d,msg:c,width:300,closable:false,buttons:Ext.Msg.OK,buttonText:{ok:b.T("TAG020","OK")},fn:function(f,g,e){}});},getRoot:function(){return this.__root;},onResize:function(c){this.getRoot().resize(c);}},{});a.Class("APFTMetaModel",com.servicemax.client.lib.api.Object,{__parent:null,__data:null,__constructor:function(c,d){this.__parent=c;this.__data=d;},initialize:function(){},getQuestionInfo:function(){return this.__data;},addQuestionList:function(c){this.__data=c;},destroy:function(){this.__data=null;}},{});};})();