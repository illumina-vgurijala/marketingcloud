(function(){var a=SVMX.Package("com.servicemax.client.sal.sfmconsole.model.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{useJsr:false,__constructor:function(){this.__base();this.__self.instance=this;this.__logger=SVMX.getLoggingService().getLogger("SAL-MODEL");},beforeInitialize:function(){},initialize:function(){var b=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if(b&&b===true){this.useJsr=true;this.__logger.info("JSR is enabled. Will use this for server communication.");}else{this.useJsr=false;}},afterInitialize:function(){com.servicemax.client.sal.model.sfmconsole.operations.init();},registerForSALEvents:function(b,c){if(!c){SVMX.getLoggingService().getLogger().warn("registerForSALEvents was invoked without operationObj!");}b.bind("REQUEST_ERROR",function(j){var f=c?c.getEventBus():SVMX.getCurrentApplication();var d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CHANGE_APP_STATE",this,{request:{state:"unblock"},responder:{}});f.triggerEvent(d);var h=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SFMDELIVERY");var g=h.T("TAG015");try{g+="::"+j.data.xhr.statusText+"=>"+j.data.xhr.responseText;}catch(i){}d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",this,{request:{message:g},responder:{}});f.triggerEvent(d);this.__logger.error(g);},this);},createServiceRequest:function(d,c){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sal.service.factory");b.getInstanceAsync({handler:function(e){var f=d.options||{};var h={type:f.type||"REST",endPoint:f.endPoint||"SFMDeliveryServiceIntf",nameSpace:f.namespace===null?null:SVMX.OrgNamespace};var i=e.createServiceManager(h);var g=i.createService();this.registerForSALEvents(g,c);d.handler.call(d.context,g);},context:this});},getErrorMessage:function(e){var c=true,d="",b="";if(e){if(e.response&&(e.response.success===false||e.response.success==="false")){c=false;if(e.response.msgDetails&&e.response.msgDetails.message){d=e.response.msgDetails.message;b=e.response.msgDetails.details;}else{d=e.response.message;}}else{if(e.success===false||e.success==="false"){c=false;if(e.msgDetails&&e.msgDetails.message){d=e.msgDetails.message;b=e.msgDetails.details;}else{d=e.message;}}}}if(b){this.__logger.error(d+"; "+b);}return d||!c;}},{instance:null});})();(function(){var a=SVMX.Package("com.servicemax.client.sal.model.sfmconsole.operations");a.init=function(){var b=com.servicemax.client.sal.sfmconsole.model.impl.Module;a.Class("RetrieveDisplayTags",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(g,f){var n=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.translation").getInstance();if(window.svmx_display_tags){SVMX.forEachProperty(window.svmx_display_tags,function(q,i){n.addData(i,q);});f.result(n);return;}var p=g.moduleIds;if(p.length==0){f.result(n);return;}var h=p[0];var k=h["module-id"];var e=h["local-id"]||"IPAD";var c=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.cache");var d=b.instance;var m=p.length;var l="";var o=SVMX.proxy(this,function(t,s){var r={moduleId:t};var q=r.moduleId+"-DISPLAY_TAGS";var i=c?c.getItem(q):null;if(i){setTimeout(function(){n.addData(i,s);m--;if(m===0){if(!l){f.result(n);}else{f.fault(n,l);}}},1);}else{if(b.instance.useJsr){SVMXJsr.JsrRetrieveDisplayTags(r,function(u,v){var w=d.getErrorMessage(u);if(!w&&c){c.setItem(q,u);}if(!w){n.addData(u,s);}else{l+=w+"; ";}m--;if(m===0){if(!l){f.result(n);}else{f.fault(n,l);}}},this);}else{b.instance.createServiceRequest({handler:function(u){u.bind("REQUEST_COMPLETED",function(v){var w=d.getErrorMessage(v.data);if(!w&&c){c.setItem(q,v.data);}if(!w){n.addData(v.data,s);}else{l+=w+"; ";}m--;if(m===0){if(!l){f.result(n);}else{f.fault(n,l);}}},this);u.callMethodAsync({methodName:"retrieveDisplayTags",data:r});},context:this},this);}}});for(var j=0;j<p.length;j++){o(p[j]["module-id"],p[j]["local-id"]);}}},{});};})();