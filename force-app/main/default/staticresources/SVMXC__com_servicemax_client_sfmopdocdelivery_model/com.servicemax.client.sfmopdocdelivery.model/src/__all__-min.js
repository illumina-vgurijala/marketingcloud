(function(){var a=SVMX.Package("com.servicemax.client.sfmopdocdelivery.model.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__constructor:function(){this.__base();},beforeInitialize:function(){com.servicemax.client.sfmopdocdelivery.model.operations.init();},initialize:function(){SVMX.getClient().bind("SFMOPDOCDELIVERY.JSEE_CREATED",function(b){var c=b.data.jsee;var e={},d=this;c.addInterceptor("$IMAGE",function(h,i){if(i&&i.node){if(e[h]!=null){$(i.node).attr("src",e[h]);}else{var g=new com.servicemax.client.sfmopdocdelivery.model.operations.SubmitQuery();i.pendingNodeItems.addItem(h,h);var f=g._performInternal({queryConfig:{api:"Document",fields:"Id, Description",condition:"DeveloperName='"+h+"'"}},function(j){i.pendingNodeItems.removeItem(h);if(j&&j.Result.length>0){var l=j.Result[0].Id;var k=SVMX.getClient().getApplicationParameter("svmx-base-url");if(k){if(k.indexOf("/")!=0){k="/"+k;}}else{k="";}e[h]=k+"/servlet/servlet.FileDownload?file="+l;$(i.node).attr("src",e[h]);}},d);}}else{if(c!=null&&c.getProperty("ImageNameId")&&c.getProperty("ImageNameId")[h]){return"/servlet/servlet.FileDownload?file="+c.getProperty("ImageNameId")[h];}else{SVMX.getLoggingService().getLogger().error("Image was not found in collection: "+h);return"";}}});});}},{});a.Class("CacheService",com.servicemax.client.lib.api.Object,{__constructor:function(){},getItem:function(b){return null;},setItem:function(b,c){},clear:function(b){},reset:function(){}},{});a.Class("PlatformSpecifics",com.servicemax.client.lib.api.Object,{__constructor:function(){},getQualificationInfo:function(c,e,g,d){var f=window.svmx_sfm_opdoc_delivery_is_qualified===undefined?true:window.svmx_sfm_opdoc_delivery_is_qualified;var b=window.svmx_sfm_opdoc_delivery_error_message===undefined?"":window.svmx_sfm_opdoc_delivery_error_message;g.call(d,{isQualified:f,errorMessage:b});},navigateBack:function(b){if(b&&b!=""){if(b.indexOf("%2F")!=-1){b="/"+b.substring(3,b.length);}SVMX.navigateTo(b);}},alert:function(b){alert(b);},confirm:function(b){return confirm(b);},getSettingsInfo:function(){var d=window.svmx_sfm_opdoc_delivery_settings===undefined?{}:window.svmx_sfm_opdoc_delivery_settings;var c={};if(d.length>0){d=SVMX.toObject(d);var e=0,b=d.stringMap.length;for(e=0;e<b;e++){c[d.stringMap[e].key]=d.stringMap[e].value;}}return c;}},{});})();(function(){var a=SVMX.Package("com.servicemax.client.sfmopdocdelivery.model.operations");a.init=function(){a.Class("GetUserInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={};SvmxOpDocDeliveryJsr.JsrGetUserInfo(c,function(e,f){if(UserContext){var g=UserContext.timeFormat;e.TimeFormat=g;if(UserContext.ampm){e.amText=UserContext.ampm[0];e.pmText=UserContext.ampm[1];}e.Locale=UserContext.locale;}b.result(e);},this);}},{});a.Class("GetTemplate",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={ProcessId:d.processId};SvmxOpDocDeliveryJsr.JsrGetTemplate(c,function(e,f){b.result(e);},this);}},{});a.Class("SubmitDocument",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={Document:d.document};SvmxOpDocDeliveryJsr.JsrSubmitDocument(c,function(e,f){b.result(e);},this);}},{});a.Class("CreatePDF",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={DocumentId:d.documentId,RecordId:d.recordId,ProcessId:d.processId};SvmxOpDocDeliveryJsr.JsrCreatePDF(c,function(e,f){var h="";if(f.status==false&&f.type=="exception"){h=f.message;}else{if(e.Status==false){h=e.Message;}}if(h.length>0){var g=SVMX.getClient().getApplicationParameter("svmx-base-url");if(g){if(g.indexOf("/")!=0){g="/"+g;}}else{g="";}var i=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sfmopdoc.platformspecifics").getInstance();i.alert(h);i.navigateBack(g+d.returnUrl);}else{b.result(e);}},this);}},{});a.Class("SubmitQuery",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},_performInternal:function(e,g,c){var d=e.queryConfig;var f="SELECT "+d.fields+" FROM "+d.api;if(d.condition&&d.condition!=""){f+=" WHERE "+d.condition;}var b={Query:f};SvmxOpDocDeliveryJsr.JsrSubmitQuery(b,function(h,i){g.call(c,h);},this);},performAsync:function(c,b){}},{});a.Class("ViewDocument",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,c){var d=SVMX.getClient().getApplicationParameter("svmx-base-url");var b=SVMX.getClient().getApplicationParameter("org-name-space");if(d){if(d.indexOf("/")!=0){d="/"+d;}}else{d="";}SVMX.navigateTo(d+"/apex/"+b+"__OPDOC_DocumentViewer?SVMX_AttID="+e.attachmentId+"&SVMX_RecId="+e.recordId);}},{});a.Class("GetDocumentMetadata",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={ProcessId:d.processId};SvmxOpDocDeliveryJsr.JsrGetDocumentMetadata(c,function(e,f){b.result(e);
},this);}},{});a.Class("GetDocumentData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={ProcessId:d.processId,RecordId:d.recordId};SvmxOpDocDeliveryJsr.JsrGetDocumentData(c,function(m,l){if(m.Status==false){var e=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sfmopdoc.platformspecifics").getInstance();e.alert(m.Message);e.navigateBack(d.returnUrl);}else{var i=m.DocumentData.length;for(var j=0;j<i;j++){var f=m.DocumentData[j]["Records"];var g=m.DocumentData[j]["SpecialFields"];var k=m.DocumentData[j]["Key"];if(k!=undefined&&k.indexOf("Checklist")>=0){var h=[];SVMX.array.forEach(f,function(n){if(n[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"]!=undefined&&n[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]!=undefined){var q=h.some(function(r){return r[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"]===n[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"];});if(!q){h.push(n);}else{var p=h.filter(function(r){return r[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"]===n[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"];});if(p.length>0){var o=p[0];if(o.hasOwnProperty([SVMX.OrgNamespace+"__ChecklistMetaJSON__c"])){o[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]=o[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"].concat(n[[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]]);}}}}else{h.push(n);}});m.DocumentData[j]["Records"]=h;}}b.result(m);}},this);}},{});a.Class("DescribeObject",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={objectName:d.objectName};SvmxOpDocDeliveryJsr.JsrDescribeObject(c,function(e,f){b.result(e);},this);}},{});a.Class("TargetUpdates",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={ProcessId:d.processId,RecordId:d.recordId};SvmxOpDocDeliveryJsr.JsrTargetUpdates(c,function(e,f){b.result(d.pdf);},this);}},{});a.Class("GetDisplayTags",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,b){var c={};SvmxOpDocDeliveryJsr.JsrGetDisplayTags(c,function(e,f){b.result(e);},this);}},{});};})();