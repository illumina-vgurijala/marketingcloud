(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.config");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");var c=SVMX.getClient().getApplicationParameter("org-name-space");Ext.define("com.servicemax.client.spm.ui.config.Config",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.config",cls:"spm-edit-process-panel",layout:"anchor",header:false,border:false,cls:"spm-config-tab",listeners:{afterrender:function(){var d=this;function e(k,h,m){var j=[];for(var g in k){if(!k.hasOwnProperty(g)){continue;}if(typeof k[g]=="object"){j=j.concat(e(k[g],h,m));}else{if(g==h){if(m!=undefined){var f={exprId:k[m],Values:k[g]};}else{var f={Values:k[g]};}j.push(f);}}}return j;}d.metaModel.loadBusinessProcessConfiguration(function(f){Ext.define("MyApp.util.Utilities",{statics:{myGlobal:f}});var m=[];for(var h in f.sources){var j={exprId:f.sources[h],Values:h};m.push(j);}var p=f.expressionDetail;var o=e(p,"expressionRuleName","expressionRuleId");var g=Ext.data.StoreManager.lookup("Issue_Tracker_Store");g.setProxy({type:"memory",data:m});g.load();var n=Ext.data.StoreManager.lookup("Qualification_Criteria_Expression");n.setProxy({type:"memory",data:o});n.load();});}},initComponent:function(){this.callParent(arguments);var m=this;function h(u,t,w){var v=[];for(var s in u){if(!u.hasOwnProperty(s)){continue;}if(typeof u[s]=="object"){v=v.concat(h(u[s],t,w));}else{if(s==t){if(w!=undefined){var r={exprId:u[w],Values:u[s]};}else{var r={Values:u[s]};}v.push(r);}}}return v;}var p=SVMX.create("Ext.data.ArrayStore",{storeId:"Issue_Tracker_Store",autoLoad:false,fields:["exprId","Values"],proxy:{type:"memory"}});var d=SVMX.create("Ext.data.ArrayStore",{storeId:"Qualification_Criteria_Expression",autoLoad:false,fields:["exprId","Values"],proxy:{type:"memory"}});var q=SVMX.create("Ext.form.FieldSet",{layout:"anchor",padding:"10"});m.add(q);var j=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",id:"save-business-process-btn",layout:{type:"vbox",align:"right"},items:[{xtype:"tbfill"},{xtype:"svmx.button",tooltip:b.T("TAG089","Save Business Process Config"),text:b.T("TAG062","Save"),handler:function(){if(Ext.getCmp("source-obj-issue-tracker").valueModels.length){var t=Ext.getCmp("source-obj-issue-tracker").valueModels[0].data.exprId;}if(Ext.getCmp("qualification_expression_id").valueModels.length){if(t!=c+"__Service_Order__c"){var r=Ext.getCmp("qualification_expression_id").valueModels[0].data.exprId;}else{var r="";}}else{var r="";}var s={source:t,selectedCriteria:r};Ext.getCmp("save-business-process-btn").disable();m.metaModel.saveBusinessProcessConfiguration(s,function(u){Ext.getCmp("save-business-process-btn").enable();Ext.MessageBox.alert("Status",b.T("","Business process configuration saved successfully"));});}}]});q.add(j);var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{name:"issueTracker",fieldLabel:b.T("TAG087","Top level Issue Tracker :"),id:"source-obj-issue-tracker",editable:false,flex:1,anchor:"50%",valueField:"exprId",displayField:"Values",store:p,labelAlign:"top",padding:"10",listeners:{change:function(r,u,t){var s=Ext.getCmp("qualification-criteria-section");if(u!=c+"__Service_Order__c"){m.metaModel.loadExpressions(u,function(v){s.show();MyApp.util.Utilities.myGlobal=v;var y=MyApp.util.Utilities.myGlobal;var x=h(y.expressionDetail,"expressionRuleName","expressionRuleId");if(t!=undefined){var w=Ext.data.StoreManager.lookup("Qualification_Criteria_Expression");w.setProxy({type:"memory",data:x});w.load();}});}else{s.hide();}}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});q.add(e);var o=SVMX.create("Ext.form.FieldSet",{title:b.T("TAG088","Qualification criteria"),id:"qualification-criteria-section",layout:"anchor",padding:"10",margin:"10 0 10 10",});m.__qualificationCriteria=q.add(o);var k=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{name:"qualificationExpression",id:"qualification_expression_id",itemId:"qualification-expression",queryMode:"local",editable:false,flex:1,anchor:"49.5%",valueField:"exprId",displayField:"Values",labelAlign:"top",store:d,padding:"10",listeners:{change:function(r,w,v){var t=MyApp.util.Utilities.myGlobal;var x=t.expressionDetail;if(x.length){for(i=0,l=x.length;i<l;i++){item=x[i];if(item.expressionRuleList[0].expressionRuleId==w){var u=Ext.getCmp("expression_table_details");u.store.loadData(item.expressionRuleList[0].expressionList);var s=Ext.getCmp("advanced_expression_text");if(item.expressionRuleList[0].advancedExpression){s.show();s.setValue(item.expressionRuleList[0].advancedExpression);}else{s.hide();}}}}else{var u=Ext.getCmp("expression_table_details");u.store.loadData("");var s=Ext.getCmp("advanced_expression_text");s.setValue("");s.hide();}}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";
}}});o.add(k);var n=Ext.create("Ext.data.Store",{autoLoad:false,fields:["sequence","field","operator","value"],proxy:{type:"memory"}});var g=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",items:[{xtype:"svmx.listcomposite",columnWidth:1,hidden:false,id:"expression_table_details",columns:[{text:b.T("TAG032","Sequence"),dataIndex:"sequence",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG033","Field"),dataIndex:"field",flex:2,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG034","Operator"),dataIndex:"operator",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG035","Value"),dataIndex:"value",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}}],store:n}]});o.add(g);var f=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",items:[{xtype:"svmx.text",name:"advExpression",width:"48.8%",flex:1,id:"advanced_expression_text",hidden:true,fieldLabel:b.T("TAG031","Advanced Expression"),labelAlign:"top",readOnly:true,labelAlign:"top",}]});o.add(f);p.on("load",function(r){var s=MyApp.util.Utilities.myGlobal;if(s.businessProcessConfig){if(s.businessProcessConfig.source===undefined||s.businessProcessConfig.source===null||s.businessProcessConfig.source==""){if(r.data.items.length){Ext.getCmp("source-obj-issue-tracker").setValue(r.data.items[0].data.exprId);}else{Ext.getCmp("source-obj-issue-tracker").setValue("");}}else{Ext.getCmp("source-obj-issue-tracker").setValue(s.businessProcessConfig.source);}}else{Ext.getCmp("source-obj-issue-tracker").setValue("");}});d.on("load",function(r){var s=MyApp.util.Utilities.myGlobal;if(s.businessProcessConfig){if(s.businessProcessConfig.selectedCriteria===undefined||s.businessProcessConfig.selectedCriteria===null||s.businessProcessConfig.selectedCriteria==""){if(r.data.items.length){Ext.getCmp("qualification_expression_id").setValue(r.data.items[0].data.exprId);}else{Ext.getCmp("qualification_expression_id").setValue("");}}else{Ext.getCmp("qualification_expression_id").setValue(s.businessProcessConfig.selectedCriteria);}}});}});};})();