(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.reports");a.init=function(){var c=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");var b=true;Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.report",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.report",cls:"spm-components-container",layout:{type:"vbox",align:"stretch"},border:false,initComponent:function(){this.callParent(arguments);},loadData:function(e,d){b=(this.processId!="AccountSummary")?false:true;this.destroyProcessListPanel();this.destroyEditProcessPanel();this.listPanel=this.add({xtype:"spm.report.processlistpanel",cls:"spm-components-tab",processId:this.processId,itemId:this.tabPanelId+"_processlistpanel",fields:e.fields,data:(e&&e.records)?e.records:[],__parent:this,padding:"0 0 10 0"});},editRecord:function(d){b=(this.processId!="AccountSummary")?false:true;this.destroyEditProcessPanel();var e=this.add({flex:1,xtype:"spm.report.editprocesspanel",itemId:this.tabPanelId+"_editprocesspanel",border:false,record:d,__parent:this});},getMetaModel:function(){return this.__parent.metaModel;},getFirstDefaultProcessConfig:function(d){return this.getMetaModel().getFirstDefaultProcessConfig(d);},saveProcessConfig:function(d){d.processId=this.processId;this.__parent.saveProcessConfig(d);},deleteProcessConfig:function(d){d.processId=this.processId;this.__parent.deleteProcessConfig(d);},destroyProcessListPanel:function(){var d=this.getComponent(this.tabPanelId+"_processlistpanel");if(d){d.destroy();}},destroyEditProcessPanel:function(){var d=this.getComponent(this.tabPanelId+"_editprocesspanel");if(d){d.destroy();}}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.ProcessListPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",alias:"widget.spm.report.processlistpanel",cls:"spm-process-list-panel",hidden:false,border:false,maxHeight:172,constructor:function(d){d=Ext.apply({columns:[{dataIndex:"cSequence",flex:0.5/10,menuDisabled:true,sortable:false},{text:c.T("TAG009","Description"),dataIndex:"appliesTo",flex:7/10,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG010","Last Modified On"),dataIndex:"lastModifiedOn",flex:2/10,menuDisabled:true,sortable:false},{xtype:"actioncolumn",align:"center",flex:0.4/10,sortable:false,menuDisabled:true,items:[{tooltip:c.T("TAG012","Delete Calculation Method"),iconCls:"svmx-spm-delete-icon",disabled:b,handler:SVMX.proxy(this,function(h,n,g,k,m,f){var j=this;Ext.MessageBox.confirm({title:c.T("TAG051","Confirm"),msg:c.T("TAG076","Are you sure ? Would you like to delete this Calculation Method ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:c.T("TAG074","Yes"),no:c.T("TAG075","No")},icon:Ext.MessageBox.QUESTION,fn:function(e,o){if(e=="yes"){j.__parent.deleteProcessConfig({recordId:f.data.raw.recordId});}}});})}]}],store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_store",proxy:{type:"memory"},fields:d.fields,data:d.data}),listeners:{select:function(h,e,f,g){this.__parent.editRecord(e);}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},{tooltip:c.T("TAG011","Add Calculation Method"),xtype:"svmx.button",text:c.T("TAG071","Add"),cursor:"pointer",disabled:b,handler:SVMX.proxy(this,function(){var e=this.__parent.getFirstDefaultProcessConfig(this.processId);e={data:e,isNewRecord:true};this.__parent.editRecord(e);this.__parent.listPanel.getSelectionModel().deselectAll();})}]}]},d||{});this.callParent(arguments);}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.EditProcessPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXTabPanel",alias:"widget.spm.report.editprocesspanel",border:true,cls:"spm-edit-process-panel",initComponent:function(){this.callParent(arguments);this.tabBar.add([{xtype:"tbfill"},{xtype:"svmx.button",margin:"2 2 0 0",tooltip:c.T("TAG013","Save Calculation Method"),text:c.T("TAG062","Save"),disabled:b,handler:SVMX.proxy(this,function(){var r=this,q={};r.items.items.forEach(function(t){if(t.getData){var u=t.getData();if(t.itemId==r.id+"spm_schedule"){q.scheduleInfo=u;}else{for(var s in u){q[s]=u[s];}}}});r.__parent.saveProcessConfig(q);})},{xtype:"svmx.button",margin:"2 5 0 0",tooltip:c.T("TAG014","Cancel"),text:c.T("TAG063","Cancel"),disabled:b,handler:SVMX.proxy(this,function(){var q=this;Ext.MessageBox.confirm({title:c.T("TAG051","Confirm"),msg:c.T("TAG052","Would you like to discard your changes ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:c.T("TAG074","Yes"),no:c.T("TAG075","No")},icon:Ext.MessageBox.QUESTION,fn:function(r,s){if(r=="yes"){q.__parent.destroyEditProcessPanel();q.__parent.listPanel.getSelectionModel().deselectAll();}}});})}]);if(!this.record){return;}var j=this;var h=j.record.isNewRecord||false;var f=j.record.data||{};var g=[];var e=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG065","Metric Information"),layout:"column",padding:"10",defaults:{padding:"10px",labelAlign:"top"}});
g.push(e);var d=["isActive","sourceObjectLabel","targetObjectLabel","appliesTo"];if(f.method==="SPMMTBF: Standard"){d=["isActive","sourceObjectLabel","targetObjectLabel","entryTypeForMTBF","appliesTo"];}if(f.entryTypeForMTBF===""||f.entryTypeForMTBF===null||h){f.entryTypeForMTBF="Multiple_MTBF";}SVMX.array.forEach(d,function(q){if(!(q in f)){return;}switch(q){case"name":e.add({fieldLabel:"Name",name:q,readOnly:true});break;case"isActive":e.add({xtype:"checkbox",boxLabel:c.T("TAG050","Active"),readOnly:b,name:q,value:f[q],columnWidth:1,labelAlign:"top"});break;case"method_values":e.add({xtype:"svmx.picklist",name:"method",fieldLabel:c.T("TAG008","Calculation Method"),displayField:"name",valueField:"name",value:f.method,hidden:true,columnWidth:1,labelAlign:"top",store:Ext.create("Ext.data.Store",{storeId:j.id+"_"+q+"_store",fields:["name"],data:f[q],proxy:{type:"memory"}}),listeners:{change:function(s,r){}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});break;case"entryTypeForMTBF":e.add({xtype:"svmx.picklist",name:"entryTypeForMTBF",fieldLabel:c.T("TAG090","Define how many entries must be maintained per Installed Product in this metric"),displayField:"label",valueField:"name",value:f.entryTypeForMTBF,columnWidth:1,labelAlign:"top",editable:false,readOnly:!h,store:Ext.create("Ext.data.Store",{storeId:"entryTypeForMTBFStore",fields:["label","name"],data:[{name:"Single_MTBF",label:c.T("TAG091","Single MTBF")},{name:"Multiple_MTBF",label:c.T("TAG092","Multiple MTBF")},],proxy:{type:"memory"}}),listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});break;case"appliesTo":e.add({xtype:"svmx.textarea",labelAlign:"top",columnWidth:1,readOnly:b,fieldLabel:c.T("TAG009","Description"),name:q});break;case"dashboardId":if(f[q]){e.add({xtype:"component",autoEl:{tag:"a",align:"right",target:"_blank",style:"text-decoration: underline !important;",href:"/../../"+f[q],html:c.T("TAG030","Launch Dashboard")}});}break;case"sourceObjectLabel":e.add({xtype:"textfield",columnWidth:1,readOnly:true,fieldLabel:c.T("TAG060","Object(s) from which this metric is derived"),name:q,value:f[q],labelAlign:"top"});break;case"targetObjectLabel":e.add({xtype:"textfield",columnWidth:1,readOnly:true,fieldLabel:c.T("TAG061","Object(s) where metrics are collected"),name:q,value:f[q],labelAlign:"top"});break;}},j);if(g.length){j.add({xtype:"form",cls:"spm-report-config-general",title:c.T("TAG055","Metric Definition"),items:g,height:"100%",header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG055","Metric Definition"),border:false,labelAlign:"top",padding:10,defaults:{padding:"10px",columnWidth:1,labelAlign:"top"},autoScroll:true,getData:function(){return this.getForm().getValues();}});}g=[];var k=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG068","Please define inputs to be used in metric calculation"),layout:"column",padding:"10",columnWidth:1});var o=this.__parent;var n=false;for(var m in f){if(m.match("_fields")){if(f[m].isCriteria==true){n=true;k.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,id:"selectbox_Id"+o.processId+f[m].componentId,fieldLabel:f[m].name,displayField:"label",valueField:"name",labelAlign:"top",padding:10,multiSelect:f[m].multiSelect,listeners:{change:function(q,s,r){if(o.processId==="FirstTimeFix"){if(s==="WorkDetail"){if(Ext.getCmp("selectbox_IdFirstTimeFixPeriod")!=undefined&&Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder")!=undefined){Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder").hide();Ext.getCmp("selectbox_IdFirstTimeFixPeriod").show();if(Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id")!=undefined&&Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id")!=undefined){Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id").up().hide();Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id").up().show();}}}if(s==="WorkOrder"){if(Ext.getCmp("selectbox_IdFirstTimeFixPeriod")!=undefined&&Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder")!=undefined){Ext.getCmp("selectbox_IdFirstTimeFixPeriod").hide();Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder").show();if(Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id")!=undefined&&Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id")!=undefined){Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id").up().show();Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id").up().hide();}}}}}},listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","label","displayType"],data:f[m].values,proxy:{type:"memory"},})});
}}}if(n){g.push(k);}var p=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG066","Please define the object mapping for this metric"),layout:"column",padding:"10",});g.push(p);for(var m in f){if(m.match("_fields")){if(f[m].isCriteria==false){p.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,fieldLabel:f[m].name,displayField:"label",valueField:"name",labelAlign:"top",padding:10,multiSelect:f[m].multiSelect,listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","label","displayType"],data:f[m].values,proxy:{type:"memory"}})});}}}for(var m in f){if(m.match("_mappings")){p.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,fieldLabel:f[m].name,displayField:"name",valueField:"mapId",labelAlign:"top",padding:10,listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","mapId"],data:f[m].values,proxy:{type:"memory"}})});}}if(g.length&&!b){j.add({xtype:"form",cls:"spm-report-config-settings",title:c.T("TAG006","Settings"),items:g,header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG056","Settings"),padding:10,defaults:{padding:"10px",columnWidth:1,labelAlign:"top"},autoScroll:true,getData:function(){return this.getForm().getValues();}});}g=[];Ext.each(f.expressions||[],function(q){g.push({xtype:"spm.report.exprpanel",columnWidth:1,itemId:j.itemId+"_expression_"+q.type,title:q.label,rules:q.rules,value:q.value});},j);if(g.length){j.add({xtype:"form",cls:"spm-report-config-criteria",title:c.T("TAG007","Criteria(s)"),items:g,autoScroll:true,header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG057","Criteria(s)"),defaults:{padding:"10px",columnWidth:0.5,labelAlign:"top"},getData:function(){var q=this.getForm().getRecord();if(!h){q=q.getData();}else{q=q.data;}var s={};Ext.each(q.expressions,function(w){var v=this.getComponent(j.itemId+"_expression_"+w.type);var x=v.getSelectedExpression();if(x){s[w.type]=x;}},this);var u=this.getForm().getValues();var t={expressions:s,raw:q.raw};if(u){for(var r in u){if(r!="advExp"){t[r]=u[r];}}}return t;}});}j.setActiveTab(0);j.loadData(j.record);},loadData:function(d){SVMX.array.forEach(this.items.items,function(e){if(e.loadRecord){e.loadRecord(d||this.record);}},this);}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.ExpressionPanel",{extend:"Ext.form.FieldSet",alias:"widget.spm.report.exprpanel",cls:"spm-report-expression-panel",id:"",layout:"column",border:false,margin:"10",labelStyle:"font-weight:bold;padding:0",defaults:{padding:"5",columnWidth:0.5,labelAlign:"top"},initComponent:function(){this.callParent(arguments);var d=this;this.add([{xtype:"svmx.picklist",itemId:d.itemId+"_expression",id:d.itemId+"fieldset_id",displayField:"name",valueField:"exprId",editable:false,store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_expression_store",fields:["exprId","name","expressions","advExp"],data:d.rules,proxy:{type:"memory"}}),listeners:{change:function(e,j){var k=e.store.data.items,h;for(i=0,l=k.length;i<l;i++){h=k[i];if(h.data.exprId==j||h.data.name==j){var g=d.getComponent(d.itemId+"_expression_details");g.store.loadData(h.data.expressions);g.show();var f=d.getComponent(d.itemId+"_advExp");if(h.data.advExp){f.setValue(h.data.advExp);f.show();}else{f.hide();}break;}}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}},{xtype:"svmx.listcomposite",columnWidth:1,itemId:d.itemId+"_expression_details",hidden:false,columns:[{text:c.T("TAG032","Sequence"),dataIndex:"sequence",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG033","Field"),dataIndex:"field",flex:2,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG034","Operator"),dataIndex:"operator",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG035","Value"),dataIndex:"value",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}}],store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_expression_grid_store",fields:["sequence","field","operator","value"],proxy:{type:"memory"}})},{xtype:"svmx.text",name:"advExp",itemId:d.itemId+"_advExp",hidden:true,fieldLabel:c.T("TAG031","Advanced Expression"),readOnly:true,columnWidth:1}]);this.items.get(this.itemId+"_expression").setValue(this.value);},getSelectedExpression:function(){return this.items.get(this.itemId+"_expression").getValue();}});};})();