(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");Ext.define("com.servicemax.client.spm.ui.desktop.api.RootContainer",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",cls:"spm-root-container",layout:"fit",width:"100%",height:650,constructor:function(c){c=Ext.apply({title:b.T("TAG001","Service Performance Metrics Setup"),titleAlign:"center",collapsible:false,header:{items:[{xtype:"svmx.button",itemId:"BackButton",padding:"0",text:b.T("TAG029","Back To Setup Home"),handler:function(h,g,d,f){if((typeof sforce!="undefined")&&(sforce!=null)){sforce.one.navigateToURL("/lightning/n/"+SVMX.OrgNamespace+"__ServiceMax_Setup");}else{window.location="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";}}}]},items:[{xtype:"svmx.tabpanel",itemId:"spm-horizontal-tab-container",defaults:{autoScroll:true,border:false,frame:false},width:"100%",height:460,activeTab:0,border:false,items:[{xtype:"spm.general",padding:"5",title:b.T("TAG002","Metrics"),metaModel:c.deliveryEngine.getMetaModel(),__parent:this,},{xtype:"spm.config",padding:"5",title:b.T("TAG086","Business Process Config"),metaModel:c.deliveryEngine.getMetaModel(),__parent:this,}],tabBar:{items:[{xtype:"tbfill"},{iconCls:"svmx-spm-help-icon ",cursor:"pointer",scale:"small",cls:"svmx-ent-help",tooltip:b.T("TAG069","SPM Help"),href:b.T("TAG070","http://userdocs.servicemax.com:8080/ServiceMaxHelp/Spring16/en_us/svmx_redirector.htm?uid=SPM|SPMConfiguration_Setup"),closable:false,}],}}],},c||{});this.callParent(arguments);}});};})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.config");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");var c=SVMX.getClient().getApplicationParameter("org-name-space");Ext.define("com.servicemax.client.spm.ui.config.Config",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.config",cls:"spm-edit-process-panel",layout:"anchor",header:false,border:false,cls:"spm-config-tab",listeners:{afterrender:function(){var d=this;function e(k,h,m){var j=[];for(var g in k){if(!k.hasOwnProperty(g)){continue;}if(typeof k[g]=="object"){j=j.concat(e(k[g],h,m));}else{if(g==h){if(m!=undefined){var f={exprId:k[m],Values:k[g]};}else{var f={Values:k[g]};}j.push(f);}}}return j;}d.metaModel.loadBusinessProcessConfiguration(function(f){Ext.define("MyApp.util.Utilities",{statics:{myGlobal:f}});var m=[];for(var h in f.sources){var j={exprId:f.sources[h],Values:h};m.push(j);}var p=f.expressionDetail;var o=e(p,"expressionRuleName","expressionRuleId");var g=Ext.data.StoreManager.lookup("Issue_Tracker_Store");g.setProxy({type:"memory",data:m});g.load();var n=Ext.data.StoreManager.lookup("Qualification_Criteria_Expression");n.setProxy({type:"memory",data:o});n.load();});}},initComponent:function(){this.callParent(arguments);var m=this;function h(u,t,w){var v=[];for(var s in u){if(!u.hasOwnProperty(s)){continue;}if(typeof u[s]=="object"){v=v.concat(h(u[s],t,w));}else{if(s==t){if(w!=undefined){var r={exprId:u[w],Values:u[s]};}else{var r={Values:u[s]};}v.push(r);}}}return v;}var p=SVMX.create("Ext.data.ArrayStore",{storeId:"Issue_Tracker_Store",autoLoad:false,fields:["exprId","Values"],proxy:{type:"memory"}});var d=SVMX.create("Ext.data.ArrayStore",{storeId:"Qualification_Criteria_Expression",autoLoad:false,fields:["exprId","Values"],proxy:{type:"memory"}});var q=SVMX.create("Ext.form.FieldSet",{layout:"anchor",padding:"10"});m.add(q);var j=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",id:"save-business-process-btn",layout:{type:"vbox",align:"right"},items:[{xtype:"tbfill"},{xtype:"svmx.button",tooltip:b.T("TAG089","Save Business Process Config"),text:b.T("TAG062","Save"),handler:function(){if(Ext.getCmp("source-obj-issue-tracker").valueModels.length){var t=Ext.getCmp("source-obj-issue-tracker").valueModels[0].data.exprId;}if(Ext.getCmp("qualification_expression_id").valueModels.length){if(t!=c+"__Service_Order__c"){var r=Ext.getCmp("qualification_expression_id").valueModels[0].data.exprId;}else{var r="";}}else{var r="";}var s={source:t,selectedCriteria:r};Ext.getCmp("save-business-process-btn").disable();m.metaModel.saveBusinessProcessConfiguration(s,function(u){Ext.getCmp("save-business-process-btn").enable();Ext.MessageBox.alert("Status",b.T("","Business process configuration saved successfully"));});}}]});q.add(j);var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{name:"issueTracker",fieldLabel:b.T("TAG087","Top level Issue Tracker :"),id:"source-obj-issue-tracker",editable:false,flex:1,anchor:"50%",valueField:"exprId",displayField:"Values",store:p,labelAlign:"top",padding:"10",listeners:{change:function(r,u,t){var s=Ext.getCmp("qualification-criteria-section");if(u!=c+"__Service_Order__c"){m.metaModel.loadExpressions(u,function(v){s.show();
MyApp.util.Utilities.myGlobal=v;var y=MyApp.util.Utilities.myGlobal;var x=h(y.expressionDetail,"expressionRuleName","expressionRuleId");if(t!=undefined){var w=Ext.data.StoreManager.lookup("Qualification_Criteria_Expression");w.setProxy({type:"memory",data:x});w.load();}});}else{s.hide();}}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});q.add(e);var o=SVMX.create("Ext.form.FieldSet",{title:b.T("TAG088","Qualification criteria"),id:"qualification-criteria-section",layout:"anchor",padding:"10",margin:"10 0 10 10",});m.__qualificationCriteria=q.add(o);var k=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{name:"qualificationExpression",id:"qualification_expression_id",itemId:"qualification-expression",queryMode:"local",editable:false,flex:1,anchor:"49.5%",valueField:"exprId",displayField:"Values",labelAlign:"top",store:d,padding:"10",listeners:{change:function(r,w,v){var t=MyApp.util.Utilities.myGlobal;var x=t.expressionDetail;if(x.length){for(i=0,l=x.length;i<l;i++){item=x[i];if(item.expressionRuleList[0].expressionRuleId==w){var u=Ext.getCmp("expression_table_details");u.store.loadData(item.expressionRuleList[0].expressionList);var s=Ext.getCmp("advanced_expression_text");if(item.expressionRuleList[0].advancedExpression){s.show();s.setValue(item.expressionRuleList[0].advancedExpression);}else{s.hide();}}}}else{var u=Ext.getCmp("expression_table_details");u.store.loadData("");var s=Ext.getCmp("advanced_expression_text");s.setValue("");s.hide();}}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});o.add(k);var n=Ext.create("Ext.data.Store",{autoLoad:false,fields:["sequence","field","operator","value"],proxy:{type:"memory"}});var g=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",items:[{xtype:"svmx.listcomposite",columnWidth:1,hidden:false,id:"expression_table_details",columns:[{text:b.T("TAG032","Sequence"),dataIndex:"sequence",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG033","Field"),dataIndex:"field",flex:2,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG034","Operator"),dataIndex:"operator",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}},{text:b.T("TAG035","Value"),dataIndex:"value",flex:1,menuDisabled:true,sortable:false,renderer:function(r){return Ext.String.htmlEncode(r);}}],store:n}]});o.add(g);var f=SVMX.create("Ext.form.FieldSet",{xtype:"toolbar",dock:"top",border:"none",items:[{xtype:"svmx.text",name:"advExpression",width:"48.8%",flex:1,id:"advanced_expression_text",hidden:true,fieldLabel:b.T("TAG031","Advanced Expression"),labelAlign:"top",readOnly:true,labelAlign:"top",}]});o.add(f);p.on("load",function(r){var s=MyApp.util.Utilities.myGlobal;if(s.businessProcessConfig){if(s.businessProcessConfig.source===undefined||s.businessProcessConfig.source===null||s.businessProcessConfig.source==""){if(r.data.items.length){Ext.getCmp("source-obj-issue-tracker").setValue(r.data.items[0].data.exprId);}else{Ext.getCmp("source-obj-issue-tracker").setValue("");}}else{Ext.getCmp("source-obj-issue-tracker").setValue(s.businessProcessConfig.source);}}else{Ext.getCmp("source-obj-issue-tracker").setValue("");}});d.on("load",function(r){var s=MyApp.util.Utilities.myGlobal;if(s.businessProcessConfig){if(s.businessProcessConfig.selectedCriteria===undefined||s.businessProcessConfig.selectedCriteria===null||s.businessProcessConfig.selectedCriteria==""){if(r.data.items.length){Ext.getCmp("qualification_expression_id").setValue(r.data.items[0].data.exprId);}else{Ext.getCmp("qualification_expression_id").setValue("");}}else{Ext.getCmp("qualification_expression_id").setValue(s.businessProcessConfig.selectedCriteria);}}});}});};})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.general");a.init=function(){var c=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");var b=function(d){if(d=="First Time Fix"){return c.T("TAG077","First Time Fix");}else{if(d=="Mean Time To Repair"){return c.T("TAG078","Mean Time To Repair");}else{if(d=="Contract Up Time"){return c.T("TAG079","Contract Up Time");}else{if(d=="Attach Rate"){return c.T("TAG080","Attach Rate");}else{if(d=="Mean Time To Complete"){return c.T("TAG081","Mean Time To Complete");}else{if(d=="Average Response Time"){return c.T("TAG082","Average Response Time");}else{if(d=="Utilization"){return c.T("TAG083","Utilization");}else{if(d=="Repeat Visit"){return c.T("TAG084","Repeat Visit");}else{if(d=="Account Summary"){return c.T("TAG085","Account Summary");}else{return d;}}}}}}}}}};Ext.define("com.servicemax.client.spm.ui.general.General",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.general",cls:"spm-edit-process-panel",layout:"anchor",header:false,border:false,cls:"spm-genral-tab",initComponent:function(){this.callParent(arguments);
var h=this.metaModel.getProcessList()||[];var g,e=h.length,f=[];for(g=0;g<e;g++){var d={xtype:"svmx.tabpanel",anchor:"100% 100%",border:false,title:b(h[g].processName),activeTab:0,defaults:{autoScroll:true,frame:false,border:false,padding:"0 0 0 0"},items:[{xtype:"spm.report",tooltip:b(h[g].processName),cls:"spm-report-general-"+g,title:c.T("TAG005","General"),processId:h[g].processId,tabPanelId:"tabPanel_"+g,__parent:this,listeners:{activate:SVMX.proxy(this,function(k,j){this.metaModel.getProcessConfig(k.processId,function(m){if(k.loadData){k.loadData(m);}});})}},{xtype:"spm.schedule",cls:"spm-report-config-schedule-tab",__parent:this,metaModel:this.metaModel,title:c.T("TAG003","Schedule & Notifications"),processId:h[g].processId,tooltip:c.T("TAG058","Schedule & Notifications"),listeners:{activate:SVMX.proxy(this,function(k,j){this.metaModel.getProcessConfig(k.processId,function(m){if(k.loadRecord){k.loadRecord({data:m.records[0]});}});})}},{xtype:"spm.status",cls:"spm-report-config-status-tab",title:c.T("TAG004","Status"),metaModel:this.metaModel,processId:h[g].processId,tooltip:c.T("TAG059","Status"),listeners:{activate:function(k,j){if(k.onActivate){k.onActivate();}}}}],tabBar:{items:[{xtype:"tbfill"},{xtype:"component",margin:"5 5 5 5",autoEl:{tag:"a",align:"right",target:"_blank",style:"text-decoration: underline !important;",href:"/../../"+h[g].dashboardId,html:(h[g].dashboardId)?c.T("TAG030","Launch Dashboard"):""}}]}};f.push(d);}this.tabPanel=this.add({xtype:"svmx.tabpanel",anchor:"100% 100%",border:false,cls:"spm-tabs-left",tabPosition:"left",itemId:"spm-general-tab-items-container",defaults:{autoScroll:true,frame:false,border:false,padding:"0 0 0 0"},items:f,activeTab:0});},saveProcessConfig:function(d,f){var e=this;if(d.appliesTo||d.scheduleInfo){e.metaModel.saveProcessConfig(d,function(g){Ext.Msg.alert(g.success?"Success":"Failed",g.message);if(g.success){var h=e.tabPanel.getActiveTab().getActiveTab();if(h.loadData){e.metaModel.getProcessConfig(d.processId,function(j){h.loadData(j);},true);}}});}else{Ext.Msg.alert("Failed",c.T("TAG064","Invalid description field value."));}},deleteProcessConfig:function(d,f){var e=this;e.metaModel.deleteProcessConfig(d,function(g){Ext.Msg.alert(g.success?"Success":"Failed",g.message);if(g.success){var h=e.tabPanel.getActiveTab().getActiveTab();if(h.loadData){e.metaModel.getProcessConfig(d.processId,function(j){h.loadData(j);},true);}}});}});};})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.reports");a.init=function(){var c=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");var b=true;Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.report",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.report",cls:"spm-components-container",layout:{type:"vbox",align:"stretch"},border:false,initComponent:function(){this.callParent(arguments);},loadData:function(e,d){b=(this.processId!="AccountSummary")?false:true;this.destroyProcessListPanel();this.destroyEditProcessPanel();this.listPanel=this.add({xtype:"spm.report.processlistpanel",cls:"spm-components-tab",processId:this.processId,itemId:this.tabPanelId+"_processlistpanel",fields:e.fields,data:(e&&e.records)?e.records:[],__parent:this,padding:"0 0 10 0"});},editRecord:function(d){b=(this.processId!="AccountSummary")?false:true;this.destroyEditProcessPanel();var e=this.add({flex:1,xtype:"spm.report.editprocesspanel",itemId:this.tabPanelId+"_editprocesspanel",border:false,record:d,__parent:this});},getMetaModel:function(){return this.__parent.metaModel;},getFirstDefaultProcessConfig:function(d){return this.getMetaModel().getFirstDefaultProcessConfig(d);},saveProcessConfig:function(d){d.processId=this.processId;this.__parent.saveProcessConfig(d);},deleteProcessConfig:function(d){d.processId=this.processId;this.__parent.deleteProcessConfig(d);},destroyProcessListPanel:function(){var d=this.getComponent(this.tabPanelId+"_processlistpanel");if(d){d.destroy();}},destroyEditProcessPanel:function(){var d=this.getComponent(this.tabPanelId+"_editprocesspanel");if(d){d.destroy();}}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.ProcessListPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",alias:"widget.spm.report.processlistpanel",cls:"spm-process-list-panel",hidden:false,border:false,maxHeight:172,constructor:function(d){d=Ext.apply({columns:[{dataIndex:"cSequence",flex:0.5/10,menuDisabled:true,sortable:false},{text:c.T("TAG009","Description"),dataIndex:"appliesTo",flex:7/10,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG010","Last Modified On"),dataIndex:"lastModifiedOn",flex:2/10,menuDisabled:true,sortable:false},{xtype:"actioncolumn",align:"center",flex:0.4/10,sortable:false,menuDisabled:true,items:[{tooltip:c.T("TAG012","Delete Calculation Method"),iconCls:"svmx-spm-delete-icon",disabled:b,handler:SVMX.proxy(this,function(h,n,g,k,m,f){var j=this;
Ext.MessageBox.confirm({title:c.T("TAG051","Confirm"),msg:c.T("TAG076","Are you sure ? Would you like to delete this Calculation Method ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:c.T("TAG074","Yes"),no:c.T("TAG075","No")},icon:Ext.MessageBox.QUESTION,fn:function(e,o){if(e=="yes"){j.__parent.deleteProcessConfig({recordId:f.data.raw.recordId});}}});})}]}],store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_store",proxy:{type:"memory"},fields:d.fields,data:d.data}),listeners:{select:function(h,e,f,g){this.__parent.editRecord(e);}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},{tooltip:c.T("TAG011","Add Calculation Method"),xtype:"svmx.button",text:c.T("TAG071","Add"),cursor:"pointer",disabled:b,handler:SVMX.proxy(this,function(){var e=this.__parent.getFirstDefaultProcessConfig(this.processId);e={data:e,isNewRecord:true};this.__parent.editRecord(e);this.__parent.listPanel.getSelectionModel().deselectAll();})}]}]},d||{});this.callParent(arguments);}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.EditProcessPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXTabPanel",alias:"widget.spm.report.editprocesspanel",border:true,cls:"spm-edit-process-panel",initComponent:function(){this.callParent(arguments);this.tabBar.add([{xtype:"tbfill"},{xtype:"svmx.button",margin:"2 2 0 0",tooltip:c.T("TAG013","Save Calculation Method"),text:c.T("TAG062","Save"),disabled:b,handler:SVMX.proxy(this,function(){var r=this,q={};r.items.items.forEach(function(t){if(t.getData){var u=t.getData();if(t.itemId==r.id+"spm_schedule"){q.scheduleInfo=u;}else{for(var s in u){q[s]=u[s];}}}});r.__parent.saveProcessConfig(q);})},{xtype:"svmx.button",margin:"2 5 0 0",tooltip:c.T("TAG014","Cancel"),text:c.T("TAG063","Cancel"),disabled:b,handler:SVMX.proxy(this,function(){var q=this;Ext.MessageBox.confirm({title:c.T("TAG051","Confirm"),msg:c.T("TAG052","Would you like to discard your changes ?"),buttons:Ext.MessageBox.YESNO,buttonText:{yes:c.T("TAG074","Yes"),no:c.T("TAG075","No")},icon:Ext.MessageBox.QUESTION,fn:function(r,s){if(r=="yes"){q.__parent.destroyEditProcessPanel();q.__parent.listPanel.getSelectionModel().deselectAll();}}});})}]);if(!this.record){return;}var j=this;var h=j.record.isNewRecord||false;var f=j.record.data||{};var g=[];var e=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG065","Metric Information"),layout:"column",padding:"10",defaults:{padding:"10px",labelAlign:"top"}});g.push(e);var d=["isActive","sourceObjectLabel","targetObjectLabel","appliesTo"];if(f.method==="SPMMTBF: Standard"){d=["isActive","sourceObjectLabel","targetObjectLabel","entryTypeForMTBF","appliesTo"];}if(f.entryTypeForMTBF===""||f.entryTypeForMTBF===null||h){f.entryTypeForMTBF="Multiple_MTBF";}SVMX.array.forEach(d,function(q){if(!(q in f)){return;}switch(q){case"name":e.add({fieldLabel:"Name",name:q,readOnly:true});break;case"isActive":e.add({xtype:"checkbox",boxLabel:c.T("TAG050","Active"),readOnly:b,name:q,value:f[q],columnWidth:1,labelAlign:"top"});break;case"method_values":e.add({xtype:"svmx.picklist",name:"method",fieldLabel:c.T("TAG008","Calculation Method"),displayField:"name",valueField:"name",value:f.method,hidden:true,columnWidth:1,labelAlign:"top",store:Ext.create("Ext.data.Store",{storeId:j.id+"_"+q+"_store",fields:["name"],data:f[q],proxy:{type:"memory"}}),listeners:{change:function(s,r){}},listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});break;case"entryTypeForMTBF":e.add({xtype:"svmx.picklist",name:"entryTypeForMTBF",fieldLabel:c.T("TAG090","Define how many entries must be maintained per Installed Product in this metric"),displayField:"label",valueField:"name",value:f.entryTypeForMTBF,columnWidth:1,labelAlign:"top",editable:false,readOnly:!h,store:Ext.create("Ext.data.Store",{storeId:"entryTypeForMTBFStore",fields:["label","name"],data:[{name:"Single_MTBF",label:c.T("TAG091","Single MTBF")},{name:"Multiple_MTBF",label:c.T("TAG092","Multiple MTBF")},],proxy:{type:"memory"}}),listConfig:{getInnerTpl:function(r){return"{[Ext.String.htmlEncode(values."+r+")]}";}}});break;case"appliesTo":e.add({xtype:"svmx.textarea",labelAlign:"top",columnWidth:1,readOnly:b,fieldLabel:c.T("TAG009","Description"),name:q});break;case"dashboardId":if(f[q]){e.add({xtype:"component",autoEl:{tag:"a",align:"right",target:"_blank",style:"text-decoration: underline !important;",href:"/../../"+f[q],html:c.T("TAG030","Launch Dashboard")}});}break;case"sourceObjectLabel":e.add({xtype:"textfield",columnWidth:1,readOnly:true,fieldLabel:c.T("TAG060","Object(s) from which this metric is derived"),name:q,value:f[q],labelAlign:"top"});break;case"targetObjectLabel":e.add({xtype:"textfield",columnWidth:1,readOnly:true,fieldLabel:c.T("TAG061","Object(s) where metrics are collected"),name:q,value:f[q],labelAlign:"top"});break;}},j);if(g.length){j.add({xtype:"form",cls:"spm-report-config-general",title:c.T("TAG055","Metric Definition"),items:g,height:"100%",header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG055","Metric Definition"),border:false,labelAlign:"top",padding:10,defaults:{padding:"10px",columnWidth:1,labelAlign:"top"},autoScroll:true,getData:function(){return this.getForm().getValues();
}});}g=[];var k=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG068","Please define inputs to be used in metric calculation"),layout:"column",padding:"10",columnWidth:1});var o=this.__parent;var n=false;for(var m in f){if(m.match("_fields")){if(f[m].isCriteria==true){n=true;k.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,id:"selectbox_Id"+o.processId+f[m].componentId,fieldLabel:f[m].name,displayField:"label",valueField:"name",labelAlign:"top",padding:10,multiSelect:f[m].multiSelect,listeners:{change:function(q,s,r){if(o.processId==="FirstTimeFix"){if(s==="WorkDetail"){if(Ext.getCmp("selectbox_IdFirstTimeFixPeriod")!=undefined&&Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder")!=undefined){Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder").hide();Ext.getCmp("selectbox_IdFirstTimeFixPeriod").show();if(Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id")!=undefined&&Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id")!=undefined){Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id").up().hide();Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id").up().show();}}}if(s==="WorkOrder"){if(Ext.getCmp("selectbox_IdFirstTimeFixPeriod")!=undefined&&Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder")!=undefined){Ext.getCmp("selectbox_IdFirstTimeFixPeriod").hide();Ext.getCmp("selectbox_IdFirstTimeFixhasPrimaryWorkOrder").show();if(Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id")!=undefined&&Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id")!=undefined){Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedfieldset_id").up().show();Ext.getCmp("tabPanel_0_editprocesspanel_expression_CriteriaForFirstTimeFixedUsingWorkDetailfieldset_id").up().hide();}}}}}},listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","label","displayType"],data:f[m].values,proxy:{type:"memory"},})});}}}if(n){g.push(k);}var p=SVMX.create("Ext.form.FieldSet",{title:c.T("TAG066","Please define the object mapping for this metric"),layout:"column",padding:"10",});g.push(p);for(var m in f){if(m.match("_fields")){if(f[m].isCriteria==false){p.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,fieldLabel:f[m].name,displayField:"label",valueField:"name",labelAlign:"top",padding:10,multiSelect:f[m].multiSelect,listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","label","displayType"],data:f[m].values,proxy:{type:"memory"}})});}}}for(var m in f){if(m.match("_mappings")){p.add({xtype:"combobox",name:f[m].name,editable:false,columnWidth:0.5,fieldLabel:f[m].name,displayField:"name",valueField:"mapId",labelAlign:"top",padding:10,listConfig:{getInnerTpl:function(q){return"{[Ext.String.htmlEncode(values."+q+")]}";}},store:Ext.create("Ext.data.Store",{storeId:j.itemId+"_"+f[m].name+"_store",fields:["name","mapId"],data:f[m].values,proxy:{type:"memory"}})});}}if(g.length&&!b){j.add({xtype:"form",cls:"spm-report-config-settings",title:c.T("TAG006","Settings"),items:g,header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG056","Settings"),padding:10,defaults:{padding:"10px",columnWidth:1,labelAlign:"top"},autoScroll:true,getData:function(){return this.getForm().getValues();}});}g=[];Ext.each(f.expressions||[],function(q){g.push({xtype:"spm.report.exprpanel",columnWidth:1,itemId:j.itemId+"_expression_"+q.type,title:q.label,rules:q.rules,value:q.value});},j);if(g.length){j.add({xtype:"form",cls:"spm-report-config-criteria",title:c.T("TAG007","Criteria(s)"),items:g,autoScroll:true,header:false,bodyPadding:5,layout:"column",defaultType:"textfield",tooltip:c.T("TAG057","Criteria(s)"),defaults:{padding:"10px",columnWidth:0.5,labelAlign:"top"},getData:function(){var q=this.getForm().getRecord();if(!h){q=q.getData();}else{q=q.data;}var s={};Ext.each(q.expressions,function(w){var v=this.getComponent(j.itemId+"_expression_"+w.type);var x=v.getSelectedExpression();if(x){s[w.type]=x;}},this);var u=this.getForm().getValues();var t={expressions:s,raw:q.raw};if(u){for(var r in u){if(r!="advExp"){t[r]=u[r];}}}return t;}});}j.setActiveTab(0);j.loadData(j.record);},loadData:function(d){SVMX.array.forEach(this.items.items,function(e){if(e.loadRecord){e.loadRecord(d||this.record);}},this);}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.ExpressionPanel",{extend:"Ext.form.FieldSet",alias:"widget.spm.report.exprpanel",cls:"spm-report-expression-panel",id:"",layout:"column",border:false,margin:"10",labelStyle:"font-weight:bold;padding:0",defaults:{padding:"5",columnWidth:0.5,labelAlign:"top"},initComponent:function(){this.callParent(arguments);
var d=this;this.add([{xtype:"svmx.picklist",itemId:d.itemId+"_expression",id:d.itemId+"fieldset_id",displayField:"name",valueField:"exprId",editable:false,store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_expression_store",fields:["exprId","name","expressions","advExp"],data:d.rules,proxy:{type:"memory"}}),listeners:{change:function(e,j){var k=e.store.data.items,h;for(i=0,l=k.length;i<l;i++){h=k[i];if(h.data.exprId==j||h.data.name==j){var g=d.getComponent(d.itemId+"_expression_details");g.store.loadData(h.data.expressions);g.show();var f=d.getComponent(d.itemId+"_advExp");if(h.data.advExp){f.setValue(h.data.advExp);f.show();}else{f.hide();}break;}}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}},{xtype:"svmx.listcomposite",columnWidth:1,itemId:d.itemId+"_expression_details",hidden:false,columns:[{text:c.T("TAG032","Sequence"),dataIndex:"sequence",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG033","Field"),dataIndex:"field",flex:2,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG034","Operator"),dataIndex:"operator",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:c.T("TAG035","Value"),dataIndex:"value",flex:1,menuDisabled:true,sortable:false,renderer:function(e){return Ext.String.htmlEncode(e);}}],store:Ext.create("Ext.data.Store",{storeId:d.itemId+"_expression_grid_store",fields:["sequence","field","operator","value"],proxy:{type:"memory"}})},{xtype:"svmx.text",name:"advExp",itemId:d.itemId+"_advExp",hidden:true,fieldLabel:c.T("TAG031","Advanced Expression"),readOnly:true,columnWidth:1}]);this.items.get(this.itemId+"_expression").setValue(this.value);},getSelectedExpression:function(){return this.items.get(this.itemId+"_expression").getValue();}});};})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__constructor:function(){this.__base();},beforeInitialize:function(){com.servicemax.client.spm.ui.desktop.api.general.init();com.servicemax.client.spm.ui.desktop.api.reports.init();com.servicemax.client.spm.ui.desktop.api.schedule.init();com.servicemax.client.spm.ui.desktop.api.status.init();com.servicemax.client.spm.ui.desktop.api.config.init();},initialize:function(){com.servicemax.client.spm.ui.desktop.api.init();}},{instance:null});})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.schedule");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");Ext.define("com.servicemax.client.spm.ui.desktop.api.schedule.Schedule",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.spm.schedule",title:b.T("TAG003","Schedule & Notifications"),layout:"fit",border:false,autoScroll:true,constructor:function(c){c=Ext.apply({dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},{tooltip:"Save",xtype:"svmx.button",text:"Save",handler:SVMX.proxy(this,function(){this.__parent.saveProcessConfig({processId:this.processId,scheduleInfo:this.getData()});})}]}]},c||{});this.callParent(arguments);},initComponent:function(c){this.callParent(arguments);this.topPanel=this.add({title:"SPM Report Schedule",header:false,anchor:"100%",autoScroll:true,border:false});},loadRecord:function(c){this.scheduleId=c.data?c.data.details.scheduleId:null;this.editRecord(c);},getData:function(){var c=this.topPanel.down("form").getForm().getValues();c.scheduleId=this.scheduleId;return c;},loadData:function(c){},editRecord:function(c){if(this.topPanel.editPanel){this.topPanel.editPanel.destroy();}this.topPanel.editPanel=this.topPanel.add({xtype:"spm.schedule.scheduleform",itemId:"scheduleform",anchor:"100%",metaModel:this.metaModel,processId:this.processId});if(c.data){var d=this.topPanel.editPanel.getForm();d.setValues(c.data.details);if(c.data.details.weekOn){d.findField("weekOn").setValue(c.data.details.weekOn);}if(c.data.details.dayToRun){d.findField("dayToRun").setValue(c.data.details.dayToRun);}}}});Ext.define("com.servicemax.client.spm.ui.desktop.api.reports.ScheduleListPanel",{extend:"Ext.grid.Panel",alias:"widget.spm.report.schedulelistpanel",constructor:function(c){var d=this;c=Ext.apply({autoScroll:false,columns:[{text:"SPM Report Name",dataIndex:"processName",flex:1,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:"Period",dataIndex:"period",flex:1,renderer:function(e){return Ext.String.htmlEncode(e);}},{text:"Last Modified",dataIndex:"lastModified",flex:1,renderer:function(e){return Ext.String.htmlEncode(e);}}],store:{storeId:c.itemId+"_store",fields:c.fields,proxy:{type:"memory"}},listeners:{select:function(h,e,f,g){}}},c||{});this.callParent(arguments);}});Ext.define("com.servicemax.client.spm.ui.desktop.api.schedule.ScheduleForm",{extend:"Ext.form.Panel",alias:"widget.spm.schedule.scheduleform",layout:"anchor",padding:10,border:false,autoScroll:true,bodyPadding:5,defaults:{labelAlign:"top",anchor:"100%",padding:"10px"},buttonAlign:"left",constructor:function(c){c=Ext.apply({},c||{});
this.callParent(arguments);},initComponent:function(){this.callParent(arguments);var o=this;o.TS={T:function(t,u){return u;}};var m=SVMX.create("Ext.data.ArrayStore",{fields:["Id","weekOn"],data:[["Monday",b.T("TAG036","Monday")],["Tuesday",b.T("TAG037","Tuesday")],["Wednesday",b.T("TAG038","Wednesday")],["Thursday",b.T("TAG039","Thursday")],["Friday",b.T("TAG040","Friday")],["Saturday",b.T("TAG041","Saturday")],["Sunday",b.T("TAG042","Sunday")]]});var q=SVMX.create("Ext.data.ArrayStore",{fields:["Id","timeAt"],data:[[1,"12:00 "+b.T("TAG072","am")],[2,"1:00 "+b.T("TAG072","am")],[3,"2:00 "+b.T("TAG072","am")],[4,"3:00 "+b.T("TAG072","am")],[5,"4:00 "+b.T("TAG072","am")],[6,"5:00 "+b.T("TAG072","am")],[7,"6:00 "+b.T("TAG072","am")],[8,"7:00 "+b.T("TAG072","am")],[9,"8:00 "+b.T("TAG072","am")],[10,"9:00 "+b.T("TAG072","am")],[11,"10:00 "+b.T("TAG072","am")],[12,"11:00 "+b.T("TAG072","am")],[13,"12:00 "+b.T("TAG073","pm")],[14,"1:00 "+b.T("TAG073","pm")],[15,"2:00 "+b.T("TAG073","pm")],[16,"3:00 "+b.T("TAG073","pm")],[17,"4:00 "+b.T("TAG073","pm")],[18,"5:00 "+b.T("TAG073","pm")],[19,"6:00 "+b.T("TAG073","pm")],[20,"7:00 "+b.T("TAG073","pm")],[21,"8:00 "+b.T("TAG073","pm")],[22,"9:00 "+b.T("TAG073","pm")],[23,"10:00 "+b.T("TAG073","pm")],[24,"11:00 "+b.T("TAG073","pm")]]});var d=SVMX.create("Ext.data.ArrayStore",{fields:["Id","period"],data:[["Daily",b.T("TAG043","Daily")],["Weekly",b.T("TAG044","Weekly")],["Monthly",b.T("TAG045","Monthly")]]});var g=SVMX.create("Ext.data.ArrayStore",{fields:["Id","day"],data:[[1,"1"],[2,"2"],[3,"3"],[4,"4"],[5,"5"],[6,"6"],[7,"7"],[8,"8"],[9,"9"],[10,"10"],[11,"11"],[12,"12"],[13,"13"],[14,"14"],[15,"15"],[16,"16"],[17,"17"],[18,"18"],[19,"19"],[20,"20"],[21,"21"],[22,"22"],[23,"23"],[24,"24"],[25,"25"],[26,"26"],[27,"27"],[28,"28"],[29,"29"],[30,"30"],[31,"31"]]});var j=SVMX.create("Ext.data.ArrayStore",{fields:["Id","name"],proxy:{type:"memory"},data:o.metaModel.getTimezoneList()});var s=SVMX.create("Ext.form.FieldSet",{title:b.T("TAG053","Choose the times and days to run metric generation engine"),layout:"anchor",padding:"10"});o.add(s);var k=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{itemId:"timezone",name:"timezone",fieldLabel:b.T("TAG018","Time Zone"),labelField:"label",valueField:"Id",displayField:"name",margins:"0 5 0 0",queryMode:"local",editable:false,anchor:"50%",flex:1,store:j,labelAlign:"top",padding:"10",listConfig:{getInnerTpl:function(t){return"{[Ext.String.htmlEncode(values."+t+")]}";}}});var c=s.add({xtype:"fieldcontainer",layout:{type:"hbox",align:"spaced"},anchor:"100%",fieldDefaults:{labelAlign:"top"},});s.add(c);c.add(k);c.add({xtype:"tbspacer",flex:1});c.add({xtype:"label",anchor:"50%",align:"right",style:"text-decoration: underline !important;",html:'<a href="#" align: "right" style: "text-decoration: underline !important;">'+b.T("TAG049","Run Now")+"</a>",listeners:{afterRender:function(){this.el.on("click",function(){o.metaModel.executeBatch(o.processId,function(t){if(t){Ext.Msg.alert(t.success?"Success":"Failed",t.message);}});});}}});var n=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{itemId:"period",name:"period",fieldLabel:b.T("TAG017","Period"),labelField:"period",valueField:"Id",displayField:"period",defaultValue:"Daily",value:"Daily",queryMode:"local",editable:false,store:d,flex:1,anchor:"30%",labelAlign:"top",padding:"10",listeners:{change:function(v,u,t){switch(u){case b.T("TAG043","Daily"):o.__on.reset();o.__on.setValue(["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]);o.__on.hide();o.__dayToRun.hide();break;case b.T("TAG044","Weekly"):o.__dayToRun.hide();o.__on.reset();o.__on.setValue([b.T("TAG036","Monday")]);o.__on.show();break;case b.T("TAG045","Monthly"):o.__on.reset();o.__on.hide();o.__dayToRun.show();}}},listConfig:{getInnerTpl:function(t){return"{[Ext.String.htmlEncode(values."+t+")]}";}}});s.add(n);var h=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{itemId:"weekOn",name:"weekOn",fieldLabel:b.T("TAG020","Create Schedule on"),labelField:"label",valueField:"Id",displayField:"weekOn",queryMode:"local",editable:false,multiSelect:true,anchor:"30%",flex:1,store:m,value:"Monday",hidden:true,labelAlign:"top",padding:"10",listConfig:{getInnerTpl:function(t){return"{[Ext.String.htmlEncode(values."+t+")]}";}}});o.__on=s.add(h);var p=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{itemId:"dayToRun",name:"dayToRun",fieldLabel:b.T("TAG021","Day"),labelField:"label",valueField:"Id",displayField:"day",queryMode:"local",editable:false,multiSelect:false,anchor:"30%",flex:1,store:g,value:1,hidden:true,labelAlign:"top",padding:"10",listConfig:{getInnerTpl:function(t){return"{[Ext.String.htmlEncode(values."+t+")]}";}}});o.__dayToRun=s.add(p);var f=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{itemId:"timeAt",name:"timeAt",fieldLabel:b.T("TAG019","At"),labelField:"label",valueField:"timeAt",displayField:"timeAt",queryMode:"local",editable:false,anchor:"30%",margins:"0 0 0 5",flex:1,store:q,labelAlign:"top",padding:"10",listConfig:{getInnerTpl:function(t){return"{[Ext.String.htmlEncode(values."+t+")]}";
}}});s.add(f);var e=SVMX.create("Ext.form.FieldSet",{title:b.T("TAG054","Specify recipients of notifications and alerts"),layout:"anchor",padding:"10"});o.add(e);var r=e.add({xtype:"textfield",fieldLabel:b.T("TAG022","Email on Job Execution"),name:"emailOnSuccess",anchor:"50%",labelAlign:"top",padding:"10",margins:"0 0 0 5"});}});};})();(function(){var a=SVMX.Package("com.servicemax.client.spm.ui.desktop.api.status");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPM");Ext.define("com.servicemax.client.spm.ui.status.Status",{extend:"Ext.panel.Panel",alias:"widget.spm.status",title:b.T("TAG004","Status"),layout:"fit",cls:"spm-report-config-status",initComponent:function(){this.callParent(arguments);var c=this.add({itemId:this.itemId+"_grid",anchor:"100%",autoScroll:true,xtype:"gridpanel",title:"SPM Schedule Jobs",disableSelection:true,header:false,columns:[{text:b.T("TAG023","Job"),dataIndex:"recordId",flex:1,renderer:function(f,d,e){return'<a target="_blank" href="{/../../'+f+'">'+e.get("jobName")+"</a>";}},{text:b.T("TAG025","Start Time"),dataIndex:"startTime",flex:1},{text:b.T("TAG026","End Time"),dataIndex:"endTime",flex:1},{text:b.T("TAG027","Job Status"),dataIndex:"status",align:"center",renderer:function(d,e){if(d.toUpperCase()=="SUCCESS"){e.style="background-color:lightgreen;align:center";d=b.T("TAG047","SUCCESS");}else{e.style="background-color:#F75D59;";d=b.T("TAG048","FAILED");}return d;}},{text:b.T("TAG028","Attachment"),dataIndex:"attachment",flex:1,renderer:function(d){if(d&&d.startsWith("068")){return'<a target="_blank" href="{/../../sfc/servlet.shepherd/version/download/'+d+'">'+b.T("TAG046","View")+"</a>";}else{return'<a target="_blank" href="{/../../servlet/servlet.FileDownload?file='+d+'">'+b.T("TAG046","View")+"</a>";}}}],store:Ext.create("Ext.data.Store",{storeId:this.itemId+"_store",fields:["recordId","jobName","processId","reportName","startTime","endTime","status","attachment"],proxy:{type:"memory"}}),});},onActivate:function(){this.metaModel.getSPMJobs(this.processId,SVMX.proxy(this,function(c){this.items.get(this.itemId+"_grid").store.loadData(c);}));}});};})();