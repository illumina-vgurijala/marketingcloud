(function(){var a=SVMX.Package("com.servicemax.client.installigence.admin.layoutAndAction");a.init=function(){Ext.define("com.servicemax.client.installigence.admin.LayoutAndAction",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",__root:null,__none:null,constructor:function(d){var e=this;this.__none="--None--";d=d||{};d.items=[];d.title=$TR.LAYOUT_AND_ACTION;d.id="layoutAndAction";this.__root=d.root;this.__registerForDidProfileSelectCall();e.showProfiles=d.root.showProfiles;var c=[{sfdcId:this.__none,processId:this.__none,processName:$TR.NONE}].concat(d.metadata.availableIBEditProcess);var b=[{sfdcId:this.__none,processId:this.__none,processName:$TR.NONE}].concat(d.metadata.availableLocationEditProcess);e.availableIbProcesStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["processId","processName","sfdcId"],data:c});e.availableLocationProcesStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["processId","processName","sfdcId"],data:b});e.showIbProcess=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_SFM_FOR_OVERVIEW_LAYOUT+' <span class="req" style="color:red">*</span>',store:e.availableIbProcesStore,labelWidth:300,width:600,displayField:"processName",valueField:"sfdcId",queryMode:"local",editable:false,disabled:true,margin:"20 0 50 30",listeners:{select:{fn:e.__persistIBProcessData,scope:e},afterrender:function(g){var f=g.getStore().getAt(0);g.setValue(f.get("sfdcId"));}}});e.showLocationProcess=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_SFM_FOR_OVERVIEW_LAYOUT+' <span class="req" style="color:red">*</span>',store:e.availableLocationProcesStore,labelWidth:300,width:600,displayField:"processName",valueField:"sfdcId",queryMode:"local",editable:false,disabled:true,margin:"20 0 10 30",listeners:{select:{fn:e.__persistLocationProcessData,scope:e},afterrender:function(g){var f=g.getStore().getAt(0);g.setValue(f.get("sfdcId"));}}});e.ibTitleLabel={xtype:"label",forId:"myFieldId",text:$TR.INSTALLED_PRODUCT,margin:"20 0 10 10",};e.locationTitleLabel={xtype:"label",forId:"myFieldId",text:$TR.LOCATION,margin:"20 0 10 10",};e.serviceFlowWizardDisplayTitle={xtype:"label",cls:"piq-setup-service-flow-wizard-display",forId:"myFieldId",text:$TR.SERVICE_FLOW_WIZARD_DISPLAY,margin:"40 0 10 10"};e.checkboxFieldForIB=SVMX.create("com.servicemax.client.installigence.ui.components.Checkbox",{boxLabel:$TR.ENABLE_OPEN_TREE_VIEW_ON_IB,cls:"piq-setup-layout-checkbox",margin:"20 0 10 10",scope:e,id:"InstalledBaseOpenTreeViewAction",checked:true,disabled:true,handler:function(g,f){e.__shouldEnableOpenTreeViewActionForProfile(g,f,e);}});e.checkboxFieldForLocation=SVMX.create("com.servicemax.client.installigence.ui.components.Checkbox",{boxLabel:$TR.ENABLE_OPEN_TREE_VIEW_ON_LOCATION,cls:"piq-setup-layout-checkbox",margin:"10 0 10 10",scope:e,id:"LocationOpenTreeViewAction",checked:true,disabled:true,handler:function(g,f){e.__shouldEnableOpenTreeViewActionForProfile(g,f,e);}});e.checkboxFieldForWO=SVMX.create("com.servicemax.client.installigence.ui.components.Checkbox",{boxLabel:$TR.ENABLE_OPEN_TREE_VIEW_ON_WO,cls:"piq-setup-layout-checkbox",margin:"10 0 10 10",id:"WorkOrderOpenTreeViewAction",scope:e,checked:true,disabled:true,handler:function(g,f){e.__shouldEnableOpenTreeViewActionForProfile(g,f,e);}});e.autoSyncTitle={xtype:"label",cls:"piq-setup-service-flow-wizard-display",forId:"myFieldId",text:$TR.AUTO_SYNC_TITLE,margin:"40 0 10 10"};e.checkboxFieldForAutoSync=SVMX.create("com.servicemax.client.installigence.ui.components.Checkbox",{boxLabel:$TR.AUTO_SYNC_CHECKBOX_TITLE,cls:"piq-setup-layout-checkbox",margin:"10 0 10 10",id:"AutoSyncId",scope:e,checked:true,disabled:true,handler:function(g,f){e.__shouldEnableAutoSyncForProfile(g,f,e);}});d.items.push(e.ibTitleLabel);d.items.push(e.showIbProcess);d.items.push(e.locationTitleLabel);d.items.push(e.showLocationProcess);d.items.push(e.serviceFlowWizardDisplayTitle);d.items.push(e.checkboxFieldForIB);d.items.push(e.checkboxFieldForLocation);d.items.push(e.checkboxFieldForWO);d.items.push(e.autoSyncTitle);d.items.push(e.checkboxFieldForAutoSync);this.callParent([d]);},__shouldEnableOpenTreeViewActionOnProfileSelection:function(){var b=this.showProfiles.getSelectedRecord();var c={};if(this.showProfiles.selectedProfile!==undefined){if(b.getData().serviceFlowWizardDisplay==undefined){b.set("serviceFlowWizardDisplay",[]);c.isOpenTreeViewActionEnabledForInstallBase=true;c.isOpenTreeViewActionEnabledForLocation=true;c.isOpenTreeViewActionEnabledForWO=true;this.checkboxFieldForIB.setValue(true);this.checkboxFieldForLocation.setValue(true);this.checkboxFieldForWO.setValue(true);b.set("serviceFlowWizardDisplay",c);}else{c=b.get("serviceFlowWizardDisplay");this.checkboxFieldForIB.setValue(c.isOpenTreeViewActionEnabledForInstallBase);this.checkboxFieldForLocation.setValue(c.isOpenTreeViewActionEnabledForLocation);
this.checkboxFieldForWO.setValue(c.isOpenTreeViewActionEnabledForWO);}}else{b.set("serviceFlowWizardDisplay",{});}},__shouldEnableOpenTreeViewActionForProfile:function(f,d,b){var c=b.showProfiles.getSelectedRecord();var e={};if(c.getData().serviceFlowWizardDisplay==undefined){c.set("serviceFlowWizardDisplay",{});}else{e=c.get("serviceFlowWizardDisplay");}switch(f.id){case"InstalledBaseOpenTreeViewAction":e.isOpenTreeViewActionEnabledForInstallBase=d;break;case"LocationOpenTreeViewAction":e.isOpenTreeViewActionEnabledForLocation=d;break;case"WorkOrderOpenTreeViewAction":e.isOpenTreeViewActionEnabledForWO=d;break;}c.set("serviceFlowWizardDisplay",e);},__shouldEnableAutoSyncForProfile:function(e,d,b){var c=b.showProfiles.getSelectedRecord();if(c.getData().isAutoSyncEnabled===undefined||c.getData().isAutoSyncEnabled==="false"){c.set("isAutoSyncEnabled","false");}c.set("isAutoSyncEnabled",d);},__persistAutoSyncCheckboxValue:function(f,b){var c=this.showProfiles.getSelectedRecord();var d={};if(this.showProfiles.selectedProfile!==undefined){if(c.getData().isAutoSyncEnabled==undefined){this.checkboxFieldForAutoSync.setValue(true);}else{const e=c.get("isAutoSyncEnabled");if(e===false||e==="false"){this.checkboxFieldForAutoSync.setValue(false);}else{this.checkboxFieldForAutoSync.setValue(true);}}}c.set("isAutoSyncEnabled",this.checkboxFieldForAutoSync.getValue());},__persistIBProcessData:function(f,c){var d=this.showProfiles.getSelectedRecord();if(d.getData().ibEditProces==undefined){d.set("ibEditProces",[]);}if(this.showProfiles.getSelectedRecord()!==undefined&&this.showProfiles.getSelectedRecord().get("processName")!==this.__none){var e=f.getSelectedRecord().data;var b={};if(e){b.objectName=e.objectName;b.processId=e.processId;b.processName=e.processName;b.sfdcId=e.sfdcId;}d.set("ibEditProces",[b]);}else{d.set("ibEditProces",[]);}},__persistLocationProcessData:function(e,b){var d=this.showProfiles.getSelectedRecord();if(d.getData().locationEditProces==undefined){d.set("locationEditProces",[]);}if(this.showProfiles.getSelectedRecord()!==undefined&&this.showProfiles.getSelectedRecord().get("processName")!==this.__none){var c=e.getSelectedRecord().data;var f={};if(c){f.objectName=c.objectName;f.processId=c.processId;f.processName=c.processName;f.sfdcId=c.sfdcId;}d.set("locationEditProces",[f]);}else{d.set("locationEditProces",[]);}},__onSelectProfile:function(b,g){this.showIbProcess.setValue(this.__none);this.showLocationProcess.setValue(this.__none);if(b.getSelectedRecord().get("profileId")==this.__none){this.showIbProcess.setDisabled(true);this.showLocationProcess.setDisabled(true);this.checkboxFieldForIB.setDisabled(true);this.checkboxFieldForLocation.setDisabled(true);this.checkboxFieldForWO.setDisabled(true);this.checkboxFieldForIB.setValue(true);this.checkboxFieldForLocation.setValue(true);this.checkboxFieldForWO.setValue(true);this.checkboxFieldForAutoSync.setDisabled(true);this.checkboxFieldForAutoSync.setValue(true);this.showProfiles.selectedProfile=undefined;}else{this.showIbProcess.setDisabled(false);this.showLocationProcess.setDisabled(false);this.checkboxFieldForIB.setDisabled(false);this.checkboxFieldForLocation.setDisabled(false);this.checkboxFieldForWO.setDisabled(false);this.checkboxFieldForAutoSync.setDisabled(false);this.showProfiles.selectedProfile=g;var d;var f="";var j="";var e;var c=g.data;(!c.ibEditProces||c.ibEditProces.length==0)?d=this.__getStandardIBProcess("sfdcId"):d=c.ibEditProces[0].sfdcId;(!c.locationEditProces||c.locationEditProces.length==0)?e=this.__getStandardLocationProcess("sfdcId"):e=c.locationEditProces[0].sfdcId;(!c.ibEditProces||c.ibEditProces.length==0)?f=this.__getStandardIBProcess("processId"):f=c.ibEditProces[0].processId;(!c.locationEditProces||c.locationEditProces.length==0)?j=this.__getStandardLocationProcess("processId"):j=c.locationEditProces[0].processId;if(d!=this.__none){var h=this.showIbProcess.getStore().data.items.find(function(k){if(k.data.sfdcId==d){return true;}return false;});if(!h||h.length==0){d=this.__none;var i=this.showIbProcess.getStore().data.items.find(function(k){if(k.data.processId==f){return true;}return false;});if(typeof(i)==="object"&&(i||i.data.sfdcId.length>0)){d=i.data.sfdcId;}}}if(e!=this.__none){var h=this.showLocationProcess.getStore().data.items.find(function(k){if(k.data.sfdcId==e){return true;}return false;});if(!h||h.length==0){e=this.__none;var i=this.showLocationProcess.getStore().data.items.find(function(k){if(k.data.processId==j){return true;}return false;});if(typeof(i)==="object"&&(i||i.data.sfdcId.length>0)){e=i.data.sfdcId;}}}this.showIbProcess.setValue(d);this.showLocationProcess.setValue(e);this.__persistIBProcessData(this.showIbProcess);this.__persistLocationProcessData(this.showLocationProcess);}this.__shouldEnableOpenTreeViewActionOnProfileSelection();this.__persistAutoSyncCheckboxValue(b,g);},__getStandardIBProcess:function(f){var j=this.showIbProcess.getStore().data.items,c=j.length;var e=this.__none;var g=this.__none;var b="View_And_Edit_Installed_Product";
for(var d=0;d<c;d++){var h=j[d];if(h.data.processId===b){e=h.data.sfdcId;g=h.data.processId;break;}}if(f==="sfdcId"){return e;}else{return g;}},__getStandardLocationProcess:function(h){var g=this.showLocationProcess.getStore().data.items,d=g.length;var c=this.__none;var e=this.__none;var b="View_And_Edit_Location";for(var f=0;f<d;f++){var j=g[f];if(j.data.processId===b){c=j.data.sfdcId;e=j.data.processId;break;}}if(h==="sfdcId"){return c;}else{return e;}},__registerForDidProfileSelectCall:function(){var b=this;SVMX.getClient().bind("SELECTED_PROFILE_CALL",function(d){var e=SVMX.toObject(d.data);var f=d.target.result.combo;var c=d.target.result.record;this.showProfiles.setRawValue(c.get("profileName"));this.__onSelectProfile(f,c);},this);},shouldAllowToSaveConfigurationData:function(){if(this.showProfiles.getSelectedRecord().get("profileId")==this.__none){return true;}var b=false;if(this.showIbProcess.getSelectedRecord()!==undefined&&this.showIbProcess.getSelectedRecord().get("processId")!==this.__none){if(this.showLocationProcess.getSelectedRecord()!==undefined&&this.showLocationProcess.getSelectedRecord().get("processId")!==this.__none){b=true;}else{b=false;}}else{b=false;}if(b==false){Ext.Msg.alert({title:"Error",message:"An overview layout needs to be selected for both Installed Product and Location",buttonText:{ok:$TR.OK_BTN},closable:false});}return b;}});};})();