(function(){var a=SVMX.Package("com.servicemax.client.installigence.admin.datavalidationrules");a.init=function(){Ext.define("com.servicemax.client.installigence.admin.dataValidationRulesGrid",{extend:"com.servicemax.client.installigence.ui.components.SVMXGrid",constructor:function(b){var c=this;var b=b||{};b.columns=[{menuDisabled:true,sortable:false,xtype:"actioncolumn",width:50,items:[{iconCls:"delet-icon",tooltip:$TR.DELETE}],handler:function(e,h,d){var f=e.getStore();var g=f.getAt(h);f.remove(g);},renderer:function(f,e,d){b.columns[0].items[0].iconCls="delet-icon";}}];var c=this;b.columns.push(this.createComboBoxColumn({text:$TR.RULE_NAME,dataIndex:"ruleName",width:350,flex:1,rulesStore:b.rulesStore,listeners:b.ruleChangeListeners}));b.columns.push(this.createLabelColumn({text:$TR.DESCRIPTION,dataIndex:"description",width:350,flex:1,rulesStore:b.rulesStore}));b.columns.push(this.createLabelColumn({text:$TR.MESSAGE_TYPE,dataIndex:"messageType",width:350,flex:1,rulesStore:b.rulesStore,listeners:b.nameFieldListner}));this.callParent([b]);},createComboBoxColumn:function(b){var c=this;c.optionPicklist=SVMX.create("com.servicemax.client.installigence.admin.celleditors.SVMXComboBoxCellEditor",{displayField:"ruleName",queryMode:"local",editable:false,valueField:"ruleId",fieldName:"name",store:b.rulesStore,listeners:b.listeners});var b=b||{};b.menuDisabled=true;b.sortable=false;b.getEditor=function(d){c.optionPicklist.setRecord(d);return SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditor",{field:c.optionPicklist});};b.listeners={blur:function(f,d){var g=f.value;}};return b;},createLabelColumn:function(c){var b=SVMX.create("com.servicemax.client.installigence.ui.components.Label",{listeners:c.listeners});var c=c||{};c.menuDisabled=true;c.sortable=false;return c;},addRecords:function(b){if(!b){return;}this.store.insert(this.getStore().count(),b);},getProfileRecords:function(){var b=[];this.store.each(function(c){delete c.data.id;b.push(c.data);});return b;},__onSelectRule:function(c,b){}});Ext.define("com.servicemax.client.installigence.admin.DataValidationRules",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",__root:null,constructor:function(f){var i=this;this.__registerForDidProfileSelectCall();this.__root=f.root;var j=f.metadata.svmxProfiles;i.objectToRules=f.metadata.dataValidationRules;Ext.define("dataValidationRulesModel",{extend:"Ext.data.Model",fields:[{name:"ruleId",type:"string"},{name:"ruleName",type:"string"},{name:"description",type:"string"},{name:"messageType",type:"string"}]});i.dataValidarionRulesStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{model:"dataValidationRulesModel",data:[]});var h=[{profileId:"--None--",profileName:$TR.NONE}];var c=[{objectName:"--None--",objectLabel:$TR.NONE}];var g=[{objectName:"--None--",objectLabel:$TR.NONE}];var b=0,e=j.length;for(b=0;b<e;b++){if(j[b].profileId!=="global"){h.push(j[b]);}}if(i.objectToRules){var d=0;for(d=0;d<i.objectToRules.length;d++){c.push(i.objectToRules[d]);}}i.profiles=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["profileId","profileName"],data:h});i.objects=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["objectName","objectLabel"],data:c});i.rulesStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{model:"dataValidationRulesModel",data:g});i.rulesGrid=SVMX.create("com.servicemax.client.installigence.admin.dataValidationRulesGrid",{cls:"grid-panel-borderless panel-radiusless",store:i.dataValidarionRulesStore,height:320,selType:"cellmodel",rulesStore:i.rulesStore,plugins:[SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditorPlugin",{clicksToEdit:2})],ruleChangeListeners:{select:function(m,k){var l=k;var n=i.rulesGrid.getSelectionModel().getSelection()[0];n.set("ruleId",k.getData().ruleId);n.set("ruleName",k.getData().ruleName);n.set("rule_key",k.getData().rule_key);n.set("description",k.getData().description);n.set("messageType",k.getData().messageType);}}});i.rulePanel=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXPanel",{style:"margin: 1px 0",layout:"fit",cls:"grid-panel-borderless",defaults:{anchor:"40%"}});i.rulePanel.add(i.rulesGrid);i.addRecButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{ui:"svmx-toolbar-icon-btn",scale:"large",iconCls:"plus-icon",tooltip:$TR.ADD,disabled:true,handler:function(){i.onAddRecords();}});i.showProfiles=f.root.showProfiles;i.showObjects=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_OBJECT,store:i.objects,width:450,labelWidth:140,displayField:"objectLabel",queryMode:"local",editable:false,disabled:true,margin:"10 0",selectedObject:undefined,listeners:{select:{fn:i.__onSelectObjects,scope:i},afterrender:function(l){var k=l.getStore().getAt(0);l.setValue(k.get("objectLabel"));}}});i.profilePanel=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXFormPanel",{width:"450",style:"margin: 3px 0",layout:"vbox",cls:"grid-panel-borderless",defaults:{anchor:"40%"}});
i.profilePanel.add(i.showObjects);i.profileFormPanel=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXFormPanel",{style:"margin: 3px 0",layout:"fit",cls:"grid-panel-borderless",defaults:{anchor:"40%"}});i.profileFormPanel.add(i.profilePanel);i.selectObjectToolbar=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-width: 0",width:"100%"});i.selectObjectToolbar.add("->");i.selectObjectToolbar.add(i.addRecButton);i.profileFormPanel.add(i.selectObjectToolbar);i.profileFormPanel.add(i.rulePanel);f=f||{};f.items=[];f.items.push(i.profileFormPanel);f.title=$TR.DATA_VALIDATION_RULE;f.id="DVR";this.callParent([f]);},onAddRecords:function(){var b=this.showObjects.getCurrentConfig().selection.getData().objectName;this.rulesGrid.addRecords({ruleId:"",ruleName:"",description:"",messageType:"",objectName:b});},__showProfilesAfterrender:function(c){var b;if(this.__root.selectedProfile){b=this.__root.selectedProfile;}else{b=c.getStore().getAt(0);}c.setValue(b.get("profileName"));},__didSelectProfileWithInfo:function(d,c){this.__root.selectedProfile=c;var b=SVMX.create("com.servicemax.client.lib.api.Event","SELECTED_PROFILE_CALL",{result:{combo:d,record:c}},this);SVMX.getClient().triggerEvent(b);},__onSelectProfile:function(d,b){this.showObjects.setValue("--None--");this.rulesGrid.getStore().removeAll();this.showObjects.selectedObject=undefined;if(d.getSelectedRecord().get("profileId")=="--None--"){this.showObjects.setDisabled(true);this.addRecButton.setDisabled(true);}else{this.showObjects.setDisabled(false);}if(d.getSelectedRecord()&&d.getSelectedRecord().get("profileId")!=="--None--"){var c=this.showProfiles.selectedProfile;if(c){this.__persistDataValidationRules(c);}}if(d.getSelectedRecord().get("profileId")!=="--None--"){this.showProfiles.selectedProfile=b;}else{this.showProfiles.selectedProfile=undefined;this.rulesGrid.getStore().removeAll();}},__onSelectObjects:function(d,g){if(d.getSelectedRecord().get("objectName")==="--None--"){this.rulesGrid.getStore().removeAll();this.addRecButton.setDisabled(true);this.showObjects.selectedObject=undefined;}else{this.addRecButton.setDisabled(false);}if(d.getSelectedRecord().get("objectName")!=="--None--"){var e=[],c=[];var b=0;var i=this.showProfiles.selectedProfile.getData().rulesWithObjectInfo;for(b=0;b<this.objectToRules.length;b++){if(this.objectToRules[b].objectName===d.getSelectedRecord().get("objectName")){var j=0;iRuleLen=this.objectToRules[b].rules.length;for(j=0;j<iRuleLen;j++){var f={};f.objectLabel=this.objectToRules[b].objectLabel;f.objectName=this.objectToRules[b].objectName;f.ruleId=this.objectToRules[b].rules[j].ruleId;f.ruleName=this.objectToRules[b].rules[j].ruleName;f.messageType=this.objectToRules[b].rules[j].messageType;f.description=this.objectToRules[b].rules[j].description;e.push(f);}break;}}if(i){for(b=0;b<i.length;b++){if(i[b].objectName===d.getSelectedRecord().get("objectName")){var j=0;iRuleLen=i[b].rules.length;for(j=0;j<iRuleLen;j++){var f={};f.objectName=i[b].rules[j].objectName;f.ruleId=i[b].rules[j].ruleId;f.ruleName=i[b].rules[j].ruleName;f.messageType=i[b].rules[j].messageType;f.description=i[b].rules[j].description;c.push(f);}break;}}}if(d.getSelectedRecord()&&d.getSelectedRecord().get("objectName")!=="--None--"){var h=this.showProfiles.selectedProfile;if(h){this.__persistDataValidationRules(h);}}this.showObjects.selectedObject=this.showObjects.getCurrentConfig().selection.getData().objectName;this.__loadDataValidationRules(e);this.__loadSavedDataValidationRules(c);}},__persistDataValidationRules:function(c){if(!c){return;}var e=this.rulesGrid.getProfileRecords();this.__savePicklistValues(e);var f=c.get("rulesWithObjectInfo");var g="";if(this.showObjects.selectedObject){g=this.showObjects.selectedObject;}if(f){var d=0;for(d=0;d<f.length;d++){if(e&&e.length){if(f[d].objectName===e[0].objectName){f.splice(d,1);break;}}else{if(g&&g.length){if(f[d].objectName===g){f.splice(d,1);break;}}}}}else{f=[];}var b={};if(e&&e.length){b.objectName=e[0].objectName;b.rules=e;f.push(b);}else{if(g&&g.length){b.objectName=g;b.rules=[];f.push(b);}}c.set("rulesWithObjectInfo",f);},__loadDataValidationRules:function(b){if(!b){b=[];}this.__loadPicklistValues(b);this.rulesGrid.rulesStore.loadData(b);},__loadSavedDataValidationRules:function(b){if(!b){b=[];}this.rulesGrid.getStore().loadData(b);},__loadPicklistValues:function(c){var b=0,e=c.length;for(b=0;b<e;b++){var d=c[b];d.rule_key=d.ruleId;d.ruleId=this.rulesGrid.rulesStore.findRecord("value",d.ruleId)!==null?this.rulesGrid.rulesStore.findRecord("value",d.ruleId).get("label"):d.ruleId;d.rule_key=d.ruleId;d.ruleId=this.rulesGrid.rulesStore.findRecord("ruleId",d.ruleId)!==null?this.rulesGrid.rulesStore.findRecord("ruleId",d.ruleId).get("ruleName"):d.ruleId;}},__savePicklistValues:function(c){var b=0,e=c.length;for(b=0;b<e;b++){var d=c[b];if(d.rule_key){d.ruleId=d.rule_key;delete d.rule_key;}}},__registerForDidProfileSelectCall:function(){SVMX.getClient().bind("SELECTED_PROFILE_CALL",function(c){var d=SVMX.toObject(c.data);
var e=c.target.result.combo;var b=c.target.result.record;this.__onSelectProfile(e,b);this.showProfiles.setRawValue(b.get("profileName"));},this);}});};})();