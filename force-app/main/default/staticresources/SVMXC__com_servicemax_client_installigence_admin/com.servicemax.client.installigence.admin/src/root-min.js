(function(){var a=SVMX.Package("com.servicemax.client.installigence.admin.root");a.init=function(){Ext.define("com.servicemax.client.installigence.admin.root.RootPanel",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",selectedProfile:null,selectedTab:null,isFilterNameEmpty:null,constructor:function(e){e=e||{};e.renderTo=SVMX.getDisplayRootId();e.title="<span class='title-text'>"+$TR.SETUP_TITLE+"</span>";var i=this;this.isFilterNameEmpty=false;var j=e.metadata.svmxProfiles;var g=[{profileId:"--None--",profileName:$TR.NONE}];var b=0,c=j.length;for(b=0;b<c;b++){if(j[b].profileId!=="global"){g.push(j[b]);}}i.profiles=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["profileId","profileName"],data:g});i.showProfiles=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_PROFILE,store:i.profiles,labelWidth:140,width:450,displayField:"profileName",queryMode:"local",editable:false,selectedProfile:undefined,cls:"piq-setup-select-profile",listeners:{select:{fn:i.__didSelectProfileWithInfo,scope:i},afterrender:function(l){var k=l.getStore().getAt(0);l.setValue(k.get("profileName"));}}});i.layoutAndAction=SVMX.create("com.servicemax.client.installigence.admin.LayoutAndAction",{metadata:e.metadata,cls:"piq-setup-layout-actions",id:"layoutAndAction",root:this});i.userActions=SVMX.create("com.servicemax.client.installigence.admin.UserActions",{metadata:e.metadata,cls:"piq-setup-user-actions",id:"userActions",root:this});i.search=SVMX.create("com.servicemax.client.installigence.admin.Search",{metadata:e.metadata,cls:"piq-setup-search",id:"search",root:this});i.otherSettings=SVMX.create("com.servicemax.client.installigence.admin.OtherSettings",{metadata:e.metadata,cls:"piq-setup-other-settings",id:"otherSettings",hidden:true});i.technicalAttributes=SVMX.create("com.servicemax.client.installigence.admin.TechnicalAttributes",{metadata:e.metadata,cls:"piq-setup-technical-attributes",id:"technicalAttributes",root:this});i.attachment=SVMX.create("com.servicemax.client.installigence.admin.Attachment",{metadata:e.metadata,cls:"piq-setup-attachements",id:"attachment",root:this});i.tabPanel=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTabPanel",{height:550,tabPosition:"left",tabRotation:0,cls:"piq-setup-profile-body",tabBar:{border:false,cls:"piq-setup-profile-nav",width:200},margin:"4 4 0 4",ui:"setup-tabpanel",defaults:{textAlign:"left",bodyPadding:7},listeners:{tabchange:function(n,k,m,l){i.selectedTab=n.activeTab.id;}}});i.tabPanel.add(i.layoutAndAction);i.tabPanel.add(i.userActions);i.tabPanel.add(i.search);i.tabPanel.add(i.attachment);i.tabPanel.add(i.otherSettings);i.tabPanel.add(i.technicalAttributes);var h=localStorage.piqSetuptabName;if(h){i.tabPanel.setActiveTab(h);localStorage.removeItem("piqSetuptabName");}else{i.tabPanel.setActiveTab("layoutAndAction");}i.saveButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.SAVE,disabled:true,cls:"piq-setup-save",rigion:"right",docked:"right",align:"right",handler:function(){i.saveButton.focus();i.onSave();}});i.closeButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.BACK_TO_SETUP_HOME,cls:"piq-setup-back-to-home",docked:"left",rigion:"left",align:"left",handler:function(){var k="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";if((typeof sforce!="undefined")&&(sforce!=null)){k="/lightning/n/"+SVMX.OrgNamespace+"__ServiceMax_Setup";sforce.one.navigateToURL(k);}else{window.location.href=k;}}});var f=[i.closeButton];e.tools=f;i.saveCloseButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.CANCEL,cls:"piq-setup-cancel",rigion:"right",docked:"right",align:"right",handler:function(){localStorage.piqSetuptabName=i.selectedTab;window.location.reload();}});i.savencloseToolbar=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-top-width: 0 !important",margin:"0 4 5",});var d=["->",i.showProfiles,i.saveButton,i.saveCloseButton];i.profileSelectionToolbar=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-top-width: 0 !important",cls:"piq-setup-profile-selection",dock:"top",items:d});i.savencloseToolbar.add("->");e.items=[];e.items.push(i.profileSelectionToolbar);e.items.push(i.tabPanel);e.items.push(i.savencloseToolbar);this.callParent([e]);},__didSelectProfileWithInfo:function(g,c){var e=this;var d;var f=Ext.getCmp("createNewTATemplatePanel");if(f.isVisible()||g.getSelectedRecord().get("profileId")!=="--None--"){d=false;}else{d=true;}e.saveButton.setDisabled(d);this.selectedProfile=c;var b=SVMX.create("com.servicemax.client.lib.api.Event","SELECTED_PROFILE_CALL",{result:{combo:g,record:c}},this);SVMX.getClient().triggerEvent(b);},backToSetupHome:function(){this.blockUI();var c=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.BACK_TO_SETUP_HOME",c,{request:{context:c}});
SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},cancel:function(){var c=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.GET_SETUP_METADATA",c,{request:{context:c}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},onSave:function(){var h=false;var k=false;this.technicalAttributes.__templatePicklists={};this.technicalAttributes.__templatePicklistSfIds={};this.isFilterNameEmpty=false;h=this.layoutAndAction.shouldAllowToSaveConfigurationData();if(h){k=this.technicalAttributes.shouldAllowToSaveConfigurationData();}if(k){this.__persistScreenConfiguration();var n=[this.userActions.showProfiles.getSelectedRecord().data]||[];var e=[];if(this.showProfiles.getSelectedRecord().get("profileId")!=="--None--"){var c=0,g=n.length;for(c=0;c<g;c++){if(n[c].profileId==="--None--"){continue;}n[c].actions=this.__removeIdProperty(n[c].actions);n[c].filters=this.__removeExtPropertiesExpr(n[c].filters);e.push(n[c]);this.__validateFilterName(n[c].filters);}e.push({profileId:"global",actions:this.__removeIdProperty(this.userActions.globalActions),filters:this.__removeExtPropertiesExpr(this.userActions.globalFilters)});}var d=[];var o=[];var i={};taTemplateConfigurationDetails=this.technicalAttributes.getTAtemplateConfigurationDetails();var b=[];b=this.technicalAttributes.technicalAttributesList.deletedTemplateIds;var m=[];m=this.technicalAttributes.createNewTATemplate.deletedTACriteriaIds;if(this.technicalAttributes.__isDefaultPicklistSetToTA===true){var f=$TR.PICKLIST_ERROR_MESSAGE;SVMX.getCurrentApplication().showQuickMessage("error",f);}else{if(this.isFilterNameEmpty){var f=$TR.FILTER_NAME_ERROR;SVMX.getCurrentApplication().showQuickMessage("error",f);}else{this.blockUI();var j=this;j.saveButton.setDisabled(true);var l=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.SAVE_SETUP_DATA",j,{request:{context:j,profiles:e,taTemplateConfiguration:taTemplateConfigurationDetails,taDeletedTemplateIds:b,isValideTAtemplate:"YES",deletedTACriteriaIds:m}});SVMX.getCurrentApplication().getEventBus().triggerEvent(l);}}}},blockUI:function(){var b={lines:25,length:25,width:5,radius:30,corners:1,rotate:0,direction:1,color:"#ffa384",speed:3,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};this.__spinner=new Spinner(b).spin($("#"+SVMX.getDisplayRootId())[0]);},unblockUI:function(){this.__spinner.stop();},__persistScreenConfiguration:function(){if(this.userActions.showProfiles.getSelectedRecord()){this.userActions.__persistUserActions(this.userActions.showProfiles.getSelectedRecord());var b=this.userActions.filters.filtersSearchGrid.selectedExpression;if(b){this.userActions.filters.__persistExpression(b);}this.userActions.__persistFilters(this.userActions.showProfiles.getSelectedRecord());this.attachment.__persistAttachment(this.attachment.showProfiles.getSelectedRecord());this.search.__persistSearchData();}},onSaveSetupDataComplete:function(c){this.saveButton.setDisabled(false);if(typeof c.isValideTAtemplate!="undefined"&&c.isValideTAtemplate=="NO"){this.unblockUI();Ext.Msg.alert({cls:"piq-setup-error-alert",title:$TR.MESSAGE_ERROR,message:$TR.TEMPLATE_SAVE_UNSUCCESSFULL,buttonText:{ok:$TR.OK_BTN},closable:false});}else{this.technicalAttributes.refreshView();var d=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.GET_SETUP_METADATA",d,{request:{context:d}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);}},dataSavedSucessfullyMessage:function(c){var b=$TR.SAVE_SUCCESS;if(c){b=c;}SVMX.getCurrentApplication().showQuickMessage("info",b);},onGetSetupMetadataComplete:function(d){var f=d.sforceObjectDescribes;for(var g=0;g<f.length;g++){d[f[g].objectAPIName]=f[g];}var e=[{profileId:"--None--",profileName:$TR.NONE}];var c=d.svmxProfiles;var b=0;iSerLength=c.length;for(b=0;b<iSerLength;b++){if(c[b].profileId!=="global"){e.push(c[b]);}else{this.userActions.globalActions=c[b].actions;this.userActions.globalFilters=c[b].filters;}}this.userActions.showProfiles.getStore().loadData(e);this.technicalAttributes.technicalAttributesList.resetData(d.totalTAtemplates);this.technicalAttributes.technicalAttributesList.refreshTemplateGrid();this.unblockUI();this.dataSavedSucessfullyMessage();},__removeIdProperty:function(b){for(var c in b){delete b[c]["id"];}return b;},__removeExtPropertiesExpr:function(b){for(var d in b){delete b[d]["id"];if(b[d].expression&&b[d].expression.children){var c=b[d].expression.children;c=this.__isArray(c)?c[0]:c;b[d]["expression"]={children:[this.__getExpressionChildNodes(c)]};}}return b;},__validateFilterName:function(b){for(var c=0;c<b.length;c++){var e=b[c];if(e){var d=e.name;d=d.replace(/\s/g,"");if(d.length===0){this.isFilterNameEmpty=true;}}}},__isArray:function(b){return b.constructor.toString().indexOf("Array")>-1;},__getExpressionChildNodes:function(e){var f={};if(e!==undefined){f.operator=e.operator;f.exprType=e.exprType;f.field=e.field;f.condition=e.condition;f.value=e.value;if(e.children&&e.children.length>0){f.children=[];
var d=e.children||[],c,b=d.length;for(c=0;c<b;c++){f.children.push(this.__getExpressionChildNodes(d[c]));}}}return f;},__removeExtPropertiesProd:function(b){var c={};if(b&&b.children){c=this.__getProductChildNodes(b.children[0]);}return c;},__getProductChildNodes:function(e){var f={};if(e!==undefined&&e!=null){f.text=e.text;f.type=e.type;f.product=e.product;if(f.product&&f.product.productConfiguration){f.product.productConfiguration=this.__removeIdProperty(f.product.productConfiguration);}f.templateDetails=e.templateDetails;if(e.children&&e.children.length>0){f.children=[];var d=e.children||[],c,b=d.length;for(c=0;c<b;c++){f.children.push(this.__getProductChildNodes(d[c]));}}}return f;}});};})();