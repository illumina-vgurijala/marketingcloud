(function(){var a=SVMX.Package("com.servicemax.client.installigence.admin.search");a.init=function(){Ext.define("com.servicemax.client.installigence.admin.Search",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",__root:null,constructor:function(e){var i=this;this.__registerForDidProfileSelectCall();this.__root=e.root;var j=e.metadata.svmxProfiles;var f=[{profileId:"--None--",profileName:$TR.NONE}];var c=[{objectName:"--None--",objectLabel:$TR.NONE},{objectName:SVMX.OrgNamespace+"__Installed_Product__c",objectLabel:"Installed Product"}];var g=[{sfdcId:"--None--",searchLabel:$TR.NONE}].concat(e.metadata.availableSearchProc.searches);var h=[];var b=0,d=j.length;for(b=0;b<d;b++){if(j[b].profileId!=="global"){f.push(j[b]);}}i.profiles=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["profileId","profileName"],data:f});i.objects=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["objectName","objectLabel"],data:c});i.availableSearches=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["sfdcId","searchLabel"],data:g});i.showProfiles=e.root.showProfiles;i.showObjects=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_OBJECT,store:i.objects,labelWidth:150,width:450,displayField:"objectLabel",valueField:"objectName",queryMode:"local",editable:false,margin:"10 0",disabled:true,selectedObject:undefined,listeners:{select:{fn:i.__onSelectObjects,scope:i},afterrender:function(l){var k=l.getStore().getAt(0);l.setValue(k.get("objectLabel"));}}});i.showSearchs=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_SEARCH,store:i.availableSearches,labelWidth:150,width:450,displayField:"searchLabel",valueField:"sfdcId",queryMode:"local",editable:false,disabled:true,listeners:{select:{fn:i.__persistSearchData,scope:i},afterrender:function(l){var k=l.getStore().getAt(0);l.setValue(k.get("searchLabel"));}}});e=e||{};e.items=[];e.items.push(i.showObjects);e.items.push(i.showSearchs);e.title=$TR.SEARCH_EMPTY_TEXT;e.id="Search";this.callParent([e]);},__showProfilesAfterrender:function(c){var b;if(this.__root.selectedProfile){b=this.__root.selectedProfile;}else{b=c.getStore().getAt(0);}c.setValue(b.get("profileName"));},__didSelectProfileWithInfo:function(d,c){this.__root.selectedProfile=c;var b=SVMX.create("com.servicemax.client.lib.api.Event","SELECTED_PROFILE_CALL",{result:{combo:d,record:c}},this);SVMX.getClient().triggerEvent(b);},__onSelectProfile:function(d,b){this.showObjects.setValue("--None--");this.showSearchs.setValue("--None--");if(d.getSelectedRecord().get("profileId")=="--None--"){this.showObjects.setDisabled(true);this.showSearchs.setDisabled(true);}else{this.showObjects.setDisabled(false);}if(d.getSelectedRecord()&&d.getSelectedRecord().get("profileId")!=="--None--"){var c=this.showProfiles.selectedProfile;}if(d.getSelectedRecord().get("profileId")!=="--None--"){this.showProfiles.selectedProfile=b;}else{this.showProfiles.selectedProfile=undefined;}},__onSelectObjects:function(c,b){if(c.getSelectedRecord().get("objectName")=="--None--"){this.showSearchs.setDisabled(true);}else{this.showSearchs.setDisabled(false);}this.__loadSearchData(c,b);},__persistSearchData:function(){var d=this.showProfiles.getSelectedRecord();if(d.getData().search==undefined){d.set("search",[]);}if(this.showObjects.getSelectedRecord()&&this.showObjects.getSelectedRecord()!==undefined&&this.showObjects.getSelectedRecord().get("objectName")!=="--None--"){var b=this.showSearchs.getSelectedRecord().get("searchName");var f=this.showObjects.getSelectedRecord().get("objectName");var c=this.showSearchs.getSelectedRecord().get("sfdcId");var e=this.__getObjectSearchData(d,f);if(!e){e={objectName:f};d.set("search",[e]);}if(c=="--None--"){c="";}e.searches=[{sfdcId:c}];if(e.searches.length>0&&c){e.searches[0].sfdcId=c;}if(e.searches.length>0&&b){e.searches[0].searchName=b;}}},__getObjectSearchData:function(b,e){var d=0,c=b.getData().search.length;for(d=0;d<c;d++){if(b.getData().search[d].objectName==e){return b.getData().search[d];}}return undefined;},__loadSearchData:function(d,g){var c=d.getSelectedRecord().get("objectName");var n=this.showProfiles.getSelectedRecord();var l="";var o="";var e="";if(c!=="--None--"&&n.getData().search){e=this.__getObjectSearchData(n,c);if(e){l=e.searches[0].sfdcId;o=e.searches[0].searchName;}}var m=this.showSearchs.store.data.items.find(function(i){if(i.data.sfdcId==l){return true;}return false;});if(!m){var h=this.showSearchs.getStore().data.items.length,j=this.showSearchs.getStore().data.items,b=false;for(var f=0;f<h;f++){var k=j[f].data.searchName;if(k===o){l=j[f].data.sfdcId;b=true;var n=this.showProfiles.getSelectedRecord();if(n.getData().search==undefined){n.set("search",[]);}var e=this.__getObjectSearchData(n,c);if(!e){e={selectedObjectName:c};n.set("search",[e]);}if(l==="--None--"){l="";}e.searches=[{sfdcId:l}];
if(e.searches.length>0&&l){e.searches[0].sfdcId=l;}if(e.searches.length>0&&o){e.searches[0].searchName=o;}break;}}if(!b){l="--None--";}}if(!l||l.length==0){l="--None--";}this.showSearchs.setValue(l);},__registerForDidProfileSelectCall:function(){SVMX.getClient().bind("SELECTED_PROFILE_CALL",function(c){var d=SVMX.toObject(c.data);var e=c.target.result.combo;var b=c.target.result.record;this.__onSelectProfile(e,b);this.showProfiles.setRawValue(b.get("profileName"));},this);}});};})();