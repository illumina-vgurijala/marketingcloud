(function(){var a=SVMX.Package("com.servicemax.client.installigence.admin.picklist");a.init=function(){a.Class("Picklist",com.servicemax.client.lib.api.Object,{__config:null,__grid:null,__store:null,__win:null,__selectedRecord:null,__applyButton:null,__searchTextField:null,__constructor:function(b){var c=this;this.__config=b;this.__getTAPicklistDefinationRecords();this.__win=this.__getUI();this.__win.show(this.__config.selectedCell);},__getTAPicklistDefinationRecords:function(){SVMX.getCurrentApplication().blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN."+this.__config.mvcEvent,this,{request:{context:this,handler:this.__onFetchingPicklistComplete}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},__onFetchingPicklistComplete:function(b){this.__store.loadData(b);SVMX.getCurrentApplication().unblockUI();},__getUI:function(){var o=this;var k=this.__getGridDateStoreFileds();var p=this.__getGridColumnFields();var d=SVMX.OrgNamespace+"__SM_Name__c";var s=SVMX.OrgNamespace+"__SM_Description__c";var r=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:k,data:[]});var g=[],n,h,f=p.length;g.push({menuDisabled:true,sortable:false,menuText:$TR.DELETE,xtype:"actioncolumn",parentContext:o,width:50,items:[{iconCls:"piq-setup-delete-icon",tooltip:$TR.DELETE}],handler:function(j,l,c){Ext.Msg.confirm({cls:"piq-setup-alert-message",title:$TR.CONFIRM_DELETE,msg:$TR.ARE_YOU_SURE,id:"piq-setup-alert-message",buttons:Ext.MessageBox.YESNO,closable:false,parentContext:o,buttonText:{yes:$TR.MESSAGE_CONFIRM,no:$TR.CANCEL},fn:function(u){if(u==="yes"){var v=j.getStore();var x=v.getAt(l);var w=Ext.Msg.cfg.parentContext;w.__selectedRecord=x;w.__applyButton.setDisabled(true);w.__deletePicklist(x);}else{}}});},renderer:function(l,j,c){}});g.push({menuDisabled:true,sortable:false,xtype:"actioncolumn",menuText:$TR.EDIT,width:50,items:[{iconCls:"piq-setup-edit-icon",tooltip:$TR.EDIT}],handler:function(l,w,j){var u=l.getStore();var v=u.getAt(w);var c=SVMX.create("com.servicemax.client.installigence.admin.picklist.PicklistDefination",{parentContext:o,picklistType:"edit",selectedRecord:v,grid:l,rowIndex:w,metadata:o.__config.technicalAttributesContext.root.metadata});},renderer:function(l,j,c){}});for(i=0;i<f;i++){n=p[i];g.push({text:n.name,dataIndex:n.dataIndex,flex:1,renderer:function(c){return Ext.String.htmlEncode(c);}});}var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXGrid",{store:r,cls:"piq-setup-ta-grid",multiSelect:true,viewConfig:{enableTextSelection:true,},columns:g,flex:1,width:"100%",listeners:{cellclick:function(c,y,l,j,v,x,w,u){},rowclick:function(v,c,l,w,u,j){o.__grid.getSelectionModel().select(w);o.__selectedRecord=c;o.__applyButton.setDisabled(false);},afterrender:function(c){}}});this.__searchTextField=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{width:"40%",emptyText:$TR.SEARCH_EMPTY_TEXT,enableKeyEvents:true,docked:"left",align:"left",cls:"piq-setup-picklist-textfield",listeners:{change:{fn:o.__onTextFieldChange,scope:this,buffer:500}}});var q=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,disabled:false,rigion:"right",docked:"right",align:"right",cls:"piq-setup-add-button",parentContext:o,handler:function(){var c=SVMX.create("com.servicemax.client.installigence.admin.picklist.PicklistDefination",{parentContext:this,picklistType:"create",grid:o.__grid,metadata:o.__config.technicalAttributesContext.root.metadata});}});this.__applyButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.APPLY,id:"applybutton",docked:"right",disabled:true,align:"right",cls:"piq-setup-picklist-apply-button",parentContext:o,handler:function(){if(this.parentContext.__selectedRecord){var u=this.parentContext.__selectedRecord.data[SVMX.OrgNamespace+"__SM_Name__c"];var j=this.parentContext.__selectedRecord.data[SVMX.OrgNamespace+"__SM_Values__c"];var c=this.parentContext.__selectedRecord.data.Id;this.parentContext.__config.cellSelectedRecord.set("defaultValue","");this.parentContext.__config.cellSelectedRecord.set("picklistName",u);this.parentContext.__config.cellSelectedRecord.set("picklistSfId",c);this.parentContext.__config.cellSelectedRecord.set("defaultDisplayValue","");this.parentContext.refreshTechnicalAttributePageForPicklist(c,u);u=u.replace(/\s/g,"");var v=JSON.parse(j);if(v&&v.setDefaultValue){var l=v.values;if(l&&l.length>0){this.parentContext.__config.cellSelectedRecord.set("defaultDisplayValue",l[0]);}}this.parentContext.__config.technicalAttributesContext.__templatePicklistModel[u]=v;}this.parentContext.__win.close();}});var e=[this.__searchTextField,"->",q];var t=["->",this.__applyButton];var m=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXWindow",{layout:{type:"vbox"},height:400,width:820,title:$TR.PICKLIST_SELECTION,cls:"piq-setup-ta-picklist-window",closable:true,maximizable:false,titleAlign:"left",layout:{padding:5},layout:"fit",items:[b],modal:true,dockedItems:[{dock:"top",xtype:"toolbar",margin:"0",items:e},{dock:"bottom",xtype:"toolbar",margin:"0",items:t}],listeners:{show:function(l){if(this.modal){var u=Ext.dom.Query.select(".x-mask");
for(var c=0;c<u.length;c++){Ext.get(u[c]).setStyle("opacity",1);var j=Ext.get(u[c]);j.addCls("customWinMask");}}},close:function(l){if(this.modal){var u=Ext.dom.Query.select(".x-mask");for(var c=0;c<u.length;c++){Ext.get(u[c]).setStyle("opacity",1);var j=Ext.get(u[c]);j.removeCls("customWinMask");}}}}});this.__grid=b;this.__store=r;return m;},__getGridColumnFields:function(){var b=[{name:$TR.PICKLIST_NAME,dataIndex:SVMX.OrgNamespace+"__SM_Name__c"},{name:$TR.PICKLIST_DESCRIPTION,dataIndex:SVMX.OrgNamespace+"__SM_Description__c"}];return b;},__getGridDateStoreFileds:function(){var b=["Id",SVMX.OrgNamespace+"__SM_Name__c",SVMX.OrgNamespace+"__SM_Description__c",SVMX.OrgNamespace+"__SM_Values__c"];return b;},__onTextFieldChange:function(f,e,c,b){this.__grid.store.clearFilter();if(e){var d=new RegExp(Ext.String.escapeRegex(e),"i");this.__grid.store.filter({filterFn:function(g){return d.test(g.get(SVMX.OrgNamespace+"__SM_Name__c"))||d.test(g.get(SVMX.OrgNamespace+"__SM_Description__c"));}});}},__deletePicklist:function(f){var e=this;SVMX.getCurrentApplication().blockUI();var d=f.data.Id;var c=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.DELETE_PICKLIST_DATA",e,{request:{context:e,sfid:d}});var b=SVMX.getCurrentApplication().getEventBus();b.triggerEvent(c);},onPicklistDeleteComplete:function(c){SVMX.getCurrentApplication().unblockUI();var b=this.__grid.getStore();b.remove(this.__selectedRecord);},refreshTechnicalAttributePageForPicklist:function(c,q){var d=this.__config.technicalAttributesContext.createNewTATemplate.__sections.length,p,b;var e=this.__config.technicalAttributesContext.createNewTATemplate.__sections;for(var h=0;h<d;h++){b=e[h];var m=b.attributesGrid.store.data.items;var k=m.length,o={},n=[];var s=false;for(var f=0;f<k;f++){var g=m[f].data;var r=g.picklistSfId;if(g.format==="Picklist"&&r===c&&g.defaultValue!==q){g.defaultValue=q;s=true;}}if(s){b.attributesGrid.getView().refresh();}}}});a.Class("PicklistDefination",com.servicemax.client.lib.api.Object,{__config:null,__picklistNameField:null,__picklistDescriptionField:null,__picklistValuesField:null,__win:null,__constructor:function(b){var c=this;this.__config=b;this.__win=this.__getUIForPicklistDefination();this.__win.show();},__getUIForPicklistDefination:function(){var d=this;this.__picklistNameField=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:false,cls:"piq-setup-ta-picklist-name-textfield",editable:true,margin:"10 10 10 10",width:"600px",height:"26px",labelWidth:150,parentContext:d,id:"picklist-name-field",enableKeyEvents:true,fieldLabel:$TR.PICKLIST_NAME+' <span class="req" style="color:red">*</span>',listeners:{change:function(l,h,j){var k=l.value;var m=Ext.getCmp("picklist-values-field").getValue();var g=Ext.getCmp("picklist-description-field").getValue();m=$.trim(m);g=$.trim(g);k=$.trim(k);if(k.length>0&&m.length>0&&g.length>0){d.__saveButton.setDisabled(false);}else{d.__saveButton.setDisabled(true);}}}});this.__picklistDescriptionField={xtype:"textareafield",grow:false,allowBlank:false,labelWidth:150,id:"picklist-description-field",name:"description",cls:"piq-setup-ta-picklist-description-textarea",fieldLabel:$TR.PICKLIST_DESCRIPTION+' <span class="req" style="color:red">*</span>',margin:"10 10 10 10",width:"600px",height:"60px",enableKeyEvents:true,parentContext:d,listeners:{change:function(k,g,h){var j=k.value;var m=Ext.getCmp("picklist-values-field").getValue();var l=Ext.getCmp("picklist-name-field").getValue();l=$.trim(l);m=$.trim(m);j=$.trim(j);if(j.length>0&&m.length>0&&l.length>0){d.__saveButton.setDisabled(false);}else{d.__saveButton.setDisabled(true);}}}};this.__picklistValuesLabel={xtype:"label",forId:"myFieldId",cls:"piq-setup-picklist-display-label",text:$TR.PICKLIST_DISPLAY_MESSAGE,margin:"10 10 0 165",width:"445px"};this.__picklistValuesField={xtype:"textareafield",grow:false,allowBlank:false,id:"picklist-values-field",labelWidth:150,name:"picklistValues",cls:"piq-setup-ta-picklist-values-textarea",fieldLabel:$TR.PICKLIST_VALUES+' <span class="req" style="color:red">*</span>',margin:"10 10 10 10",width:"600px",height:"120px",enableKeyEvents:true,parentContext:d,listeners:{change:function(l,h,j){var k=l.value;var g=Ext.getCmp("picklist-description-field").getValue();var m=Ext.getCmp("picklist-name-field").getValue();g=$.trim(g);m=$.trim(m);k=$.trim(k);if(k.length>0&&g.length>0&&m.length>0){d.__saveButton.setDisabled(false);}else{d.__saveButton.setDisabled(true);}}}};this.__picklistCheckboxField=SVMX.create("com.servicemax.client.installigence.ui.components.Checkbox",{boxLabel:$TR.PICKLIST_CHECKBOX_FIELD_NAME,cls:"piq-setup-ta-picklist-checkbox",margin:"0 10 10 165",scope:d,disabled:false,handler:function(h,g){}});var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXPanel",{items:[this.__picklistNameField,this.__picklistDescriptionField,this.__picklistValuesLabel,this.__picklistValuesField,this.__picklistCheckboxField],layout:{type:"vbox"},});
this.__saveButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.SAVE,disabled:true,handler:function(){d.onSave();}});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.CANCEL,handler:function(){d.__win.close();}});var f=["->",this.__saveButton,b];var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXWindow",{layout:{type:"vbox"},height:440,width:830,title:$TR.PICKLIST_DEFINATION,cls:"piq-setup-ta-picklist-window",closable:true,maximizable:false,titleAlign:"left",layout:{padding:5},layout:"fit",items:[c],modal:true,dockedItems:[{dock:"bottom",xtype:"toolbar",margin:"0",items:f}],listeners:{}});this.__updatePicklistDefinationModelForEdit();return e;},__updatePicklistDefinationModelForEdit:function(){if(this.__config.picklistType==="edit"){this.__saveButton.setDisabled(false);var f=this.__config.selectedRecord.data;var j=f[SVMX.OrgNamespace+"__SM_Name__c"];var b=f[SVMX.OrgNamespace+"__SM_Description__c"];var h=f[SVMX.OrgNamespace+"__SM_Values__c"];var g=JSON.parse(h);if(j){this.__picklistNameField.setValue(j);}if(b){Ext.getCmp("picklist-description-field").setValue(b);}if(g){var d=g.values;var c=d.join("\r\n");var e=g.setDefaultValue;Ext.getCmp("picklist-values-field").setValue(c);this.__picklistCheckboxField.setValue(e);}}},onSave:function(){var k=this;var e=null;if(this.__config.picklistType==="edit"&&this.__config.selectedRecord.data.Id){e=this.__config.selectedRecord.data.Id;}var j=Ext.getCmp("picklist-values-field").getValue();var b=j.replace(/\n\s*\n/g,"\n");var q=b.split("\n");var n=[];for(var g=0;g<q.length;g++){var p=q[g];var f=p.replace(/^\s+$/,"");if(f.length>0){n.push(p);}}var c=Ext.getCmp("picklist-description-field").getValue();var d=this.__picklistNameField.value;d=$.trim(d);c=$.trim(c);var m={values:n,setDefaultValue:this.__picklistCheckboxField.value};var h=JSON.stringify(m);var l=this.__validateTextAndTextAreaLength(d,c,h);if(!l.isValid){SVMX.getCurrentApplication().showQuickMessage($TR.MESSAGE_ERROR,l.errorMessage);}else{SVMX.getCurrentApplication().blockUI();var o=SVMX.create("com.servicemax.client.lib.api.Event","INSTALLIGENCEADMIN.SAVE_PICKLIST_DATA",k,{request:{context:k,sfid:e,name:d,description:c,values:m}});SVMX.getCurrentApplication().getEventBus().triggerEvent(o);}},onSaveSetupPicklistDataComplete:function(f){SVMX.getCurrentApplication().unblockUI();if(!f.isValidPicklistDefinition){SVMX.getCurrentApplication().showQuickMessage($TR.MESSAGE_ERROR,$TR.PICKLIST_EXITS_ERROR_MESSAGE);}else{var e=this.__config.grid.getStore();var j=JSON.stringify(f.picklistValues);var d={};d.Id=f.sfdcId;d[SVMX.OrgNamespace+"__SM_Name__c"]=f.name;d[SVMX.OrgNamespace+"__SM_Description__c"]=f.description;d[SVMX.OrgNamespace+"__SM_Values__c"]=j;if(this.__config.picklistType==="edit"){var g=e.getAt(this.__config.rowIndex);g.data=d;var c=e.data.items;e.loadData(c);}else{e.add(d);var h=e.data.items.length-1;var b=this.__config.grid.getView();Ext.get(b.getRow(h)).scrollIntoView(b.getEl(),null,true);}this.__win.close();}},__validateTextAndTextAreaLength:function(k,d,g){var c={isValid:true,errorMessage:""};var b=this.__config.metadata[SVMX.OrgNamespace+"__SM_TA_Picklist_Definition__c"].fields,e=b.length;for(var f=0;f<e;f++){var h=b[f];switch(h.fieldAPIName){case SVMX.OrgNamespace+"__SM_Name__c":if(k.length>h.fieldLength){c.errorMessage=$TR.PICKLIST_NAME+" : "+$TR.TOO_LONG;c.isValid=false;}break;case SVMX.OrgNamespace+"__SM_Description__c":if(d.length>h.fieldLength){c.errorMessage=$TR.PICKLIST_DESCRIPTION+" : "+$TR.TOO_LONG;c.isValid=false;}break;case SVMX.OrgNamespace+"__SM_Values__c":if(g.length>h.fieldLength){c.errorMessage=$TR.PICKLIST_VALUES+" : "+$TR.TOO_LONG;c.isValid=false;}break;}}return c;}});};})();