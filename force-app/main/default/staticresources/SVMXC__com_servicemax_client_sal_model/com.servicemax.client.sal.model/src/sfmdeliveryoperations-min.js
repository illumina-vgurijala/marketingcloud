(function(){var a=SVMX.Package("com.servicemax.client.sal.model.sfmdelivery.operations");a.init=function(){var f=com.servicemax.client.sal.model.impl.ModelState;var c=com.servicemax.client.sal.model.impl.Module;var b=com.servicemax.client.sfmdelivery.operationutils.Utilities;var d=com.servicemax.client.lib.datetimeutils.DatetimeUtil;var e=SVMX.getProfilingService();addJSRDataToProfiler=function(k){var h=k.details||[];var j=null;for(var g=0;g<h.length;g++){j=h[g];if(!!e.addServerEntry){e.addServerEntry(j);}}};getProfileDataFromResult=function(g){var h=null;if(!!g.data){if(!!g.data.response){if(!!g.data.response.profileData){h=g.data.response.profileData;}}}else{if(!!g.response){if(!!g.response.profileData){h=g.response.profileData;}}}return h;};a.Class("GetPageLayout",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,j){var g=c.instance,o="",n=null,p=true;var i=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();o="SFMDELIVERY-PROCESS-LMD-"+k.processId;var h=i.getProcessLMD();var m=g.getItemFromCache(o);if(m!==undefined&&m!==null){if(h>m){p=false;}}g.setItemToCache(o,h);o="SFMDELIVERY-PAGELAYOUT-"+k.processId;if(p){n=g.getItemFromCache(o);}else{SVMX.getLoggingService().getLogger().info("Process information in the cache is out-dated. It will be updated now.");}if(n){setTimeout(function(){j.result(n);},1);}else{var l={processId:k.processId,recordId:k.recordId};if(c.instance.useJsr){SVMXJsr.JsrGetPageLayout(l,function(q,r){var t=getProfileDataFromResult(q);if(!!t){addJSRDataToProfiler(t);}if(g.checkResponseStatus("GetPageLayout",q,false,this)==true){this.__cacheDefinitions(k,q,p);var s=this.__restructureData(q);g.setItemToCache(o,s);j.result(s);}},this);}else{c.instance.createServiceRequest({handler:function(q){q.bind("REQUEST_COMPLETED",function(r){if(g.checkResponseStatus("GetPageLayout",r.data,false,this)==true){this.__cacheDefinitions(k,r.data,p);var s=this.__restructureData(r.data);g.setItemToCache(o,s);j.result(s);}},this);q.callMethodAsync({methodName:"getPageLayout",data:l});},context:this},this);}}},__cacheDefinitions:function(j,k,p){this.__cacheLookupDefinitions(k);this.__cacheDetailMappedLiterals(j,k);this.__cacheChildRecordTemplates(j,k);this.__cacheRecordTypeTranslations(j,k);if(!p){var q=[k.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"]];var g=k.page.details,m,h=g.length,o;for(m=0;m<h;m++){var n=g[m];q[m+1]=n.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"];}h=q.length;for(m=0;m<h;m++){o="SFMDELIVERY-DESCRIBE_OBJECT_"+q[m];c.instance.clearItemFromCache(o);}}},__cacheRecordTypeTranslations:function(k,l){var j=l.page.recordTypeList||[];var i={},h,g;if(j.length){h=j[0].value1;SVMX.array.forEach(j,function(m){if(!i[m.value1]){i[m.value1]={};}i[m.value1][m.key]=m.value;});for(h in i){g="SFMDELIVERY-RECORDTYPE-TRANSLATIONS-"+h;c.instance.setItemToCache(g,i[h]);}}},__cacheDetailMappedLiterals:function(m,n){var g=n.page.details;if(g&&g.length>0){var o,j=g.length,h,p,k,q;for(o=0;o<j;o++){h=g[o].mappedLiterals;p=g[o].mappedValues;k=g[o].dtlLayoutId;q="SFMDELIVERY-DETAIL-MAPPED-INFO-"+m.processId+"-"+k;c.instance.setItemToCache(q,SVMX.cloneObject({mappedLiterals:h,mappedValues:p}));}}},__cacheChildRecordTemplates:function(o,p){var g=p.page.details;if(g&&g.length>0){var q,k=g.length,j,n,m,r;for(q=0;q<k;q++){j=g[q].recordTemplate;if(!j){continue;}n=g[q].dtlLayoutId;m=[{sobjectinfo:j,bubbleInfo:[]}];for(var h in j){if(h=="attributes"||h=="attributes__key"){continue;}m[0].bubbleInfo.push({fieldapiname:h,fieldvalue:{value:j[h],value1:j[h]}});}r="SFMDELIVERY-ADDRECORDS-TEMPLATE-"+o.processId+"-"+n;c.instance.setItemToCache(r,m);}}},__cacheLookupDefinitions:function(n){if(n.page.lookupDefinitions){var h=SVMX.cloneObject(n.page.lookupDefinitions),k,g=h.length,j,m;delete n.page.lookupDefinitions;for(k=0;k<g;k++){m=h[k];j="SFMDELIVERY-LOOKUP-CONFIG-"+m.key;c.instance.setItemToCache(j,m);}}},__restructureData:function(j){var k=j.response.stringMap,h,g=k.length;for(h=0;h<g;h++){if(k[h].key=="PROCESSTYPE"){j.response.sfmProcessType=k[h].value;break;}}switch(j.response.sfmProcessType){case"SOURCETOTARGET":j.response.sfmProcessType="SOURCE TO TARGET ALL";break;case"SOURCETOTARGETONLYCHILDROWS":j.response.sfmProcessType="SOURCE TO TARGET CHILD";break;case"EDIT":j.response.sfmProcessType="STANDALONE EDIT";break;case"VIEWRECORD":j.response.sfmProcessType="VIEW RECORD";break;}return j;}},{});a.Class("GetDetailMappedInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,g){var j=c.instance,i="",h=null;i="SFMDELIVERY-DETAIL-MAPPED-INFO-"+k.processId+"-"+k.alias;h=j.getItemFromCache(i);SVMX.doLater(function(){g.result(h);});}},{});a.Class("RetrieveSettings",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){if(window.svmx_sfm_delivery_settings!=undefined&&window.svmx_sfm_delivery_settings!=null){setTimeout(function(){ret=window.svmx_sfm_delivery_settings;
ret=SVMX.toObject(ret);g.result(ret);},1);}else{c.instance.createServiceRequest({handler:function(i){i.bind("REQUEST_COMPLETED",function(j){if(c.instance.checkResponseStatus("RetrieveSettings",j.data,false,this)==true){g.result(j.data);}},this);i.callMethodAsync({methodName:"retrieveSettings",data:h});},context:this},this);}}},{});a.Class("GetLookupConfig",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,m){var x={},A=k.callType,z="SFMDELIVERY-LOOKUP-CONFIG-",o=false,h={namesearchinfo:{namedSearch:[{namedSearchHdr:{},namedSearchDetails:[{fields:[]}]}]},data:[],advFilters:[]};if(k.LookupRecordId){z+=k.LookupRecordId;}else{z+=k.ObjectName;}var g=c.instance.getItemFromCache(z),B=m.__parent.getReferenceMetaModel();var p=b.replaceLiteralsWithValue(g.lookupDefDetail.preFilterCriteria,B,z);k.preFilterCriteria=p;if(!g){c.instance.checkResponseStatus("GetLookupConfig",{success:false,message:"Could not find the lookup definition. This may be due to outdated client cache. Please clear the cache and try again!"},false,this);return;}var r=h.namesearchinfo.namedSearch[0].namedSearchHdr,y=h.namesearchinfo.namedSearch[0].namedSearchDetails[0],s=y.fields,u,t;r[SVMX.OrgNamespace+"__Default_Lookup_Column__c"]=g.lookupDefDetail.defaultLookupColumn;var v=g.lookupDefDetail.displayFields,j;t=v.length;SVMX.array.forEach(v,function(i){s.push(this.__createFieldObject(i));},this);var w=SVMX.cloneObject(g);w=b.extractDefWithFiltersToQuery(k,w);var q=this.__isPFCValueEmpty(k.preFilterCriteria);if(k.preFilterCriteria!=undefined&&k.preFilterCriteria!=null&&k.preFilterCriteria!=""&&(!q)){w.lookupDefDetail.preFilterCriteria=k.preFilterCriteria;}else{delete w.lookupDefDetail.preFilterCriteria;}w.lookupDefDetail.formFillFields=SVMX.array.map(k.formFillFields,function(C,l){return{apiName:C,dataType:null,fieldRelationshipName:null,operandType:null,refObjectName:null,refObjectNameField:null};});if(A=="DATA"||A=="BOTH"){o=true;x.lookupRequest={LookupDef:w,KeyWord:k.KeyWord,Operator:k.SearchOperator,ContextValue:k.LookupContext,ContextMatchField:k.LookupQueryField};if(c.instance.useJsr){SVMXJsr.JsrGetLookupData(x,function(i,l){var C=getProfileDataFromResult(i);if(!!C){addJSRDataToProfiler(C);}if(c.instance.checkResponseStatus("GetLookupConfig",i,false,this)==true){h.data=this.__createDisplayRecords(i.records,s);h.advFilters=g.advFilters;m.result(h);}},this);}else{c.instance.createServiceRequest({handler:function(i){i.bind("REQUEST_COMPLETED",function(l){if(c.instance.checkResponseStatus("GetLookupConfig",l.data,false,this)==true){h.data=this.__createDisplayRecords(l.data.records,s);h.advFilters=g.advFilters;m.result(h);}},this);i.callMethodAsync({methodName:"getLookupData",data:x});},context:this},this);}}if(!o){var n=k.LookupRecordId;if(!n){n=k.ObjectName;}h.data=this.__createDisplayRecords(com.servicemax.client.sal.model.impl.LookupCacheUtil.getFromCache(n));if(g.advFilters.length>0&&h.advFilters.length==0){h.advFilters=g.advFilters;}m.result(h);}},__createFieldObject:function(h){var g={};g[SVMX.OrgNamespace+"__Field_Name__c"]=h.apiName;g[SVMX.OrgNamespace+"__Sequence__c"]=h.sequence;g[SVMX.OrgNamespace+"__Search_Object_Field_Type__c"]="Result";g.nameField=h.refObjectNameField;g.dataType=h.dataType;g.relationshipName=h.fieldRelationshipName;return g;},__isPFCValueEmpty:function(h){var m,k,g=["<",">","=","LIKE"],l=0;if(h==null){return true;}for(l=0;l<g.length;l++){var j=h.indexOf(g[l]);if(j>0){m=g[l];k=j;}}if(m&&h.length>k+1){return false;}return true;},__createDisplayRecords:function(k,h){var q=[];if(k){var o,m=k.length,n,t,p,s,r,g,j;for(o=0;o<m;o++){n={FieldMap:[]};p=k[o];for(t in p){if(t=="attributes"){continue;}s=p[t];if(h){g=this.__getFieldInfo(h,t);if(g&&g.dataType=="REFERENCE"){j=g.relationshipName;if(p[j]){n.FieldMap.push({ftype:"Reference",key:t+"__key",value:s});s=p[j][g.nameField];}}}n.FieldMap.push({ftype:"Result",key:t,value:s});}q.push(n);}}return q;},__getFieldInfo:function(k,m){var j,g=k.length,h=null;for(j=0;j<g;j++){if(k[j][SVMX.OrgNamespace+"__Field_Name__c"]==m){h=k[j];break;}}return h;}},{});a.Class("GetUserInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){if(window.svmx_sfm_delivery_userinfo!=undefined&&window.svmx_sfm_delivery_userinfo!=null){setTimeout(function(){ret=window.svmx_sfm_delivery_userinfo;ret=SVMX.toObject(ret);c.instance.setUserInfo(ret);g.result(ret);},1);}else{c.instance.createServiceRequest({handler:function(i){i.bind("REQUEST_COMPLETED",function(j){c.instance.setUserInfo(j.data);g.result(j.data);});i.callMethodAsync({methodName:"getUserInfo",data:h});},context:this},this);}}},{});a.Class("DescribeObject_OLD",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,g){var j=c.instance,i="SFMDELIVERY-DESCRIBE_OBJECT_"+k.objectName;var h=j.getItemFromCache(i);if(h){setTimeout(function(){g.result(h);},1);}else{c.instance.createServiceRequest({handler:function(l){l.bind("REQUEST_COMPLETED",function(m){if(j.checkResponseStatus("DescribeObject",m.data,false,this)==true){j.setItemToCache(i,m.data);
g.result(m.data);}},this);l.callApiAsync({url:"sobjects/"+k.objectName+"/describe",data:{objectName:k.objectName}});},context:this},this);}}},{});a.Class("DescribeObject",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},getObjectDescribe:function(j){var i=c.instance,h="SFMDELIVERY-DESCRIBE_OBJECT_"+j;var g=i.getItemFromCache(h);return g;},performAsync:function(l,k){var g=c.instance,u="SFMDELIVERY-DESCRIBE_OBJECT_"+l.objectName;var p=g.getItemFromCache(u),h=true;var o=SVMX.getClient().getApplicationParameter("svmx-use-server-cache");if(o===false){h=false;SVMX.getLoggingService().getLogger().info("Server cache is disabled. Using the SFDC meta api");}if(p){var t=p.fields;if(typeof t!=="object"){var n=[];for(var m=0;m<t;m++){var s=u+"_field_"+m;var r=g.getItemFromCache(s);n.push(r);}p.fields=n;}setTimeout(function(){k.result(p);},1);}else{var j={objectName:l.objectName};if(h){if(c.instance.useJsr){SVMXJsr.JsrDescribeObject(j,function(i,v){var w=getProfileDataFromResult(i);if(!!w){addJSRDataToProfiler(w);}if(c.instance.checkResponseStatus("DescribeObject",i,false,this)==true){this.__cacheDefinitions(u,j,i);k.result(i);}},this);}else{c.instance.createServiceRequest({handler:function(i){i.bind("REQUEST_COMPLETED",function(v){if(g.checkResponseStatus("DescribeObject",v.data,false,this)==true){this.__cacheDefinitions(u,j,v.data);k.result(v.data);}},this);i.callMethodAsync({methodName:"getObjectDescription",data:j});},context:this},this);}}else{var q=this;this.__describeViaApi(j,function(i){q.__cacheDefinitions(u,j,i);k.result(i);});}}},__describeViaApi:function(g,h){c.instance.createServiceRequest({handler:function(i){i.bind("REQUEST_COMPLETED",function(t){var n=SVMX.xmlToJson(t.data),j=null;n=n.Envelope.Body.describeSObjectResponse.result;if(!n.recordTypeInfos){n.recordTypeInfos=[];}if(!(n.recordTypeInfos instanceof Array)){n.recordTypeInfos=[n.recordTypeInfos];}if(!(n.fields instanceof Array)){n.fields=[n.fields];}var p,q=n.fields,k=q.length,r;for(p=0;p<k;p++){r=q[p];r.dataType=r.type;r.accessible=true;if(!r.picklistValues){r.picklistValues=[];}if(!(r.picklistValues instanceof Array)){r.picklistValues=[r.picklistValues];}if(r.dataType=="boolean"){r.picklistValues=[{label:"false",value:"false"},{label:"true",value:"true"}];}}var o=c.instance.getItemFromCache("SFMDELIVERY-RECORDTYPE-TRANSLATIONS-"+g.objectName);var s=n.recordTypeInfos,m=[];k=s.length;for(p=0;p<k;p++){if(o&&o[s[p].recordTypeId]||!o&&s[p].name!=="Master"){m.push(s[p].recordTypeId);}}if(m.length>0){c.instance.createServiceRequest({handler:function(l){l.bind("REQUEST_COMPLETED",function(u){j=SVMX.xmlToJson(u.data);j=j.Envelope.Body.describeLayoutResponse.result;b.processDescribeResult(n,j);h(n);return;},this);l.callApiSync({methodName:"describeLayout",data:{sObjectType:g.objectName,recordTypeIds:m}});},context:this,options:{type:"SOAP"}},this);}else{b.processDescribeResult(n,j);h(n);return;}},this);i.callApiSync({methodName:"describeSObject",data:{sObjectType:g.objectName}});},context:this,options:{type:"SOAP"}},this);},__cacheDefinitions:function(g,h,i){this.__cacheRecordTypes(h,i);this.__cacheDescribeInfo(g,i);},__cacheDescribeInfo:function(j,l){var n=SVMX.cloneObject(l);var g=n.fields;if(g&&g.length>0){n.fields=g.length;var k=g.length;for(var h=0;h<k;h++){var m=j+"_field_"+h;c.instance.setItemToCache(m,g[h]);}}c.instance.setItemToCache(j,n);},__cacheRecordTypes:function(n,o){var k=o.recordTypeMapping,j,g,m,h="SFMDELIVERY-RECORDTYPES-"+n.objectName;if(k){c.instance.setItemToCache(h,k);delete o.recordTypeMapping;}}},{});a.Class("SaveTargetRecord",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(j,h){var g=SVMX.create("com.servicemax.client.sfmdelivery.operationutils.SFMTargetRecord",j.data,j.metadata,j.additionalInfo);var i=g.getRequest();i=this._normalizeDatetimes(i,j.metadata);if(c.instance.useJsr){SVMXJsr.JsrSaveTarget(i,function(k,l){var q=getProfileDataFromResult(k);if(!!q){addJSRDataToProfiler(q);}if(c.instance.checkResponseStatus("SaveTargetRecord",k,false,this)==true){var p=j.data;if(k&&k.resultIds&&k.resultIds.length>0){p.setTargetRecordId(k.resultIds[0]);}if(j.deliveryEngine.getMetaModel().getProcessType()==="CHECKLIST"){var m=this.isLocalAttachment(j);if(m){var o={request:j,responder:h,result:k};var n=SVMX.create("com.servicemax.client.sal.model.impl.UploadAttachment",o);n.uploadAttachments();}else{h.result(k);}}else{h.result(k);}}},this);}else{c.instance.createServiceRequest({handler:function(k){k.bind("REQUEST_COMPLETED",function(l){if(c.instance.checkResponseStatus("SaveTargetRecord",l.data,false,this)==true){var m=j.data;if(l.data&&l.data.resultIds&&l.data.resultIds.length>0){m.setTargetRecordId(l.data.resultIds[0]);}h.result(l.data);}},this);k.callMethodAsync({methodName:"saveTarget",data:i});},context:this},this);}},isLocalAttachment:function(m){var k=false;var h=m.data.__attachementData.__attachementDataHash;if(h){var j=Object.keys(h);var i=j.length;
for(var l=0;l<i;l++){var g=h[j[l]];if(g&&!g[SVMX.OrgNamespace+"__SM_Attachment_ID__c"]){k=true;break;}}}return k;},_normalizeDatetimes:function(k,r){var h={};var i={};var q,p,m;if(k.page===null||k.headerRecord===undefined){return k;}for(q in r.page.header.sections){for(p in r.page.header.sections[q].fields){m=r.page.header.sections[q].fields[p].fieldDetail;if(m===undefined||m===null){continue;}if(SVMX.OrgNamespace+"__DataType__c" in m&&SVMX.OrgNamespace+"__Field_API_Name__c" in m){if(m[SVMX.OrgNamespace+"__DataType__c"]=="datetime"||m[SVMX.OrgNamespace+"__DataType__c"]=="date"){h[m[SVMX.OrgNamespace+"__Field_API_Name__c"]]=m[SVMX.OrgNamespace+"__DataType__c"];}}}}for(q in r.page.details){for(p in r.page.details[q].fields){m=r.page.details[q].fields[p].fieldDetail;if(m===undefined||m===null){continue;}if(SVMX.OrgNamespace+"__DataType__c" in m&&SVMX.OrgNamespace+"__Field_API_Name__c" in m){if(m[SVMX.OrgNamespace+"__DataType__c"]=="datetime"||m[SVMX.OrgNamespace+"__DataType__c"]=="date"){i[m[SVMX.OrgNamespace+"__Field_API_Name__c"]]=m[SVMX.OrgNamespace+"__DataType__c"];}}}}var j,n,l,g;for(l=0;l<k.headerRecord.records.length;l++){for(g=0;g<k.headerRecord.records[l].targetRecordAsKeyValue.length;g++){j=k.headerRecord.records[l].targetRecordAsKeyValue[g];if(j.key===undefined||h[j.key]===undefined||h[j.key]===null){continue;}n=h[j.key];if(n=="datetime"){j.value=d.convertToTimezone(j.value);k.headerRecord.records[l].targetRecordAsKeyValue[g].value=d.getFormattedDatetime(j.value,"YYYY-MM-DD[T]HH:mm:ss");k.headerRecord.records[l].targetRecordAsKeyValue[g].value1=d.getFormattedDatetime(j.value,"YYYY-MM-DD[T]HH:mm:ss");}else{if(n=="date"){k.headerRecord.records[l].targetRecordAsKeyValue[g].value=d.getFormattedDatetime(j.value,"YYYY-MM-DD");k.headerRecord.records[l].targetRecordAsKeyValue[g].value1=d.getFormattedDatetime(j.value,"YYYY-MM-DD");}}}}j=undefined;n=undefined;for(var o=0;o<k.detailRecords.length;o++){for(l=0;l<k.detailRecords[o].records.length;l++){for(g=0;g<k.detailRecords[o].records[l].targetRecordAsKeyValue.length;g++){j=k.detailRecords[o].records[l].targetRecordAsKeyValue[g];if(i[j.key]===undefined||i[j.key]===null){continue;}n=i[j.key];if(n=="datetime"){j.value=d.convertToTimezone(j.value);k.detailRecords[o].records[l].targetRecordAsKeyValue[g].value=d.getFormattedDatetime(j.value,"YYYY-MM-DD[T]HH:mm:ss");k.detailRecords[o].records[l].targetRecordAsKeyValue[g].value1=d.getFormattedDatetime(j.value,"YYYY-MM-DD[T]HH:mm:ss");}else{if(n=="date"){k.detailRecords[o].records[l].targetRecordAsKeyValue[g].value=d.getFormattedDatetime(j.value,"YYYY-MM-DD");k.detailRecords[o].records[l].targetRecordAsKeyValue[g].value1=d.getFormattedDatetime(j.value,"YYYY-MM-DD");}}}}}return k;}},{});a.Class("SaveTargetAttachmentRecord",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,h){var j=k.additionalInfo;j.eventType="save checklist attachment";var g=SVMX.create("com.servicemax.client.sfmdelivery.operationutils.SFMTargetAttachmentRecord",k,k.metadata,k.additionalInfo);var i=g.getRequest();if(c.instance.useJsr){SVMXJsr.JsrSaveTarget(i,function(l,m){h.result(k.data.result);},this);}}},{});a.Class("GetPageData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(i,g){this.objectNameMap=i.objectNameMap;if(i.layout!==undefined&&i.layout!==null){this.layout=i.layout;}i=this.__prepareRequestObject(i);var h=f.getInstance().remove("pageData");if(h){g.result(h);}else{if(window.svmx_sfm_delivery_page_data!=undefined&&window.svmx_sfm_delivery_page_data!=null){console.warn("Unsupported use of embedded page data in HTML/VF! Embedded page data has been deprecated as of Summer 15.");h=window.svmx_sfm_delivery_page_data;h=SVMX.toObject(h);window.svmx_sfm_delivery_page_data=null;h.data.objectNameMap=this.objectNameMap;g.result(SVMX.create("com.servicemax.client.sal.model.impl.SFMDeliveryData",h.data));}else{if(c.instance.useJsr){SVMXJsr.JsrGetPageData(i,function(j,k){var l=getProfileDataFromResult(j);if(!!l){addJSRDataToProfiler(l);}if(c.instance.checkResponseStatus("GetPageData",j,false,this)==true){this.__processResponseData(j,i,g);}},this);}else{c.instance.createServiceRequest({handler:function(j){j.bind("REQUEST_COMPLETED",function(k){this.__processResponseData(k.data,i,g);},this);j.callMethodAsync({methodName:"getPageData",data:i});},context:this},this);}}}},__prepareRequestObject:function(i){var g={processId:true,recordId:true,targetId:true,qualify:true,actionType:true};if(i){if(i.refreshData){i.actionType="QuickSave";}for(var h in i){if(!g[h]){delete i[h];}}}return i;},__processResponseData:function(j,i,g){if(c.instance.checkResponseStatus("GetPageData",j,false,this)==true){var k=null;if(i.qualify&&!j.isQualified){k={isQualified:false};}else{if(j.data.pageDataSet.sobjectinfo){j.data.objectNameMap=this.objectNameMap;if(this.layout!==undefined){j.data=this._normalizeDatetimes(j.data,this.layout);}k=SVMX.create("com.servicemax.client.sal.model.impl.SFMDeliveryData",j.data);
}else{if(j.data.pageDataSet.lstSobjectinfo!=undefined&&j.data.pageDataSet.lstSobjectinfo.length>0){var h=SVMX.cloneObject(j.data.pageDataSet.lstSobjectinfo[0]);if(h.hasOwnProperty([SVMX.OrgNamespace+"__ChecklistMetaJSON__c"])&&j.data.pageDataSet.lstSobjectinfo.length>1){h[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]=j.data.pageDataSet.lstSobjectinfo.map(function(l){return l.hasOwnProperty(SVMX.OrgNamespace+"__ChecklistMetaJSON__c")?l[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]:"";}).join("");}j.data.pageDataSet.sobjectinfo=h;j.data.objectNameMap=this.objectNameMap;if(this.layout!==undefined){j.data=this._normalizeDatetimes(j.data,this.layout);}j.data.response.processType="CHECKLIST";k=SVMX.create("com.servicemax.client.sal.model.impl.SFMDeliveryData",j.data);}}}g.result(k);}},_normalizeDatetimes:function(j,p){var g={};var h={};var o,n,l;if(j.pageDataSet===null||j.pageDataSet===undefined){return j;}for(o in p.page.header.sections){for(n in p.page.header.sections[o].fields){l=p.page.header.sections[o].fields[n].fieldDetail;if(l===undefined||l===null){continue;}if(SVMX.OrgNamespace+"__DataType__c" in l&&SVMX.OrgNamespace+"__Field_API_Name__c" in l){if(l[SVMX.OrgNamespace+"__DataType__c"]=="datetime"||l[SVMX.OrgNamespace+"__DataType__c"]=="date"){g[l[SVMX.OrgNamespace+"__Field_API_Name__c"]]=l[SVMX.OrgNamespace+"__DataType__c"];}}}}for(o in p.page.details){for(n in p.page.details[o].fields){l=p.page.details[o].fields[n].fieldDetail;if(l===undefined||l===null){continue;}if(SVMX.OrgNamespace+"__DataType__c" in l&&SVMX.OrgNamespace+"__Field_API_Name__c" in l){if(l[SVMX.OrgNamespace+"__DataType__c"]=="datetime"||l[SVMX.OrgNamespace+"__DataType__c"]=="date"){h[l[SVMX.OrgNamespace+"__Field_API_Name__c"]]=l[SVMX.OrgNamespace+"__DataType__c"];}}}}delete g.CreatedDate;delete g.LastActivityDate;delete g.LastModifiedDate;delete g.LastReferencedDate;delete g.LastViewedDate;delete g.SystemModstamp;delete h.CreatedDate;delete h.LastActivityDate;delete h.LastModifiedDate;delete h.LastReferencedDate;delete h.LastViewedDate;delete h.SystemModstamp;var i;var m;for(n=0;n<j.pageDataSet.bubbleInfo.length;n++){i=j.pageDataSet.bubbleInfo[n];if(g[i.fieldapiname]===undefined||g[i.fieldapiname]===null){continue;}m=g[i.fieldapiname];if(m=="datetime"){i.fieldvalue.key=d.convertToTimezone(i.fieldvalue.key,undefined,true);j.pageDataSet.bubbleInfo[n].fieldvalue.key=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD[T]HH:mm:ss");j.pageDataSet.bubbleInfo[n].fieldvalue.value=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD[T]HH:mm:ss");}else{if(m=="date"){j.pageDataSet.bubbleInfo[n].fieldvalue.key=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD");j.pageDataSet.bubbleInfo[n].fieldvalue.value=d.getFormattedDatetime(i.fieldvalue.value,"YYYY-MM-DD");}}}i=undefined;m=undefined;for(n in g){i=j.pageDataSet.sobjectinfo[n];if(i===undefined||i===null){continue;}m=g[n];if(m=="datetime"){i=d.convertToTimezone(i.split("+")[0],undefined,true);j.pageDataSet.sobjectinfo[n]=d.getFormattedDatetime(i,"YYYY-MM-DD[T]HH:mm:ss");}else{if(m=="date"){j.pageDataSet.sobjectinfo[n]=d.getFormattedDatetime(i,"YYYY-MM-DD");}}}i=undefined;m=undefined;for(var l=0;l<j.detailDataSet.length;l++){for(var k=0;k<j.detailDataSet[l].pageDataSet.length;k++){if(!j.detailDataSet[l].pageDataSet[k].bubbleInfo){continue;}for(var n=0;n<j.detailDataSet[l].pageDataSet[k].bubbleInfo.length;n++){i=j.detailDataSet[l].pageDataSet[k].bubbleInfo[n];if(!("fieldapiname" in i)){continue;}if(h[i.fieldapiname]===undefined||h[i.fieldapiname]===null){continue;}m=h[i.fieldapiname];if(m=="datetime"){i.fieldvalue.key=d.convertToTimezone(i.fieldvalue.key,undefined,true);j.detailDataSet[l].pageDataSet[k].bubbleInfo[n].fieldvalue.key=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD[T]HH:mm:ss");j.detailDataSet[l].pageDataSet[k].bubbleInfo[n].fieldvalue.value=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD[T]HH:mm:ss");}else{if(m=="date"){j.detailDataSet[l].pageDataSet[k].bubbleInfo[n].fieldvalue.key=d.getFormattedDatetime(i.fieldvalue.key,"YYYY-MM-DD");j.detailDataSet[l].pageDataSet[k].bubbleInfo[n].fieldvalue.value=d.getFormattedDatetime(i.fieldvalue.value,"YYYY-MM-DD");}}}i=undefined;m=undefined;for(n in h){i=j.detailDataSet[l].pageDataSet[k].sobjectinfo[n];if(i===undefined||i===null){continue;}m=h[n];if(m=="datetime"){i=d.convertToTimezone(i,undefined,true);j.detailDataSet[l].pageDataSet[k].sobjectinfo[n]=d.getFormattedDatetime(i,"YYYY-MM-DD[T]HH:mm:ss");}else{if(m=="date"){j.detailDataSet[l].pageDataSet[k].sobjectinfo[n]=d.getFormattedDatetime(i,"YYYY-MM-DD");}}}}}return j;}},{});a.Class("GetTemplateData",com.servicemax.client.mvc.api.Operation,{__sourceRecordId:null,__constructor:function(){this.__base();},performAsync:function(i,g){this.objectNameMap=i.objectNameMap;this.__sourceRecordId=i.recordId;window.svmx_sfm_delivery_is_sfmprocess=true;window.svmx_sfm_delivery_is_qualified=true;i=this.__prepareRequestObject(i);var h=f.getInstance().remove("pageData");if(h){g.result(h);}else{if(window.svmx_sfm_delivery_page_data!=undefined&&window.svmx_sfm_delivery_page_data!=null){h=window.svmx_sfm_delivery_page_data;
h=SVMX.toObject(h);window.svmx_sfm_delivery_page_data=null;h.data.objectNameMap=this.objectNameMap;g.result(SVMX.create("com.servicemax.client.sal.model.impl.SFMDeliveryData",h.data));}else{if(c.instance.useJsr){SVMXJsr.JsrGetListOfChecklist(i,function(j,k){var l=getProfileDataFromResult(j);if(!!l){addJSRDataToProfiler(l);}if(c.instance.checkResponseStatus("GetTemplateData",j,false,this)==true){this.__processResponseData(j,i,g);}},this);}else{}}}},__prepareRequestObject:function(i){var g={processId:true,recordId:true};if(i){for(var h in i){if(!g[h]){delete i[h];}}}return i;},__processResponseData:function(j,i,h){if(c.instance.checkResponseStatus("GetTemplateData",j,false,this)==true){var k=null;if(i.qualify&&!j.isQualified){k={isQualified:false};}else{if(j.lstChecklistInfo!==undefined){var g={};g.objectNameMap=this.objectNameMap;g.pageDataSet={sobjectinfo:{attributes:{type:"Virtual__c"}},sourceRecordID:this.__sourceRecordId,sourceRecord:j.stringFieldMap,bubbleInfo:[{fieldapiname:"LIST_SECTION_FIELD_ID",fieldvalue:{key:"templates",value:j.lstChecklistInfo||[],value1:null}}]};k=SVMX.create("com.servicemax.client.sal.model.impl.SFMDeliveryData",g);}}h.result(k);}}},{});a.Class("GetNextStepInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(i,g){var h=i;if(!h.recordId){h.recordId=SVMX.getUrlParameter("SVMX_recordId");}if(c.instance.useJsr){SVMXJsr.JsrGetNextStepInfo(h,function(j,k){var m=getProfileDataFromResult(j);if(!!m){addJSRDataToProfiler(m);}if(c.instance.checkResponseStatus("GetNextStepInfo",j,true,this)==true){var l=j.message;g.result({nextStepUrl:l});}},this);}else{c.instance.createServiceRequest({handler:function(j){j.bind("REQUEST_COMPLETED",function(k){if(c.instance.checkResponseStatus("GetNextStepInfo",k.data,true,this)==true){var l=k.data.message;g.result({nextStepUrl:l});}},this);j.callMethodAsync({methodName:"getNextStepInfo",data:h});},context:this},this);}}},{});a.Class("InvokeEvent",com.servicemax.client.mvc.api.Operation,{__responder:null,__constructor:function(){this.__base();},performAsync:function(h,g){h.additionalInfo.eventType=h.event.eventType;this.__responder=g;var i=h.event;if(i.callType=="WEBSERVICE"){this.__invokeWebServiceEvent(h);}else{if(i.callType=="JAVASCRIPT"){this.__invokeJavaScriptEvent(h);}else{if(i.callType=="URL"){this.__invokeUrlEvent(h);}else{}}}},__invokeUrlEvent:function(h){var g=this;SVMX.openInBrowserWindow(h.event.target);setTimeout(function(){g.__responder.result();},1);},__invokeJavaScriptEvent:function(m){var j=m.event.eventId,l=this;var i=c.instance,h="SFMDELIVERY-SNIPPET-"+j;var k=i.getItemFromCache(h);if(k){setTimeout(function(){l.__invokeSnippet(k,m);},1);}else{var g={eventId:j};if(c.instance.useJsr){SVMXJsr.JsrGetSnippetForEvent(g,function(n,o){var p=getProfileDataFromResult(n);if(!!p){addJSRDataToProfiler(p);}this.__handleSnippetResponse(h,m,j,n);},this);}else{c.instance.createServiceRequest({handler:function(n){n.bind("REQUEST_COMPLETED",function(o){this.__handleSnippetResponse(h,m,j,o.data);},this);n.callMethodAsync({methodName:"getSnippetForEvent",data:g});},context:this},this);}}},__handleSnippetResponse:function(j,n,k,p){if(c.instance.checkResponseStatus("__invokeJavaScriptEvent",p,false,this)==true){var o=p.stringMap,h,g=o.length,m;for(h=0;h<g;h++){if(o[h].key=="EventData"){m=o[h].value;c.instance.setItemToCache(j,m);break;}}if(m){this.__invokeSnippet(m,n);}else{SVMX.getLoggingService().getLogger("SFM-SAL-MODEL-InvokeEvent").warning("No snippet found for =>"+k);this.__responder.fault();}}},__invokeSnippet:function(j,i){var g=SVMX.create("com.servicemax.client.sfmdelivery.operationutils.SFMTargetRecord",i.data,i.metadata,i.additionalInfo);var h=g.getRequest();$EXPR.SVMXEvalExpression(j,h,function(k){i.data.copyFromTargetRecord(k);this.__responder.result();},this);},__invokeWebServiceEvent:function(j){var h=SVMX.create("com.servicemax.client.sfmdelivery.operationutils.SFMTargetRecord",j.data,j.metadata,j.additionalInfo);var i=h.getRequest();var p,o;i.stringMap=[{key:"SVMX_processId",value:j.additionalInfo.processId},{key:"SVMX_recordId",value:(j.data.getRawValues().Id||SVMX.getUrlParameter("SVMX_recordId"))},{key:"SVMX_retURL",value:SVMX.getUrlParameter("SVMX_retURL")},{key:"SVMX_NxtStepID",value:j.additionalInfo.nextStepId}];try{var n=j.event.target,k=n.split("."),l=k[0],g=k[1];o=null;endPoint=l;if(l.indexOf("__")!=-1){l=l.split("__");endPoint=l[1];o=l[0];}}catch(m){SVMX.getLoggingService().getLogger().error("There was an error while processing target info for WEBSERVICE event => "+j.event.target+".."+m);responder.fault();return;}c.instance.createServiceRequest({handler:function(q){q.bind("REQUEST_COMPLETED",function(r){var u;try{var t=this.__processSoapXml(r.data);u=t.Envelope.Body;for(var s in u){u=u[s];break;}}catch(v){SVMX.getLoggingService().getLogger("SFM-SAL-MODEL-InvokeEvent").error("Can't processSoapXml!");this.__responder.result();return;}if(c.instance.checkResponseStatus("WS EVENT",u.result,false,this)==true){if(this.__checkForNavigation(u.result)==false){try{j.data.updateFromEvent(u.result);
}catch(v){SVMX.getLoggingService().getLogger("SFM-SAL-MODEL-InvokeEvent").warning("Could not update the client model from the event response. Ignoring. <"+v+">");}this.__responder.result();}}},this);q.callMethodAsync({methodName:g,data:i});},context:this,options:{type:"SOAP",endPoint:endPoint,namespace:o}},this);},__checkForNavigation:function(j){var h=this.__getFromResponse(j,"NAVIGATE_TO"),g=false;if(h){g=true;var i="";if(h.match(/^[a-zA-Z0-9]+$/)){i=(SVMX.getClient().getApplicationParameter("svmx-base-url")||"")+"/";}SVMX.navigateTo(i+h);}return g;},__getFromResponse:function(m,k){var n=m.response.stringMap,h=null;if(n){if(!(n instanceof Array)){n=[n];}var j,g=n.length;for(j=0;j<g;j++){if(n[j].key==k){h=n[j].value;break;}}}return h;},__processSoapXml:function(i){function j(o){var k;var n;var q=o.attributes;var r=o.childNodes;var m=o.nodeType;var l={};var p=-1;if(m==1&&q.length){p=-1;}else{if(m==3){l=o.nodeValue;}}while(n=r.item(++p)){m=n.nodeName;m=m.indexOf(":")!=-1?m.split(":")[1]:m;if(l.hasOwnProperty(m)){if(l.toString.call(l[m])!="[object Array]"){l[m]=[l[m]];}l[m].push(j(n));}else{l[m]=j(n);}}return l;}function h(k){for(var l in k){var m=k[l];if(m&&typeof(m)=="object"){if(m.hasOwnProperty("#text")){k[l]=m["#text"];}else{if(l=="value1"&&typeof(m)=="object"){k[l]=null;}else{if(l=="value"&&typeof(m)=="object"){k[l]=null;}else{if(l=="key"&&typeof(m)=="object"){k[l]=null;}else{h(m);}}}}}}return k;}var g=h(j(i));return g;}});a.Class("AddRecords",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(k,g){var h={processId:k.processId,alias:k.alias};var j=this.__addRecordsFromCache(k);var i=new a.DescribeObject().getObjectDescribe(k.objectName);if(j!=null){if(c.instance.checkResponseStatus("AddRecords",j,false,this)==true){b.addRecords_processData({request:k,responder:g,data:j,objectInfo:i,operation:this,cacheKey:"",onSuccess:function(l){g.result(l);}});}}else{if(c.instance.useJsr){SVMXJsr.JsrAddRecords(h,function(l,m){var n=getProfileDataFromResult(l);if(!!n){addJSRDataToProfiler(n);}if(c.instance.checkResponseStatus("AddRecords",l,false,this)==true){getOpUtils().addRecords_processData({request:k,responder:g,data:l,objectInfo:i,operation:this,cacheKey:this.__getCacheKey(k),onSuccess:function(o){g.result(o);}});}},this);}else{c.instance.createServiceRequest({handler:function(l){l.bind("REQUEST_COMPLETED",function(m){if(c.instance.checkResponseStatus("AddRecords",m.data,false,this)==true){getOpUtils().addRecords_processData({request:k,responder:g,data:m.data,objectInfo:i,operation:this,cacheKey:this.__getCacheKey(k)});}},this);l.callMethodAsync({methodName:"addRecords",data:h});},context:this},this);}}},__addRecordsFromCache:function(k){var i=c.instance,h=this.__getCacheKey(k);var j=i.getItemFromCache(h),g=j;if(j){SVMX.getLoggingService().getLogger("SFM-SAL-MODEL-AddRecords").info("Creating record(s) for <"+k.alias+"> from cache");}return g;},__getCacheKey:function(g){return"SFMDELIVERY-ADDRECORDS-TEMPLATE-"+g.processId+"-"+g.alias;}},{});a.Class("DeleteRecords",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){h.data.deleteDetailRecords(h.records,h.alias);g.result({});}},{});a.Class("LookupItemSelected",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){com.servicemax.client.sal.model.impl.LookupCacheUtil.addToCache(h);}},{});a.Class("GetBubbleData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(i,g){var h={RecordId:i.RecordId};if(i.LookupRecordId){h.LookupRecordId=i.LookupRecordId;}else{h.ObjectName=i.ObjectName;}if(c.instance.useJsr){SVMXJsr.JsrGetBubbleData(h,function(j,k){var l=getProfileDataFromResult(j);if(!!l){addJSRDataToProfiler(l);}if(c.instance.checkResponseStatus("GetBubbleData",j,false,this)==true){g.result(j);}},this);}else{c.instance.createServiceRequest({handler:function(j){j.bind("REQUEST_COMPLETED",function(k){if(c.instance.checkResponseStatus("GetBubbleData",k.data,false,this)==true){g.result(k.data);}},this);j.callMethodAsync({methodName:"getBubbleData",data:h});},context:this},this);}}},{});a.Class("GetRecordTypes",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(m,h){var l=c.instance,k="SFMDELIVERY-RECORDTYPES-"+m.objectName;var j=l.getItemFromCache(k);if(j){var n="SFMDELIVERY-RECORDTYPE-TRANSLATIONS-"+m.objectName;var g=l.getItemFromCache(n);if(g){SVMX.array.forEach(j,function(o){o.fixedName=g[o.recordTypeId];},this);}setTimeout(function(){h.result(j);},1);}else{var i={objectName:m.objectName};if(c.instance.useJsr){SVMXJsr.JsrGetRecordTypes(i,function(o,p){var q=getProfileDataFromResult(o);if(!!q){addJSRDataToProfiler(q);}if(c.instance.checkResponseStatus("GetRecordTypes",o,false,this)==true){l.setItemToCache(k,o);h.result(o);}},this);}else{c.instance.createServiceRequest({handler:function(o){o.bind("REQUEST_COMPLETED",function(p){if(c.instance.checkResponseStatus("GetRecordTypes",p.data,false,this)==true){l.setItemToCache(k,p.data);
h.result(p.data);}},this);o.callMethodAsync({methodName:"getRecordTypes",data:i});},context:this},this);}}}},{});a.Class("GetRecordAlreadyOpen",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){g.result(false);}});a.Class("GetViewProcesses",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(h,g){g.result([]);}},{});};})();