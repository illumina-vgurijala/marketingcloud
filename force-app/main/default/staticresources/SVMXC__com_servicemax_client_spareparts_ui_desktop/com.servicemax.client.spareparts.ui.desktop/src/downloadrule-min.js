(function(){var a=SVMX.Package("com.servicemax.client.spareparts.ui.desktop.downloadrule");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SPAREPARTS");Ext.define("com.servicemax.client.spareparts.ui.desktop.downloadrule.DownloadrulePanel",{extend:"Ext.form.FormPanel",id:"downloadrule",constructor:function(c){c=Ext.apply({title:b.T("TAG024","Download Criteria")},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var c=this;this.__downloadCriteriaGrid=SVMX.create("com.servicemax.client.spareparts.ui.desktop.downloadRule.CriteriaGrid",{});c.add(this.__downloadCriteriaGrid);},loadData:function(d,c,h){Ext.getCmp("addRowButton").setDisabled(false);var f=Ext.getStore("productStockStatus");f.loadData(d);var e=Ext.getStore("quantityFields");e.loadData(c);var g=Ext.getStore("downloadCriteria_store");if(h==null||h==""){h=[];}g.loadData(h);if(d.length!=h.length){Ext.getCmp("addRowButton").setDisabled(false);}}});Ext.define("com.servicemax.client.spareparts.ui.desktop.downloadRule.CriteriaGrid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",frame:true,viewConfig:{markDirty:false},initComponent:function(){this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,listeners:{beforeedit:function(f,i){var j=Ext.getStore("productStockStatus");j.clearFilter();if(i.colIdx==1){j.data.items.forEach(function(l,k){l.data.isUsed=false;});var h=i.rowIdx;var g=Ext.getCmp("sparePartsGrid").getStore().data.items;g.forEach(function(m,l){if(l!=h){var k=j.findExact("Id",m.data.productstockstatus);if(k!=-1){j.getAt(k).data.isUsed=true;}}});}},}});var e=SVMX.create("Ext.data.Store",{fields:[{name:"Id"},{name:"name"},{name:"isUsed"}],id:"productStockStatus",proxy:{type:"memory"}});this.productStockCombo=new Ext.form.field.ComboBox({typeAhead:true,triggerAction:"all",displayField:"name",valueField:"Id",queryMode:"local",typeAhead:true,editable:false,triggerAction:"all",selectOnTab:true,store:e,listConfig:{getInnerTpl:function(f){return"{[Ext.String.htmlEncode(values."+f+")]}";}},listeners:{expand:function(f){f.store.filter("isUsed",false);}}});var c=SVMX.create("Ext.data.Store",{fields:[{name:"Id"},{name:"name"}],id:"quantityFields",proxy:{type:"memory"}});this.quantityFieldCombo=new Ext.form.field.ComboBox({typeAhead:false,triggerAction:"all",displayField:"name",valueField:"Id",queryMode:"local",editable:false,triggerAction:"all",selectOnTab:true,store:c,listConfig:{getInnerTpl:function(f){return"{[Ext.String.htmlEncode(values."+f+")]}";}}});var d=SVMX.create("Ext.data.Store",{fields:[{name:"Id"},{name:"name"}],id:"serializedStore",proxy:{type:"memory"},data:[{Id:true,name:b.T("TAG025","Yes")},{Id:false,name:b.T("TAG026","No")}]});this.serializedCombo=new Ext.form.field.ComboBox({typeAhead:true,triggerAction:"all",displayField:"name",valueField:"Id",queryMode:"local",typeAhead:false,editable:false,triggerAction:"all",selectOnTab:true,store:d,listConfig:{getInnerTpl:function(f){return"{[Ext.String.htmlEncode(values."+f+")]}";}}});this.picklistRenderer=function(f){return function(h){var g=f.store.find(f.valueField,h);var i=f.store.getAt(g);return((i===null||i===undefined)?"":Ext.String.htmlEncode(i.get(f.displayField)));};};Ext.apply(this,{width:"60%",autoScroll:true,margin:"5",plugins:[this.cellEditing],id:"sparePartsGrid",cls:"spareparts-download-criteria",store:new Ext.data.Store({storeId:"downloadCriteria_store",fields:["productstockstatus","quantityfield","includeserializedstock",],}),columns:[{xtype:"actioncolumn",width:40,height:40,align:"center",sortable:false,menuDisabled:true,items:[{tooltip:b.T("TAG027","Delete"),scope:this,iconCls:"spareparts-delete-row-icon",cls:"spareparts-delete-row-icon",handler:this.onRemoveClick}]},{flex:1,text:b.T("TAG028","Product Stock Status"),dataIndex:"productstockstatus",align:"left",resizable:true,readOnly:true,editor:this.productStockCombo,renderer:this.picklistRenderer(this.productStockCombo)},{flex:1,text:b.T("TAG029","Quantity"),dataIndex:"quantityfield",align:"left",resizable:true,readOnly:true,editor:this.quantityFieldCombo,renderer:this.picklistRenderer(this.quantityFieldCombo)},{flex:1,text:b.T("TAG030","Include Serialized Stocks"),dataIndex:"includeserializedstock",align:"left",resizable:true,readOnly:true,editor:this.serializedCombo,renderer:this.picklistRenderer(this.serializedCombo)},],selModel:{selType:"cellmodel"},bbar:[{text:"+ "+b.T("TAG031","Add Row"),id:"addRowButton",scope:this,disabled:true,handler:this.onAddClick,cls:"spareparts-blue-link"}]});this.callParent();},onAddClick:function(f){var k=this.getStore().getCount();var g=Ext.getCmp("sparePartsGrid");var i=this.getStore().getAt(k-1);if(i!=null&&i!=""){if(i.data.productstockstatus==""){var c=g.getNode(k-1).childNodes[1].getAttribute("class");g.getNode(k-1).childNodes[1].setAttribute("class",c+" make-cell-dirty-lt");g.getNode(k-1).childNodes[1].setAttribute("data-qtip",b.T("TAG032","This is a required field."));
}else{var e=Ext.getStore("productStockStatus");e.clearFilter();var h=e.getCount();if(k<h){var d={productstockstatus:"",quantityfield:"",includeserializedstock:false};this.getStore().insert(k,d);if(k==h-1){f.setDisabled(true);}}}}else{var j={productstockstatus:"",quantityfield:"",includeserializedstock:false};this.getStore().insert(k,j);}},onRemoveClick:function(d,g,e,f){var c=this.getStore();c.removeAt(g);Ext.getCmp("addRowButton").setDisabled(false);}});};})();