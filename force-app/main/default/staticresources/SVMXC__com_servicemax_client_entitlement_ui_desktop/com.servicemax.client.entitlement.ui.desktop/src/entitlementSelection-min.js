(function(){var a=SVMX.Package("com.servicemax.client.entitlement.ui.desktop.api.entitlementSelection");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("ENTITLEMENT");Ext.define("com.servicemax.client.entitlement.ui.desktop.api.EntitlementSelectionPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",height:"100%",border:false,id:"entitlementSelection",__parentData:null,autoscroll:true,style:"top: 10px;",layout:"anchor",constructor:function(c){this.callParent([c]);},initComponent:function(){this.callParent(arguments);var n=this;var k=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{title:b.T("TAG067","Entitlement Selection"),bodyPadding:10,items:[],});var f=SVMX.create("Ext.form.Panel",{border:false,id:"entitlementInfoLabel",cls:"svmx-ent-entitlementInfoPanel",layout:{type:"vbox",},items:[]});k.add(f);var h=SVMX.create("Ext.window.Window",{id:"coveredServiceWindow",layout:"anchor",border:false,title:b.T("TAG082","Included Services"),header:{titleAlign:"center",},closable:true,hidden:true,closeAction:"close",width:"60%",layout:"anchor",resizable:false,autoScroll:true,cls:"entitlement-root-container",__parentWin:n,listeners:{hide:function(s,r){s.hide();s.__parentWin.enable();}},});n.coveredServiceStore=SVMX.create("Ext.data.Store",{fields:[{name:"serviceName"},{name:"allowedUnits"},{name:"consumedUnits"},{name:"tracked"},{name:"recordID"},{name:"selected"}],data:[],storeId:"cs_store",listeners:{datachanged:function(r,s){var t=r.getRange();if(t.length>0){t[0].set("result_row_selected",true);}Ext.each(t,function(u){if(u.data.selected){u.set("result_row_selected",true);t[0].set("result_row_selected",false);}});}}});var c=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXListComposite",{autoScroll:true,margin:"20 10",anchor:"100%",store:n.coveredServiceStore,border:false,columns:[{maxWidth:40,width:40,xtype:"svmx.columnradio",dataIndex:"result_row_selected",contentAlign:"left",id:"selectedEntitlement",sortable:false,listeners:{onselect:function(u,s,t){var r=Ext.getCmp("coveredServiceWindow");var v=r.__SCParentData.getData();v.coveredService.forEach(function(x){if(x.recordID==s.data.recordID){x.selected=true;}else{x.selected=false;}});var w=r.__SCParentData;w.set("coveredService",v.coveredService);w.store.fireEvent("refresh");}}},{flex:1,text:b.T("TAG083","Service Name"),dataIndex:"serviceName",resizable:false,readOnly:true,sortable:false,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG084","Allowed Units"),dataIndex:"allowedUnits",align:"center",resizable:false,readOnly:true,sortable:false,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG085","Consumed Units"),dataIndex:"consumedUnits",align:"center",resizable:false,readOnly:true,sortable:false,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG086","Tracked?"),dataIndex:"tracked",align:"center",resizable:false,readOnly:true,sortable:false},]});h.add(c);var d=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{width:"100%",dock:"bottom"});var e=SVMX.create("Ext.Toolbar.Fill",{});d.add(e);var l=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG088","Close"),scale:"medium",height:30,handler:function(r,s){h.close();h.__parentWin.enable();}});d.add(l);h.add(d);n.warrantystore=SVMX.create("Ext.data.Store",{fields:[{name:"recordName"},{name:"startDate"},{name:"endDate"},{name:"coveredBy"},{name:"sLARecordName"},{name:"coveredService"},{name:"recordId"},{name:"sLARecordId"},{name:"uniqueID"},{name:"warrantyOrScon"},{name:"warrantyTermId"},{name:"warrantyTermName"},{name:"installedBaseName"}],data:[],storeId:"warranty_store",listeners:{datachanged:function(r,s){var u=r.getRange();if(u.length>0){var t=Ext.getCmp("entitlementSelection");Ext.each(u,function(v){if(t.__parentData.selectedPSEntitlement!=undefined){if(t.__parentData.selectedPSEntitlement.entitlementInfo!=null&&t.__parentData.selectedPSEntitlement.entitlementInfo.uniqueID!=null&&v.data.uniqueID==t.__parentData.selectedPSEntitlement.entitlementInfo.uniqueID){v.set("result_row_selected",true);}}else{if(t.__parentData.selectedEntitlementInfo!=null&&t.__parentData.selectedEntitlementInfo.uniqueID!=null&&v.data.uniqueID==t.__parentData.selectedEntitlementInfo.uniqueID){v.set("result_row_selected",true);}}});}}}});n.serviceContractstore=SVMX.create("Ext.data.Store",{fields:[{name:"recordName"},{name:"startDate"},{name:"endDate"},{name:"coveredBy"},{name:"sLARecordName"},{name:"coveredService"},{name:"coveredServiceName"},{name:"recordId"},{name:"uniqueID"},{name:"sLARecordId"},{name:"warrantyOrScon"},{name:"warrantyTermId"},{name:"warrantyTermName"}],data:[],storeId:"sc_store",listeners:{datachanged:function(r,t){var s=r.getRange();if(s.length>0){var u=Ext.getCmp("entitlementSelection");
Ext.each(s,function(v){if(u.__parentData.selectedPSEntitlement!=undefined){if(u.__parentData.selectedPSEntitlement.entitlementInfo!=null&&u.__parentData.selectedPSEntitlement.entitlementInfo.uniqueID!=null&&v.data.uniqueID==u.__parentData.selectedPSEntitlement.entitlementInfo.uniqueID){v.set("result_row_selected",true);return false;}}else{if(u.__parentData.selectedEntitlementInfo!=null){if(u.__parentData.selectedEntitlementInfo.uniqueID!=null){if(v.data.uniqueID==u.__parentData.selectedEntitlementInfo.uniqueID){v.set("result_row_selected",true);return false;}else{if(u.__parentData.selectedEntitlementInfo.uniqueID!=null&&u.__parentData.selectedEntitlementInfo.uniqueID==v.data.recordId&&v.data.uniqueID.startsWith(u.__parentData.selectedEntitlementInfo.uniqueID)){v.set("result_row_selected",true);return false;}}}}}});}}}});n.notCoveredstore=SVMX.create("Ext.data.Store",{fields:[{name:"notCovered"}],data:[{notCovered:b.T("TAG068","Not Covered")}],storeId:"notCovered"});var j=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXListComposite",{autoScroll:true,margin:"5 10",anchor:"100%",store:n.notCoveredstore,hideHeaders:true,border:false,bodyCls:"svmx-ent-selectionTable svmx-ent-notCovered",columns:[{maxWidth:30,width:30,xtype:"svmx.columnradio",dataIndex:"result_row_selected",contentAlign:"center",id:"selectedEntitlement",listeners:{onselect:function(v,r,u){var s=p.getStore().getRange();Ext.each(s,function(y){if(y.data.result_row_selected!="undefined"){y.set("result_row_selected",false);}});var x=m.getStore().getRange();Ext.each(x,function(y){if(y.data.result_row_selected!="undefined"){y.set("result_row_selected",false);}});var w=Ext.getCmp("entitlementSelection");w.__selectedEntitlement={};var t=Ext.getCmp("entNotes");w.__selectedEntitlement.entitlementNotes=t.getValue();w.__selectedEntitlement.warrantyOrScon="notcovered";w.enableDisbaleSelectbtn();}}},{flex:1,text:"Not Covered",dataIndex:"notCovered",resizable:false,border:false}]});k.add(j);var p=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXListComposite",{autoScroll:true,margin:"5 10",anchor:"100%",store:n.warrantystore,emptyText:b.T("TAG071","No warranty available"),border:false,bodyCls:"svmx-ent-selectionTable",viewConfig:{deferEmptyText:false,cls:"svmx-ent-gridempty",},columns:[{maxWidth:30,width:30,xtype:"svmx.columnradio",dataIndex:"result_row_selected",contentAlign:"center",id:"selectedEntitlement",resizable:false,listeners:{onselect:function(u,r,t){var x=m.getStore().getRange();Ext.each(x,function(y){if(y.data.result_row_selected!="undefined"){y.set("result_row_selected",false);}});var w=j.getStore().getRange();Ext.each(w,function(y){if(y.data.result_row_selected!="undefined"){y.set("result_row_selected",false);}});var v=Ext.getCmp("entitlementSelection");v.__selectedEntitlement=r.data;var s=Ext.getCmp("entNotes");v.__selectedEntitlement.entitlementNotes=s.getValue();v.enableDisbaleSelectbtn();}}},{flex:1,text:b.T("TAG057","Warranty Name"),dataIndex:"recordName",resizable:true,readOnly:true,renderer:function(v,u,r,w,t,s){return'<a class="detailRecord" href="#">'+Ext.String.htmlEncode(r.data.recordName)+"</a>";}},{flex:1,text:b.T("TAG052","Start Date"),dataIndex:"startDate",align:"center",resizable:false,readOnly:true,},{flex:1,text:b.T("TAG053","End Date"),dataIndex:"endDate",align:"center",resizable:false,readOnly:true,},{flex:1,text:b.T("TAG058","Installed Product"),dataIndex:"installedBaseName",align:"center",resizable:false,readOnly:true,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG059","Warranty Terms"),dataIndex:"warrantyTermName",align:"center",resizable:false,readOnly:true,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},],listeners:{cellclick:function(r,t,y,u,x,z,w){var s=w.getTarget("a.detailRecord");if(s){var v=r.store.getAt(z);w.preventDefault();var A=Ext.getCmp("entitlementSelection");n.findDuplicateTab(o,A,u.data.recordName,u.data.recordId);}}}});k.add(p);var m=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXListComposite",{autoScroll:true,margin:"5 10",anchor:"100%",store:n.serviceContractstore,id:"scGrid",emptyText:b.T("TAG070","No service contract available"),border:false,bodyCls:"svmx-ent-selectionTable",viewConfig:{deferEmptyText:false,cls:"svmx-ent-gridempty",},columns:[{maxWidth:30,width:30,xtype:"svmx.columnradio",dataIndex:"result_row_selected",contentAlign:"center",id:"selectedEntitlement",resizable:false,listeners:{onselect:function(w,t,s){var z=p.getStore().getRange();Ext.each(z,function(A){if(A.data.result_row_selected!="undefined"){A.set("result_row_selected",false);}});var x=j.getStore().getRange();Ext.each(x,function(A){if(A.data.result_row_selected!="undefined"){A.set("result_row_selected",false);}});var y=Ext.getCmp("entitlementSelection");if(t.data.coveredService!=null&&t.data.coveredService.length>0){t.data.coveredService.forEach(function(A,B){if(A.selected&&A.index==0){t.data.coveredService=null;return;
}});var u=Ext.getCmp("coveredServiceWindow");u.__SCParentData=t;var v=Ext.getStore("cs_store");v.loadData(t.data.coveredService);u.show();u.__parentWin.disable();}y.__selectedEntitlement=t.data;var r=Ext.getCmp("entNotes");y.__selectedEntitlement.entitlementNotes=r.getValue();y.enableDisbaleSelectbtn();}}},{flex:1,text:b.T("TAG056","Contract Name/Number"),dataIndex:"recordName",resizable:true,readOnly:true,renderer:function(v,u,r,w,t,s){return'<a class="detailRecord" href="#">'+Ext.String.htmlEncode(r.data.recordName)+"</a>";}},{flex:0.7,text:b.T("TAG052","Start Date"),dataIndex:"startDate",align:"center",resizable:false,readOnly:true,sortable:true,},{flex:0.7,text:b.T("TAG053","End Date"),dataIndex:"endDate",align:"center",resizable:false,readOnly:true,sortable:true,},{flex:1,text:b.T("TAG025","Covered By"),dataIndex:"coveredBy",align:"center",resizable:false,readOnly:true,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG055","SLA Terms"),dataIndex:"sLARecordName",align:"center",resizable:false,readOnly:true,renderer:function(v,u,r,w,t,s){return Ext.String.htmlEncode(v);}},{flex:1,text:b.T("TAG054","Covered Service"),dataIndex:"coveredServiceName",align:"center",resizable:false,readOnly:true,renderer:function(w,v,s,x,u,t){if(s.data.coveredService!=null){var r="";s.data.coveredService.forEach(function(y){if(y.selected){r+='<a class="coveredServiceLink" style="text-align:left" target="_blank" href="/'+y.recordID+' ">'+y.serviceName+"</a> <br/>";r+=b.T("TAG087","Available Units")+"  "+y.availableUnits;s.data.coveredServiceName=y.serviceName;}});return r;}else{s.data.coveredServiceName=r;}return Ext.String.htmlEncode(r);}}],listeners:{cellclick:function(r,t,z,v,y,A,x){var s=x.getTarget("a.detailRecord");if(s){var w=r.store.getAt(A);x.preventDefault();var u=Ext.getCmp("entitlementSelection");n.findDuplicateTab(o,u,v.data.recordName,v.data.recordId);}},}});k.add(m);var g=SVMX.create("com.servicemax.client.entitlement.ui.desktop.api.EntitlementHistoryPanel",{__parent:n,__engine:n.__engine,border:false,collapsible:false,hidden:true,__parentRecordID:null});var q=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{tabConfig:{title:b.T("TAG017","Entitlement History"),margin:"0 0 0 4"},autoScroll:true,closable:false,id:"recordEntHis",listeners:{activate:function(t,s,r){if(t.id=="recordEntHis"){var u=Ext.getCmp("entHisPanel");u.__parentRecordID=Ext.getCmp("entitlementSelection").__parentData.recordID,u.callEntHisWebservice();u.show();}},}});q.add(g);var o=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXTabPanel",{activeTab:0,id:"selectionWindowTab",layout:"fit",autoScroll:true,tabBar:{height:40,},items:[k,q,],listeners:{beforeadd:function(t,s,r){if(r==5){t.getComponent(2).close();}},}});n.add(o);},loadData:function(d,c){var f=[];var e=[];this.__parentData=c;var k=c.selectedEntitlementInfo;var j=[];this.notCoveredstore.loadData([{notCovered:b.T("TAG068","Not Covered")}]);if(c.selectedPSEntitlement!=undefined&&c.selectedPSEntitlement.entitlementInfo.warrantyOrScon=="notcovered"){this.selectNotCovered();}else{if(c.selectedEntitlementInfo!=null&&c.selectedEntitlementInfo.warrantyOrScon=="notcovered"&&c.selectedPSEntitlement==undefined){this.selectNotCovered();}}if(d!=null){d.forEach(function(l,m){if(l.warrantyOrScon=="scontract"){e.push(l);}if(l.warrantyOrScon=="warranty"){f.push(l);}});}var h=false;if(k!=null){if(k.warrantyOrScon=="scontract"){e.forEach(function(m,l){if(m.recordId==k.recordId){h=true;return;}});if(!h){e.push(k);}}if(k.warrantyOrScon=="warranty"){f.forEach(function(m,l){if(m.recordId==k.recordId){h=true;return;}});if(!h){f.push(k);}}}this.serviceContractstore.loadData(e);this.warrantystore.loadData(f);if(this.__parent.__showDetailView){var g=Ext.getCmp("scGrid");g.down("[dataIndex=sLARecordName]").hide();g.down("[dataIndex=coveredServiceName]").hide();}},loadParentData:function(){var f=this.__parentData;var d="";var c=Ext.getCmp("entitlementInfoLabel");c.removeAll();if(f.productName!=null){var h=SVMX.create("Ext.form.Label",{text:f.productName,cls:"svmx-ent-entitlementInfo",});c.add(h);}if(f.installedBaseName!=null){var g=SVMX.create("Ext.form.Label",{text:b.T("TAG074","Installed Product")+": "+f.installedBaseName,cls:"svmx-ent-entitlementInfoPre",});c.add(g);}var e="";var j=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXTextArea",{grow:true,labelAlign:"top",fieldLabel:"Entitlement Notes",anchor:"100%",resizable:false,width:500,height:86,value:e,id:"entNotes",enableKeyEvents:true,fieldCls:"svmx-ent-entitlementnotes",listeners:{keyup:function(k,n,l){var m=Ext.getCmp("entitlementSelection");if(m.__selectedEntitlement!=undefined){m.__selectedEntitlement.entitlementNotes=k.getValue();m.enableDisbaleSelectbtn();}else{if(m.__parentData.selectedEntitlementInfo!=null){m.__selectedEntitlement=m.__parentData.selectedEntitlementInfo;m.__selectedEntitlement.entitlementNotes=k.getValue();m.enableDisbaleSelectbtn();}}}}});
if(f.selectedPSEntitlement!=null&&f.selectedPSEntitlement.entitlementInfo.entitlementNotes!=null){e=f.selectedPSEntitlement.entitlementInfo.entitlementNotes;}else{if(f.selectedEntitlementInfo!=null&&f.selectedEntitlementInfo.entitlementNotes!=null){e=f.selectedEntitlementInfo.entitlementNotes;}}j.setValue(e);c.add(j);},enableDisbaleSelectbtn:function(){var c=Ext.getCmp("selectEntBtn");if(c!=undefined){c.setDisabled(false);}else{var d=Ext.getCmp("saveEnttoDatabase");d.setDisabled(false);}},selectNotCovered:function(){var c=this.notCoveredstore.getRange();Ext.each(c,function(d){d.set("result_row_selected",true);});},findDuplicateTab:function(e,h,f,d){var c=false;for(i=1;i<e.items.items.length;i++){if(e.items.items[i].itemId!=undefined&&e.items.items[i].itemId==d){e.setActiveTab(e.items.items[i]);c=true;break;}}if(!c){var g=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{tabConfig:{title:Ext.String.htmlEncode(f),margin:"0 0 0 4"},closable:true,itemId:d,loader:{autoLoad:true,url:h.__parent.__engine.__manualEntitlementSettings.recordViewPage+d,}});e.add(g);e.setActiveTab(g);}}});};})();