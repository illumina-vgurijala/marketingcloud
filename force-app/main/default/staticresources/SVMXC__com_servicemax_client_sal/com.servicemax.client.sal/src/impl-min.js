(function(){var a=SVMX.Package("com.servicemax.client.sal.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__logger:null,__constructor:function(){this.__base();this.__logger=SVMX.getLoggingService().getLogger("SAL-SERVICE");},beforeInitialize:function(){},initialize:function(){},afterInitialize:function(){}},{});a.Class("RuntimeMode",com.servicemax.client.lib.api.Object,{appInstance:"",url:"/services/data/",apexRestUrl:"/services/apexrest/",soapUrl:"/services/Soap/u/",apexSoapUrl:"/services/Soap/class/",__constructor:function(){},init:function(){},getUrl:function(b,c){},getApexRestUrl:function(b){},adjustHeaders:function(d,c,b){},adjustApexRestHeaders:function(c,b){},adjustSoapHeaders:function(d,c,b){},adjustApexSoapHeaders:function(c,b){},getSoapUrl:function(b,c){},getApexSoapUrl:function(b){}},{});a.Class("VFRuntimeMode",a.RuntimeMode,{proxyUrl:"/services/proxy/",__constructor:function(){},init:function(){var c=SVMX.getClient().getApplicationParameter("svmx-base-url");if(c){if(c.indexOf("/")!=0){c="/"+c;}}else{c="";}this.soapUrl=c+this.soapUrl;this.url=c+this.url;this.proxyUrl=c+this.proxyUrl;this.apexSoapUrl=c+this.apexSoapUrl;this.apexRestUrl=c+this.apexRestUrl;var b=location.hostname.split(".");this.appInstance=(b.length==3?b[0]:b[1])+(b.length==6?"."+b[3]:"");},getUrl:function(b,c){return this.proxyUrl;},getApexRestUrl:function(b){return this.proxyUrl;},adjustHeaders:function(e,d,c){var b=SVMX.getClient().getApplicationParameter("instanceName");if(b){e["SalesforceProxy-Endpoint"]="https://"+b+".salesforce.com"+this.url+c+"/"+d.url;}else{e["SalesforceProxy-Endpoint"]="https://"+this.appInstance+".salesforce.com"+this.url+c+"/"+d.url;}},adjustApexRestHeaders:function(d,c){var b=SVMX.getClient().getApplicationParameter("instanceName");if(b){d["SalesforceProxy-Endpoint"]="https://"+b+".salesforce.com"+this.apexRestUrl+c.url;}else{d["SalesforceProxy-Endpoint"]="https://"+this.appInstance+".salesforce.com"+this.apexRestUrl+c.url;}},adjustSoapHeaders:function(d,c,b){},adjustApexSoapHeaders:function(c,b){},getSoapUrl:function(b,c){return this.soapUrl+c+"/"+b;},getApexSoapUrl:function(b){return this.apexSoapUrl+b;}},{});a.Class("SARuntimeMode",a.RuntimeMode,{__constructor:function(){},init:function(){},getUrl:function(b,c){return this.__getInstanceUrl()+this.url+b;},getApexRestUrl:function(b){return this.__getInstanceUrl()+this.apexRestUrl+b;},__getInstanceUrl:function(){return SVMX.getClient().getApplicationParameter("api-instance-url");},adjustSoapHeaders:function(d,c,b){},adjustApexSoapHeaders:function(c,b){},getSoapUrl:function(b,c){},getApexSoapUrl:function(b){}},{});a.Class("RPRuntimeMode",a.RuntimeMode,{__constructor:function(){},init:function(){},getUrl:function(b,c){return this.url+c+"/"+b;},getApexRestUrl:function(b){return this.apexRestUrl+b;},adjustHeaders:function(d,c,b){},adjustApexRestHeaders:function(c,b){},adjustSoapHeaders:function(d,c,b){},adjustApexSoapHeaders:function(c,b){},getSoapUrl:function(b,c){return this.soapUrl+c+"/"+b;},getApexSoapUrl:function(b){return this.apexSoapUrl+b;}},{});a.Class("SAL",com.servicemax.client.lib.api.Object,{},{initialized:false,rtMode:null,init:function(){if(a.SAL.initialized){return;}a.SAL.initialized=true;var b=SVMX.getClient().getApplicationParameter("sal-service-runtime-mode");var c=null;if(b=="VISUAL_FORCE"){c=new a.VFRuntimeMode();}else{if(b=="STAND_ALONE"){c=new a.SARuntimeMode();}else{if(b=="REMOTE_PROXY"){c=new a.RPRuntimeMode();}else{throw new Error("Please specify a runtime mode!");}}}c.init();a.SAL.rtMode=c;}});a.Class("RestRequestEvent",com.servicemax.client.lib.api.Event,{__constructor:function(b,d,c){this.__base(b,d,c);}},{});a.Class("SoapRequestEvent",com.servicemax.client.lib.api.Event,{__constructor:function(b,d,c){this.__base(b,d,c);}},{});a.Class("RestRequest",com.servicemax.client.lib.api.EventDispatcher,{_options:null,_baseURL:"",__constructor:function(b){this.__base();this._options=b;},callAsync:function(g){if(!g){g={};}if(!g.headers){g.headers={};}var e=true;if(g.async!=undefined){e=g.async;}this._appendAuthToken(g.headers);var c=this._getUrl(g.url);var h=g.method?g.method:"GET";var b=g.responseType?g.responseType:"json";this._adjustEndpoint(g.headers,g);var f="";if(g.data){if(typeof(g.data)=="string"){f=g.data;}else{f=SVMX.toJSON(g.data);if(h=="GET"){f="getParams="+f;}}}return SVMX.ajax({type:h,contentType:g.contentType?g.contentType:"application/json",dataType:b,data:f,url:c,context:this,async:e,headers:g.headers,success:function(k,i,j){var l=k;if(b=="json"){l=SVMX.toObject(k);}this._callAsyncSuccess(l,i);},error:function(i,d,j){this._callAsyncError(i,d,j);}});},_callAsyncSuccess:function(e,c,d){e=this._processDataOnLoad(e);var b=new a.RestRequestEvent("REQUEST_COMPLETED",this,e);this.triggerEvent(b);},_appendAuthToken:function(b){b.Authorization="OAuth "+this._options.sessionId;},_adjustEndpoint:function(c,b){a.SAL.rtMode.adjustHeaders(b.headers,b,this._options.apiVersion);},_getUrl:function(b){return a.SAL.rtMode.getUrl(b,this._options.apiVersion);
},_callAsyncError:function(d,c,f){var b=new a.RestRequestEvent("REQUEST_ERROR",this,{e:f,status:c,xhr:d});this.triggerEvent(b);},_processDataOnLoad:function(b){return b;}},{});a.Class("ApexRestRequest",a.RestRequest,{__constructor:function(b){this.__base(b);},_adjustEndpoint:function(c,b){a.SAL.rtMode.adjustApexRestHeaders(b.headers,b);},_getUrl:function(b){return a.SAL.rtMode.getApexRestUrl(b);}},{});a.Class("AttachmentSoapRequest",com.servicemax.client.lib.api.EventDispatcher,{_options:null,_baseURL:"",_requestTemplate:"",_recordId:null,__constructor:function(b){this.__base();this._options=b;this._requestTemplate="<s:Envelope xmlns:s='http://schemas.xmlsoap.org/soap/envelope/' xmlns='urn:partner.soap.sforce.com'><s:Header><SessionHeader><sessionId>{0}</sessionId></SessionHeader></s:Header><s:Body><create><sobject><type>{1}</type><isPrivate>{2}</isPrivate><ParentId>{3}</ParentId><Name>{4}</Name><Body>{5}</Body></sobject></create></s:Body></s:Envelope>";},callAsync:function(f){if(!f){f={};}if(!f.headers){f.headers={};}var d=true;if(f.async!=undefined){d=f.async;}this._setupHeaders(f.headers,f);var c=this._getUrl(f.url),h="POST",b="xml",e=this._getData(f.data,f),g="text/xml";this._recordId=f.questionId;SVMX.ajax({type:h,contentType:g,dataType:b,data:e,url:c,context:this,async:d,headers:f.headers,success:function(k,i,j){this._callAsyncAttachmentSuccess(k,i,j);},error:function(j,i,k){this._callAsyncError(j,i,k);}});},_callAsyncAttachmentSuccess:function(g,d,e){var i=new DOMParser();var f=i.parseFromString(e.responseText,"text/xml");var h="";if(f.getElementsByTagName("id")&&f.getElementsByTagName("id").length>0){var c=f.getElementsByTagName("id")[0];if(c.childNodes&&c.childNodes.length>0){h=c.childNodes[0].nodeValue;}}g=this._processDataOnLoad(g);g.attachmentId=h;g.questionId=this._recordId;var b=new a.SoapRequestEvent("REQUEST_COMPLETED",this,g);this.triggerEvent(b);},_callAsyncSuccess:function(e,c,d){e=this._processDataOnLoad(e);var b=new a.SoapRequestEvent("REQUEST_COMPLETED",this,e);this.triggerEvent(b);},_getUrl:function(b){return"/services/Soap/u/20/"+b;},_getData:function(b,c){b=SVMX.toXML(b);b=this._format(this._requestTemplate,this._options.sessionId,c.type,c.isPrivate,c.ParentId,c.name,c.body);return b;},_getOrgNamespace:function(b){if(b!=null&&b!=""){return b+"/";}else{return"";}},_format:function(){return SVMX.format(arguments);},_callAsyncError:function(d,c,f){var b=new a.RestRequestEvent("REQUEST_ERROR",this,{e:f,status:c,xhr:d});this.triggerEvent(b);},_setupHeaders:function(c,b){c.SOAPAction=b.methodName;},_processDataOnLoad:function(b){return b;}},{});a.Class("SoapRequest",com.servicemax.client.lib.api.EventDispatcher,{_options:null,_baseURL:"",_requestTemplate:"",__constructor:function(b){this.__base();this._options=b;this._requestTemplate='<se:Envelope xmlns:se="http://schemas.xmlsoap.org/soap/envelope/"><se:Header xmlns:sfns="urn:partner.soap.sforce.com"><sfns:SessionHeader><sessionId>{0}</sessionId></sfns:SessionHeader></se:Header><se:Body><{1} xmlns="urn:partner.soap.sforce.com" xmlns:ns1="sobject.partner.soap.sforce.com">{2}</{1}></se:Body></se:Envelope>';},callAsync:function(f){if(!f){f={};}if(!f.headers){f.headers={};}var d=true;if(f.async!=undefined){d=f.async;}this._setupHeaders(f.headers,f);var c=this._getUrl(f.url),h="POST",b="xml",e=this._getData(f.data,f),g="text/xml";SVMX.ajax({type:h,contentType:g,dataType:b,data:e,url:c,context:this,async:d,headers:f.headers,success:function(k,i,j){this._callAsyncSuccess(k,i);},error:function(j,i,k){this._callAsyncError(j,i,k);}});},_callAsyncSuccess:function(e,c,d){e=this._processDataOnLoad(e);var b=new a.SoapRequestEvent("REQUEST_COMPLETED",this,e);this.triggerEvent(b);},_getUrl:function(b){return a.SAL.rtMode.getSoapUrl(b,this._options.apiVersion);},_getData:function(b,c){b=SVMX.toXML(b);b=this._format(this._requestTemplate,this._options.sessionId,c.methodName,b);return b;},_getOrgNamespace:function(b){if(b!=null&&b!=""){return b+"/";}else{return"";}},_format:function(){return SVMX.format(arguments);},_callAsyncError:function(d,c,f){var b=new a.RestRequestEvent("REQUEST_ERROR",this,{e:f,status:c,xhr:d});this.triggerEvent(b);},_setupHeaders:function(c,b){c.SOAPAction=b.methodName;},_processDataOnLoad:function(b){return b;}},{});a.Class("ApexSoapRequest",a.SoapRequest,{__constructor:function(b){this.__base(b);this._requestTemplate='<se:Envelope xmlns:se="http://schemas.xmlsoap.org/soap/envelope/"><se:Header xmlns:sfns="http://soap.sforce.com/schemas/package/{0}{1}"><sfns:SessionHeader><sessionId>{2}</sessionId></sfns:SessionHeader></se:Header><se:Body><{3} xmlns="http://soap.sforce.com/schemas/package/{0}{1}"><request>{4}</request></{3}></se:Body></se:Envelope>';},_getUrl:function(b){return a.SAL.rtMode.getApexSoapUrl(b);},_getData:function(b,c){b=SVMX.toXML(b);b=this._format(this._requestTemplate,this._getOrgNamespace(this._options.nameSpace),this._options.endPoint,this._options.sessionId,c.methodName,b);return b;},_processDataOnLoad:function(b){return b;
}},{});a.Class("WSSoapRequest",a.SoapRequest,{__constructor:function(b){this.__base(b);this._requestTemplate='<se:Envelope xmlns:se="http://schemas.xmlsoap.org/soap/envelope/" xmlns:sfns="http://soap.sforce.com/schemas/class/{0}"><se:Header><sfns:SessionHeader><sfns:sessionId>{1}</sfns:sessionId></sfns:SessionHeader></se:Header><se:Body><sfns:{2}><sfns:request>{3}</sfns:request></sfns:{2}></se:Body></se:Envelope>';},_getUrl:function(b){return a.SAL.rtMode.getApexSoapUrl(b);},_getData:function(c,b){data=this._format(this._requestTemplate,this._options.endPoint,this._options.sessionId,b.methodName,c);return data;},_processDataOnLoad:function(b){return b;}},{});a.Class("ServiceEvent",com.servicemax.client.lib.api.Event,{__constructor:function(b,d,c){this.__base(b,d,c);}},{});a.Class("ServiceBase",com.servicemax.client.lib.api.EventDispatcher,{_parent:null,_profiler:null,__constructor:function(b){this.__base();this._parent=b;this._profiler=SVMX.getProfilingService();},callMethod:function(b){},callMethodAsync:function(b){},callApiAsync:function(b){}},{});a.Class("RestService",a.ServiceBase,{apiVersion:"",__constructor:function(b){a.SAL.init();this.__base(b);this.apiVersion="v24.0";},callApiAsync:function(g){var b=this._profiler;var d=g.methodName;var e="fetch";var f=this.getClassName()+"APIAsync";var c=new a.RestRequest({sessionId:this._parent.params.sessionId,apiVersion:this.apiVersion});c.bind("REQUEST_COMPLETED",this._callMethodAsyncSuccess,this);c.bind("REQUEST_ERROR",this._callMethodAsyncError,this);b.begin(d,f,e);c.callAsync({url:g.url,method:"GET",data:g.data,responseType:g.responseType}).always(function(){b.end(d,f,e);}).then(function(){b.raiseEvent("REFRESH_CONTENT");});},callMethod:function(b){b.async=false;this.callMethodAsync(b);},callMethodAsync:function(g){var m=this._profiler;var c=g.methodName;var j="fetch";var i=this.getClassName()+"MethodAsync";var d=this._parent.params.nameSpace!=undefined?this._parent.params.nameSpace:"SVMXC";var k=this._parent.params.endPoint!=undefined?this._parent.params.endPoint:"NO_END_POINT";var l=g.methodName;var f=this._parent.params.svmxServiceVersion;var b=d+"/svmx/rest/"+k+"/"+l+"/"+f+"/";var e=true;if(g.async!=undefined){e=g.async;}var h=new a.ApexRestRequest({sessionId:this._parent.params.sessionId,apiVersion:this.apiVersion});h.bind("REQUEST_COMPLETED",this._callMethodAsyncSuccess,this);h.bind("REQUEST_ERROR",this._callMethodAsyncError,this);m.begin(c,i,j);h.callAsync({url:b,method:this.__getHttpMethodType(l),data:g.data,async:e}).always(function(){m.end(c,i,j);}).then(function(){m.raiseEvent("REFRESH_CONTENT");});},__getHttpMethodType:function(b){var c="";if(this.__findIn(b,["get","retrieve","obtain","query"],0)){c="POST";}else{if(this.__findIn(b,["post","submit","create","modify","update","alter","save","add"],0)){c="POST";}else{throw new Error("Unsupported method type");}}return c;},__findIn:function(e,f,d){var b=f.length;for(var c=0;c<b;c++){if(e.indexOf(f[c])==d){return true;}}return false;},_callMethodAsyncSuccess:function(c){var b=new a.ServiceEvent("REQUEST_COMPLETED",this,c.data);this.triggerEvent(b);},_callMethodAsyncError:function(c){var b=new a.ServiceEvent("REQUEST_ERROR",this,c.data);this.triggerEvent(b);}},{});a.Class("LocalService",a.ServiceBase,{},{});a.Class("SoapService",a.ServiceBase,{apiVersion:"",__constructor:function(b){a.SAL.init();this.__base(b);this.apiVersion="9.0";},callMethodAsync:function(g){var b=this._parent.params.nameSpace!==undefined?this._parent.params.nameSpace:"SVMXC";var e=this._parent.params.endPoint!=undefined?this._parent.params.endPoint:"NO_END_POINT";var c=g.methodName;var f;var d=this.__getOrgNamespace(b)+e;if(g.type==="Attachment"){f=new a.AttachmentSoapRequest({sessionId:this._parent.params.sessionId,apiVersion:this.apiVersion,endPoint:e,nameSpace:b});f.bind("REQUEST_COMPLETED",this._callMethodAsyncSuccess,this);f.bind("REQUEST_ERROR",this._callMethodAsyncError,this);f.callAsync(g);}else{f=new a.ApexSoapRequest({sessionId:this._parent.params.sessionId,apiVersion:this.apiVersion,endPoint:e,nameSpace:b});f.bind("REQUEST_COMPLETED",this._callMethodAsyncSuccess,this);f.bind("REQUEST_ERROR",this._callMethodAsyncError,this);f.callAsync({url:d,methodName:c,data:g.data});}},callApiSync:function(d){var b="19";var c=new a.SoapRequest({sessionId:this._parent.params.sessionId,apiVersion:b});c.bind("REQUEST_COMPLETED",this._callMethodAsyncSuccess,this);c.bind("REQUEST_ERROR",this._callMethodAsyncError,this);c.callAsync({url:"",methodName:d.methodName,data:d.data});},__getOrgNamespace:function(b){if(b!=null&&b!=""){return b+"/";}else{return"";}},_callMethodAsyncSuccess:function(c){var b=new a.ServiceEvent("REQUEST_COMPLETED",this,c.data);this.triggerEvent(b);},_callMethodAsyncError:function(c){var b=new a.ServiceEvent("REQUEST_ERROR",this,c.data);this.triggerEvent(b);}},{});a.Class("RestServiceManager",com.servicemax.client.lib.api.Object,{params:null,__constructor:function(b){this.params=b;},createService:function(){return SVMX.create("com.servicemax.client.sal.impl.RestService",this);
}},{});a.Class("SoapServiceManager",com.servicemax.client.lib.api.Object,{params:null,__constructor:function(b){this.params=b;},createService:function(){return new a.SoapService(this);}},{});a.Class("ServiceManagerFactory",com.servicemax.client.lib.api.Object,{__constructor:function(){},createServiceManager:function(b){if(!b){b={};}b.svmxServiceVersion=SVMX.getClient().getApplicationParameter("svmx-api-version");b.sessionId=SVMX.getClient().getApplicationParameter("session-id");if(b.type=="SOAP"){return new a.SoapServiceManager(b);}else{return new a.RestServiceManager(b);}}},{});})();