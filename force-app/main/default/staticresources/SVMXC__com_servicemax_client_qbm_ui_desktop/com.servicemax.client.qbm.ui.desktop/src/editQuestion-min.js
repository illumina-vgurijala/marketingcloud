(function(){var a=SVMX.Package("com.servicemax.client.qbm.ui.desktop.editQuestion");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("CQL");Ext.define("com.servicemax.client.qbm.ui.desktop.editQuestion.EditQuestionPanel",{extend:"Ext.form.FormPanel",__actionType:null,constructor:function(c){c=Ext.apply({layout:"anchor",defaultType:"textfield",bodyPadding:25,autoScroll:true,border:false,defaults:{anchor:"100%"},fieldDefaults:{labelAlign:"top",labelWidth:100},},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var k=this;Ext.define("State",{extend:"Ext.data.Model",fields:[{type:"string",name:"name"},]});var i=Ext.create("Ext.data.Store",{model:"State",data:[],proxy:{type:"memory"}});this.__tagstore=i;var d=Ext.create("com.servicemax.client.qbm.ui.desktop.boxselect.BoxSelect",{fieldLabel:b.T("TAG024","Tags"),displayField:"name",name:"TagField",id:"tagsList",anchor:"50%",multiSelect:true,forceSelection:false,hideTrigger:true,editable:true,store:i,queryMode:"local",createNewOnEnter:true,createNewOnBlur:true,filterPickList:true,triggerOnClick:false,pinList:false,delimiter:",",});k.add({fieldLabel:b.T("TAG025","Question Text"),name:"questionText",id:SVMX.OrgNamespace+"__Question__c",anchor:"50%",allowBlank:false,padding:"0 0 15",blankText:b.T("TAG054","This field is required")});k.add({fieldLabel:"Question ID",name:"questionId",id:SVMX.OrgNamespace+"__QuestionID__c",anchor:"50%",padding:"0 0 15",hidden:"true"});k.add({fieldLabel:b.T("TAG051","Default Answer"),name:"defaultResponseText",id:"defaultResponseText",anchor:"50%",padding:"0 0 15",xtype:"textfield",maxLength:255,enforceMaxLength:true});k.add({fieldLabel:b.T("TAG051","Default Answer"),name:"defaultResponseNumber",id:"defaultResponseNumber",anchor:"50%",padding:"0 0 15",xtype:"numberfield",hidden:"true",enforceMaxLength:true,maxLength:14});var g=SVMX.create("Ext.data.Store",{fields:["value","label"],data:{items:[{label:b.T("COMM002","Value"),value:"Value"},{label:b.T("COMM001","Function"),value:"Function",}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});var c={xtype:"combobox",padding:"0 0 15",id:"valueFunctionCombo",name:"valueFunctionCombo",fieldLabel:b.T("TAG051","Default Answer"),labelField:"label",valueField:"value",displayField:"label",defaultValue:"Value",value:"Value",queryMode:"local",editable:false,anchor:"50%",store:g,hidden:true,listeners:{change:function(r,q,p){var s=Ext.getCmp("defaultResponseDate");var o=Ext.getCmp("literalCombo");if(q==="Value"){o.hide();s.reset();s.show();}else{if(q==="Function"){s.hide();o.reset();o.show();}}},afterrender:function(o){o.setValue(this.defaultValue);}},listConfig:{getInnerTpl:function(o){return"{[Ext.String.htmlEncode(values."+o+")]}";}},};var l={xtype:"datefield",name:"defaultResponseDate",id:"defaultResponseDate",anchor:"50%",padding:"0 0 15",editable:false,hidden:true,};var h=Ext.create("Ext.data.Store",{fields:["value","label","type"],data:{items:[{label:b.T("COMM004","Today"),value:"Today",type:"DateAns"},{label:b.T("COMM005","Tomorrow"),value:"Tomorrow",type:"DateAns"},{label:b.T("COMM006","Yesterday"),value:"Yesterday",type:"DateAns"},{label:b.T("COMM007","Now"),value:"Now",type:"DateTimeAns"}]},proxy:{type:"memory",reader:{type:"json",root:"items"}},sorters:[{property:"label",direction:"ASC"}]});var n={xtype:"combobox",padding:"0 0 15",id:"literalCombo",name:"literalCombo",labelField:"label",valueField:"value",displayField:"label",queryMode:"local",editable:false,anchor:"50%",store:h,hidden:true,emptyText:b.T("COMM003","Select"),listeners:{expand:function(p){var o=Ext.getCmp(SVMX.OrgNamespace+"__Response_Type__c").getValue();if(o!==null&&o!==""&&o==="Date"){p.store.filter("type","DateAns");}}},listConfig:{getInnerTpl:function(o){return"{[Ext.String.htmlEncode(values."+o+")]}";}},};k.add(c);k.add(l);k.add(n);k.add({fieldLabel:b.T("TAG044","Help URL"),name:"helpURL",id:SVMX.OrgNamespace+"__Help_URL__c",anchor:"50%",padding:"0 0 15"});var f=SVMX.create("Ext.data.ArrayStore",{fields:["Id","response_Type"],data:[["Text",b.T("TAG026","Text")],["Checkbox",b.T("TAG027","Checkbox")],["Radio Button",b.T("TAG028","Radio Button")],["Picklist",b.T("TAG029","Picklist")],["Multi-select Picklist",b.T("TAG030","Multi-select Picklist")],["Number",b.T("TAG031","Number")],["DateTime",b.T("TAG032","DateTime")],["Date",b.T("TAG033","Date")],["Attachment",b.T("TAG048","Attachment")]],sorters:[{property:"response_Type",direction:"ASC"}]});this.__responseTypeDropDown=k.add({xtype:"combobox",padding:"0 0 15",id:SVMX.OrgNamespace+"__Response_Type__c",name:"response_Type",fieldLabel:b.T("TAG034","Answer Type"),labelField:"label",valueField:"Id",displayField:"response_Type",defaultValue:"Text",value:"Text",queryMode:"local",editable:false,anchor:"50%",store:f,listeners:{change:function(r,q,o){var p=Ext.getCmp("literalCombo");if(p!=null){p.store.clearFilter();}if(q==="Checkbox"||q==="Picklist"||q==="Multi-select Picklist"||q==="Radio Button"){k.showHideResponseSetDropDown(true);
k.showResponseOptions(true);k.showHideNewResponseSetName(true);}else{k.showHideResponseSetDropDown(false);k.showResponseOptions(false);k.showHideNewResponseSetName(false);}if(q==="Attachment"){k.showHideOpdocDescriptionFields(true);}else{k.showHideOpdocDescriptionFields(false);}k.hideAllDefaultAnsCmp();if(q==="Text"||q==="Number"||q==="Date"||q==="DateTime"){switch(q){case"Text":k.resetAndShowCmp("defaultResponseText");break;case"Number":k.resetAndShowCmp("defaultResponseNumber");break;case"Date":case"DateTime":k.resetAndShowCmp("valueFunctionCombo");k.resetAndShowCmp("defaultResponseDate");break;}}if(q==="Attachment"){Ext.getCmp("clearDefault").hide();}else{Ext.getCmp("clearDefault").show();}},afterrender:function(o){o.setValue(this.defaultValue);}},listConfig:{getInnerTpl:function(o){return"{[Ext.String.htmlEncode(values."+o+")]}";}},});k.add({xtype:"checkbox",boxLabel:b.T("TAG049","Include in Output Document"),name:"includeInOpDoc",id:SVMX.OrgNamespace+"__SM_Show_In_Smart_Doc__c",anchor:"50%",padding:"0 0 15",hidden:true});k.add({xtype:"checkbox",boxLabel:b.T("TAG050","Description required"),name:"descriptionRequired",id:SVMX.OrgNamespace+"__SM_Description_Required__c",anchor:"50%",padding:"0 0 15",hidden:true});var j=SVMX.create("Ext.data.ArrayStore",{fields:["Id","responseSetName","responseSetValues"],data:[]});this.__responseSetStore=j;this.__responseSetDropDown=k.add({xtype:"combobox",padding:"0 0 15",hidden:"true",id:SVMX.OrgNamespace+"__Response_Set__c",name:"responseSetName",fieldLabel:b.T("TAG035","Response Set"),labelField:"label",valueField:"Id",displayField:"responseSetName",defaultValue:"CreateNew",value:"CreateNew",queryMode:"local",editable:false,anchor:"50%",store:j,listeners:{change:function(v,u,p){if(u==="CreateNew"){k.showHideNewResponseSetName(true);k.__activeRecord.responseOptions=[""];k.showResponseOptions(true);}else{var r=[""];var o=k.__responseSetDropDown.store;var t=o.data.items||[];for(var q=0;q<t.length;q++){var s=t[q].data;if(s.Id===u){k.__newResponseSetName.setValue(s.responseSetName);r=s.responseSetValues&&s.responseSetValues.split(";");if(r&&r.length>0){r.splice(r.length-1,1);}break;}}k.__activeRecord.responseOptions=r;k.showResponseOptions(true);}},afterrender:function(o){}},listConfig:{getInnerTpl:function(o){return"{[Ext.String.htmlEncode(values."+o+")]}";}}});this.__newResponseSetName=k.add({fieldLabel:b.T("TAG036","Response Set Name"),name:"newResponseSetName",id:"Name",anchor:"50%",allowBlank:false,padding:"0 0 15",blankText:b.T("TAG054","This field is required")});k.add(d);var m=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{id:"clearDefault",text:b.T("TAG052","Clear Default"),__parent:this,style:{marginLeft:"0px",marginRight:"0px",marginTop:"10px",marginBottom:"5px"},handler:function(){var o=Ext.getCmp(SVMX.OrgNamespace+"__Response_Type__c").getValue();switch(o){case"Text":Ext.getCmp("defaultResponseText").reset();break;case"Number":Ext.getCmp("defaultResponseNumber").reset();break;case"Date":case"DateTime":Ext.getCmp("valueFunctionCombo").reset();Ext.getCmp("defaultResponseDate").reset();Ext.getCmp("literalCombo").reset();break;case"Radio Button":case"Picklist":var s=this.__parent.__responseOptionsPanel.__fields,p=s.length;for(var r=0;r<p;r++){var v=s[r].radioField.getId();if(v!=null){var q=Ext.getCmp(v);if(q){q.setValue(false);}}}case"Multi-select Picklist":case"Checkbox":var s=this.__parent.__responseOptionsPanel.__fields,p=s.length;for(var r=0;r<p;r++){var u=s[r].checkboxField.getId();if(u!=null){var t=Ext.getCmp(u);if(t){t.setValue(false);}}}}}});var e=Ext.create("Ext.form.Panel",{layout:"vbox",border:false,anchor:"50%"});e.add(m);k.add(e);this.radioButton=k.add({xtype:"radiogroup",id:"operationTypeCmp",columns:1,vertical:true,items:[{boxLabel:b.T("TAG037","Update library (all checklists using this question will be updated)"),name:"Operationtype",inputValue:"SAVE",checked:true},{boxLabel:b.T("TAG038","Save as a new question in the library"),name:"Operationtype",inputValue:"SAVEAS"}],listeners:{change:function(q,r,o,p){k.__actionType=r.Operationtype;}}});this.showResponseOptions();},hideAllDefaultAnsCmp:function(){Ext.getCmp("defaultResponseText").hide();Ext.getCmp("defaultResponseNumber").hide();Ext.getCmp("valueFunctionCombo").hide();Ext.getCmp("defaultResponseDate").hide();Ext.getCmp("literalCombo").hide();},resetAndShowCmp:function(d){var c=Ext.getCmp(d);c.reset();c.show();},showHideOpdocDescriptionFields:function(c){var e=Ext.getCmp(SVMX.OrgNamespace+"__SM_Show_In_Smart_Doc__c");var d=Ext.getCmp(SVMX.OrgNamespace+"__SM_Description_Required__c");if(c){e.setValue(true);d.setValue(true);e.show();d.show();}else{e.setValue(false);d.setValue(false);e.hide();d.hide();}},showHideResponseSetDropDown:function(c){if(c){this.__responseSetDropDown.reset();this.__responseSetDropDown.show();}else{this.__responseSetDropDown.hide();}},showHideNewResponseSetName:function(c){if(c){this.__newResponseSetName.reset();this.__newResponseSetName.show();}else{this.__newResponseSetName.hide();
}},showResponseOptions:function(c){if(this.__responseOptionsPanel){this.__responseOptionsPanel.destroy();}if(!c){return;}this.__responseOptionsPanel=SVMX.create("com.servicemax.client.qbm.ui.desktop.editQuestion.ResponseOptionsPanel",{data:(this.__activeRecord&&this.__activeRecord.responseOptions)||null,defaultValueForRadio:(this.__activeRecord&&this.__activeRecord.defaultValueForRadio)||null,defaultValueForCheckbox:(this.__activeRecord&&this.__activeRecord.defaultValueForCheckbox)||null});var d=(!this.radioButton.hidden&&this.items.length-3)||this.items.length-3;this.add(d,this.__responseOptionsPanel);},loadQuestionDataInEditMode:function(e,c){this.resetComponentData();if(c&&c[SVMX.OrgNamespace+"__Response_Type__c"]&&c[SVMX.OrgNamespace+"__Response_Type__c"]==="Attachment"){this.showHideOpdocDescriptionFields(true);}else{this.showHideOpdocDescriptionFields(false);}this.showHideNewResponseSetName(false);if(!e){this.showResponseOptions(false);this.showHideResponseSetDropDown(false);}this.hideAllDefaultAnsCmp();this.resetAndShowCmp("defaultResponseText");var d=c&&c[SVMX.OrgNamespace+"__Response_Type__c"]&&c[SVMX.OrgNamespace+"__Response_Type__c"];if(d==="Date"||d==="DateTime"){this.resetAndShowCmp("valueFunctionCombo");if(c.valueFunctionCombo&&c.valueFunctionCombo==="Value"){this.resetAndShowCmp("defaultResponseDate");}else{if(c.valueFunctionCombo&&c.valueFunctionCombo==="Function"){this.resetAndShowCmp("literalCombo");}}}if(d==="Attachment"){Ext.getCmp("clearDefault").hide();}else{Ext.getCmp("clearDefault").show();}this.__activeRecord=c;this.getForm().setValues(c);if(c&&c[SVMX.OrgNamespace+"__Response_Type__c"]&&c[SVMX.OrgNamespace+"__Response_Type__c"]==="Text"){this.showResponseOptions(false);}if(e){this.__actionType="SAVE";}else{this.__actionType="SAVEAS";}},resetComponentData:function(){Ext.getCmp(SVMX.OrgNamespace+"__Question__c").reset();Ext.getCmp(SVMX.OrgNamespace+"__QuestionID__c").reset();Ext.getCmp("defaultResponseText").reset();Ext.getCmp("defaultResponseNumber").reset();Ext.getCmp("valueFunctionCombo").reset();Ext.getCmp("defaultResponseDate").reset();Ext.getCmp("literalCombo").reset();Ext.getCmp(SVMX.OrgNamespace+"__Help_URL__c").reset();Ext.getCmp(SVMX.OrgNamespace+"__SM_Show_In_Smart_Doc__c").reset();Ext.getCmp(SVMX.OrgNamespace+"__SM_Description_Required__c").reset();Ext.getCmp(SVMX.OrgNamespace+"__Response_Type__c").reset();Ext.getCmp("tagsList").reset();Ext.getCmp("operationTypeCmp").reset();},getData:function(){var c=this.getForm().getFieldValues();c.Operationtype=this.__actionType;if(this.__actionType==="SAVE"){c.Id=this.__activeRecord.Id;}return c;},resetData:function(){this.getForm().reset();},getActionType:function(){return this.__actionType;}});Ext.define("com.servicemax.client.qbm.ui.desktop.editQuestion.ResponseOptionsPanel",{extend:"Ext.form.FieldSet",constructor:function(c){c=Ext.apply({title:b.T("TAG039","Answer Values"),layout:"vbox",border:true,anchor:"50%"},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var g=this;this.__addButton=g.add({xtype:"button",text:"+"+b.T("TAG040","Add Answer"),anchor:"10%",margins:"8 8",disabled:true,listeners:{click:function(){g.addOption();g.__addButton.setDisabled(true);g.__disableDeleteButton();}}});this.__fields=[];var d=this.defaultValueForRadio;var j=this.defaultValueForCheckbox;var h=this.data||[""],e,c=h.length,f;for(e=0;e<c;e++){f=h[e];g.addOption(f,d,j);}this.__disableDeleteButton();},addOption:function(q,n,j){var o=this;q=q||"";var f=false;if(q===n){f=true;}var k=Ext.getCmp(SVMX.OrgNamespace+"__Response_Type__c").getValue();var c=false;if(j!=null&&j.length>0){var l=j.length;for(var h=0;h<l;h++){if(q===j[h]){c=true;break;}}}var e=this.add(this.items.length-1,{layout:"hbox",width:"100%",border:false,flex:1,padding:"8 8"});var g=e.add({xtype:"textfield",name:"answers",flex:0.9,allowBlank:false,padding:"0 5",blankText:b.T("TAG054","This field is required"),value:q,listeners:{change:function(){var i=Ext.getCmp(SVMX.OrgNamespace+"__Response_Type__c").getValue();if(i==="Radio Button"||i==="Picklist"){o.__setValueOfRadio();}o.__addButton.setDisabled(!o.__isValid());}}});var m=Ext.create("Ext.form.field.Checkbox",{name:"defaultAnsForCheckbox",boxLabel:b.T("TAG053","Default"),value:q,checked:c});if(k==="Checkbox"||k==="Multi-select Picklist"){e.add(m);}var p=Ext.create("Ext.form.field.Radio",{xtype:"radiofield",name:"defaultAnsForRadio",boxLabel:b.T("TAG053","Default"),inputValue:q,checked:f,listeners:{change:function(s,t,i,r){o.__setValueOfRadio();}}});if(k==="Radio Button"||k==="Picklist"){e.add(p);}var d=e.add({xtype:"button",name:"del",text:"X",flex:0.1,margin:"0 0 0 5",listeners:{click:function(){e.destroy();o.__disableDeleteButton(true);}}});this.__fields.push({fld:g,btn:d,radioField:p,checkboxField:m});},__setValueOfRadio:function(){var d=this.__fields,c=d.length;for(var e=0;e<c;e++){d[e].radioField.inputValue=d[e].fld.getValue();}},__isValid:function(){var d=this.__fields,e,c=d.length,f;for(e=0;e<c;e++){f=d[e];
if(f&&!f.fld.isDestroyed&&!f.fld.getValue()){return false;}}return true;},__disableDeleteButton:function(){var d=this.__fields,f,c=d.length,h,e,g=0;for(f=0;f<c;f++){h=d[f];if(h&&!h.btn.isDestroyed){h.btn.setDisabled(false);if(!g){e=h.btn;}g++;}}if(g===1&&e){e.setDisabled(true);}this.__addButton.setDisabled(!this.__isValid());}});};})();