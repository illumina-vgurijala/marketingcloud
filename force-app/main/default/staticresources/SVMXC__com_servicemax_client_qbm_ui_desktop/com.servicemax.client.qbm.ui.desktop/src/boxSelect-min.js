(function(){var a=SVMX.Package("com.servicemax.client.qbm.ui.desktop.boxselect");a.init=function(){Ext.define("com.servicemax.client.qbm.ui.desktop.boxselect.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],multiSelect:true,forceSelection:true,createNewOnEnter:false,createNewOnBlur:false,encodeSubmitValue:false,triggerOnClick:true,stacked:false,pinList:true,filterPickList:false,selectOnFocus:true,grow:true,growMin:false,growMax:false,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list">','<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:true,disableFormats:true}],childEls:["listWrapper","itemList","inputEl","inputElCt","emptyEl"],componentLayout:"boxselectfield",emptyInputCls:"x-boxselect-emptyinput",initComponent:function(){var c=this,b=c.typeAhead;if(b&&!c.editable){Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings.");}Ext.apply(c,{typeAhead:false});c.callParent();c.typeAhead=b;c.selectionModel=new Ext.selection.Model({store:c.valueStore,mode:"MULTI",lastFocused:null,onSelectChange:function(d,f,e,g){g();}});if(!Ext.isEmpty(c.delimiter)&&c.multiSelect){c.delimiterRegexp=new RegExp(String(c.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&"));}},initEvents:function(){var b=this;b.callParent(arguments);if(!b.enableKeyEvents){b.mon(b.inputEl,"keydown",b.onKeyDown,b);}b.mon(b.inputEl,"paste",b.onPaste,b);b.mon(b.listWrapper,"click",b.onItemListClick,b);b.mon(b.selectionModel,{selectionchange:function(c,d){b.applyMultiselectItemMarkup();b.fireEvent("valueselectionchange",b,d);},focuschange:function(c,e,d){b.fireEvent("valuefocuschange",b,e,d);},scope:b});},onBindStore:function(b,c){var d=this;if(b){d.valueStore=new Ext.data.Store({model:b.model,proxy:{type:"memory"}});d.mon(d.valueStore,"datachanged",d.applyMultiselectItemMarkup,d);if(d.selectionModel){d.selectionModel.bindStore(d.valueStore);}}},onUnbindStore:function(b){var c=this,d=c.valueStore;if(d){if(c.selectionModel){c.selectionModel.setLastFocused(null);c.selectionModel.deselectAll();c.selectionModel.bindStore(null);}c.mun(d,"datachanged",c.applyMultiselectItemMarkup,c);d.destroy();c.valueStore=null;}c.callParent(arguments);},createPicker:function(){var c=this,b=c.callParent(arguments);c.mon(b,{beforerefresh:c.onBeforeListRefresh,scope:c});if(c.filterPickList){b.addCls("x-boxselect-hideselections");}return b;},onDestroy:function(){var b=this;Ext.destroyMembers(b,"valueStore","selectionModel");b.callParent(arguments);},getSubTplData:function(){var b=this,c=b.callParent(),d=b.emptyText&&c.value.length<1;c.value="";if(d){c.emptyText=b.emptyText;c.emptyCls=b.emptyCls;c.inputElCls=b.emptyInputCls;}else{c.emptyText="";c.emptyCls=b.emptyInputCls;c.inputElCls="";}return c;},afterRender:function(){var b=this;if(Ext.supports.Placeholder&&b.inputEl&&b.emptyText){delete b.inputEl.dom.placeholder;}b.bodyEl.applyStyles("vertical-align:top");if(b.grow){if(Ext.isNumber(b.growMin)&&(b.growMin>0)){b.listWrapper.applyStyles("min-height:"+b.growMin+"px");}if(Ext.isNumber(b.growMax)&&(b.growMax>0)){b.listWrapper.applyStyles("max-height:"+b.growMax+"px");}}if(b.stacked===true){b.itemList.addCls("x-boxselect-stacked");}if(!b.multiSelect){b.itemList.addCls("x-boxselect-singleselect");}b.applyMultiselectItemMarkup();b.callParent(arguments);},findRecord:function(e,d){var c=this.store,b;if(!c){return false;}b=c.queryBy(function(f,g){return f.isEqual(f.get(e),d);});return(b.getCount()>0)?b.first():false;},onLoad:function(){var c=this,b=c.valueField,d=c.valueStore,e=false;if(d){if(!Ext.isEmpty(c.value)&&(d.getCount()==0)){c.setValue(c.value,false,true);}d.suspendEvents();d.each(function(h){var g=c.findRecord(b,h.get(b)),f=g?d.indexOf(h):-1;if(f>=0){d.removeAt(f);d.insert(f,g);e=true;}});d.resumeEvents();if(e){d.fireEvent("datachanged",d);}}c.callParent(arguments);},isFilteredRecord:function(b){var g=this,c=g.store,e=g.valueField,f,d=false;f=c.findExact(e,b.get(e));d=((f===-1)&&(!c.snapshot||(g.findRecord(e,b.get(e))!==false)));d=d||(!d&&(f===-1)&&(g.forceSelection!==true)&&(g.valueStore.findExact(e,b.get(e))>=0));return d;},doRawQuery:function(){var b=this,c=b.inputEl.dom.value;if(b.multiSelect){c=c.split(b.delimiter).pop();}if(c.length>0){this.doQuery(c,false,true);}this.focus();this.selectText(c.length,c.length);},onBeforeListRefresh:function(){this.ignoreSelection++;},onListRefresh:function(){this.callParent(arguments);
if(this.ignoreSelection>0){--this.ignoreSelection;}},onListSelectionChange:function(d,g){var c=this,e=c.valueStore,f=[],b;if((c.ignoreSelection<=0)&&c.isExpanded){e.each(function(h){if(Ext.Array.contains(g,h)||c.isFilteredRecord(h)){f.push(h);}});f=Ext.Array.merge(f,g);b=Ext.Array.intersect(f,e.getRange()).length;if((b!=f.length)||(b!=c.valueStore.getCount())){c.setValue(f,false);if(!c.multiSelect||!c.pinList){Ext.defer(c.collapse,1,c);}if(e.getCount()>0){c.fireEvent("select",c,e.getRange());}}c.inputEl.focus();if(!c.pinList){c.inputEl.dom.value="";}if(c.selectOnFocus){c.inputEl.dom.select();}}},syncSelection:function(){var g=this,e=g.picker,d=g.valueField,b,f,c;if(e){b=e.store;f=[];if(g.valueStore){g.valueStore.each(function(j){var h=b.findExact(d,j.get(d));if(h>=0){f.push(b.getAt(h));}});}g.ignoreSelection++;c=e.getSelectionModel();c.deselectAll();if(f.length>0){c.select(f);}if(g.ignoreSelection>0){--g.ignoreSelection;}}},doAlign:function(){var e=this,d=e.picker,b="-above",c;e.picker.alignTo(e.listWrapper,e.pickerAlign,e.pickerOffset);c=d.el.getY()<e.inputEl.getY();e.bodyEl[c?"addCls":"removeCls"](e.openCls+b);d[c?"addCls":"removeCls"](d.baseCls+b);},alignPicker:function(){var d=this,c=d.picker,b=c.getTargetEl().dom.scrollTop;d.callParent(arguments);if(d.isExpanded){if(d.matchFieldWidth){c.setWidth(d.listWrapper.getWidth());}c.getTargetEl().dom.scrollTop=b;}},getCursorPosition:function(){var b;if(Ext.isIE){b=document.selection.createRange();b.collapse(true);b.moveStart("character",-this.inputEl.dom.value.length);b=b.text.length;}else{b=this.inputEl.dom.selectionStart;}return b;},hasSelectedText:function(){var c,b;if(Ext.isIE){c=document.selection;b=c.createRange();return(b.parentElement()==this.inputEl.dom);}else{return this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd;}},onKeyDown:function(f,j){var g=this,i=f.getKey(),c=Ext.String.htmlEncode(g.inputEl.dom.value),k=g.valueStore,d=g.selectionModel,b=false;if(g.readOnly||g.disabled||!g.editable){return;}if(g.isExpanded&&(i==f.A&&f.ctrlKey)){g.select(g.getStore().getRange());d.setLastFocused(null);d.deselectAll();g.collapse();g.inputEl.focus();b=true;}else{if((k.getCount()>0)&&((c=="")||((g.getCursorPosition()===0)&&!g.hasSelectedText()))){var h=(d.getCount()>0)?k.indexOf(d.getLastSelected()||d.getLastFocused()):-1;if((i==f.BACKSPACE)||(i==f.DELETE)){if(h>-1){if(d.getCount()>1){h=-1;}g.valueStore.remove(d.getSelection());}else{g.valueStore.remove(g.valueStore.last());}d.clearSelections();g.setValue(g.valueStore.getRange());if(h>0){d.select(h-1);}b=true;}else{if((i==f.RIGHT)||(i==f.LEFT)){if((h==-1)&&(i==f.LEFT)){d.select(k.last());b=true;}else{if(h>-1){if(i==f.RIGHT){if(h<(k.getCount()-1)){d.select(h+1,f.shiftKey);b=true;}else{if(!f.shiftKey){d.setLastFocused(null);d.deselectAll();b=true;}}}else{if((i==f.LEFT)&&(h>0)){d.select(h-1,f.shiftKey);b=true;}}}}}else{if(i==f.A&&f.ctrlKey){d.selectAll();b=f.A;}}}g.inputEl.focus();}}if(b){g.preventKeyUpEvent=b;f.stopEvent();return;}if(g.isExpanded&&(i==f.ENTER)&&g.picker.highlightedItem){g.preventKeyUpEvent=true;}if(g.enableKeyEvents){g.callParent(arguments);}if(!f.isSpecialKey()&&!f.hasModifier()){g.selectionModel.setLastFocused(null);g.selectionModel.deselectAll();g.inputEl.focus();}},onKeyUp:function(f,b){var c=this,d=Ext.String.htmlEncode(c.inputEl.dom.value);if(c.preventKeyUpEvent){f.stopEvent();if((c.preventKeyUpEvent===true)||(f.getKey()===c.preventKeyUpEvent)){delete c.preventKeyUpEvent;}return;}if(c.multiSelect&&(c.delimiterRegexp&&c.delimiterRegexp.test(d))||((c.createNewOnEnter===true)&&f.getKey()==f.ENTER)){d=Ext.Array.clean(d.split(c.delimiterRegexp));c.inputEl.dom.value="";c.setValue(c.valueStore.getRange().concat(d));c.inputEl.focus();}c.callParent([f,b]);},onPaste:function(g,b){var c=this,f=c.inputEl.dom.value,d=(g&&g.browserEvent&&g.browserEvent.clipboardData)?g.browserEvent.clipboardData:false;if(c.multiSelect&&(c.delimiterRegexp&&c.delimiterRegexp.test(f))){if(d&&d.getData){if(/text\/plain/.test(d.types)){f=d.getData("text/plain");}else{if(/text\/html/.test(d.types)){f=d.getData("text/html");}}}f=Ext.Array.clean(f.split(c.delimiterRegexp));c.inputEl.dom.value="";c.setValue(c.valueStore.getRange().concat(f));c.inputEl.focus();}},onExpand:function(){var c=this,b=c.listKeyNav;c.callParent(arguments);if(b||!c.filterPickList){return;}b=c.listKeyNav;b.highlightAt=function(f){var e=this.boundList,g=e.all.item(f),d=e.all.getCount(),h;if(g&&g.hasCls("x-boundlist-selected")){if((f==0)||!e.highlightedItem||(e.indexOf(e.highlightedItem)<f)){h=1;}else{h=-1;}do{f=f+h;g=e.all.item(f);}while((f>0)&&(f<d)&&g.hasCls("x-boundlist-selected"));if(g.hasCls("x-boundlist-selected")){return;}}if(g){g=g.dom;e.highlightItem(g);e.getTargetEl().scrollChildIntoView(g,false);}};},onTypeAhead:function(){var g=this,f=g.displayField,i=g.inputEl.dom,k=g.valueStore,j=g.getPicker(),d,b,e,c;if(g.filterPickList){var h=this.createFilterFn(f,i.value);d=g.store.findBy(function(l){return((k.indexOfId(l.getId())===-1)&&h(l));});d=(d===-1)?false:g.store.getAt(d);
}else{d=g.store.findRecord(f,i.value);}if(d){b=d.get(f);e=b.length;c=i.value.length;j.highlightItem(j.getNode(d));if(c!==0&&c!==e){i.value=b;g.selectText(c,b.length);}}},onItemListClick:function(b,d,f){var e=this,c=b.getTarget(".x-boxselect-item"),g=c?b.getTarget(".x-boxselect-item-close"):false;if(e.readOnly||e.disabled){return;}b.stopPropagation();if(c){if(g){e.removeByListItemNode(c);if(e.valueStore.getCount()>0){e.fireEvent("select",e,e.valueStore.getRange());}}else{e.toggleSelectionByListItemNode(c,b.shiftKey);}e.inputEl.focus();}else{if(e.selectionModel.getCount()>0){e.selectionModel.setLastFocused(null);e.selectionModel.deselectAll();}if(e.triggerOnClick){e.onTriggerClick();}}},getMultiSelectItemMarkup:function(){var b=this;if(!b.multiSelectItemTpl){if(!b.labelTpl){b.labelTpl=Ext.create("Ext.XTemplate","{[values."+b.displayField+"]}");}else{if(Ext.isString(b.labelTpl)||Ext.isArray(b.labelTpl)){b.labelTpl=Ext.create("Ext.XTemplate",b.labelTpl);}}b.multiSelectItemTpl=['<tpl for=".">','<li class="x-boxselect-item ','<tpl if="this.isSelected(values.'+b.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : values.'+b.displayField+']}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:true,disableFormats:true,isSelected:function(d){var c=b.valueStore.findExact(b.valueField,d);if(c>=0){return b.selectionModel.isSelected(b.valueStore.getAt(c));}return false;},getItemLabel:function(c){return b.getTpl("labelTpl").apply(c);}}];}return this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"));},applyMultiselectItemMarkup:function(){var d=this,b=d.itemList,c;if(b){while((c=d.inputElCt.prev())!=null){c.remove();}d.inputElCt.insertHtml("beforeBegin",d.getMultiSelectItemMarkup());}Ext.Function.defer(function(){if(d.picker&&d.isExpanded){d.alignPicker();}if(d.hasFocus&&d.inputElCt&&d.listWrapper){d.inputElCt.scrollIntoView(d.listWrapper);}},15);},getRecordByListItemNode:function(c){var e=this,d=0,b=e.itemList.dom.firstChild;while(b&&b.nextSibling){if(b==c){break;}d++;b=b.nextSibling;}d=(b==c)?d:false;if(d===false){return false;}return e.valueStore.getAt(d);},toggleSelectionByListItemNode:function(c,e){var d=this,f=d.getRecordByListItemNode(c),b=d.selectionModel;if(f){if(b.isSelected(f)){if(b.isFocused(f)){b.setLastFocused(null);}b.deselect(f);}else{b.select(f,e);}}},removeByListItemNode:function(b){var c=this,d=c.getRecordByListItemNode(b);if(d){c.valueStore.remove(d);c.setValue(c.valueStore.getRange());}},getRawValue:function(){var c=this,d=c.inputEl,b;c.inputEl=false;b=c.callParent(arguments);c.inputEl=d;return Ext.String.htmlDecode(b);},setRawValue:function(d){d=Ext.String.htmlEncode(d);var c=this,e=c.inputEl,b;c.inputEl=false;b=c.callParent([d]);c.inputEl=e;return b;},addValue:function(c){c=Ext.String.htmlEncode(c);var b=this;if(c){b.setValue(Ext.Array.merge(b.value,Ext.Array.from(c)));}},removeValue:function(c){c=Ext.String.htmlDecode(c);var b=this;if(c){b.setValue(Ext.Array.difference(b.value,Ext.Array.from(c)));}},setValue:function(m,c,n){var l=this,p=l.valueStore,o=l.valueField,g,j,e,b,f,k=[];if(Ext.isEmpty(m)){m=null;}if(Ext.isString(m)&&l.multiSelect){m=m.split(l.delimiter);}m=Ext.Array.from(m,true);for(e=0,j=m.length;e<j;e++){g=m[e];if(!g||!g.isModel){b=p.findExact(o,g);if(b>=0){m[e]=p.getAt(b);}else{b=l.findRecord(o,g);if(!b){if(l.forceSelection){k.push(g);}else{b={};b[l.valueField]=g;b[l.displayField]=g;b=new l.valueStore.model(b);}}if(b){m[e]=b;}}}}if((n!==true)&&(k.length>0)&&(l.queryMode==="remote")){var d={};d[l.valueParam||l.valueField]=k.join(l.delimiter);l.store.load({params:d,callback:function(){if(l.itemList){l.itemList.unmask();}l.setValue(m,c,true);l.autoSize();l.lastQuery=false;}});return false;}if(!l.multiSelect&&(m.length>0)){for(e=m.length-1;e>=0;e--){if(m[e].isModel){m=m[e];break;}}if(Ext.isArray(m)){m=m[m.length-1];}}return l.callParent([m,c]);},getValueRecords:function(){return this.valueStore.getRange();},getSubmitData:function(){var b=this,c=b.callParent(arguments);if(b.multiSelect&&b.encodeSubmitValue&&c&&c[b.name]){c[b.name]=Ext.encode(c[b.name]);}return c;},mimicBlur:function(){var b=this;if(b.selectOnTab&&b.picker&&b.picker.highlightedItem){b.inputEl.dom.value="";}b.callParent(arguments);},assertValue:function(){var b=this,d=b.inputEl.dom.value,e=!Ext.isEmpty(d)?b.findRecordByDisplay(d):false,c=false;if(!e&&!b.forceSelection&&b.createNewOnBlur&&!Ext.isEmpty(d)){c=d;}else{if(e){c=e;}}if(c){b.addValue(c);}b.inputEl.dom.value="";b.collapse();},checkChange:function(){var f=this,h=f.valueStore,j=h.getRange(),g=f.value;var e=[];SVMX.array.forEach(f.valueModels,function(i){i.data.name=i.data.name.replace(/^\s+|\s+$/g,"");});var b={};for(var d=0;d<f.valueModels.length;d++){if(f.valueModels[d].data.name!=""&&!(b[f.valueModels[d].data.name.toUpperCase()])){b[f.valueModels[d].data.name.toUpperCase()]=f.valueModels[d];
}}f.valueModels=new Array();for(var c in b){f.valueModels.push(b[c]);}if((Ext.encode(g)!==Ext.encode(f.lastValue))||(Ext.isArray(g)&&(j.length!=g.length))){h.suspendEvents();h.removeAll();f.value=g;if(Ext.isArray(f.valueModels)){h.add(f.valueModels);}h.resumeEvents();h.fireEvent("datachanged",h);}f.callParent(arguments);},isEqual:function(j,h){var c=Ext.Array.from,d=this.valueField,e,b,g,f;j=c(j);h=c(h);b=j.length;if(b!==h.length){return false;}for(e=0;e<b;e++){g=j[e].isModel?j[e].get(d):j[e];f=h[e].isModel?h[e].get(d):h[e];if(g!==f){return false;}}return true;},applyEmptyText:function(){var c=this,b=c.emptyText,d,e;if(c.rendered&&b){e=Ext.isEmpty(c.value)&&!c.hasFocus;d=c.inputEl;if(e){d.dom.value="";c.emptyEl.update(b);c.emptyEl.addCls(c.emptyCls);c.emptyEl.removeCls(c.emptyInputCls);c.listWrapper.addCls(c.emptyCls);c.inputEl.addCls(c.emptyInputCls);}else{c.emptyEl.addCls(c.emptyInputCls);c.emptyEl.removeCls(c.emptyCls);c.listWrapper.removeCls(c.emptyCls);c.inputEl.removeCls(c.emptyInputCls);}c.autoSize();}},preFocus:function(){var c=this,d=c.inputEl,b=c.emptyText,e=(d.dom.value=="");c.emptyEl.addCls(c.emptyInputCls);c.emptyEl.removeCls(c.emptyCls);c.listWrapper.removeCls(c.emptyCls);c.inputEl.removeCls(c.emptyInputCls);if(c.selectOnFocus||e){d.dom.select();}},onFocus:function(){var d=this,c=d.focusCls,b=d.itemList;if(c&&b){b.addCls(c);}d.callParent(arguments);},onBlur:function(){var d=this,c=d.focusCls,b=d.itemList;if(c&&b){b.removeCls(c);}d.callParent(arguments);},renderActiveError:function(){var e=this,d=e.invalidCls,c=e.itemList,b=e.hasActiveError();if(d&&c){c[b?"addCls":"removeCls"](e.invalidCls+"-field");}e.callParent(arguments);},autoSize:function(){var c=this,b;if(c.grow&&c.rendered){c.autoSizing=true;c.updateLayout();}return c;},afterComponentLayout:function(){var c=this,b;if(c.autoSizing){height=c.getHeight();if(height!==c.lastInputHeight){if(c.isExpanded){c.alignPicker();}c.fireEvent("autosize",c,height);c.lastInputHeight=height;delete c.autoSizing;}}}});Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",waitForOuterWidthInDom:true,beginLayout:function(d){var c=this,b=c.owner;c.callParent(arguments);d.inputElCtContext=d.getEl("inputElCt");b.inputElCt.setStyle("width","");c.skipInputGrowth=!b.grow||!b.multiSelect;},beginLayoutFixed:function(e,c,f){var d=this,b=e.target;b.triggerEl.setStyle("height","24px");d.callParent(arguments);if(e.heightModel.fixed&&e.lastBox){b.listWrapper.setStyle("height",e.lastBox.height+"px");b.itemList.setStyle("height","100%");}},publishInnerWidth:function(f){var e=this,b=e.owner,d=b.itemList.getWidth(true)-10,c=b.inputElCt.prev(null,true);if(c&&!b.stacked){c=Ext.fly(c);d=d-c.getOffsetsTo(c.up(""))[0]-c.getWidth();}if(!e.skipInputGrowth&&(d<35)){d=d-10;}else{if(d<1){d=1;}}f.inputElCtContext.setWidth(d);}});};})();