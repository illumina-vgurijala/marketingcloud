(function(){var a=SVMX.Package("com.servicemax.client.qbm.ui.desktop.api");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("CQL");Ext.define("com.servicemax.client.qbm.ui.desktop.api.RootContainer",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",alias:"widget.qbm.rootcontainer",layout:"border",cls:"qbm-root-container",__resultsViewPanel:null,__runOpts:null,height:"100%",__parent:this,constructor:function(d){var e="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";var c=window.location.search.substring(1);var f=b.T("TAG002","Back To Setup Home");if(c&&c.indexOf("isStandAloneChecklist")!=-1){e="/apex/"+SVMX.OrgNamespace+"__CONF_FeatureSetup";f=b.T("COMM008","Back To Feature Setup");}else{if((typeof sforce!="undefined")&&(sforce!=null)){e="/lightning/n/"+SVMX.OrgNamespace+"__ServiceMax_Setup";}}d=Ext.apply({header:{items:[{xtype:"svmx.button",itemId:"BackButton",padding:"0",text:f,handler:function(j,i,g,h){if((typeof sforce!="undefined")&&(sforce!=null)){sforce.one.navigateToURL(e);}else{window.location=e;}}}]},collapsible:false,title:SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")?"":b.T("TAG003","Checklist Question Library"),titleAlign:"center",layout:{type:"border"}},d||{});this.callParent([d]);},run:function(d){var g=this;this.__runOpts=d;this.__mainPanel=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXContainer",{region:"center",width:"100%",layout:{type:"vbox",align:"stretch"}});this.add(this.__mainPanel);this.__libraryPanel=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXContainer",{region:"center",width:"100%",flex:1,hidden:true,layout:{type:"vbox",align:"stretch"}});this.__mainPanel.add(this.__libraryPanel);this.__editPanel=SVMX.create("com.servicemax.client.qbm.ui.desktop.EditPanel",{region:"center",width:"100%",flex:1,hidden:true,__parent:this});this.__mainPanel.add(this.__editPanel);var f=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{dock:"top",flex:0.5});var j=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXText",{cls:"svmx-text-filter-icon",width:300,emptyText:b.T("TAG004","Search for Questions"),selectOnFocus:false,style:{marginLeft:"20px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},listeners:{change:function(l,m){var k=j.getValue();g.__resultsViewPanel.__questionListStore.clearFilter();g.__resultsViewPanel.__questionListStore.filter("question",new RegExp(Ext.escapeRe(k),"i"));}}});f.addItemsLeft(j);var h=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG005","Add"),tootip:b.T("TODO","Create a Question"),style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){g.showEditPanel(false);}});f.addItemsRight(h);var i=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG006","Delete"),tootip:b.T("TODO","Delete a Question"),disabled:true,style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){var k=g.__resultsViewPanel.getSelectedItems();if(k.length===1){Ext.Msg.confirm(b.T("TAG007","Confirm Delete"),b.T("TAG008","The question will be deleted. This action cannot be undone"),function(l){if(l==="yes"){g.blockApplication();g.deliveryEngine.deleteQuestion(k[0]);}},this);}}});f.addItemsRight(i);var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG009","PREVIOUS"),tootip:b.T("TODO","Get Previous List of Question"),style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){g.blockApplication();g.deliveryEngine.previousQuestionList();}});f.addItemsRight(e);var c=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG010","NEXT"),tootip:b.T("TODO","Get Next List of Question"),style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){g.blockApplication();g.deliveryEngine.nextQuestionList();}});f.addItemsRight(c);this.__libraryPanel.add(f);this.__toolbar=f;this.__deleteButton=i;this.__resultsViewPanel=SVMX.create("com.servicemax.client.qbm.ui.desktop.Grid",{metaModel:this.metaModel,__parent:this,deliveryEngine:this.deliveryEngine,style:{marginLeft:"2px",marginRight:"2px",marginTop:"2px",marginBottom:"2px"},flex:9.5});this.__libraryPanel.add(this.__resultsViewPanel);this.resize();this.showLibraryPanel();},showLibraryPanel:function(){this.__editPanel.hide();this.__libraryPanel.show();},showEditPanel:function(d,c){this.__libraryPanel.hide();this.__editPanel.show();this.__editPanel.setActiveQuestion(d,c);},setAndSaveQuestionData:function(){var m=this.__editPanel.formPanel.getData();var k=false;var c=false;var f=m.questionText&&m.questionText.trim();if(m.answers!=undefined){var n=SVMX.typeOf(m.answers)==="string"?[m.answers]:m.answers;var e=n.length;for(var g=0;g<e;g++){var h=Ext.String.htmlEncode(n[g].trim());
if(!(h!=""&&h.length>0)){k=true;}}}var d=["Checkbox","Radio Button","Picklist","Multi-select Picklist"];var j=d.indexOf(m.response_Type);if(j!=-1&&m.newResponseSetName!=undefined&&m.newResponseSetName.trim()==""){c=true;}if(f!=""&&f.length>0&&!k&&!c){this.blockApplication();this.deliveryEngine.saveQuestion(m);}else{Ext.Msg.alert(b.T("TAG011","Failure"),b.T("TAG012","Please fill all the Required fields"));}},showMessage:function(d){var c=Ext.Msg.alert(b.T("TAG013","Success"),Ext.String.htmlEncode(d),function(e,f){if(e=="ok"){this.showLibraryPanel();}},this);},onFailure:function(e,c){this.unblockApplication();if(c==="DUPLICATE_RESPONSE_SET"){var d=Ext.Msg.alert(b.T("TAG011","Failure"),Ext.String.htmlEncode(e),function(f,g){},this);}else{var d=Ext.Msg.alert(b.T("TAG011","Failure"),Ext.String.htmlEncode(e),function(f,g){if(f=="ok"){this.showLibraryPanel();}},this);}},onDeleteFailure:function(f,g){f=Ext.String.htmlEncode(f);var e,c=g&&g.length;f=f+"<ol>";for(e=0;e<c;e++){f=f+"<li>"+Ext.String.htmlEncode(g[e])+"</li>";if(e===3){break;}}f=f+"</ol>";if(e===3&&c>e+1){f=f+"<br>"+b.T("TAG015","and")+" "+(c-(e+1))+" "+b.T("TAG016","more");}this.unblockApplication();var d=Ext.Msg.alert(b.T("TAG014","Unable To Delete"),f);},onSaveFailure:function(f,g){f=Ext.String.htmlEncode(f);var e,c=g&&g.length;f=f+"<ol>";for(e=0;e<c;e++){f=f+"<li>"+Ext.String.htmlEncode(g[e])+"</li>";if(e===3){break;}}f=f+"</ol>";if(e===3&&c>e+1){f=f+"<br>"+b.T("TAG015","and")+" "+(c-(e+1))+" "+b.T("TAG016","more");}this.unblockApplication();var d=Ext.Msg.alert(b.T("TAG047","Unable To Save"),f);},resize:function(c){if(!this.getEl()){return SVMX.timer.job(this.id+".resize",10,this,"resize");}if(!c){c=this.getEl().getViewSize();}if(c.width){c.width=c.width-4;}if(c.height){c.height=c.height-6;}if(c.width){this.setWidth(c.width);}if(c.height){this.setHeight(c.height);}},blockApplication:function(f){var e=f||{request:{state:"block",deliveryEngine:this.getDeliveryEngine()},responder:{}};var d=this.getDeliveryEngine().getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","QBM.CHANGE_APP_STATE",this,e);d.triggerEvent(c);},unblockApplication:function(f){var e=f||{request:{state:"unblock",deliveryEngine:this.getDeliveryEngine()},responder:{}};var d=this.getDeliveryEngine().getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","QBM.CHANGE_APP_STATE",this,e);d.triggerEvent(c);},getDeliveryEngine:function(){return this.deliveryEngine;}});Ext.define("com.servicemax.client.qbm.ui.desktop.EditPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXContainer",alias:"widget.svmx.qbm.editpanel",constructor:function(c){c=Ext.apply({layout:{type:"vbox",align:"stretch"}},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var c=this;var f=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{dock:"top",flex:0.5});var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG017","Cancel"),tootip:b.T("TODO","Back to Question listing page"),style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){c.__parent.showLibraryPanel();}});f.addItemsLeft(e);var d=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG018","Save"),tootip:b.T("TODO","Save a Question"),style:{marginLeft:"2px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){c.__parent.setAndSaveQuestionData();}});f.addItemsRight(d);this.add(f);this.formPanel=SVMX.create("com.servicemax.client.qbm.ui.desktop.editQuestion.EditQuestionPanel",{titleAlign:"center",width:"90%",__parent:this,flex:9.5});this.add(this.formPanel);},setActiveQuestion:function(d,c){if(!d){this.formPanel.setTitle(b.T("TAG019","Add Question"));this.formPanel.radioButton.hide();this.formPanel.__newResponseSetName.hide();}else{this.formPanel.radioButton.show();this.formPanel.setTitle(b.T("TAG020","Edit Question"));}this.formPanel.loadQuestionDataInEditMode(d,c||{});}});Ext.define("com.servicemax.client.qbm.ui.desktop.Grid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",alias:"widget.svmx.qbm.grid",constructor:function(e){var f=this;var c=SVMX.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:false,mode:"SINGLE",setLastFocused:function(i,h){var j=this,g=i;j.lastFocused=i;if(i!==g){j.onLastFocusChanged(g,i,h);}},onRowMouseDown:function(k,l,o,q,n){var p=this,r=n.getTarget("."+Ext.baseCSSPrefix+"grid-row-checker"),m;if(!p.allowRightMouseSelection(n)){return;}if(p.checkOnly&&!r){return;}if(r){m=p.getSelectionMode();if(m!=="SINGLE"){p.setSelectionMode("SIMPLE");}p.doSelect(l,true);p.setSelectionMode(m);}else{p.doSelect(l,true);}},listeners:{selectionchange:function(g,h){f.__parent.__deleteButton.setDisabled(h.length==0);}}});var d=this.__questionListStore=Ext.create("Ext.data.Store",{storeId:"questionListStore",fields:[{name:"id"},{name:"question"},{name:"dataType"},{name:"lastModifiedDate",type:"date"}],data:[]});
e=Ext.apply({store:d,selModel:c,columns:[{text:b.T("TAG021","Question"),dataIndex:"question",width:"50%"},{text:b.T("TAG022","Type"),dataIndex:"dataType",width:"25%"},{text:b.T("TAG023","Edited"),xtype:"datecolumn",format:"m-d-Y",dataIndex:"lastModifiedDate",width:"25%"}],listeners:{celldblclick:SVMX.proxy(this,function(g,j,h,i){this.__parent.blockApplication();this.deliveryEngine.editQuestion(this.getSelectionModel().getLastSelected());})}},e||{});this.callParent([e]);},initComponent:function(){this.callParent(arguments);this.loadData();},loadData:function(){this.__questionListStore.loadData(this.__parent.metaModel.getQuestionInfo());},getSelectedItems:function(){var d=[],e=this.selModel.getSelection();if(e.length>0){for(var c=0;c<e.length;c++){d.push(e[c].data.id);}}return d;}});};})();