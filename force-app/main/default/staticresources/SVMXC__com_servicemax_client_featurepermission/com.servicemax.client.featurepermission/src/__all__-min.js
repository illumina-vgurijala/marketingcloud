(function(){var a=SVMX.Package("com.servicemax.client.featurepermission.api");a.init=function(){a.Class("Application",com.servicemax.client.lib.api.AbstractApplication,{__constructor:function(){},beforeRun:function(b){var c=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.featurepermission.impl.EventBus",{});c.createNamedInstanceAsync("CONTROLLER",{handler:function(d){c.createNamedInstanceAsync("MODEL",{handler:function(e){d.setModel(e);},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});b.handler.call(b.context);},getEventBus:function(){return this.__eventBus;},run:function(){this.getMetaData();},getMetaData:function(){this.blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","FEATUREPERMISSION.GET_META_DATA",this,{request:{context:this,}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},onGetMetaDataComplete:function(b){var c=this;c.unblockUI();c.__processTranslations(b.translations);SVMX.create("com.servicemax.client.featurepermission.root.RootPanel",{collapsible:false,titleAlign:"center",frame:"true",metaData:b,app:c});},__processTranslations:function(e){var c,d=e.length;var b={};for(c=0;c<d;c++){b[e[c].Key]=Ext.String.htmlEncode(e[c].Text);}window.$TR=b;},blockUI:function(){if(this.__spinner){this.__spinner.spin($("#"+SVMX.getDisplayRootId())[0]);}else{var c=window.innerHeight/2-100;var b={lines:25,length:25,width:5,radius:30,corners:1,rotate:0,direction:1,color:"#ffa384",speed:3,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,top:c};this.__spinner=new Spinner(b).spin($("#"+SVMX.getDisplayRootId())[0]);}},unblockUI:function(){this.__spinner.stop();},});};})();(function(){var a=SVMX.Package("com.servicemax.client.featurepermission.commands");a.init=function(){a.Class("GetMetaData",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"FEATUREPERMISSION.GET_META_DATA"});},result:function(b){this.__cbContext.onGetMetaDataComplete(b);}},{});a.Class("GetUserData",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"FEATUREPERMISSION.GET_USER_DATA"});},result:function(b){this.__cbContext.onGetUserDataComplete(b);}},{});a.Class("SaveData",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"FEATUREPERMISSION.SAVE_DATA"});},result:function(b){this.__cbContext.saveDataComplete(b);}},{});};})()(function(){SVMX.OrgNamespace=SVMX.getClient().getApplicationParameter("org-name-space")||"SVMXDEV";SVMX.appType=SVMX.getClient().getApplicationParameter("app-type")||"external";var a=SVMX.Package("com.servicemax.client.featurepermission.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__constructor:function(){this.__base();a.Module.instance=this;},initialize:function(){},afterInitialize:function(){},beforeInitialize:function(){com.servicemax.client.featurepermission.api.init();com.servicemax.client.featurepermission.root.init();com.servicemax.client.featurepermission.commands.init();com.servicemax.client.featurepermission.operations.init();},createServiceRequest:function(d,c){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sal.service.factory");b.getInstanceAsync({handler:function(e){var f=d.options||{};var h={type:f.type||"REST",endPoint:f.endPoint||"",nameSpace:SVMX.OrgNamespace};var i=e.createServiceManager(h);var g=i.createService();d.handler.call(d.context,g);},context:this});},},{instance:null});a.Class("EventBus",com.servicemax.client.lib.api.EventDispatcher,{__constructor:function(){this.__base();}},{__instance:null,getInstance:function(){if(!a.EventBus.__instance){a.EventBus.__instance=SVMX.create("com.servicemax.client.featurepermission.EventBus",{});}return a.EventBus.__instance;}});})();(function(){var a=SVMX.Package("com.servicemax.client.featurepermission.operations");a.init=function(){var b=com.servicemax.client.featurepermission.impl.Module;a.Class("GetMetaData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,c){featurepermissionObject.JsrGetMetadata("",function(e,f){c.result(e);},this);}},{});a.Class("GetUserData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,d){var c={profileId:e.profileId,searchValue:e.searchValue};featurepermissionObject.JsrGetUserData(c,function(f,g){d.result(f);},this);}},{});a.Class("SaveData",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,c){featurepermissionObject.JsrSaveData(d.modifiedUsers,function(e,f){c.result(e);
},this);}},{});};})();(function(){var a=SVMX.Package("com.servicemax.client.featurepermission.root");a.init=function(){var b=com.servicemax.client.ui.components.composites.impl;Ext.define("com.servicemax.client.featurepermission.root.RootPanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",cls:"svmx-feature-permission-root",__grid:null,__store:null,__metaData:null,__app:null,__modifiedUsers:null,__currentProfile:null,__newProfile:null,constructor:function(c){var d=this;c=c||{};c.renderTo=SVMX.getDisplayRootId();c.autoScroll=true;d.__metaData=c.metaData;d.__app=c.app;d.__modifiedUsers={};d.__newProfile=[];d.__currentProfile=[];c.items=d.__getItems();this.callParent([c]);},__getItems:function(){var j=this;var g=[{profileId:"--None--",profileName:$TR.NONE}];g=g.concat(j.__metaData.svmxProfiles);var m=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["profileId","profileName"],data:g});j.__profilePicklist=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{id:"profileId",name:"profileName",align:"center",fieldLabel:$TR.PROFILE,labelWidth:60,labelField:"profileName",valueField:"profileId",displayField:"profileName",width:300,store:m,parentContext:j,listeners:{select:function(p,n,o){j.__didProfileSelect(p,n,o);},afterrender:function(o){var n=o.getStore().getAt(0);o.setValue(n.get("profileId"));}},listConfig:{getInnerTpl:function(n){return"{[Ext.String.htmlEncode(values."+n+")]}";}}});var e={xtype:"radiogroup",id:"groupradiocomp",disabled:true,margin:"0 0 0 25",bind:{value:"{}"},listeners:{change:function(q,p,n){j.__grid.getStore().clearFilter();var o=[new Ext.util.Filter({filterFn:function(r){if(p.users=="userWithPermission"){j.__store.filterData=j.__store.allData.filter(function(s){return(s.isChecklistEnabled===true||s.isSFMEnabled===true);});return(r.get("isChecklistEnabled")==true||r.get("isSFMEnabled")==true);}else{if(p.users=="alluser"){j.__store.filterData=j.__store.allData;return(r.get("isChecklistEnabled")==false)||(r.get("isChecklistEnabled")==true)||(r.get("isSFMEnabled")==true)||(r.get("isSFMEnabled")==false);}}}})];j.__grid.getStore().filter(o);j.__store.loadPage(1);j.__updateSelectAllCheckboxes();}},defaults:{name:"users"},items:[{boxLabel:$TR.ALL_USER,inputValue:"alluser",checked:true,width:100,},{boxLabel:$TR.USER_WITH_PERMISSION,inputValue:"userWithPermission",width:150}]};j.searchTextField=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXText",{cls:"svmx-text-filter-icon",width:300,id:"searchtextfield",emptyText:$TR.SEARCH_FOR_USERNAME_OR_EMAIL,selectOnFocus:true,disabled:true,margin:"0 0 0 5"});j.searchButton=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:$TR.SEARCH,tootip:$TR.SEARCH,disabled:true,cls:"fp-btn-neutral",style:{marginLeft:"10px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){if(Object.keys(j.__modifiedUsers).length){Ext.Msg.show({title:$TR.ABANDON_CHANGES,msg:$TR.ERROR_PROFILE_CHANGE,width:400,closable:false,cls:"fp-confirmation-window",buttons:Ext.Msg.YESNO,buttonText:{yes:$TR.CANCEL,no:$TR.ABANDON},multiline:false,fn:function(o,p,n){if(o=="no"){j.__doSearch();}}});}else{j.__doSearch();}}});var d=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{width:"100%",dock:"bottom",border:false,cls:"svmx-feature-permission-main-nav",});var l=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{width:"calc(100% - 20px)",height:50,dock:"bottom",border:false,margin:10});var k=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:$TR.SETUP_HOME,docked:"left",rigion:"left",align:"left",cls:"svmx-feature-permission-back-btn",handler:function(){var n="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";if((typeof sforce!="undefined")&&(sforce!=null)){n="/lightning/n/"+SVMX.OrgNamespace+"__ServiceMax_Setup";sforce.one.navigateToURL(n);}else{window.location=n;}}});var f={xtype:"label",forId:"pagetitle",text:$TR.FEATURE_PERMISSION,margins:"0 0 0 0"};var h={iconCls:"",cursor:"pointer",scale:"small",cls:"svmx-feature-permission-help-btn",tooltip:$TR.HELP,href:$TR.HELP_URL,style:{marginRight:"25px",}};d.add(k);d.add(f);d.add("->");d.add(h);l.add(j.__profilePicklist);l.add(e);l.add("->");l.add(j.searchTextField);l.add(j.searchButton);Ext.define("userModel",{extend:"Ext.data.Model",fields:[{name:"userId",type:"string"},{name:"name",type:"string"},{name:"userName",type:"string"},{name:"isChecklistEnabled",type:"boolean"},{name:"isSFMEnabled",type:"boolean"}]});var c=100;j.__store=SVMX.create("Ext.data.Store",{model:"userModel",data:[],storeId:"user_store",autoLoad:false,pageSize:c,parentContext:j,proxy:{type:"memory",reader:{type:"array",root:"data",totalProperty:"total"}},allData:[],filterData:[],listeners:{beforeload:function(w,n,s){var v=Ext.getCmp("groupradiocomp").items.items[0].getValue();w.clearFilter();var r;if(v){r=this.allData||[];}else{r=this.filterData||[];}var u=n.start;
var o=n.limit;var x=r.slice(u,u+o);var q=[];for(var p=0;p<x.length;p++){var t=Ext.create("userModel",x[p]);q.push(t);}w.proxy.data={data:q,total:r.length,};}}});j.__grid=SVMX.create("com.servicemax.client.featurepermission.Grid",{parentContext:j,store:j.__store,autoScroll:true,margin:"5 10",anchor:"100%",style:{marginLeft:"2px",marginRight:"2px",marginTop:"2px",marginBottom:"2px"},height:570,margin:"10",autoScroll:true,layout:"fit",selType:"cellmodel",flex:9.5});var i=[d,l,j.__grid];return i;},__doSearch:function(){var c=this;c.__modifiedUsers={};c.__grid.getStore().clearFilter();Ext.getCmp("groupradiocomp").items.items[0].setValue(true);var d=c.searchTextField.getValue();c.__getUserData(c.__currentProfile[0].data.profileId,d);},__didProfileSelect:function(f,c,d){var e=this;e.__newProfile=c;if(Object.keys(e.__modifiedUsers).length){Ext.Msg.show({title:$TR.ABANDON_CHANGES,msg:$TR.ERROR_PROFILE_CHANGE,width:400,closable:false,cls:"fp-confirmation-window",buttons:Ext.Msg.YESNO,buttonText:{yes:$TR.CANCEL,no:$TR.ABANDON},multiline:false,fn:function(h,i,g){if(h=="no"){e.__didProfileChange(e.__newProfile);}if(h=="yes"){e.__profilePicklist.setValue(e.__currentProfile[0].data.profileId);}}});}else{e.__currentProfile=c;e.__didProfileChange(c);}},__didProfileChange:function(c){var d=this;d.searchTextField.setValue("");d.__modifiedUsers={};d.__grid.getStore().clearFilter();Ext.getCmp("groupradiocomp").items.items[0].setValue(true);if(c[0].data.profileId=="--None--"){Ext.getCmp("groupradiocomp").setDisabled(true);d.searchButton.setDisabled(true);d.__grid.saveButton.setDisabled(true);Ext.getCmp("searchtextfield").setDisabled(true);d.__grid.getStore().loadData([]);document.getElementById("allchecklist").checked=false;document.getElementById("allsfm").checked=false;document.getElementById("allchecklist").disabled=true;document.getElementById("allsfm").disabled=true;d.__store.allData=[];d.__store.filterData=[];d.__store.loadPage(1);}else{Ext.getCmp("groupradiocomp").setDisabled(false);d.searchButton.setDisabled(false);d.__grid.saveButton.setDisabled(false);Ext.getCmp("searchtextfield").setDisabled(false);d.__getUserData(c[0].data.profileId,"");}},__getUserData:function(f,e){var d=this;Ext.getCmp("groupradiocomp").items.items[0].setValue(true);d.__app.blockUI();var c=SVMX.create("com.servicemax.client.lib.api.Event","FEATUREPERMISSION.GET_USER_DATA",this,{request:{context:d,profileId:f,searchValue:e}});SVMX.getCurrentApplication().getEventBus().triggerEvent(c);},onGetUserDataComplete:function(c){var d=this;d.__app.unblockUI();d.__store.allData=c.svmxUser;d.__store.filterData=c.svmxUser;d.__store.loadPage(1);d.__updateSelectAllCheckboxes();d.__updateActionItems();},__updateActionItems:function(){var d=this;var c=d.__store.allData;if(c.length==0){Ext.getCmp("groupradiocomp").setDisabled(true);d.__grid.saveButton.setDisabled(true);document.getElementById("allchecklist").checked=false;document.getElementById("allsfm").checked=false;}else{Ext.getCmp("groupradiocomp").setDisabled(false);d.__grid.saveButton.setDisabled(false);document.getElementById("allchecklist").disabled=false;document.getElementById("allsfm").disabled=false;}},__updateSelectAllCheckboxes:function(){var f=this;var e=Ext.getCmp("groupradiocomp").items.items[0].getValue();var d=[];if(e){d=f.__store.allData;}else{d=f.__store.filterData;}if(d.length>0){document.getElementById("allchecklist").checked=true;document.getElementById("allsfm").checked=true;}else{document.getElementById("allchecklist").checked=false;document.getElementById("allsfm").checked=false;}for(var c=0;c<d.length;c++){if(!d[c].isChecklistEnabled){document.getElementById("allchecklist").checked=false;break;}}for(var c=0;c<d.length;c++){if(!d[c].isSFMEnabled){document.getElementById("allsfm").checked=false;break;}}},__backToSetuphome:function(){window.location="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";}});Ext.define("com.servicemax.client.featurepermission.Grid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",alias:"widget.svmx.featurepermission.grid",__store:null,constructor:function(c){var d=this;d.saveButton=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:$TR.SAVE,tootip:$TR.SAVE,disabled:true,style:{marginLeft:"10px",marginRight:"2px",marginTop:"0px",marginBottom:"0px"},handler:function(){d.__saveData();}});d.__store=c.store;c=Ext.apply({store:d.__store,emptyText:"<span>"+$TR.NO_USER_FOUND+"</span>",columns:[{text:$TR.NAME,dataIndex:"name",width:"30%",renderer:function(e){return Ext.String.htmlEncode(e);}},{text:$TR.USER_NAME,dataIndex:"userName",width:"30%",renderer:function(e){return Ext.String.htmlEncode(e);}},{xtype:"checkColumnEditor",headerCheckbox:true,text:"<input type='checkbox' disabled id = 'allchecklist' class='grid-header-checkbox'>".concat($TR.CHECKLIST),dataIndex:"isChecklistEnabled",width:"20%",sortable:false,listeners:{scope:d,checkchange:d.__onChecklistCheckChange,headerclick:d.__checklistHeaderclick}},{xtype:"checkColumnEditor",headerCheckbox:true,text:"<input type='checkbox' disabled id = 'allsfm' class='grid-header-checkbox'>".concat($TR.SFM_DESIGNER),dataIndex:"isSFMEnabled",width:"20%",sortable:false,listeners:{scope:d,checkchange:d.__onSFMCheckChange,headerclick:d.__sfmHeaderClick}}],bbar:[{xtype:"pagingtoolbar",store:d.__store,dock:"bottom",cls:"svmx-feature-permission-pagingtoolbar",align:"center",displayInfo:false,displayMsg:$TR.PAGE+"{0}"+$TR.OF+"{1}",listeners:{afterrender:function(){this.child("#refresh").hide();
document.querySelectorAll(".svmx-toolbar-text.svmx-box-item")[1].innerHTML=$TR.OF+" "+0;},change:function(h,g,f){document.querySelectorAll(".svmx-toolbar-text.svmx-box-item")[1].innerHTML=$TR.OF+" "+g.pageCount;}}},"->",{xtype:"svmx.button",itemId:"cancelbtn",cls:"fp-btn-neutral",dock:"bottom",padding:"0",text:$TR.CANCEL,handler:function(i,h,f,g){if(Object.keys(d.parentContext.__modifiedUsers).length){Ext.Msg.show({title:$TR.ABANDON_CHANGES,msg:$TR.CANCEL_MESSAGE,width:400,closable:false,cls:"fp-confirmation-window",buttons:Ext.Msg.YESNO,buttonText:{yes:$TR.CANCEL,no:$TR.ABANDON},multiline:false,fn:function(j,k,e){if(j=="no"){d.parentContext.__backToSetuphome();}}});}else{d.parentContext.__backToSetuphome();}}},d.saveButton],listeners:{}},c||{});d.callParent([c]);},__saveData:function(){var d=this;var e=d.__getModifiedUsers();d.parentContext.__app.blockUI();var c=SVMX.create("com.servicemax.client.lib.api.Event","FEATUREPERMISSION.SAVE_DATA",this,{request:{context:d,modifiedUsers:e}});SVMX.getCurrentApplication().getEventBus().triggerEvent(c);},__getModifiedUsers:function(){var e=this;var f=[];var c=e.parentContext.__modifiedUsers;for(var d in c){if(c.hasOwnProperty(d)){f.push(c[d]);}}return f;},saveDataComplete:function(d){var e=this;var c=e.parentContext;c.__modifiedUsers={};c.__app.unblockUI();c.__getUserData(c.__currentProfile[0].data.profileId,c.searchTextField.getValue());Ext.Msg.alert({title:$TR.STATUS,msg:$TR.RECORD_SUCCESSFULLY_SAVED,buttonText:{ok:$TR.OK}});},__onChecklistCheckChange:function(i,c,g){var f=this;var h=f.store.data.items[c].data;f.parentContext.__modifiedUsers[h.userId]=h;f.parentContext.__modifiedUsers[h.userId].isChecklistUpdated=true;var d=f.store.allData.find(function(e){if(e.userId==h.userId){return true;}return false;});if(typeof(d)==="object"){d.isChecklistEnabled=h.isChecklistEnabled;}f.parentContext.__updateSelectAllCheckboxes();},__checklistHeaderclick:function(j,c,k,q,l){var m=this;if(m.parentContext.__profilePicklist.getSelectedData().profileId==="--None--"){return;}var n=Ext.getCmp("groupradiocomp").items.items[0].getValue();var g;if(n){g=m.store.allData||[];}else{g=m.store.filterData||[];}var d=!document.getElementById("allchecklist").checked;var p=m.store;var o=c.dataIndex;for(var f=0;f<p.getCount();f++){var h=p.getAt(f);if(d){h.set(o,true);}else{h.set(o,false);}}for(var f=0;f<g.length;f++){if(d){g[f].isChecklistEnabled=true;}else{g[f].isChecklistEnabled=false;}}if(d){m.parentContext.__modifiedUsers={};}m.parentContext.__modifiedUsers=g;for(var f=0;f<m.parentContext.__modifiedUsers.length;f++){m.parentContext.__modifiedUsers[f].isChecklistUpdated=true;}if(!d){document.getElementById("allchecklist").checked=false;}else{document.getElementById("allchecklist").checked=true;}},__onSFMCheckChange:function(i,c,g){var f=this;var h=f.store.data.items[c].data;f.parentContext.__modifiedUsers[h.userId]=h;f.parentContext.__modifiedUsers[h.userId].isSFMUpdated=true;var d=f.store.allData.find(function(e){if(e.userId==h.userId){return true;}return false;});if(typeof(d)==="object"){d.isSFMEnabled=h.isSFMEnabled;}f.parentContext.__updateSelectAllCheckboxes();},__sfmHeaderClick:function(j,c,k,q,l){var m=this;if(m.parentContext.__profilePicklist.getSelectedData().profileId==="--None--"){return;}var n=Ext.getCmp("groupradiocomp").items.items[0].getValue();var g;if(n){g=m.store.allData||[];}else{g=m.store.filterData||[];}var d=!document.getElementById("allsfm").checked;var p=m.store;var o=c.dataIndex;for(var f=0;f<p.getCount();f++){var h=p.getAt(f);if(d){h.set(o,true);}else{h.set(o,false);}}for(var f=0;f<g.length;f++){if(d){g[f].isSFMEnabled=true;}else{g[f].isSFMEnabled=false;}}if(!d){m.parentContext.__modifiedUsers={};}m.parentContext.__modifiedUsers=g;for(var f=0;f<m.parentContext.__modifiedUsers.length;f++){m.parentContext.__modifiedUsers[f].isSFMUpdated=true;}if(!d){document.getElementById("allsfm").checked=false;}else{document.getElementById("allsfm").checked=true;}}});Ext.define("Ext.ux.CheckBoxColumnEditor",{extend:"Ext.grid.column.Column",alias:"widget.checkColumnEditor",stopSelection:true,tdCls:Ext.baseCSSPrefix+"grid-cell-checkcolumn",constructor:function(){this.addEvents("beforecheckchange","checkchange");this.callParent(arguments);},processEvent:function(i,k,o,d,j,g,f,p){var h=this,n=i==="keydown"&&g.getKey(),c=i=="mousedown";if(c||(n==g.ENTER||n==g.SPACE)){var l=h.dataIndex,m=!f.get(l);if(h.fireEvent("beforecheckchange",h,d,m)!==false){f.set(l,m);h.fireEvent("checkchange",h,d,m);if(c){g.stopEvent();}if(!h.stopSelection){k.selModel.selectByPosition({row:d,column:j});}return false;}else{return !h.stopSelection;}}else{return h.callParent(arguments);}},renderer:function(d){var e=Ext.baseCSSPrefix,c=[e+"grid-checkheader"];if(d){c.push(e+"grid-checkheader-checked");}return'<center><div class="'+c.join(" ")+'">&#160;</div></center>';}});};})();(function(){if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(b){if(this==null){throw new TypeError('"this" is null or not defined');
}var f=Object(this);var a=f.length>>>0;if(typeof b!=="function"){throw new TypeError("predicate must be a function");}var c=arguments[1];var d=0;while(d<a){var e=f[d];if(b.call(c,e,d,f)){return e;}d++;}return undefined;}});}})();