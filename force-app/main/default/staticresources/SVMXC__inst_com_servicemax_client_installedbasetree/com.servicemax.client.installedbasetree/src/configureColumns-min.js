(function(){var a=SVMX.Package("com.servicemax.client.installedbasetree.configureColumns");a.init=function(){var c=com.servicemax.client.ui.components;var b=com.servicemax.client.ui.components.composites.impl;Ext.define("com.servicemax.client.installedbasetree.configureColumns.CongigureColumn",{constructor:function(d){d=d||{};this.__width=650;this.__height=500;this.__allFields=d.allFields;this.__selectedFields=d.selectedFields.slice();this.__parent=d.parent;this.callParent([d]);this.showColumns();},showColumns:function(){var g=this;var n={xtype:"svmx.label",text:"Configure Columns",itemId:"title",width:"100%",height:80};var h={xtype:"svmx.toolbar",itemId:"topBar",width:"100%",height:70,items:["->",{text:$TR.CANCEL,itemId:"cancelBtn",cls:"svmx-ibtree-btn-cancel",handler:function(){g.__window.close();}},{text:$TR.APPLY,itemId:"applyBtn",cls:"svmx-ibtree-btn-apply",handler:function(){g.applyColumns();}}]};var k=this.getSelectedStore();this.__selectedList=Ext.create(b.name+".SVMXListComposite",{store:k,columns:[{text:"Selected Fields",dataIndex:"fieldLabel",width:275,renderer:function(p){return Ext.String.htmlEncode(p);}}],height:250,width:275,itemId:"selectedFields",reserveScrollbar:true,hideHeaders:true,viewConfig:{preserveScrollOnRefresh:true}});this.__selectedList.selModel.setSelectionMode("MULTI");var i={xtype:"svmx.toolbar",collapsible:false,border:false,height:50,width:275,style:{"background-color":"transparent"},margin:"-10 0 0 0",layout:{type:"hbox",pack:"center"},items:[{cls:"svmx-ibtree-btn-up",width:25,height:25,handler:function(){g.moveFieldUp();}}," ",{cls:"svmx-ibtree-btn-down",width:25,height:25,handler:function(){g.moveFieldDown();}}]};var j={xtype:"svmx.section",cls:"svmx-ib-tree-field-container",collapsible:false,border:false,layout:"vbox",height:350,width:275,items:[{xtype:"svmx.label",text:$TR.SF,width:"275px",height:"28px"},this.__selectedList,i]};var e=this.getAvailableStore();this.__availableList=Ext.create(b.name+".SVMXListComposite",{store:e,columns:[{text:"Available Fields",dataIndex:"fieldLabel",width:275,renderer:function(p){return Ext.String.htmlEncode(p);}}],height:250,width:275,itemId:"availableFields",reserveScrollbar:true,hideHeaders:true,viewConfig:{preserveScrollOnRefresh:true}});var l={xtype:"svmx.section",cls:"svmx-ib-tree-field-container",collapsible:false,border:false,layout:"vbox",height:350,width:275,items:[{xtype:"svmx.label",text:$TR.AF,width:"275px",height:"28px"},this.__availableList,]};this.__availableList.selModel.setSelectionMode("MULTI");var d={xtype:"svmx.toolbar",collapsible:false,border:false,height:250,width:45,vertical:true,style:{"background-color":"transparent"},margin:"0 0 0 15",layout:{type:"vbox",pack:"center"},items:[{cls:"svmx-ibtree-btn-right",width:25,height:25,handler:function(){g.moveFieldRight();}}," ",{cls:"svmx-ibtree-btn-left",width:25,height:25,handler:function(){g.moveFieldLeft();}}]};var f={xtype:"svmx.section",itemId:"errorPanel",collapsible:false,border:false,height:0,items:[{xtype:"svmx.label",text:$TR.SF_ERROR,width:g.__width,cls:"svmx-ibtree-error-msg",height:"40px",itemId:"errorMsg"}]};var m={xtype:"svmx.section",itemId:"centerPanel",collapsible:false,border:false,layout:"hbox",height:380,items:[l,d,j]};var o={xtype:"svmx.section",itemId:"contentPanel",collapsible:false,border:false,height:380,margin:"20 0 0 20",items:[f,m,]};this.__window=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXWindow",{layout:{type:"vbox"},height:g.__height,width:g.__width,closable:false,maximizable:false,bodyBorder:false,border:false,header:false,titleAlign:"left",cls:"svmx-ibtree-configure-columns",layout:{padding:5},layout:"fit",modal:true,items:[o],dockedItems:[{dock:"top",xtype:"toolbar",margin:"0",height:"80px",items:n},{dock:"bottom",xtype:"toolbar",margin:"0",items:h,height:"70px"}],listeners:{}});this.__window.show();},applyColumns:function(){var h=this.__selectedList.store.data.items;var e=[];for(var f=0;f<h.length;f++){var g=h[f];var d=g.raw;e.push(d);}this.saveConfiguredColumns(e);},saveConfiguredColumns:function(f){this.__parent.blockUI();var e={};var g=this.__parent.__objName;if(g==SVMX.getCustomFieldName("Site")){g="SITE";}else{g="IB";}e.objectName=g;e.columnsToDisplay=f;var d=SVMX.create("com.servicemax.client.lib.api.Event","IBTREE.TREE_CONFIGURE_COLUMN",this,{request:{context:this,configuredData:e}});SVMX.getCurrentApplication().getEventBus().triggerEvent(d);},onConfigureColumnsComplete:function(j){if(!(j.hasOwnProperty("status")&&j.status==false)){var e=SVMX.getCustomFieldName("SM_Configured_Columns");var d=JSON.parse(j[e]);var g=this.__parent.__objName;if(d.length>0){for(var f=0;f<d.length;f++){var h=d[f];if((h.objectName==="SITE"&&g==SVMX.getCustomFieldName("Site"))||h.objectName==="IB"&&g==SVMX.getCustomFieldName("Installed_Product")){this.__parent.__configuredFields=h.columnsToDisplay;}}this.__window.close();this.__parent.getTreeData();}}else{this.updateErrorPositions(j.message);this.__parent.unblockUI();}},getAvailableStore:function(){var d=this.filterAndSortAllFields();
var e=Ext.create(b.name+".SVMXStore",{fields:["fieldLabel"],data:d,sorters:[{property:"fieldLabel",direction:"ASC"}],});return e;},filterAndSortAllFields:function(){var e=this;var d=this.__allFields.filter(function(f){if(e.checkForSelectedField(f.fieldName)==-1){return true;}return false;});return d;},getSelectedStore:function(){var d=Ext.create(b.name+".SVMXStore",{fields:["fieldLabel"],data:this.__selectedFields});return d;},checkForSelectedField:function(e){for(var d=0;d<this.__selectedFields.length;d++){var f=this.__selectedFields[d];if(f.fieldName===e){return d;}}return -1;},moveFieldLeft:function(){var d=this.__selectedList.selModel;if(d){var e=d.getSelection();var f=this.__selectedList.store.getCount();if(e.length<f){if(this.__errorShown){this.updateNormalPositions();}if(e){this.__selectedList.store.remove(e);this.__selectedList.getView().refresh();this.__availableList.store.add(e);this.__availableList.getView().refresh();}}else{this.updateErrorPositions($TR.SF_ERROR);}}},moveFieldRight:function(){var d=this.__availableList.selModel;if(d){var e=d.getSelection();e.sort(function(g,f){var i=g.data.fieldLabel.toUpperCase();var h=f.data.fieldLabel.toUpperCase();return i>h;});if(e){if(this.__errorShown){this.updateNormalPositions();}this.__selectedList.store.add(e);this.__selectedList.getView().refresh();this.__availableList.store.remove(e);this.__availableList.getView().refresh();}}},moveFieldUp:function(){this.selectedListDataMove(-1);},moveFieldDown:function(){this.selectedListDataMove(1);},selectedListDataMove:function(h){if(this.__errorShown){this.updateNormalPositions();}var k=this;var e=this.__selectedList.selModel;if(e){var g=e.getSelection();g.sort(function(n,i){var m=k.__selectedList.store.indexOf(n);var o=k.__selectedList.store.indexOf(i);if(h==-1){return m>o;}else{return m<o;}});if(g&&g.length>0&&this.canSelectedRecordsMove(g,h)){for(var j=0;j<g.length;j++){var f=g[j];var d=this.__selectedList.store.indexOf(f);d=d+h;this.__selectedList.store.remove(f,true);this.__selectedList.store.insert(d,f);}var l=this.__selectedList.getView();l.select(g);}}},canSelectedRecordsMove:function(e,f){var h=false;for(var g=0;g<e.length;g++){var d=this.__selectedList.store.indexOf(e[g]);if(f==-1){if(d>0){h=true;}else{h=false;break;}}else{if(d<this.__selectedList.store.getCount()-1){h=true;}else{h=false;break;}}}return h;},updateErrorPositions:function(d){this.__errorShown=true;var e=this.__window.query("#errorPanel")[0];e.setHeight(40);var f=this.__window.query("#availableFields")[0];f.setHeight(210);var h=this.__window.query("#selectedFields")[0];h.setHeight(210);var h=this.__window.query("#selectedFields")[0];var g=this.__window.query("#errorMsg")[0];g.setText(d);},updateNormalPositions:function(){this.__errorShown=false;var d=this.__window.query("#errorPanel")[0];d.setHeight(0);var e=this.__window.query("#availableFields")[0];e.setHeight(250);var f=this.__window.query("#selectedFields")[0];f.setHeight(250);}});};})();