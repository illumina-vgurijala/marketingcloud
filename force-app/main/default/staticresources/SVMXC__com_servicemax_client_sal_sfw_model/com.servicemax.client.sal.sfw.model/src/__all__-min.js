(function(){var a=SVMX.Package("com.servicemax.client.sal.sfw.model.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{useJsr:false,__settings:null,__constructor:function(){this.__base();this.__self.instance=this;this.__logger=SVMX.getLoggingService().getLogger("SAL-SFW-MODEL");},beforeInitialize:function(){com.servicemax.client.sal.sfw.model.operations.init();},initialize:function(){var b=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if(b&&b===true){this.useJsr=true;this.__logger.info("JSR is enabled. Will use this for server communication.");}},updateSettings:function(d){this.__settings={};var c,b=d.length;for(c=0;c<b;c++){this.__settings[d[c].Key]=d[c].Value;}},getSettings:function(){return this.__settings;}},{instance:null});a.Class("ServiceRequest",com.servicemax.client.lib.api.Object,{__constructor:function(c){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sal.service.factory");b.getInstanceAsync({handler:function(d){var e=c.options||{};var g={type:e.type||"REST",endPoint:e.endPoint||"SFMWizardDeliveryServiceIntf",nameSpace:(e.namespace===null?null:SVMX.OrgNamespace)};var h=d.createServiceManager(g);var f=h.createService();c.handler.call(c.context,f);},context:this});}},{});a.Class("PlatformSpecifics",com.servicemax.client.lib.api.Object,{__logger:null,__constructor:function(){this.__logger=SVMX.getLoggingService().getLogger("SFW:Online:PlatformSpecifics");},getSupportedActionTypes:function(){return[];},performAction:function(c){var b=this,d=c.getRoot().getDeliveryEngine();if(c.confirmationMessage){SVMX.MessageBox.show({title:d.translate("SFW_TITLE"),buttons:SVMX.MessageBox.YESNO,icon:SVMX.MessageBox.QUESTION,buttonText:{yes:d.translate("SFW_YES_BTN"),no:d.translate("SFW_NO_BTN")},msg:c.confirmationMessage,fn:function(e){if(e=="yes"){b.__performAction(c);}}});}else{this.__performAction(c);}},__performAction:function(c){var b=c.actionType;if(b=="SFM"){this.__performSFMAction(c);}else{if(b=="RECEIPT"){this.__performRECEIPTAction(c);}else{if(b=="DELIVERY"){this.__performDELIVERYAction(c);}else{if(b=="PICK_MOVE"){this.__performPICKANDMOVEAction(c);}else{if(b=="SHIP"){this.__performSHIPAction(c);}else{if(b=="FULFILLMENT"){this.__performFULFILLMENTAction(c);}else{if(b=="INVENTORY"){this.__performINVENTORYAction(c);}else{if(b=="INITIATE_RETURN"){this.__performINITIATERETURNAction(c);}else{if(b=="OUTPUT_DOCUMENT"){this.__performOUTPUTDOCUMENTAction(c);}else{if(b=="OTHERS"){this.__performOTHERSAction(c);}else{this.__performUnknownAction(c);}}}}}}}}}}},__performOTHERSAction:function(f){var g=f.getData();var k=g.customActionRecord[SVMX.OrgNamespace+"__Custom_Action_Type__c"];var c=new a.TargetUrl(f);var j=g.customActionRecord[SVMX.OrgNamespace+"__Target_URL__c"];var e=g.customActionParams||[],h,d=e.length;for(h=0;h<d;h++){c.addParam(e[h].key,e[h].value);}if(k=="URL"){}else{if(k=="Web-Service"){var m=g.customActionRecord[SVMX.OrgNamespace+"__Name__c"];c.addParam("SVMX_title",m);var b=g.customActionRecord[SVMX.OrgNamespace+"__ProcessID__c"];c.addParam("SVMX_processId",b);j=this.__getPageUrl("SFM_ExecuteAPEX");}}this.__navigate(j,c);},__performOUTPUTDOCUMENTAction:function(f){this.__logger.info("Performing OUTPUT_DOCUMENT action => "+f.getName());var e=this.__getPageUrl("OPDOC_Delivery"),h=null,g=f.getRoot().getDeliveryEngine();var b=f.getData().actionDef[SVMX.OrgNamespace+"__Select_Template_At_Runtime__c"],c=this;if(b===true){d(function(i){h=new a.TargetUrl(f,{SVMX_processId:i.pid});h.addProcessId();h.addRecordId();h.addReturnUrl();c.__navigate(e,h);});}else{h=new a.TargetUrl(f);h.addProcessId();h.addRecordId();h.addReturnUrl();this.__navigate(e,h);}function d(p){var o=f.getRoot().availableActions,m,j=o.length,k=[];for(m=0;m<j;m++){if(o[m][SVMX.OrgNamespace+"__Purpose__c"]=="OUTPUT DOCUMENT"){k.push({pid:o[m][SVMX.OrgNamespace+"__ProcessID__c"],name:o[m][SVMX.OrgNamespace+"__Name__c"],desc:o[m][SVMX.OrgNamespace+"__Description__c"]});}}var n=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXWindow",{width:500,height:300,modal:true,resizable:false,title:g.translate("CONF016_TAG113"),items:[{xtype:"svmx.listcomposite",height:240,store:{xtype:"svmx.store",fields:["name"],data:k},columns:[{text:"",dataIndex:"name",flex:1}],viewConfig:{emptyText:g.translate("CONF016_TAG115"),deferEmptyText:false},listeners:{itemdblclick:function(l,i,r,q,s){p(i.raw);n.close();}}}],dockedItems:[{xtype:"svmx.toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"svmx.button",text:g.translate("CONF016_TAG114"),handler:function(){var i=n.items.getAt(0);var l=i.getSelectionModel().getSelection();if(l&&l.length>0){p(l[0].raw);n.close();}}},{xtype:"svmx.button",text:g.translate("CONF016_TAG032"),handler:function(){n.close();}}]}]}).show();}},__performINVENTORYAction:function(c){this.__logger.info("Performing INVENTORY action => "+c.getName());var d=new a.TargetUrl(c);var b=this.__getPageUrl("INVT_SmartEngine");d.addProcessId("SMid");d.addRecordId("hdrId");
this.__navigate(b,d);},__performSPRLAction:function(b,d){this.__logger.info("Performing action => "+d.actionType+"::"+d.getName());var c=this.__getPageUrl(b);var e=new a.TargetUrl(d);e.addProcessId();e.addRecordId();e.addReturnUrl();if(d.handOver===true){e.addNextStepId();}this.__navigate(c,e);},__performINITIATERETURNAction:function(b){this.__performSPRLAction("APL_InitiateReturn",b);},__performFULFILLMENTAction:function(b){this.__performSPRLAction("APL_FulfillmentConsole",b);},__performSHIPAction:function(b){this.__performSPRLAction("APL_ConfirmShipment",b);},__performPICKANDMOVEAction:function(b){this.__performSPRLAction("APL_PickAndMove",b);},__performDELIVERYAction:function(b){this.__performSPRLAction("APL_DeliveryOnReceipt",b);},__performRECEIPTAction:function(b){this.__performSPRLAction("APL_ProcessReceipts",b);},__performSFMAction:function(d){this.__logger.info("Performing SFM action => "+d.getName());var b=a.Module.instance.getSettings();var e=new a.TargetUrl(d);var c=this.__getPageUrl("ServiceMaxConsole");if(b.GBL021=="FLEX"||d.modeOfExecution=="Background"){c=this.__getPageUrl("SFM_TDM_Delivery");}e.addProcessId();e.addRecordId();e.addReturnUrl();if(d.modeOfExecution=="Background"){e.addBackgroundExecutionMode();}if(d.handOver===true){e.addNextStepId();}this.__navigate(c,e);},__performUnknownAction:function(b){this.__logger.info("Unknown action => "+b.getName()+" of type "+b.actionType);},__getPageUrl:function(b){return"/apex/"+SVMX.OrgNamespace+"__"+b;},__navigate:function(d,b){d+="?"+b.getUrlString();var e=SVMX.getClient().getApplicationParameter("svmx-sfw-open-in-window");var c=SVMX.getClient().getApplicationParameter("svmx-base-url")||"";if(c&&c.indexOf("/")!=0){c="/"+c;}d=c+d;if(e){SVMX.navigateTopTo(d);}else{SVMX.openInBrowserWindowLightning(d);}}},{});a.Class("TargetUrl",com.servicemax.client.lib.api.Object,{__uri:null,__params:null,__action:null,__overrides:null,__constructor:function(b,c){this.__uri="";this.__params={};this.__action=b;this.__overrides=c;},addParam:function(b,c){this.__params[b]=c;},addRecordId:function(c){var b=c||"SVMX_recordId";var d=this.__action.getRoot().recordId;this.addParam(b,d);},addNextStepId:function(){var b=this.__action.getData().actionDef[SVMX.OrgNamespace+"__Process1__c"];this.addParam("SVMX_NxtStepID",b);},addReturnUrl:function(){var b="/"+this.__action.getRoot().recordId;this.addParam("SVMX_retURL",b);},addBackgroundExecutionMode:function(){this.addParam("SVMX_Execution_Mode","SVMXAUTO");},addProcessId:function(c){var b=c||"SVMX_processId",d="";if(this.__overrides&&this.__overrides[b]){d=this.__overrides[b];}else{d=this.__action.getData().actionDef[SVMX.OrgNamespace+"__Process__r"][SVMX.OrgNamespace+"__ProcessID__c"];}this.addParam(b,d);},getUrlString:function(){var c,b=[],d=0;for(c in this.__params){b[d++]=c+"="+this.__params[c];}return b.join("&");}});})();(function(){var a=SVMX.Package("com.servicemax.client.sal.sfw.model.operations");a.init=function(){var b=com.servicemax.client.sal.sfw.model.impl.Module;a.Class("GetWizardInfo",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(f,c){var e=this;var d={RecordId:f.RecordId};if(b.instance.useJsr){SVMXJsr.JsrGetWizardInfo(d,function(g,h){e.__handleResponse(f,c,g);},this);}else{SVMX.create("com.servicemax.client.sal.sfw.model.impl.ServiceRequest",{handler:function(g){g.callMethodAsync({data:d,methodName:"getWizardInfo"});g.bind("REQUEST_COMPLETED",function(h){if(h.data){e.__handleResponse(f,c,h.data);}else{c.fault(h.data);}});}});}},__handleResponse:function(e,c,g){var f=g.SFWInfo;var d=g.Settings;if(f.SFWs){f.SFWs.sort(this.__sequenceSFW);}b.instance.updateSettings(d);c.result(f);},__sequenceSFW:function(d,c){function g(i){var h="";var j=String(i);if(j.length==1){h="0"+i;}else{h=j;}return h;}var f=parseInt(d.row+""+g(d.col));var e=parseInt(c.row+""+g(c.col));return(f-e);}},{});};})();