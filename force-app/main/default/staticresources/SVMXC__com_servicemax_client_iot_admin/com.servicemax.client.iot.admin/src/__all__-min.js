(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.app");a.Class("Application",com.servicemax.client.lib.api.AbstractApplication,{__eventBus:null,__constructor:function(){},beforeRun:function(b){var c=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.iot.admin.impl.IoTAdminEventBus",{});c.createNamedInstanceAsync("CONTROLLER",{handler:function(d){c.createNamedInstanceAsync("MODEL",{handler:function(e){d.setModel(e);},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});b.handler.call(b.context);},getEventBus:function(){return this.__eventBus;},getSetupMetadata:function(){var c=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","IOT.GET_SETUP_METADATA",c,{request:{context:c}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},onGetSetupMetadataComplete:function(c){var d=c.sforceObjectDescribes;for(var e=0;e<d.length;e++){c[d[e].objectAPIName]=d[e];}c.context=this;this.__processTranslations(c.translations);var b=SVMX.create("com.servicemax.client.iot.admin.root.RootPanel",{collapsible:false,titleAlign:"center",frame:"true",style:"margin:10px",layout:{padding:"0"},metadata:c});},__processTranslations:function(e){var c,d=e.length;var b={};for(c=0;c<d;c++){b[e[c].Key]=Ext.String.htmlEncode(e[c].Text);}window.$TR=b;},run:function(){this.getSetupMetadata();},showQuickMessage:function(b,c,d){if(b==="confirm"){typeMessage=$TR.MESSAGE_CONFIRM;Ext.Msg.confirm(typeMessage,c,d);}else{switch(b){case"success":typeMessage=$TR.MESSAGE_SUCCESS;break;case"error":typeMessage=$TR.MESSAGE_ERROR;break;case"info":default:typeMessage=$TR.MESSAGE_INFO;break;}Ext.Msg.alert({cls:"piq-setup-info-alert",title:typeMessage,message:c,buttonText:{ok:$TR.OK},closable:false});}},blockUI:function(){var b={lines:25,length:25,width:5,radius:30,corners:1,rotate:0,direction:1,color:"#ffa384",speed:3,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};this.__spinner=new Spinner(b).spin($("#"+SVMX.getDisplayRootId())[0]);},unblockUI:function(){this.__spinner.stop();}});})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.celleditors");a.init=function(){Ext.define("com.servicemax.client.iot.admin.celleditors.SVMXComboBoxCellEditor",{extend:"com.servicemax.client.installigence.ui.components.SVMXComboBox",constructor:function(b){this.callParent([b]);},setRecord:function(b){this.__record=b;},setValue:function(b){if(this.__record&&this.__record.data[this.fieldName+"_key"]){b=this.__record.data[this.fieldName+"_key"];}this.callParent([b]);},getValue:function(){if(!this.__record){return null;}var c=this.callParent();var b="";if(this.findRecordByValue(c)){b=this.findRecordByValue(c).get(this.displayField);}this.__record.data[this.fieldName+"_key"]=c;return b;}});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.commands");a.init=function(){a.Class("GetSetupMetadata",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"IOT.GET_SETUP_METADATA"});},result:function(b){this.__cbContext.onGetSetupMetadataComplete(b);}},{});a.Class("Save",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"IOT.SAVE"});},result:function(b){this.__cbContext.onSaveComplete(b);}},{});a.Class("BackToSetupHome",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"IOT.BACK_TO_SETUP_HOME"});},result:function(b){}},{});a.Class("DescribeObject",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__isRefobj:null,__constructor:function(){this.__base();},executeAsync:function(d,b){var c=this;c.__isRefobj=d.isRefobj;c.__cbContext=d.context;c._executeOperationAsync(d,c,{operationId:"IOT.DESCRIBE_OBJECT"});},result:function(c){var b=this;if(b.__isRefobj){b.__cbContext.describeReferenceObjectComplete(c);}else{b.__cbContext.describeSelectedObjectComplete(c);}}},{});a.Class("GetAllEventTemplates",com.servicemax.client.mvc.api.CommandWithResponder,{__cbContext:null,__constructor:function(){this.__base();},executeAsync:function(c,b){this.__cbContext=c.context;this._executeOperationAsync(c,this,{operationId:"IOT.GET_ALL_EVENT_TEMPLATES"});},result:function(b){this.__cbContext.loadAllEventTemplatesComplete(b);}},{});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.compositekey");a.init=function(){Ext.define("com.servicemax.client.iot.admin.compositeKeyGrid",{extend:"com.servicemax.client.installigence.ui.components.SVMXGrid",__config:null,constructor:function(b){this.__config=b;b.columns=[new Ext.grid.RowNumberer()];
if(b.forExternal){b.columns.push(this.createTextBoxColumn({text:$TR.EXTERNAL_FLD_NAME,dataIndex:"name",width:400,flex:1}));}else{b.columns.push(this.createComboBoxColumn({text:$TR.IB_FLD_NAME,dataIndex:"name",width:400,flex:1,renderer:function(c){return Ext.String.htmlEncode(c);},}));}b.columns.push({menuDisabled:true,sortable:false,xtype:"actioncolumn",width:50,items:[{iconCls:"delet-icon",tooltip:$TR.DELETE}],handler:function(d,g,c){var e=d.getStore();var f=e.getAt(g);e.remove(f);d.refresh();},renderer:function(e,d,c){b.columns[b.columns.length-1].items[0].iconCls="delet-icon";}});this.callParent([b]);},createTextBoxColumn:function(b){var d=this;var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:true});var b=b||{};b.sortable=false;b.editable=true;b.getEditor=function(e){return c;};return b;},createComboBoxColumn:function(c){var e=this;var b=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["fieldAPIName","fieldLabel"],sorters:[{property:"fieldLabel",direction:"ASC"}],data:this.__config.metadata[SVMX.OrgNamespace+"__Installed_Product__c"].fields});var d=SVMX.create("com.servicemax.client.iot.admin.celleditors.SVMXComboBoxCellEditor",{displayField:"fieldLabel",queryMode:"local",editable:false,valueField:"fieldAPIName",fieldName:"name",store:b});var c=c||{};c.menuDisabled=true;c.sortable=false;c.getEditor=function(f){d.setRecord(f);return d;};return c;}});Ext.define("com.servicemax.client.iot.admin.CompositeKey",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",sfKeyGrid:null,exKeyGrid:null,sfKey:null,exKey:null,metadata:null,addRecButton:null,constructor:function(c){var d=this;this.metadata=c.metadata;this.refresh();var f=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-width: 0"});this.addRecButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"iot-setup-add-button",handler:function(){d.onAddRecords(d.sfKeyGrid);this.setDisabled(true);}});this.sfKey=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:false});f.add(this.sfKey);f.add("->");f.add(this.addRecButton);var h=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-width: 0"});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"iot-setup-add-button",handler:function(){d.onAddRecords(d.exKeyGrid);}});this.exKey=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:false});h.add(this.exKey);h.add("->");h.add(b);var e=this.resolveIBFields(c.metadata.compositeKey&&c.metadata.compositeKey.ibFields&&c.metadata.compositeKey.ibFields!==null?c.metadata.compositeKey.ibFields:[]);var g=c.metadata.compositeKey&&c.metadata.compositeKey.externalFields&&c.metadata.compositeKey.externalFields!==null?c.metadata.compositeKey.externalFields:[];c=c||{};c.items=[];c.items.push(f);this.sfKeyGrid=this.addGrid(c,false,e);if(e.length>0){this.addRecButton.setDisabled(true);}c.items.push(h);this.exKeyGrid=this.addGrid(c,true,g);c.title=$TR.COMP_INFO;c.id="CI";this.sfKeyGrid.getView().on("refresh",this.updateSFKey,this);this.exKeyGrid.getView().on("refresh",this.updateEXKey,this);this.callParent([c]);},addGrid:function(c,g,e){var d=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["name"],data:e});var f=SVMX.create("com.servicemax.client.iot.admin.compositeKeyGrid",{cls:"grid-panel-borderless panel-radiusless iot-setup-ta-grid",selType:"cellmodel",height:200,plugins:[SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditorPlugin",{clicksToEdit:2})],viewConfig:{markDirty:false},store:d,metadata:c.metadata,forExternal:g,});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXFormPanel",{style:"margin: 1px 0",layout:"fit",title:g?$TR.COMP_KEY:$TR.EXT_KEY,cls:"grid-panel-borderless",height:200,defaults:{anchor:"40%"}});b.add(f);c.items.push(b);return f;},onAddRecords:function(c){c.addItems({});c.getView().refresh();var d=c.store.data.items.length-1;var b=c.getView();Ext.get(b.getRow(d)).scrollIntoView(b.getEl(),null,true);b.select(d);},updateSFKey:function(){this.updateKey(this.sfKeyGrid,this.sfKey);if(this.sfKeyGrid.getStore()&&this.sfKeyGrid.getStore()&&this.sfKeyGrid.getStore().getData()){var b=this.sfKeyGrid.getStore().getData().length;if(b==0){this.addRecButton.setDisabled(false);}}},updateEXKey:function(){this.updateKey(this.exKeyGrid,this.exKey);},resolveIBFields:function(d){var f=0,c=[],e=0;var b=this.metadata[SVMX.OrgNamespace+"__Installed_Product__c"].fields;for(f=0;f<d.length;f++){for(e=0;e<b.length;e++){if(b[e].fieldAPIName==d[f].name){c.push({name_key:b[e].fieldAPIName,name:b[e].fieldLabel});}}}return c;},loadData:function(d){this.metadata=d;var b=this.metadata.sforceObjectDescribes;for(var c=0;c<b.length;c++){this.metadata[b[c].objectAPIName]=b[c];
}var e=this.resolveIBFields(this.metadata.compositeKey?this.metadata.compositeKey.ibFields:[]);var f=this.metadata.compositeKey?this.metadata.compositeKey.externalFields:[];this.sfKeyGrid.getStore().loadData(e);this.sfKeyGrid.getStore().commitChanges();this.exKeyGrid.getStore().loadData(f);this.exKeyGrid.getStore().commitChanges();},updateKey:function(e,d){var c=0,f=e.store.data.length;var b="";for(c=1;c<=f;c++){b=b.length>0?b+"+":b;b=b+c;}d.setValue(b);},getData:function(){var b=this.getRecords(this.sfKeyGrid.getStore(),true);var c=this.getRecords(this.exKeyGrid.getStore());return{ibFields:b,externalFields:c};},refresh:function(){var b=this;SVMX.getClient().bind("SAVE_SUCCESS",function(c){b.loadData(c.data);},this);},getRecords:function(c,d){var b=[];var e=d?"name_key":"name";c.each(function(f){delete f.data.id;b.push({name:f.data[e],sequence:b.length+1});});return b;}});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.createevent");a.init=function(){a.Class("CreateEvent",com.servicemax.client.lib.api.Object,{__config:null,__win:null,__applyButton:null,__searchTextField:null,__selectedCell:null,__parentContext:null,__recordIndex:null,__payload:null,__metadata:null,__constructor:function(b){var c=this;c.__config=b;c.__metadata=b.metadata;c.__selectedCell=b.selectCell;c.__parentContext=b.parentContext;c.__recordIndex=b.recordIndex;c.__payload=b.payload;c.__win=c.__getUI();c.__win.show();c.__refresh();},__refresh:function(){var e=this,f,d;if(!$.isEmptyObject(e.__payload)){f=e.__payload.objName;d=e.__payload.fld;e.showObjects.setValue(f);e.fieldGridStore.loadData(d);e.__describeSelectedObject(f);var b=[];for(var c=0;c<d.length;c++){if(d[c].fldType==="REFERENCE"){b.push(d[c].refObj);}}if(b){e.fieldGrid.__describeReferenceObject(b);}}else{e.showObjects.setValue("--None--");e.__resetFieldGrid();}},__getUI:function(){var c=this;c.__applyButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.APPLY,id:"applybutton",docked:"right",disabled:true,align:"right",cls:"piq-setup-picklist-apply-button",parentContext:c,handler:function(){this.parentContext.__apply();}});var d=["->",c.__applyButton];var b=c.__getObjectListData();c.objectStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["objectName","objectLabel"],data:b});c.showObjects=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXComboBox",{fieldLabel:$TR.SELECT_OBJECT+' <span class="req" style="color:red">*</span>',store:c.objectStore,labelWidth:150,width:"60%",displayField:"objectLabel",valueField:"objectName",queryMode:"local",editable:true,disabled:false,selectedObject:undefined,listeners:{select:{fn:c.__onSelectObjects,scope:c},afterrender:function(g){var f=g.getStore().getAt(0);g.setValue(f.get("objectLabel"));}}});c.fieldGridStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:[{name:"fldLabel",type:"string"},{name:"fldApi",type:"string"},{name:"fldKey",type:"string"},{name:"fldType",type:"string"},{name:"refObj",type:"string"},{name:"refFld",type:"string"},{name:"refLabel",type:"string"},{name:"isExternalId",type:"boolean"}],data:[]});c.fieldStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:[{name:"fldApi",type:"string"},{name:"fldLabel",type:"string"},{name:"fldType",type:"string"},{name:"referenceTo",type:"string"},{name:"isExternalId",type:"boolean"}],data:[],sorters:[{property:"fldLabel",direction:"ASC"}]});c.fieldGrid=SVMX.create("com.servicemax.client.iot.admin.FieldsGrid",{cls:"grid-panel-borderless panel-radiusless piq-setup-ta-grid iot-create-map-for-object-grid",store:c.fieldGridStore,fieldStore:c.fieldStore,height:350,margin:"7 7 7 7",width:"calc(100% - 25px)",autoScroll:true,layout:"fit",selType:"cellmodel",parentContext:c,editRowIndex:0,plugins:[SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditorPlugin",{clicksToEdit:2})],viewConfig:{},listeners:{celldblclick:function(f,m,h,g,j,l,k,i){},cellclick:function(m,f,k,g,j,l,h,i){m.config.grid.editRowIndex=l;var n=this.getView().getRow(l);Ext.get(n).removeCls("piq-setup-new-attributes-row");},edit:function(g,h,f){}}});var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXWindow",{layout:{type:"vbox"},height:500,width:820,items:[c.fieldGrid],title:$TR.CREATE_EVENT,cls:"piq-setup-ta-picklist-window",closable:true,maximizable:false,titleAlign:"left",layout:{padding:5},layout:"fit",modal:true,dockedItems:[{dock:"top",xtype:"toolbar",margin:"0",items:c.showObjects},{dock:"bottom",xtype:"toolbar",margin:"0",items:d}],listeners:{show:function(h){if(this.modal){var j=Ext.dom.Query.select(".x-mask");for(var f=0;f<j.length;f++){Ext.get(j[f]).setStyle("opacity",1);var g=Ext.get(j[f]);g.addCls("customWinMask");}}},close:function(h){if(this.modal){var j=Ext.dom.Query.select(".x-mask");for(var f=0;f<j.length;f++){Ext.get(j[f]).setStyle("opacity",1);var g=Ext.get(j[f]);g.removeCls("customWinMask");
}}}}});return e;},__getObjectListData:function(){var c=this;var b=[{objectName:"--None--",objectLabel:$TR.NONE}];if(c.__metadata.eventObjects){b.push.apply(b,c.__metadata.eventObjects);}return b;},__apply:function(){var d=this;var b=d.__shouldAllowApply();if(!b.isValid){SVMX.getCurrentApplication().showQuickMessage("error",b.message);d.__highlightRow(b.rowIndex);}else{var e=d.showObjects.getSelectedRecord().data.objectName;var h=d.showObjects.getSelectedRecord().data.objectLabel;var c=[];var g=d.__getAllFieldDetails();if(g){c=g;}var f={objName:e,fld:c,objLbl:h};d.__parentContext.applyEvent(d.__selectedCell,d.__recordIndex,f);d.__win.close();}},__getAllFieldDetails:function(){var e=this;var h=[];var c=e.fieldGridStore.data.items;var b=c.length;for(var d=0;d<b;d++){var f=c[d].data;var g={fldLabel:f.fldLabel,fldKey:f.fldKey,fldApi:f.fldApi,fldType:f.fldType,refLabel:f.refLabel,isExternalId:f.isExternalId};if(f.fldType=="REFERENCE"){g.refObj=f.refObj;g.refFld=f.refFld;}h.push(g);}return h;},__shouldAllowApply:function(){var h=this;var k={isValid:false,message:"",rowIndex:0};var g=h.__getAllKeys();var i=h.__getAllFields();var c=h.__getAllLookups();var b=h.__validateDuplicateValues(i);var e=h.__checkEmptyValues(g);var j=h.__checkEmptyValues(i.apis);var f=h.__checkEmptyValues(c);var d=[];if(g.length==0&&i.apis.length==0){k.message=$TR.EMPTY_FIELD;k.rowIndex=0;}else{if(e!==-1){k.message=$TR.EMPTY_KEY;k.rowIndex=e;}else{if(j!==-1){k.message=$TR.EMPTY_FIELD;k.rowIndex=j;}else{if(b.isFound){d=b.duplicateValues.join();k.message=$TR.DUPLICATE_FIELD+" : "+d;k.rowIndex=b.rowIndex;}else{if(f!==-1){k.message=$TR.EMPTY_LOOKUP_ID;k.rowIndex=j;}else{k.isValid=true;}}}}}return k;},__validateDuplicateValues:function(k){var c=k.apis;var j=k.labels;var f=[];var b=[];var m=false;var h=0;for(var d=0;d<c.length;d++){var l=c[d];var e=c.reduce(function(n,i){if(i.toLowerCase()===l.toLowerCase()){n++;}return n;},0);if(e>1){if(b.indexOf(l.toLowerCase())>-1){}else{f.push(j[d]);b.push(l.toLowerCase());}m=true;h=d;}}var g={duplicateValues:f,isFound:m,rowIndex:h};return g;},__highlightRow:function(e){var c=this;var b=c.fieldGrid.getView();var d=b.getRow(e);Ext.get(d).scrollIntoView(b.getEl(),null,true);Ext.get(d).addCls("piq-setup-new-attributes-row");},__checkEmptyValues:function(b){return $.inArray("",b);},__checkIfArrayValuesAreUnique:function(b){return b.length===new Set(b).size;},__getAllLookups:function(){var e=[];var d=this;var c=d.fieldGridStore.data.items;for(var b=0;b<c.length;b++){e.push(c[b].data.refLabel);}return e;},__getAllKeys:function(){var d=[];var c=this;var b=c.fieldGridStore.data.items;for(var e=0;e<b.length;e++){d.push(b[e].data.fldKey);}return d;},__getAllFields:function(){var b=[];var d=[];var f=this;var c=f.fieldGridStore.data.items;for(var g=0;g<c.length;g++){b.push(c[g].data.fldApi);d.push(c[g].data.fldLabel);}var e={apis:b,labels:d};return e;},__onSelectObjects:function(e,c){var d=this;d.__resetFieldGrid();if(e.getSelectedRecord().get("objectName")=="--None--"){d.fieldGrid.addFieldButton.setDisabled(true);d.__applyButton.setDisabled(true);}else{var b=e.getSelectedRecord().get("objectName");d.__describeSelectedObject(b);}},__describeSelectedObject:function(c){var d=this;d.blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","IOT.DESCRIBE_OBJECT",d,{request:{context:d,requestData:{allObjects:[{objectAPIName:c}]}}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},describeSelectedObjectComplete:function(c){var b=this;b.fieldGrid.addFieldButton.setDisabled(false);b.__applyButton.setDisabled(false);b.__loadFieldStoreData(c);},__loadFieldStoreData:function(e){var d=this;var g=[];var b=e.sforceObjectDescribes[0];var h=b.fields;for(var c=0;c<h.length;c++){var f=h[c];g.push({fldApi:f.fieldAPIName,fldLabel:f.fieldLabel,fldType:f.type,referenceTo:f.referenceTo,isExternalId:f.isExternalId});}d.fieldStore.setData(g);d.unblockUI();},__resetFieldGrid:function(){var b=this;b.fieldGridStore.clearData();b.fieldGridStore.removeAll();b.fieldGrid.view.refresh();},blockUI:function(){var b={lines:25,length:25,width:5,radius:30,corners:1,rotate:0,direction:1,color:"#ffa384",speed:3,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};this.__spinner=new Spinner(b).spin($("#"+this.__win.el.dom.id)[0]);},unblockUI:function(){this.__spinner.stop();}});Ext.define("com.servicemax.client.iot.admin.FieldsGrid",{extend:"com.servicemax.client.installigence.ui.components.SVMXGrid",fieldStore:null,__refObjDescribes:null,constructor:function(b){var c=this;var b=b||{};c.__refObjDescribes={};if(b.fieldStore){c.fieldStore=b.fieldStore||{};}c.addFieldButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"piq-setup-add-button",disabled:true,id:"addFieldRecordbutton",handler:function(){c.addFieldRecord({name:""});}});b.dockedItems=[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},c.addFieldButton]}];b.columns=[{menuDisabled:true,sortable:false,xtype:"actioncolumn",width:50,items:[{iconCls:"delet-icon",tooltip:$TR.DELETE}],handler:function(e,h,d){var f=e.getStore();
var g=f.getAt(h);f.remove(g);},renderer:function(f,e,d){b.columns[0].items[0].iconCls="delet-icon";}}];b.columns.push(c.createComboBoxColumn({text:$TR.FILED_NAME,dataIndex:"fldLabel",flex:1,store:c.fieldStore,renderer:function(d){return Ext.String.htmlEncode(d);}}));b.columns.push(c.createComboBoxColumnForReference({text:$TR.LOOKUP_FIELD_ID,dataIndex:"refLabel",flex:1,}));b.columns.push(c.createTextBoxColumn({text:$TR.FIELD_KEY,dataIndex:"fldKey",flex:1,listeners:null}));c.callParent([b]);},__describeReferenceObject:function(f){var c=[];for(var d=0;d<f.length;d++){c.push({objectAPIName:f[d]});}var e=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","IOT.DESCRIBE_OBJECT",e,{request:{context:e,requestData:{allObjects:c},isRefobj:true}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},describeReferenceObjectComplete:function(b){this.__reloadObjectDescribes(b);},__reloadObjectDescribes:function(f){var e=f.sforceObjectDescribes;for(var g=0;g<e.length;g++){var j=e[g].objectAPIName;var k=e[g].objectLabel;var h=[];var b=e[g].fields;for(var c=0;c<b.length;c++){var d=b[c];if(d.fieldAPIName==="Name"||d.fieldAPIName==="Id"||d.isExternalId==true){h.push(d);}}var l={objName:j,objLbl:k,flds:h};this.__refObjDescribes[j]=l;}},addFieldRecord:function(c){if(!c){return;}var d=this.getStore().count();this.store.insert(this.getStore().count(),c);var b=this.getView();Ext.get(b.getRow(d)).scrollIntoView(b.getEl(),null,true);},__updateLookUpLabel:function(d){var c=this.getSelectionModel();var b=c.getSelection()[0];b.set("refLabel",d);},createComboBoxColumn:function(b){var d=this;var c=SVMX.create("com.servicemax.client.iot.admin.celleditors.SVMXComboBoxCellEditor",{displayField:"fldLabel",queryMode:"local",editable:false,valueField:"fldApi",fieldName:b.dataIndex,store:b.store,parentContext:d,rowIndex:-1,listeners:{select:function(j,e,g){var h=this;var i=h.parentContext.editRowIndex;var f=e.data;h.parentContext.store.data.items[i].data.fldType=f.fldType;h.parentContext.store.data.items[i].data.fldApi=f.fldApi;h.parentContext.store.data.items[i].data.refObj=f.referenceTo;h.parentContext.store.data.items[i].data.isExternalId=f.isExternalId;h.parentContext.store.data.items[i].data.refFld="";if(f.fldType==="REFERENCE"){if(!h.parentContext.__refObjDescribes[f.referenceTo]){h.parentContext.__describeReferenceObject([f.referenceTo]);}h.parentContext.__updateLookUpLabel("");}else{h.parentContext.__updateLookUpLabel($TR.NA);}},beforeedit:function(g,f,e){console.log(f.rowIdx);rowIndex=f.rowIdx;}}});var b=b||{};b.menuDisabled=false;b.sortable=true;b.parentContext=d,b.getEditor=function(e){c.setRecord(e);c.setValue(e.data.fldApi);return c;};return b;},createComboBoxColumnForReference:function(c){var e=this;var b=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:[{name:"fldApi",type:"string"},{name:"fldLabel",type:"string"},{name:"fldType",type:"string"}],data:[],sorters:[{property:"fldLabel",direction:"ASC"}]});var d=SVMX.create("com.servicemax.client.iot.admin.celleditors.SVMXComboBoxCellEditor",{displayField:"fldLabel",queryMode:"local",editable:false,valueField:"fldApi",fieldName:c.dataIndex,store:b,parentContext:e,rowIndex:-1,listeners:{select:function(j,f,g){var h=this;var i=h.parentContext.editRowIndex;h.parentContext.store.data.items[i].data.refFld=j.value;},beforeedit:function(h,g,f){}}});var c=c||{};c.menuDisabled=false;c.sortable=true;c.parentContext=e,c.getEditor=function(f){var j;var m=f.data;var h=m.fldType;if(!h||h!=="REFERENCE"){j=null;}else{d.setRecord(f);d.setValue(f.data.refFld);var k=this.parentContext.__refObjDescribes[m.refObj].flds;var l=[];for(var g=0;g<k.length;g++){var n=k[g];l.push({fldApi:n.fieldAPIName,fldLabel:n.fieldLabel});}d.store.setData(l);j=d;}return j;};return c;},createTextBoxColumn:function(b){var d=this;var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:true,maskRe:/[^ ]/});var b=b||{};b.sortable=true;b.editable=true;b.getEditor=function(e){return c;};return b;}});};})();(function(){SVMX.OrgNamespace=SVMX.getClient().getApplicationParameter("org-name-space")||"SVMXC";var a=SVMX.Package("com.servicemax.client.iot.admin.impl");a.Class("Module",com.servicemax.client.lib.api.ModuleActivator,{__constructor:function(){this.__base();},afterInitialize:function(){},beforeInitialize:function(){com.servicemax.client.iot.admin.root.init();com.servicemax.client.iot.admin.celleditors.init();com.servicemax.client.iot.admin.othersettings.init();com.servicemax.client.iot.admin.commands.init();com.servicemax.client.iot.admin.operations.init();com.servicemax.client.iot.admin.compositekey.init();com.servicemax.client.iot.admin.ioteventmap.init();com.servicemax.client.iot.admin.createevent.init();com.servicemax.client.iot.admin.maptoobject.init();},registerForSALEvents:function(b,c){if(!c){SVMX.getLoggingService().getLogger().warn("registerForSALEvents was invoked without operationObj!");}b.bind("REQUEST_ERROR",function(i){var f=c?c.getEventBus():SVMX.getCurrentApplication();
var d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CHANGE_APP_STATE",this,{request:{state:"unblock"},responder:{}});f.triggerEvent(d);var g="Custom Tag ";try{g+="::"+i.data.xhr.statusText+"=>"+i.data.xhr.responseText;}catch(h){}d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",this,{request:{message:g},responder:{}});f.triggerEvent(d);},this);},createServiceRequest:function(d,c){var b=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.sal.service.factory");b.getInstanceAsync({handler:function(e){var f=d.options||{};var h={type:f.type||"REST",endPoint:f.endPoint||"",nameSpace:"SVMXDEV"};var i=e.createServiceManager(h);var g=i.createService();this.registerForSALEvents(g,c);d.handler.call(d.context,g);},context:this});},checkResponseStatus:function(e,f,j,g){if(!g){SVMX.getLoggingService().getLogger().warn("checkResponseStatus was invoked without operationObj!");}var i=true,m="",c="";if(f){if(f.response&&(f.response.success===false||f.response.success==="false")){i=false;if(f.response.msgDetails&&f.response.msgDetails.message){m=f.response.msgDetails.message;c=f.response.msgDetails.details;}else{m=f.response.message;}}else{if(f.success===false||f.success==="false"){i=false;if(f.msgDetails&&f.msgDetails.message){m=f.msgDetails.message;c=f.msgDetails.details;}else{m=f.message;}}}}var b=g?g.getEventBus():SVMX.getCurrentApplication(),k;if(i==false){k=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CHANGE_APP_STATE",this,{request:{state:"unblock"},responder:{}});b.triggerEvent(k);k=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",this,{request:{message:m,msgDetail:c},responder:{}});b.triggerEvent(k);var d=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SFMDELIVERY");this.__logger.error(e+" : "+d.T("TAG035")+" "+m);}else{if(!j){var l=null,h=null;if(f.response&&f.response.message){l=f.response.message;h=f.response.messageType;}else{if(f.message){l=f.message;h=f.messageType;}}if(l&&typeof(l)=="string"){k=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_QUICK_MESSAGE",this,{request:{message:l,type:h},responder:{}});b.triggerEvent(k);}}}return i;}},{instance:null});a.Class("IoTAdminEventBus",com.servicemax.client.lib.api.EventDispatcher,{__constructor:function(){this.__base();},triggerEvent:function(b){return this.__base(b);}},{});})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.operations");a.init=function(){var b=com.servicemax.client.installigence.ui.components.impl.Module;a.Class("GetSetupMetadata",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,c){var d={};InstalligenceSetupJsr.JsrGetSetupMetadata(d,function(f,g){c.result(f);},this);}},{});a.Class("Save",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,c){var d={events:e.events,deletedEvents:e.deletedEvents,compositeKey:e.compositeKey,objectMapEvents:e.objectMapEvents,deletedObjectMap:e.deletedObjectMap};InstalligenceSetupJsr.JsrSave(d,function(f,g){c.result(f);},this);}},{});a.Class("BackToSetupHome",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,c){var d={};InstalligenceSetupJsr.JsrBackToSetupHome(d,function(f,g){},this);}},{});a.Class("DescribeObject",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(d,c){InstalligenceSetupJsr.JsrDescribeObject(d.requestData,function(e,f){c.result(e);},this);}},{});a.Class("GetAllEventTemplates",com.servicemax.client.mvc.api.Operation,{__constructor:function(){this.__base();},performAsync:function(e,c){var d=b.instance;b.instance.createServiceRequest({handler:function(f){f.bind("REQUEST_COMPLETED",function(h){if(d.checkResponseStatus("GetAllEventTemplates",h.data,false,this)==true){c.result(h.data.records);}},this);f.bind("REQUEST_ERROR",function(h){if(d.checkResponseStatus("GetAllEventTemplates",h.data,false,this)==true){c.result([]);}},this);var g=encodeURI("SELECT Id,"+SVMX.OrgNamespace+"__SM_Event_Name__c,"+SVMX.OrgNamespace+"__SM_Description__c ,"+SVMX.OrgNamespace+"__SM_JSON_Payload__c  FROM "+SVMX.OrgNamespace+"__SM_IoT_Field_Mapping__c");f.callApiAsync({url:"query?q="+g});},context:this},this);}},{});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.ioteventmap");a.init=function(){Ext.define("com.servicemax.client.iot.admin.ioteventmap",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",constructor:function(b){var c=this;c.otherSettings=SVMX.create("com.servicemax.client.iot.admin.OtherSettings",{metadata:metadata});c.maptoobject=SVMX.create("com.servicemax.client.iot.admin.Maptoobject",{metadata:metadata});c.eventTabPanel=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTabPanel",{tabPosition:"top",tabRotation:0,cls:"iot-setup-tab-horizantal"});
c.eventTabPanel.add(c.otherSettings);c.eventTabPanel.add(c.maptoobject);c.eventTabPanel.setActiveTab("OS");b=b||{};b.items=[c.eventTabPanel];b.title=$TR.IOT_EVENTS;b.id="EM";c.callParent([b]);},getData:function(){var e=this;var d=e.otherSettings.getData();var g=e.maptoobject.getData();var b=d.data.concat(g.data);var c=d.deletedEvents.concat(g.deletedEvents);var f={data:b,deletedEvents:c};return f;},getMappingRecords:function(){var b={};b=this.maptoobject.getMappingRecords();return b;},shouldSave:function(){var f=this;var b={};b=f.maptoobject.shouldSave();if(b.isValid){var d=f.otherSettings.getAllEventName();var e=f.maptoobject.getAllEventName();var c=[];c=d.concat(e);b=f.__validateDuplicateValues(c);}return b;},__validateDuplicateValues:function(b){var g=[];var d=[];var j=false;for(var f=0;f<b.length;f++){var h=b[f];var e=b.reduce(function(k,i){if(i.toLowerCase()===h.toLowerCase()){k++;}return k;},0);if(e>1){if(d.indexOf(h.toLowerCase())>-1){}else{g.push(b[f]);d.push(h.toLowerCase());}j=true;}}var c={message:$TR.DUPLICATE_EVENT_NAMES+g.join(),isValid:!j};return c;}});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.maptoobject");a.init=function(){Ext.define("com.servicemax.client.iot.admin.Maptoobject",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",metadata:null,constructor:function(d){var e=this;e.refresh();e.metadata=d.metadata,d.items=[];e.eventStore=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:[{name:"eventName",type:"string"},{name:"eventDescription",type:"string"},{name:"objectName",type:"string"},{name:"sfdc",type:"string"},{name:"eventId",type:"string"},{name:"payload",type:"string"}],data:[]});e.eventGrid=SVMX.create("com.servicemax.client.iot.admin.EventGrid",{cls:"grid-panel-borderless panel-radiusless iot-setup-ta-grid iot-create-map-for-object-grid",store:e.eventStore,autoScroll:true,parentContext:e,selType:"cellmodel",plugins:[SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditorPlugin",{clicksToEdit:2})],viewConfig:{markDirty:false,getRowClass:function(g,h){return"iot-maptoobject-object-cell";}},listeners:{cellclick:function(q,g,m,i,l,n,j,k){if(q.config.grid.columns[m].dataIndex==="objectName"){var o=q.config.grid.getStore().data.items[n].data.payload,p=null;if(o!==""){p=JSON.parse(o);}var h=SVMX.create("com.servicemax.client.iot.admin.createevent.CreateEvent",{recordIndex:n,selectCell:q,parentContext:q.config.grid.parentContext,metadata:q.config.grid.parentContext.metadata,payload:p});}},edit:function(h,i,g){}}});var f=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-width: 0"});var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"iot-setup-add-button",handler:function(){e.__onAddRecords();}});f.add("->");f.add(c);var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXFormPanel",{style:"margin: 1px 0",layout:"fit",cls:"grid-panel-borderless",defaults:{anchor:"40%"}});b.add(e.eventGrid);d.items.push(f);d.items.push(b);d.title=$TR.MAP_TO_OBJECT;d.id="MO";e.callParent([d]);e.__loadAllEventTemplates();},shouldSave:function(){var d=this;var b={isValid:true,message:""};var f=d.__getAllMappings();var e=d.getAllEventName();var c;if(Boolean($.inArray("",f)+1)){b.isValid=false;b.message=$TR.SELECT_FIELD_MAP;c=$.inArray("",f);}else{if(Boolean($.inArray("",e)+1)){b.isValid=false;b.message=$TR.EMPTY_EVENT_NAME;c=$.inArray("",e);}}if(!b.isValid){d.__highlightRow(c);}return b;},getAllEventName:function(){var e=[];var d=this;var c=d.eventStore.data.items;for(var b=0;b<c.length;b++){e.push(c[b].data.eventName);}return e;},__getAllMappings:function(){var e=[];var d=this;var c=d.eventStore.data.items;for(var b=0;b<c.length;b++){e.push(c[b].data.payload);}return e;},getMappingRecords:function(){var d=this.eventGrid;var f=d.getStore();f=f.getModifiedRecords();var c=[];var e=0,b=f.length;for(e=0;e<b;e++){delete f[e].data.id;c.push(f[e].data);}return{data:c,deletedEventMapIds:d.deletedEventMapIds};},getData:function(){var e=this.eventGrid;var h=e.getStore();h=h.getModifiedRecords();var d=[];var g=0,c=h.length;for(g=0;g<c;g++){delete h[g].data.id;var f=h[g].data;var b={eventName:f.eventName,className:"COMM_IoTRestApiEngine"};if(f.eventId!==""){b.eventId=f.eventId;}d.push(b);}return{data:d,deletedEvents:e.deletedEventIds};},__onAddRecords:function(c){var d=this;d.eventGrid.addItems({objectName:$TR.SELECT});d.eventGrid.getView().refresh();var e=d.eventGrid.store.data.items.length-1;var b=d.eventGrid.getView();Ext.get(b.getRow(e)).scrollIntoView(b.getEl(),null,true);b.select(e);},__loadAllEventTemplates:function(){var c=this;SVMX.getCurrentApplication().blockUI();var b=SVMX.create("com.servicemax.client.lib.api.Event","IOT.GET_ALL_EVENT_TEMPLATES",c,{request:{context:c}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},loadAllEventTemplatesComplete:function(e){var j=this;var d=e.length;var m=[];
for(var f=0;f<d;f++){var h=e[f];var i=JSON.parse(h[SVMX.OrgNamespace+"__SM_JSON_Payload__c"]);var g=i.objLbl;var k={eventName:h[SVMX.OrgNamespace+"__SM_Event_Name__c"],eventDescription:h[SVMX.OrgNamespace+"__SM_Description__c"],sfdc:h.Id,objectName:g,payload:h[SVMX.OrgNamespace+"__SM_JSON_Payload__c"]};var c=j.__getEventItems(j.metadata.events,k.eventName);if(c){var b=c.eventId;k.eventId=b;}m.push(k);}j.eventStore.loadData(m);SVMX.getCurrentApplication().unblockUI();},__getEventItems:function(c,b){var d=null;for(var e=0;e<c.length;e++){if(c[e].eventName===b){d=c[e];break;}}return d;},applyEvent:function(b,d,f){var e=this;var c=JSON.stringify(f);e.eventGrid.store.data.items[d].data.objectName=f.objLbl;e.eventGrid.store.data.items[d].data.payload=c;e.eventGrid.getView().refresh();},refresh:function(){var b=this;SVMX.getClient().bind("SAVE_SUCCESS",function(c){b.metadata=c.data;b.__loadAllEventTemplates();},b);},__highlightRow:function(e){var c=this;var b=c.eventGrid.getView();var d=b.getRow(e);Ext.get(d).scrollIntoView(b.getEl(),null,true);Ext.get(d).addCls("piq-setup-new-attributes-row");},});Ext.define("com.servicemax.client.iot.admin.EventGrid",{extend:"com.servicemax.client.installigence.ui.components.SVMXGrid",deletedEventMapIds:null,deletedEventIds:null,constructor:function(b){var c=this;c.deletedEventMapIds=[];c.deletedEventIds=[];var b=b||{};c.addFieldButton=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"piq-setup-add-button",disabled:false,id:"addFieldRecordbutton",handler:function(){c.addFieldRecord({name:""});}});b.columns=[{menuDisabled:true,sortable:false,xtype:"actioncolumn",width:50,items:[{iconCls:"delet-icon",tooltip:$TR.DELETE}],handler:function(e,i,d){var f=e.getStore();var h=f.getAt(i);f.remove(h);var g=h.data;if(g.sfdc&&g.eventId){c.deletedEventMapIds.push(g.sfdc);c.deletedEventIds.push(g.eventId);}},renderer:function(f,e,d){b.columns[0].items[0].iconCls="delet-icon";}}];b.columns.push(c.createTextBoxColumn({text:$TR.EVENT_NAME,dataIndex:"eventName",flex:1,parentContext:c,maskRe:/[^ ]/,listeners:{blur:function(d){setTimeout(function(){var f=d.parentContext.__getAllEventsName();var g=d.value;var e=f.reduce(function(i,h){if(h.toLowerCase()===g.toLowerCase()){i++;}return i;},0);if(e>1){SVMX.getCurrentApplication().showQuickMessage("error","Event name already exists");}},200);}}}));b.columns.push(this.createTextBoxColumn({text:$TR.EVENT_DESCRIPTION,dataIndex:"eventDescription",flex:1,listeners:null}));b.columns.push(this.createObjectColumn({text:$TR.OBJECT,dataIndex:"objectName",flex:1,listeners:null,tdCls:"x-change-cell"}));c.callParent([b]);},__getAllEventsName:function(){var c=[];var e=this;var d=e.store.data.items;for(var b=0;b<d.length;b++){c.push(d[b].data.eventName);}return c;},addFieldRecord:function(c){if(!c){return;}var d=this.getStore().count();this.store.insert(this.getStore().count(),c);var b=this.getView();Ext.get(b.getRow(d)).scrollIntoView(b.getEl(),null,true);},createTextBoxColumn:function(b){var d=this;var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:true,listeners:b.listeners,parentContext:b.parentContext,maskRe:b.maskRe});var b=b||{};b.sortable=true;b.editable=true;b.getEditor=function(e){return c;};return b;},createObjectColumn:function(b){var c=this;var b=b||{};b.sortable=true;b.editable=true;b.getEditor=function(d){return null;};return b;}});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.othersettings");a.init=function(){Ext.define("com.servicemax.client.iot.admin.eventsGrid",{extend:"com.servicemax.client.installigence.ui.components.SVMXGrid",metadata:null,deletedIds:null,constructor:function(b){var c=this;this.deletedIds=[];b.columns=[];b.columns.push(this.createTextBoxColumn({text:$TR.EVENT_NAME,dataIndex:"eventName",width:400,flex:1}));b.columns.push(this.createTextBoxColumn({text:$TR.CLASS_NAME,dataIndex:"className",width:400,flex:1}));b.columns.push({menuDisabled:true,sortable:true,xtype:"actioncolumn",width:50,items:[{iconCls:"delet-icon",tooltip:$TR.DELETE}],handler:function(e,i,d){var g=e.getStore();var h=g.getAt(i);var f=h.data.eventId;if(f){c.deletedIds.push(f);}g.remove(h);},renderer:function(f,e,d){b.columns[b.columns.length-1].items[0].iconCls="delet-icon";}});this.metadata=b.metadata;this.callParent([b]);this.loadData();},getDeletedEvents:function(){return this.deletedIds;},loadData:function(){var b=this;b.store.loadData(b.filterMapToObjectEvents());b.store.commitChanges();},filterMapToObjectEvents:function(){var b=this.metadata.events.filter(function(c){return c.className!=="COMM_IoTRestApiEngine";});return b;},createTextBoxColumn:function(b){var d=this;var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:true,maskRe:/[^ ]/});var b=b||{};b.sortable=true;b.editable=true;b.getEditor=function(e){return c;};return b;}});Ext.define("com.servicemax.client.iot.admin.OtherSettings",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",eventsGrid:null,constructor:function(d){var f=this;
this.refresh();var e=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXStore",{fields:["eventId","eventName","className"],data:[]});this.eventsGrid=SVMX.create("com.servicemax.client.iot.admin.eventsGrid",{cls:"grid-panel-borderless panel-radiusless iot-setup-ta-grid",selType:"cellmodel",plugins:[SVMX.create("com.servicemax.client.installigence.ui.components.SVMXCellEditorPlugin",{clicksToEdit:2})],viewConfig:{markDirty:false},sortable:true,store:e,metadata:d.metadata});var c=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXFormPanel",{style:"margin: 1px 0",layout:"fit",cls:"grid-panel-borderless",defaults:{anchor:"40%"}});c.add(this.eventsGrid);var g=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-width: 0"});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.ADD,cls:"iot-setup-add-button",handler:function(){f.onAddRecords();}});g.add("->");g.add(b);d=d||{};d.items=[];d.items.push(g);d.items.push(c);d.title=$TR.MAP_TO_APEX;d.id="OS";this.callParent([d]);},onAddRecords:function(c){this.eventsGrid.addItems({});this.eventsGrid.getView().refresh();var d=this.eventsGrid.store.data.items.length-1;var b=this.eventsGrid.getView();Ext.get(b.getRow(d)).scrollIntoView(b.getEl(),null,true);b.select(d);},getData:function(){var e=this.eventsGrid.getStore();e=e.getModifiedRecords();var c=[];var d=0,b=e.length;for(d=0;d<b;d++){delete e[d].data.id;if(!$.isEmptyObject(e[d].data)){c.push(e[d].data);}}return{data:c,deletedEvents:this.eventsGrid.getDeletedEvents()};},refresh:function(){var b=this;SVMX.getClient().bind("SAVE_SUCCESS",function(c){b.eventsGrid.metadata=c.data;var d=metadata.sforceObjectDescribes;for(var e=0;e<d.length;e++){b.eventsGrid.metadata[d[e].objectAPIName]=d[e];}b.eventsGrid.loadData();},this);},getAllEventName:function(){var e=[];var d=this;var c=d.eventsGrid.getStore().data.items;for(var b=0;b<c.length;b++){if(c[b].data.eventName){e.push(c[b].data.eventName);}}return e;},createTextField:function(b){return SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTextField",{allowBlank:true,editable:true,margin:"5, 5",labelAlign:"right",fieldLabel:b,labelWidth:200,width:550,listeners:{change:function(d,c){}}});}});};})();(function(){var a=SVMX.Package("com.servicemax.client.iot.admin.root");a.init=function(){Ext.define("com.servicemax.client.iot.admin.root.RootPanel",{extend:"com.servicemax.client.installigence.ui.components.SVMXPanel",metadata:null,__spinner:null,constructor:function(e){var l=this;e=e||{};e.renderTo=SVMX.getDisplayRootId();e.title="<span class='title-text'>"+$TR.IOT_SETUP+"</span>";metadata=e.metadata;var j=SVMX.create("com.servicemax.client.iot.admin.OtherSettings",{metadata:metadata});var d=SVMX.create("com.servicemax.client.iot.admin.ioteventmap",{metadata:metadata});var m=SVMX.create("com.servicemax.client.iot.admin.CompositeKey",{metadata:metadata});var k=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXTabPanel",{height:465,tabPosition:"left",tabRotation:0,cls:"iot-setup-tab-body",tabBar:{border:false,cls:"iot-setup-left-nav"},margin:"4 4 0 4",ui:"setup-tabpanel",defaults:{textAlign:"left",bodyPadding:7,cls:"iot-setup-content-body",}});k.add(d);k.add(m);k.setActiveTab("EM");var h=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.SAVE,cls:"iot-setup-save",handler:function(){l.save(m,d);}});var b=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.BACK_TO_SETUP_HOME,cls:"iot-setup-back-to-home",docked:"left",rigion:"left",align:"left",handler:function(){var n="/apex/"+SVMX.OrgNamespace+"__CONF_SetupHome";if((typeof sforce!="undefined")&&(sforce!=null)){n="/lightning/n/"+SVMX.OrgNamespace+"__ServiceMax_Setup";sforce.one.navigateToURL(n);}else{window.location.href=n;}}});var i=[b];e.tools=i;var g=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXButton",{text:$TR.CANCEL,cls:"iot-setup-cancel",handler:function(){window.location.reload();}});var c=["->",h,g];var f=SVMX.create("com.servicemax.client.installigence.ui.components.SVMXToolbar",{style:"border-top-width: 0 !important",cls:"iot-setup-profile-selection",dock:"top",items:c});e.items=[];e.items.push(f);e.items.push(k);this.callParent([e]);},backToSetupHome:function(){this.blockUI();var c=this;var b=SVMX.create("com.servicemax.client.lib.api.Event","IOT.BACK_TO_SETUP_HOME",c,{request:{context:c}});SVMX.getCurrentApplication().getEventBus().triggerEvent(b);},save:function(i,e){var g=this;var b=g.__shouldAllowSave(e);if(!b.isValid){SVMX.getCurrentApplication().showQuickMessage("error",b.message);}else{g.blockUI();var h=e.getData();var f=i.getData();var d=e.getMappingRecords();var c=SVMX.create("com.servicemax.client.lib.api.Event","IOT.SAVE",g,{request:{context:g,events:h.data,deletedEvents:h.deletedEvents,compositeKey:f,objectMapEvents:d.data,deletedObjectMap:d.deletedEventMapIds}});SVMX.getCurrentApplication().getEventBus().triggerEvent(c);
}},__shouldAllowSave:function(b){return b.shouldSave();},onSaveComplete:function(c){this.unblockUI();metadata=c;this.dataSavedSucessfullyMessage();var b=SVMX.create("com.servicemax.client.lib.api.Event","SAVE_SUCCESS",this,c);SVMX.getClient().triggerEvent(b);},dataSavedSucessfullyMessage:function(d){var b=$TR.SAVE_SUCCESS;if(d){b=d;}var c=Ext.Msg.alert({title:$TR.INFO,msg:b,closable:false,buttonText:{ok:$TR.OK},fn:function(e){}});},blockUI:function(){var b={lines:25,length:25,width:5,radius:30,corners:1,rotate:0,direction:1,color:"#ffa384",speed:3,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};this.__spinner=new Spinner(b).spin($("#"+SVMX.getDisplayRootId())[0]);},unblockUI:function(){this.__spinner.stop();}});};})();