(function(){var a=SVMX.Package("com.servicemax.client.pmplantemplate.ui.desktop.conditionRuleCriteriaBased");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("PMPLAN");Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.conditionRuleCriteriaBased.ConditionRuleCriteriaBased",{extend:"Ext.form.FormPanel",constructor:function(c){c=Ext.apply({title:b.T("TAG027","Condition Rules")},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var c=Ext.create("Ext.data.Store",{storeId:"Field_List_Store_CB",fields:["fieldApiName","fieldLabel","dataType","category","attributeType"],groupField:"category",});this.__grid=SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRuleCriteriaBased.ConditionRuleGrid",{__fieldStore:c});this.add(this.__grid);}});Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.conditionRuleCriteriaBased.ConditionRuleGrid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",frame:true,__fieldStore:null,__rowData:null,viewConfig:{markDirty:false},initComponent:function(){this.fieldCombo=new SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.GroupComboBox",{id:"fieldComboCmp_CB",typeAhead:true,queryMode:"local",triggerAction:"all",selectOnTab:true,store:this.__fieldStore,displayField:"fieldLabel",valueField:"fieldApiName",groupField:"category",editable:false});var c=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("COMM_TAG010","Equals"),value:"eq",type:"TEXT_PICKLIST"},{label:b.T("COMM_TAG011","Greater Than"),value:"gt",type:""},{label:b.T("COMM_TAG012","Less Than"),value:"lt",type:""}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.operatorCombo=new Ext.form.field.ComboBox({id:"operatorComboCmp_CB",typeAhead:true,triggerAction:"all",queryMode:"local",selectOnTab:true,displayField:"label",store:c,valueField:"value",editable:false,__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;var h=Ext.getStore("Field_List_Store_CB");var i=h.findRecord("fieldApiName",e,0,false,true,true);var g=i&&i.getData().dataType.toUpperCase();if(e!==null&&e!==""){if(g==="TEXT"||g==="PICKLIST"){f.store.filter("type","TEXT_PICKLIST");}}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}});var d=Ext.create("Ext.data.Store",{storeId:"TA_PA_Store",fields:["fieldApiName","label","value"]});this.TA_PA_Combo=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{id:"TA_PA_ComboCmp",store:d,queryMode:"local",displayField:"label",valueField:"value",editable:false,__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){f.store.filter("fieldApiName",e);}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}});this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,__parent:this,listeners:{beforeedit:function(g,i){this.__parent.__rowData=i.record.data;var f=Ext.getCmp("operatorComboCmp_CB");f.store.clearFilter();var h=Ext.getCmp("TA_PA_ComboCmp");h.store.clearFilter();},edit:function(h,j){if(j.field==="selectedField"){var i=j.value;var g=j.originalValue;var f="";var l="";var k=Ext.getStore("Field_List_Store_CB");var m=k.findRecord("fieldApiName",i,0,false,true,true);var l=m&&m.getData().dataType.toUpperCase();if(g!==""&&g!==null){m=k.findRecord("fieldApiName",g,0,false,true,true);f=m&&m.getData().dataType.toUpperCase();}if((l==="TEXT"||l==="PICKLIST")&&(f!==""&&(f==="NUMBER"||f==="DATE"))){j.record.set("selectedOperator","");}else{if((l==="NUMBER"||l==="DATE")&&(f!==""&&(f==="TEXT"||f==="PICKLIST"))){j.record.set("selectedOperator","");}}if(f!==""&&(l!==f)){j.record.set("value","");}else{if(l==="PICKLIST"&&f!==""&&(l===f)&&(i!==g)){j.record.set("value","");}}}}}});this.comboBoxRenderer=function(e){return function(g){var f=e.store.find(e.valueField,g);var h=e.store.getAt(f);return((h===null||h===undefined)?"":h.get(e.displayField));};};Ext.apply(this,{width:600,plugins:[this.cellEditing],store:new Ext.data.Store({storeId:"Condition_Rule_Store_CB",fields:["isRowHasError","conditionRuleId","sequence","selectedField","selectedOperator","value"]}),columns:[{xtype:"actioncolumn",width:40,align:"center",sortable:false,menuDisabled:true,items:[{iconCls:"pmplantemplate-delete-row-icon",tooltip:b.T("TAG029","Delete"),scope:this,handler:this.onRemoveClick}]},{header:b.T("TAG014","Sequence"),dataIndex:"sequence",width:80,sortable:false,menuDisabled:true,align:"center"},{header:b.T("TAG015","Attribute"),dataIndex:"selectedField",width:300,align:"center",sortable:false,menuDisabled:true,editor:this.fieldCombo,renderer:this.comboBoxRenderer(this.fieldCombo)},{header:b.T("TAG016","Operator"),dataIndex:"selectedOperator",width:250,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.operatorCombo),__parent:this,getEditor:function(e){var f=e.data.selectedField;
if(f!==null&&f!==""){return this.__parent.operatorCombo;}}},{header:b.T("TAG063","Value"),dataIndex:"value",width:470,align:"center",sortable:false,menuDisabled:true,__parent:this,renderer:function(p,e,l,h,k,q){if(p!=null&&p!=""){var g=l.data.selectedField;var f=Ext.getStore("Field_List_Store_CB");var j=f.findRecord("fieldApiName",g,0,false,true,true);var m=j&&j.getData().dataType.toUpperCase();if(m==="DATE"){var i=new Date(p);var n=("0"+(i.getMonth()+1)).slice(-2);var o=("0"+i.getDate()).slice(-2);return[n,o,i.getFullYear()].join("-");}else{return Ext.String.htmlEncode(p);}}else{return p;}},getEditor:function(e){var g=e.data.selectedField;var i=Ext.getStore("Field_List_Store_CB");var j=i.findRecord("fieldApiName",g,0,false,true,true);var h=j&&j.getData().dataType.toUpperCase();if(h!==null&&h!==""){if(h==="DATE"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.value,"m-d-Y"),invalidText:b.T("COMM_TAG013","Enter a valid date")});return Ext.create("Ext.grid.CellEditor",{field:f});}else{if(h==="TEXT"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Text",{})});}else{if(h==="NUMBER"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0.1,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(m,l){var k=m.getValue();if(!Ext.isEmpty(k)){if(/\.\d{2,}/.test(k)){l.stopEvent();}}}}})});}else{if(h==="PICKLIST"){return Ext.create("Ext.grid.CellEditor",{field:this.__parent.TA_PA_Combo});}}}}}}}],selModel:{selType:"cellmodel"},bbar:[{text:"+ "+b.T("TAG028","Add row"),id:"addRowButton_CB",scope:this,handler:this.onAddClick,cls:"pmplantemplate-blue-link"}]});this.callParent();},onAddClick:function(d){var c=this.getStore().getCount();var e={sequence:c+1,isRowHasError:false};if(c<5){this.getStore().insert(c,e);if(c==4){d.setDisabled(true);}}Ext.getCmp("buildSampleSchedule").setDisabled(false);},onRemoveClick:function(d,h,c,g){var k=this.getStore();k.removeAt(h);var l=k.getCount();for(var f=h;f<l;f++){var e=k.getAt(f);e.set("sequence",f+1);}var j=Ext.getCmp("addRowButton_CB");if(l<5&&j.isDisabled()){j.setDisabled(false);}if(l===0){Ext.getCmp("buildSampleSchedule").setDisabled(true);}}});};})();