(function(){var a=SVMX.Package("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("PMPLAN");Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.ConditionRule",{extend:"Ext.form.FormPanel",constructor:function(c){c=Ext.apply({title:b.T("TAG027","Condition Rules")},c||{});this.callParent([c]);},initComponent:function(){this.callParent(arguments);var c=Ext.create("Ext.data.Store",{storeId:"Field_List_Store",fields:["fieldApiName","fieldLabel","dataType","category","attributeType"],groupField:"category",});this.__grid=SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.ConditionRuleGrid",{__fieldStore:c});this.add(this.__grid);}});Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.GroupComboBox",{extend:"com.servicemax.client.ui.components.controls.impl.SVMXPicklist",groupField:"group",listConfig:{cls:"grouped-list",getInnerTpl:function(c){return"{[Ext.String.htmlEncode(values."+c+")]}";}},initComponent:function(){var c=this;c.tpl=new Ext.XTemplate(["{[this.currentGroup = null]}",'<tpl for=".">','   <tpl if="this.shouldShowHeader('+c.groupField+')">','       <div class="group-header">{[this.showHeader(values.'+c.groupField+")]}</div>","   </tpl>",'   <div class="svmx-boundlist-item">{'+c.displayField+"}</div>","</tpl>",{shouldShowHeader:function(d){return this.currentGroup!=d;},showHeader:function(d){this.currentGroup=d;return d;}}]);c.callParent(arguments);}});Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.ConditionRuleGrid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",frame:true,__fieldStore:null,__rowData:null,viewConfig:{markDirty:false},initComponent:function(){this.fieldCombo=new SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.GroupComboBox",{id:"fieldComboCmp",typeAhead:true,queryMode:"local",triggerAction:"all",selectOnTab:true,store:this.__fieldStore,displayField:"fieldLabel",valueField:"fieldApiName",groupField:"category",editable:false});var c=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("TAG032","Every"),value:"EYI",type:"Date"},{label:b.T("TAG033","Every decrement"),value:"EYD",type:"Number"}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.operatorCombo=new Ext.form.field.ComboBox({id:"operatorComboCmp",typeAhead:true,triggerAction:"all",queryMode:"local",selectOnTab:true,displayField:"label",store:c,valueField:"value",editable:false,__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){if(e==="Months"||e==="Weeks"||e==="Years"){f.store.filter("type","Date");}}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}});this.adjustmentTypeCombo=new Ext.form.field.ComboBox({typeAhead:true,triggerAction:"all",selectOnTab:true,editable:false,queryMode:"local",store:[["None",b.T("COMM_TAG004","--None--")],["Actual",b.T("TAG038","Actual")],["Fixed",b.T("TAG039","Fixed")]],listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}});var d=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("TAG040","Days"),value:"Days",type:"Date"},{label:b.T("TAG034","Count"),value:"Count",type:"Number"}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.adjustmentUnitCombo=new Ext.form.field.ComboBox({id:"adjustmentUnitComboCmp",displayField:"label",valueField:"value",queryMode:"local",typeAhead:true,triggerAction:"all",selectOnTab:true,editable:false,store:d,__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){if(e==="Months"||e==="Weeks"||e==="Years"){f.store.filter("type","Date");}else{f.store.filter("type","Number");}}}},listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}}});this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,__parent:this,listeners:{beforeedit:function(g,h){this.__parent.__rowData=h.record.data;var i=Ext.getCmp("adjustmentUnitComboCmp");i.store.clearFilter();var f=Ext.getCmp("operatorComboCmp");f.store.clearFilter();},edit:function(n,o){if(o.field==="selectedAdjustmentType"&&(o.value==="None")&&(o.value!==o.originalValue)){o.record.set("minAdjustment","");o.record.set("maxAdjustment","");o.record.set("adjustmentVal","");o.record.set("selectedAdjustedUnit","");}if(o.field==="selectedAdjustmentType"&&(o.value==="Actual")&&(o.value!==o.originalValue)){o.record.set("adjustmentVal","");}if(o.field==="selectedField"){if((o.value==="Weeks"||o.value==="Months"||o.value==="Years")&&(o.originalValue!==""&&o.originalValue!=="Weeks"&&o.originalValue!=="Months"&&o.originalValue!=="Years")){o.record.set("startAt","");o.record.set("stopAt","");o.record.set("threshold","");o.record.set("frequency","");
o.record.set("selectedOperator","");o.record.set("selectedAdjustedUnit","");}else{if((o.value!=="Weeks"&&o.value!=="Months"&&o.value!=="Years")&&(o.originalValue!==""&&(o.originalValue==="Weeks"||o.originalValue==="Months"||o.originalValue==="Years"))){o.record.set("startAt","");o.record.set("stopAt","");o.record.set("frequency","");o.record.set("selectedOperator","");o.record.set("selectedAdjustedUnit","");}}}if(o.record.data.selectedOperator=="EYI"&&(o.record.data.stopAt===""||o.record.data.stopAt===null)){var i=o.row.childNodes[7];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",h+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG041","This is a required field."));}}if(o.record.data.selectedOperator=="EYD"&&(o.record.data.startAt===""||o.record.data.startAt===null)){var i=o.row.childNodes[5];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",h+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG041","This is a required field."));}}if(o.record.data.selectedAdjustmentType==="Fixed"&&(o.record.data.adjustmentVal===""||o.record.data.adjustmentVal===null)){var i=o.row.childNodes[11];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",h+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG041","This is a required field."));}}else{if(o.record.data.selectedAdjustmentType!=="Fixed"){var i=o.row.childNodes[11];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")!==-1){i.firstChild.setAttribute("class",h.replace("make-cell-dirty","").trim());}}}if(o.record.data.selectedOperator=="EYI"&&(o.record.data.startAt!==""&&o.record.data.startAt!==null)&&(o.record.data.stopAt!==""&&o.record.data.stopAt!==null)){var k=false;if((o.record.data.selectedField==="Months"||o.record.data.selectedField==="Weeks"||o.record.data.selectedField==="Years")&&o.record.data.stopAt<o.record.data.startAt){k=true;}else{if((o.record.data.selectedField!=="Months"&&o.record.data.selectedField!=="Weeks"&&o.record.data.selectedField!=="Years")&&parseFloat(o.record.data.stopAt)<parseFloat(o.record.data.startAt)){k=true;}}if(k){var i=o.row.childNodes[7];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",h+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG042","Stop At cannot be less than Start At."));}}}if((o.record.data.selectedField!=="Months"&&o.record.data.selectedField!=="Weeks"&&o.record.data.selectedField!=="Years")&&o.record.data.selectedOperator=="EYD"&&(o.record.data.startAt!==""&&o.record.data.startAt!==null)&&(o.record.data.stopAt!==""&&o.record.data.stopAt!==null)&&parseFloat(o.record.data.stopAt)>parseFloat(o.record.data.startAt)){var i=o.row.childNodes[5];var h=i.firstChild.getAttribute("class");if(h.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",h+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG043","Start At cannot be less than Stop At."));}}if(o.record.data.selectedField!==null&&o.record.data.selectedField!==""){var i=o.row.childNodes[7];var h=i.firstChild.getAttribute("class");var t=i.firstChild.getAttribute("data-qtip");if(h.indexOf("make-cell-dirty")===-1&&t!==null&&t.length>0){i.firstChild.removeAttribute("data-qtip");}}if(o.record.data.selectedField!=="Weeks"&&o.record.data.selectedField!=="Months"&&o.record.data.selectedField!=="Years"){var i=o.row.childNodes[5];var h=i.firstChild.getAttribute("class");var t=i.firstChild.getAttribute("data-qtip");if(h.indexOf("make-cell-dirty")===-1&&t!==null&&t.length>0){i.firstChild.removeAttribute("data-qtip");}}if(o.record.data.selectedAdjustmentType==="Fixed"&&(o.record.data.adjustmentVal!==""&&o.record.data.adjustmentVal!==null)){var i=o.row.childNodes[11];var h=i.firstChild.getAttribute("class");var t=i.firstChild.getAttribute("data-qtip");if(h.indexOf("make-cell-dirty")===-1&&t!==null&&t.length>0){i.firstChild.removeAttribute("data-qtip");}}var u;var m;var j=false;var l=o.row.childNodes[5];var g=l.firstChild.getAttribute("class");if(g.indexOf("make-cell-dirty")!==-1){j=true;u=l;m=g;}var f=o.row.childNodes[7];var s=f.firstChild.getAttribute("class");if(s.indexOf("make-cell-dirty")!==-1){j=true;u=f;m=s;}var r=o.row.childNodes[11];var p=r.firstChild.getAttribute("class");if(p.indexOf("make-cell-dirty")!==-1){j=true;u=r;m=p;}if(j){o.record.set("isRowHasError",true);u.firstChild.setAttribute("class",m.replace("make-cell-dirty","").trim());u.firstChild.setAttribute("class",u.firstChild.getAttribute("class")+" make-cell-dirty ");var q=o.row.childNodes[0];var v=q.firstChild.getAttribute("class");if(v.indexOf("make-cell-dirty")===-1){q.firstChild.setAttribute("class",v+" make-cell-dirty ");q.firstChild.setAttribute("data-qtip",b.T("TAG044","This row has one or more issues. Please correct before proceeding"));}}else{o.record.set("isRowHasError",false);
var q=o.row.childNodes[0];var v=q.firstChild.getAttribute("class");var t=q.firstChild.getAttribute("data-qtip");if(v.indexOf("make-cell-dirty")!==-1&&t!==null&&t.length>0){q.firstChild.removeAttribute("data-qtip");q.firstChild.setAttribute("class",v.replace("make-cell-dirty","").trim());}}}}});this.comboBoxRenderer=function(e){return function(g){var f=e.store.find(e.valueField,g);var h=e.store.getAt(f);return((h===null||h===undefined)?"":Ext.String.htmlEncode(h.get(e.displayField)));};};Ext.apply(this,{width:600,plugins:[this.cellEditing],store:new Ext.data.Store({storeId:"Condition_Rule_Store",fields:["isRowHasError","conditionRuleId","sequence","selectedField","selectedOperator","frequency","startAt","threshold","stopAt","selectedAdjustmentType","minAdjustment","maxAdjustment","adjustmentVal","selectedAdjustedUnit"]}),columns:[{xtype:"actioncolumn",width:40,align:"center",sortable:false,menuDisabled:true,items:[{iconCls:"pmplantemplate-delete-row-icon",tooltip:b.T("TAG029","Delete"),scope:this,handler:this.onRemoveClick}]},{header:b.T("TAG014","Sequence"),dataIndex:"sequence",width:80,sortable:false,menuDisabled:true,align:"center"},{header:b.T("TAG015","Attribute"),dataIndex:"selectedField",width:150,align:"center",sortable:false,menuDisabled:true,editor:this.fieldCombo,renderer:this.comboBoxRenderer(this.fieldCombo)},{header:b.T("TAG016","Operator"),dataIndex:"selectedOperator",width:120,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.operatorCombo),__parent:this,getEditor:function(e){var f=e.data.selectedField;if(f!==null&&f!==""){return this.__parent.operatorCombo;}}},{header:b.T("TAG017","Frequency"),dataIndex:"frequency",width:100,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedField;if(f!==null&&f!==""){if(f==="Weeks"||f==="Months"||f==="Years"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:1,allowDecimals:false,nanText:b.T("COMM_TAG014","Enter a valid number"),})});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0.1,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}}},{header:b.T("TAG019","Start At"),dataIndex:"startAt",width:120,align:"center",sortable:false,menuDisabled:true,renderer:function(l,e,i,f,h,m){if(l!=null&&l!=""&&(i.data.selectedField==="Weeks"||i.data.selectedField==="Months"||i.data.selectedField==="Years")){var g=new Date(l);var j=("0"+(g.getMonth()+1)).slice(-2);var k=("0"+g.getDate()).slice(-2);return[j,k,g.getFullYear()].join("-");}else{return l;}},getEditor:function(e){var g=e.data.selectedField;if(g==="Weeks"||g==="Months"||g==="Years"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.startAt,"m-d-Y"),invalidText:b.T("COMM_TAG013","Enter a valid date")});return Ext.create("Ext.grid.CellEditor",{field:f});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(j,i){var h=j.getValue();if(!Ext.isEmpty(h)){if(/\.\d{2,}/.test(h)){i.stopEvent();}}}}})});}}},{header:b.T("TAG020","Threshold %"),dataIndex:"threshold",width:100,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedField;if(f!=="Weeks"&&f!=="Months"&&f!=="Years"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,allowDecimals:false,nanText:b.T("COMM_TAG014","Enter a valid number"),})});}}},{header:b.T("TAG021","Stop At"),dataIndex:"stopAt",width:120,align:"center",sortable:false,menuDisabled:true,renderer:function(l,e,i,f,h,m){if(l!=null&&l!=""&&(i.data.selectedField==="Weeks"||i.data.selectedField==="Months"||i.data.selectedField==="Years")){var g=new Date(l);var j=("0"+(g.getMonth()+1)).slice(-2);var k=("0"+g.getDate()).slice(-2);return[j,k,g.getFullYear()].join("-");}else{return l;}},getEditor:function(e){var g=e.data.selectedField;if(g==="Weeks"||g==="Months"||g==="Years"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.stopAt,"m-d-Y"),invalidText:b.T("COMM_TAG013","Enter a valid date")});return Ext.create("Ext.grid.CellEditor",{field:f});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(j,i){var h=j.getValue();if(!Ext.isEmpty(h)){if(/\.\d{2,}/.test(h)){i.stopEvent();}}}}})});}}},{header:b.T("TAG022","Adjustment Type"),dataIndex:"selectedAdjustmentType",width:110,align:"center",sortable:false,menuDisabled:true,editor:this.adjustmentTypeCombo,renderer:this.comboBoxRenderer(this.adjustmentTypeCombo)},{header:b.T("TAG023","Minimum Adjustment"),dataIndex:"minAdjustment",width:125,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;
if(f!==null&&f!==""&&f!=="None"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG024","Maximum Adjustment"),dataIndex:"maxAdjustment",width:130,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;if(f!==null&&f!==""&&f!=="None"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG025","Adjustment Value"),dataIndex:"adjustmentVal",width:120,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;if(f==="Fixed"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("COMM_TAG014","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG026","Adjustment Unit"),dataIndex:"selectedAdjustedUnit",width:120,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.adjustmentUnitCombo),__parent:this,getEditor:function(e){var g=e.data.selectedAdjustmentType;var f=e.data.selectedField;if(g!==null&&g!==""&&g!=="None"&&f!==null&&f!==""){return this.__parent.adjustmentUnitCombo;}}}],selModel:{selType:"cellmodel"},bbar:[{text:"+ "+b.T("TAG028","Add row"),id:"addRowButton",scope:this,handler:this.onAddClick,cls:"pmplantemplate-blue-link"}]});this.callParent();},onAddClick:function(d){var c=this.getStore().getCount();var e={sequence:c+1,isRowHasError:false};if(c<5){this.getStore().insert(c,e);if(c==4){d.setDisabled(true);}}Ext.getCmp("buildSampleSchedule").setDisabled(false);},onRemoveClick:function(d,h,c,g){var k=this.getStore();k.removeAt(h);var l=k.getCount();for(var f=h;f<l;f++){var e=k.getAt(f);e.set("sequence",f+1);}var j=Ext.getCmp("addRowButton");if(l<5&&j.isDisabled()){j.setDisabled(false);}if(l===0){Ext.getCmp("buildSampleSchedule").setDisabled(true);}}});};})();