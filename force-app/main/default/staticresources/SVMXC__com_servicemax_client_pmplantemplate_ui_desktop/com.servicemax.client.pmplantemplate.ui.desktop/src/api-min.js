(function(){var a=SVMX.Package("com.servicemax.client.pmplantemplate.ui.desktop.api");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("PMPLAN");Ext.define("com.servicemax.client.pmplantemplate.ui.desktop.api.RootContainer",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXSection",cls:"pmplantemplate-root-container",id:"pmPlanTemplateContainer",width:"100%",height:730,__parent:this,__runOpts:null,constructor:function(c){c=Ext.apply({collapsible:false,title:SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")?"":b.T("TAG001","Preventive Maintenance Plan Template"),titleAlign:"center",layout:{type:"border"}},c||{});this.callParent([c]);},run:function(g){var D=this;this.__runOpts=g;var o=SVMX.create("Ext.form.FormPanel",{id:"templateMainPanel",collapsible:false,region:"center",width:"100%",border:false,layout:"anchor",layout:{type:"anchor",align:"stretch"},buttons:[{text:b.T("COMM_TAG002","Cancel"),__parent:this,cls:"pmplantemplate-cancel-btn",height:30,listeners:{click:function(G,I,F){var H={title:b.T("TAG048","Warning"),msg:b.T("TAG045","All your changes will be discarded. Do you want to continue?"),width:300,closable:false,icon:Ext.MessageBox.WARNING,buttons:Ext.Msg.YESNO,__parent:G.__parent,buttonText:{yes:b.T("COMM_TAG005","Yes"),no:b.T("COMM_TAG006","No"),},fn:function(K,M,J){if(K==="yes"){var L="/"+J.__parent.deliveryEngine.getKeyPrefixForTemplateObject();if((typeof sforce!="undefined")&&(sforce!=null)){sforce.one.navigateToURL(L);}else{window.location.href=L;}}}};SVMX.MessageBox.show(H);}}},{text:b.T("COMM_TAG001","Save"),__parent:this,cls:"pmplantemplate-save-btn",height:30,listeners:{click:function(G,K,L){var M=Ext.getCmp("templateMainPanel");var I=M.getForm().getFieldValues();var N=I.conditionType;if(this.__parent.validateFormData(I)){if(N===null||N===""||N==="Usage_Frequency"){var J=Ext.getStore("Condition_Rule_Store");var H=J.data.items;if(this.__parent.validateGridData(H)){this.__parent.deliveryEngine.saveTemplateData(I,H);}}else{if(N==="Criteria_Comparison"){var F=Ext.getStore("Condition_Rule_Store_CB");var H=F.data.items;if(this.__parent.validateCriteriaGridData(H)){this.__parent.deliveryEngine.saveTemplateData(I,H);}}}}}}}]});this.add(o);var k=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXText",{id:"templateNameBox",name:"templateName",fieldLabel:b.T("TAG002","Template Name")+"*",labelAlign:"top",labelSeparator:"",msgTarget:"under"});var y=Ext.create("Ext.data.Store",{storeId:"Schedule_Type_Store",fields:["name","label"]});var m=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG003","Schedule Type"),labelSeparator:"",name:"scheduleType",id:"scheduleTypeCombo",store:y,queryMode:"local",displayField:"label",valueField:"name",labelAlign:"top",editable:false,readOnly:true,listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});var B=Ext.create("Ext.data.Store",{storeId:"Condition_Type_Store",fields:["name","label"],data:[{name:"Usage_Frequency",label:b.T("TAG060","Usage/Frequency Based")},{name:"Criteria_Comparison",label:b.T("TAG061","Criteria/Comparison Based")}]});var v=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG062","Condition Type")+"*",labelSeparator:"",name:"conditionType",id:"conditionTypeCombo",store:B,queryMode:"local",displayField:"label",valueField:"name",labelAlign:"top",editable:false,value:"Usage_Frequency",__parent:this,listeners:{beforeselect:function(K,G,J){var H=this.getValue();var I=Ext.getStore("Condition_Rule_Store");var F=Ext.getStore("Condition_Rule_Store_CB");if(I.getCount()>0||F.getCount()>0){Ext.Msg.show({title:b.T("COMM_TAG007","Warning"),msg:b.T("TAG064","Changing the Condition type will reset the fields on the Condition grid. Are you sure you want to proceed?"),width:300,closable:false,icon:Ext.MessageBox.WARNING,buttons:Ext.Msg.YESNO,__parent:this.__parent,__comboCmp:this,buttonText:{yes:b.T("COMM_TAG008","Ok"),no:b.T("COMM_TAG009","Cancel"),},fn:function(M,N,L){if(M==="yes"){L.__comboCmp.changeComponentState(G,F,I);}else{K.setValue(H);}}});}else{this.changeComponentState(G,F,I);}}},listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}},changeComponentState:function(H,F,J){var M=H.get("name");var G=Ext.getCmp("useCurrentFieldVal");var I=Ext.getCmp("conditionRuleTabPanel");var L=Ext.getCmp("conditionRuleTabPanelForCriteria");if(M==="Usage_Frequency"){G.setVisible(true);I.setVisible(true);L.setVisible(false);F.removeAll();Ext.getCmp("addRowButton").setDisabled(false);}else{if(M==="Criteria_Comparison"){G.setVisible(false);I.setVisible(false);L.setVisible(true);J.removeAll();Ext.getCmp("addRowButton_CB").setDisabled(false);}}Ext.getCmp("advancedExpression").setValue("");Ext.getCmp("buildSampleSchedule").setDisabled(true);var K=Ext.getCmp("productCombo").getValue();if(K!=null){this.__parent.deliveryEngine.getTechnicalAttribute(K,M);
}}});var d=Ext.create("Ext.data.Store",{storeId:"Coverage_Type_Store",fields:["name","label"]});var u=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{id:"coverageTypeCombo",name:"coverageType",fieldLabel:b.T("TAG004","Coverage Type")+"*",labelSeparator:"",store:d,queryMode:"local",displayField:"label",valueField:"name",labelAlign:"top",editable:false,readOnly:true,listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});var t=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{layout:"column",defaults:{columnWidth:0.5},collapsible:false,border:false,style:"background-color: white !important"});var A=Ext.create("Ext.data.Store",{storeId:"Product_Store",fields:["name","label"],});var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG005","Product")+"*",labelSeparator:"",name:"product",id:"productCombo",store:A,queryMode:"local",displayField:"label",valueField:"name",labelAlign:"top",msgTarget:"under",columnWidth:0.95,listeners:{select:function(H,F){var G=F[0].getData().name;var I=Ext.getCmp("conditionTypeCombo").getValue();this.deliveryEngine.getTechnicalAttribute(G,I);},scope:this},listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});t.add(e);t.add({iconCls:"svmx-filter-icon",cursor:"pointer",scale:"small",cls:"img-header-default",border:false,columnWidth:0.05,style:"top: 20px",listeners:{el:{click:function(){var G=Ext.getCmp("productCombo");var H={};H.objAPIName="Product2";H.searchtext=G.getRawValue();H.whereClause=" IsActive = true ";if(H.searchtext.length<3){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG010","Please enter atleast first three characters and click Search"));}else{var F=Ext.getCmp("pmPlanTemplateContainer");F.getDeliveryEngine().searchObject(H);}}}},});var j=Ext.create("Ext.data.Store",{storeId:"IB_Filter_Store",fields:["exprId","exprName"]});var i=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG006","Installed Product Filter"),labelSeparator:"",name:"installedProductFilter",id:"installedProductFilterCombo",store:j,queryMode:"local",displayField:"exprName",valueField:"exprId",labelAlign:"top",editable:false,listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});var f=Ext.create("Ext.data.Store",{storeId:"Activity_Date_Store",fields:["fieldApiName","fieldLabel"]});var E=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG007","Activity Date")+"*",labelSeparator:"",id:"activityDateCombo",name:"activityDate",store:f,queryMode:"local",displayField:"fieldLabel",valueField:"fieldApiName",labelAlign:"top",editable:false,allowBlank:false,listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});var x=Ext.create("Ext.data.Store",{storeId:"WO_Purpose_Store",fields:["taskTemplateId","taskTemplateName"]});var h=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{fieldLabel:b.T("TAG008","Work Order Purpose"),labelSeparator:"",name:"workOrderPurpose",id:"workOrderPurposeCombo",store:x,queryMode:"local",displayField:"taskTemplateName",valueField:"taskTemplateId",labelAlign:"top",editable:false,listConfig:{getInnerTpl:function(F){return"{[Ext.String.htmlEncode(values."+F+")]}";}}});var c=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXCheckbox",{labelSeparator:"",name:"useCurrentFieldVal",id:"useCurrentFieldVal",boxLabelAlign:"after",hidden:true,boxLabel:b.T("TAG059","Use Current Field Value")});var C={xtype:"fieldset",columnWidth:0.5,border:false,defaults:{anchor:"100%"},layout:"anchor",items:[k,u,i,h,c]};var z={xtype:"fieldset",columnWidth:0.5,border:false,defaults:{anchor:"100%"},layout:"anchor",items:[m,v,t,E]};var l=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{collapsible:false,region:"center",width:"100%",border:false,layout:"column",defaults:{bodyPadding:0},items:[C,z]});o.add(l);var r=SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRule.ConditionRule",{itemId:"conditionRulePanelCmp",collapsible:false,region:"center",width:"100%",layout:"anchor",__parent:this,defaults:{bodyPadding:0,anchor:"100%"}});var q=SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.conditionRuleCriteriaBased.ConditionRuleCriteriaBased",{itemId:"conditionRulePanelForCriteriaCmp",collapsible:false,region:"center",width:"100%",layout:"anchor",__parent:this,defaults:{bodyPadding:0,anchor:"100%"}});var w={id:"conditionRuleTabPanel",xtype:"tabpanel",items:[r],cls:"pmplantemplate-tab-panel",margin:"10px 10px 10px 10px",hidden:true};var p={id:"conditionRuleTabPanelForCriteria",xtype:"tabpanel",items:[q],cls:"pmplantemplate-tab-panel",margin:"10px 10px 10px 10px",hidden:true};o.add(p);o.add(w);var n=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXText",{id:"advancedExpression",name:"advancedExpression",fieldLabel:b.T("TAG051","Advanced Expression"),labelAlign:"top",labelSeparator:"",width:"98%",margin:"10px 10px 10px 10px"});
o.add(n);var s=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{id:"buildSampleSchedule",name:"buildSampleSchedule",text:b.T("TAG054","Build sample schedule"),disabled:true,__parent:this,margin:"10px 10px 10px 0px",style:{marginLeft:"44% !important"},cls:"pmplantemplate-blue-link",listeners:{click:function(F,K,L){var M=Ext.getCmp("templateMainPanel");var H=M.getForm().getFieldValues();var O=H.conditionType;var J=(O=="Criteria_Comparison")?Ext.getStore("Condition_Rule_Store_CB"):Ext.getStore("Condition_Rule_Store");var G=J.data.items;var N=(O=="Criteria_Comparison")?F.__parent.validateCriteriaGridData(G):F.__parent.validateGridData(G);if(N){var I=SVMX.create("com.servicemax.client.pmplantemplate.ui.desktop.scheduleWindow.ScheduleWindow",{id:"scheduleWindow",cls:"pmplantemplate-schedule-window",__parent:this,maxHeight:550,width:530,conditionTypeValue:O});F.__parent.getDeliveryEngine().getSampleSchedules(H,G);}}}});o.add(s);this.resize();},validateFormData:function(d){var c=true;if(d.templateName==null||d.templateName==""){Ext.getCmp("templateNameBox").markInvalid(b.T("TAG041","This is a required field."));c=false;}if(d.product==null||d.product==""){Ext.getCmp("productCombo").markInvalid(b.T("TAG041","This is a required field."));c=false;}return c;},validateGridData:function(d){var p=Ext.data.StoreManager.lookup("Field_List_Store");var k=false;var m=false;var n=false;var g=false;for(var h=0;h<d.length;h++){if(!k){if(d[h].data.isRowHasError===true){k=true;}}if(!m){var c=d[h].data.selectedField;if(c!=null&&c!=""){var r=p.findExact("fieldApiName",c);if(r===-1){m=true;}}}if(!n){var c=d[h].data.selectedField;var o=d[h].data.selectedOperator;var f=d[h].data.frequency;if(c===null||c===""){n=true;}else{if(o===null||o===""){n=true;}else{if(f===null||f===""){n=true;}}}}if(!g){var l=d[h].data.selectedField;if(l==="Months"||l==="Weeks"||l==="Years"){var j=d[h].data.startAt;if(j===null||j===""){var q=d[h].data.stopAt;var e=new Date();e=e.setHours(0,0,0,0);if(q<e){g=true;}}}}}if(m){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG047","There is a mismatch between the product and attribute chosen. Please choose the correct attribute and save."),7000,"success");return false;}else{if(n){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG050","Please fill values for the following columns in Condition Rule : Attribute, Operator and Frequency"),7000,"success");return false;}else{if(k){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG046","One or more conditions is invalid. Please review the conditions and save"),7000,"success");return false;}else{if(g){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG053","Stop At cannot be less than today. Please validate your condition"),7000,"success");return false;}}}}return true;},validateCriteriaGridData:function(d){var k=Ext.data.StoreManager.lookup("Field_List_Store_CB");var g=false;var h=false;for(var f=0;f<d.length;f++){if(!g){var c=d[f].data.selectedField;if(c!=null&&c!=""){var l=k.findExact("fieldApiName",c);if(l===-1){g=true;}}}if(!h){var c=d[f].data.selectedField;var j=d[f].data.selectedOperator;var e=d[f].data.value;if(c===null||c===""){h=true;}else{if(j===null||j===""){h=true;}else{if(e===null||e===""){h=true;}}}}}if(g){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG047","There is a mismatch between the product and attribute chosen. Please choose the correct attribute and save."),7000,"success");return false;}else{if(h){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG065","Please fill values for the following columns in Condition Rule : Attribute, Operator and Value"),7000,"success");return false;}}return true;},resize:function(c){if(!this.getEl()){return SVMX.timer.job(this.id+".resize",10,this,"resize");}if(!c){c=this.getEl().getViewSize();}if(c.width){c.width=c.width-4;}if(c.height){c.height=c.height-6;}if(c.width){this.setWidth(c.width);}if(c.height){this.setHeight(c.height);}},blockApplication:function(f){var e=f||{request:{state:"block",deliveryEngine:this.getDeliveryEngine()},responder:{}};var d=this.getDeliveryEngine().getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","PMPLAN.CHANGE_APP_STATE",this,e);d.triggerEvent(c);},unblockApplication:function(f){var e=f||{request:{state:"unblock",deliveryEngine:this.getDeliveryEngine()},responder:{}};var d=this.getDeliveryEngine().getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","PMPLAN.CHANGE_APP_STATE",this,e);d.triggerEvent(c);},getDeliveryEngine:function(){return this.deliveryEngine;}});};})();