(function(a){var b=SVMX.Package("com.servicemax.client.lib.core");b.Class("LoadProgressEvent",com.servicemax.client.lib.api.Event,{__constructor:function(c,e,d){this.__base(c,e,d);}},{});b.Class("LoadProgressMonitor",com.servicemax.client.lib.api.EventDispatcher,{totalSteps:0,currentStep:0,__constructor:function(c,e,d){this.__base(c,e,d);},start:function(c){this.totalSteps=c.totalSteps;this.currentStep=1;var d=new b.LoadProgressEvent("LOAD_STARTED",this,c.params);this.triggerEvent(d);},finishStep:function(d){var c=new b.LoadProgressEvent("STEP_FINISHED",this,d);this.triggerEvent(c);this.currentStep++;},finish:function(){var c=new b.LoadProgressEvent("LOAD_FINISHED",this);this.triggerEvent(c);}},{});b.Class("ModuleLoaderEvent",com.servicemax.client.lib.api.Event,{__constructor:function(c,e,d){this.__base(c,e,d);}},{});b.Class("ModuleLoader",com.servicemax.client.lib.api.EventDispatcher,{__options:null,module:null,__logger:null,templateList:null,__constructor:function(c){this.__base();this.__options=c;this.__logger=SVMX.getLoggingService().getLogger("MODULE-LOADER");},loadAsync:function(){if(this.__options.manifestOnly){return this.__loadManifest();}else{return this.__loadModuleScripts();}},getOptions:function(){return this.__options;},__loadManifest:function(){var e=this.__getCodeBase(),c=SVMX.isCachingEnabled();var d=e+"/manifest/module.json";return a.ajax({cache:c,type:"GET",dataType:"json",url:d,context:this,async:true,success:function(h,f,g){this.__loadManifestSuccess(h,f);},error:function(g,f,h){this.__loadManifestError(g,f,h);}});},__loadManifestSuccess:function(d,c){var e=new b.ModuleLoaderEvent("LOAD_COMPLETE",this,d);this.triggerEvent(e);},__loadManifestError:function(d,c,f){this.__logger.error("Cannot load manifest for "+this.__options.id+", XHR Status = "+c);var g=new b.ModuleLoaderEvent("LOAD_ERROR",this);this.triggerEvent(g);},__getCodeBase:function(){var c=this.__options.codebase;if(c!=null){if(c.charAt(c.length-1)!="/"){c+="/";}}else{c="";}c+=this.__options.id;if(SVMX.TEST){c=SVMX.SRC_DIR+c;}return c;},__loadModuleScripts:function(){var d=SVMX.Deferred();var e=this.__getCodeBase();var c=e+"/src/";SVMX.requireScript(this.__options.module.scripts,this.__loadModuleScriptsComplete,SVMX.proxy(this,"__loadModuleError"),this,{async:true,prefix:c},d);return d;},__loadModuleError:function(d){this.__logger.error(d);var c=new b.ModuleLoaderEvent("LOAD_ERROR",this);this.triggerEvent(c);},__loadModuleScriptsComplete:function(){this.__loadModuleTemplates();},__loadModuleTemplates:function(){if(this.__options.module.templates&&this.__options.module.templates.length>0){var d=this.__getCodeBase();var c=d+"/resources/templates/";SVMX.requireTemplate(this.__options.module.templates,this.__loadModuleTemplatesComplete,this,{async:true,prefix:c});}else{this.__loadModuleTemplatesComplete();}},__loadModuleTemplatesComplete:function(c){this.templateList=c;var d=new b.ModuleLoaderEvent("LOAD_COMPLETE",this);this.triggerEvent(d);}},{});b.Class("Module",com.servicemax.client.lib.api.Object,{dependencies:null,declarations:null,definitions:null,scripts:null,services:null,tests:null,version:null,id:null,name:null,description:null,client:null,codebase:null,loadAtStartup:false,activatorClass:null,__activator:null,templates:null,loadedTemplates:null,def:null,__constructor:function(c,f,d){this.client=c;this.dependencies=[];this.declarations=[];this.definitions=[];this.services=[];this.id=f.id;this.version=f.version;this.name=f.name;this.description=f.description;this.def=f;this.scripts=f.scripts;this.tests=f.tests?f.tests:[];this.activatorClass=f["module-activator"];this.loadAtStartup=f["load-at-startup"];this.codebase=d.codebase;this.templates=f.templates;this.__extractDependencies();this.__extractDeclaredInterfaces();this.__extractInterfaceImplementations();this.__extractServices();var e=0;for(e=0;e<this.declarations.length;e++){c.registerDeclaration(this.declarations[e]);}},setLoadedTemplates:function(c){this.loadedTemplates=c;},getTemplate:function(c){if(!this.loadedTemplates){return null;}for(var d=0;d<this.loadedTemplates.length;d++){if(c==this.loadedTemplates[d].name){return this.loadedTemplates[d].data;}}return null;},createActivator:function(){var c=SVMX.getClass(this.activatorClass);this.__activator=new c();this.__activator.setModule(this);},beforeInitialize:function(){this.__activator.beforeInitialize();},initialize:function(){this.__activator.initialize();},afterInitialize:function(){this.__activator.afterInitialize();},resolveDefinitions:function(){for(var d=0;d<this.definitions.length;d++){var c=this.client.registerDefinition(this.definitions[d]);if(c==false){return c;}}return true;},resolveServices:function(){for(var d=0;d<this.services.length;d++){var c=this.client.registerService(this.services[d]);if(c==false){return c;}}return true;},__extractServices:function(){var e=this.def.services,f=e.length;for(var d=0;d<f;d++){var c=new b.Service(this,e[d]);this.services[d]=c;}},__extractDependencies:function(){var f=this.def.depends,e=f.length;
for(var d=0;d<e;d++){var c=new b.Dependency(this,f[d]);this.dependencies[d]=c;}},__extractDeclaredInterfaces:function(){var e=this.def.declares,d=e.length;for(var c=0;c<d;c++){var f=new b.DeclaredInterface(this,e[c]);this.declarations[c]=f;}},__extractInterfaceImplementations:function(){var e=this.def.defines,f=e.length;for(var d=0;d<f;d++){var c=new b.InterfaceDefinition(this,e[d]);this.definitions[d]=c;}},getResourceUrl:function(d){var c=this.__getCodeBase()+"/resources/"+d;return c;},__getCodeBase:function(){var c=this.codebase;if(c!=null){if(c.charAt(c.length-1)!="/"){c+="/";}}else{c="";}c+=this.id;if(SVMX.TEST){c=SVMX.SRC_DIR+c;}return c;}},{});b.Class("DeclaredInterface",com.servicemax.client.lib.api.Object,{id:null,description:null,module:null,__constructor:function(c,d){this.id=d.id;this.description=d.description;this.module=c;}},{});b.Class("InterfaceDefinition",com.servicemax.client.lib.api.Object,{type:null,id:null,config:null,module:null,__constructor:function(c,d){this.type=d.type;this.id=d.id;this.config=d.config;this.module=c;},createInstanceAsync:function(d,c){this.__createInstanceAsyncInternal(d,c);},__createInstanceAsyncInternal:function(e,d){var c=SVMX.getClass(e);var f=new c();d.handler.call(d.context,f);},getResourceUrl:function(c){return this.module.getResourceUrl(c);}},{});b.Class("Dependency",com.servicemax.client.lib.api.Object,{id:null,version:null,module:null,__constructor:function(c,d){this.id=d.id;this.version=d.version;this.module=c;}},{});b.Class("ModuleResourceLoader",com.servicemax.client.lib.services.ResourceLoader,{__module:null,__constructor:function(c){this.__base();this.__module=c;},loadAsync:function(c){c.url=this.__getCodeBase()+"/resources/"+c.url;return this.__base(c);},__getCodeBase:function(){var c=this.__module.getModule().codebase;if(c!=null){if(c.charAt(c.length-1)!="/"){c+="/";}}else{c="";}c+=this.__module.getModule().id;if(SVMX.TEST){c=SVMX.SRC_DIR+c;}return c;},getResourceUrl:function(c){return this.__getCodeBase()+"/resources/"+c;}},{});b.Class("Service",com.servicemax.client.lib.api.Object,{id:null,module:null,__serviceClassName:null,__serviceInstance:null,__constructor:function(d,c){this.id=c.id;this.__serviceClassName=c["class-name"];this.module=d;},getInstance:function(){if(this.__serviceInstance==null){var c=SVMX.getClass(this.__serviceClassName);this.__serviceInstance=new c();}return this.__serviceInstance;},getInstanceAsync:function(c){this.__getInstanceAsyncInternal(c);},__getInstanceAsyncInternal:function(c){if(this.__serviceInstance==null){var d=SVMX.getClass(this.__serviceClassName);this.__serviceInstance=new d();}c.handler.call(c.context,this.__serviceInstance);}},{});b.Class("ClientEvent",com.servicemax.client.lib.api.Event,{__constructor:function(c,e,d){this.__base(c,e,d);}},{});b.Class("Client",com.servicemax.client.lib.api.EventDispatcher,{__moduleId2Modules:null,__serviceId2Services:null,__declarationId2Declarations:null,__declarationId2Definitions:null,__logger:null,__appParams:null,__progressMonitor:null,__loadVersion:"debug",__applicationTitle:null,__constructor:function(){if(b.Client.__instance!=null){return b.Client.__instance;}this.__base();this.__moduleId2Modules={};this.__declarationId2Definitions={};this.__declarationId2Declarations={};this.__serviceId2Services={};this.__appParams={};this.__progressMonitor=new b.LoadProgressMonitor();this.__logger=SVMX.getLoggingService().getLogger();this.__profiler=SVMX.getProfilingService();b.Client.__instance=this;},run:function(c){jQuery.ajaxSettings.converters["text json"]=this.__parseJSON;SVMX.Deferred=a.Deferred;if(c.loadVersion!=undefined&&c.loadVersion!=null){this.__loadVersion=c.loadVersion;}if(c.configType=="remote"){this.__runWithRemoteConfig(c.data);}else{if(c.configType=="local"){this.__runWithLocalConfig(c.data);}else{throw new Error("Unknown config type!");}}},__parseJSON:function(d){var f=/^[\],:{}\s]*$/,c=/(?:^|:|,)(?:\s*\[)+/g,i=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,h=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g;if(!d||typeof d!="string"){return null;}d=jQuery.trim(d);try{if(window.JSON&&window.JSON.parse&&d.indexOf("/*")==-1){return window.JSON.parse(d);}}catch(g){}if(f.test(d.replace(i,"@").replace(h,"]").replace(c,"").replace(/\/\*.*?\*\//g,""))){try{return(new Function("return "+d))();}catch(g){}}throw new Error("Invalid JSON: "+d);},getModuleForId:function(c){return this.__moduleId2Modules[c];},getApplicationTitle:function(){return this.__applicationTitle;},getLoadVersion:function(){return this.__loadVersion;},getApplicationParameter:function(c){return this.__appParams[c];},addApplicationParameter:function(c,d){this.__appParams[c]=d;},getPlatformParameter:function(c){},getProgressMonitor:function(){return this.__progressMonitor;},__runWithRemoteConfig:function(e){var c=com.servicemax.client.lib.services.ResourceLoaderService.getInstance().createResourceLoader();c.bind("LOAD_COMPLETE",this.__configLoadSuccess,this);c.bind("LOAD_ERROR",this.__configLoadError,this);
var d=this.__profiler;var f=e;var g="load";var h="config";d.begin(f,h,g);c.loadAsync({url:e,responseType:"json",cache:false}).always(function(){d.end(f,h,g);});},__configLoadSuccess:function(c){this.__run(c.data);},__configLoadError:function(c){},__runWithLocalConfig:function(c){this.__run(c);},__run:function(d){var f=d["app-config"];for(var e in f){this.__appParams[e]=f[e];}var c=this.getApplicationParameter("svmx-logging-preferences");if(c){SVMX.getLoggingService().setTargetSettings(c);}this.__applicationTitle=d.title;if(!SVMX.TEST){SVMX.create("com.servicemax.client.lib.core.MiniSplash",this.__progressMonitor,d);}this.__progressMonitor.start({totalSteps:d.modules.length+1,params:{stepTitle:"Starting module load"}});this.__loadModuleManifests(d.modules);},__loadModulesContext:0,__allDependencies:null,__loadManifestTriggeredFor:null,__loadModuleManifests:function(g){this.__loadModulesContext=0;this.__loadManifestTriggeredFor={};var e=0,f=g.length;for(e=0;e<f;e++){var c=g[e];var d={manifestOnly:true,id:c.id,codebase:c.codebase};this.__loadModuleManifest(d);}},__loadModuleManifest:function(d){if(this.__loadManifestTriggeredFor[d.id]!=undefined){return;}this.__loadModulesContext++;this.__loadManifestTriggeredFor[d.id]=d.id;var h=new b.ModuleLoader(d);h.bind("LOAD_COMPLETE",this.__loadModuleManifestSuccess,this);h.bind("LOAD_ERROR",SVMX.proxy(this,"__loadModuleManifestError",d),this);var c=this.__profiler;var e=d.id;var f="load";var g="manifest";c.begin(e,g,f);h.loadAsync().always(function(){c.end(e,g,f);});},__loadModuleManifestSuccess:function(d){var c=new b.Module(this,d.data,d.target.getOptions());this.__logger.info("Loaded Module "+c.id);this.__moduleId2Modules[c.id]=c;this.__loadModulesContext--;if(this.__loadModulesContext==0){this.__loadModuleManifestsComplete();}},__loadModuleManifestError:function(d,c){this.__logger.error("loadModuleManifestError: "+d.id+" failed to load");},__loadModuleManifestsComplete:function(){this.__progressMonitor.finishStep({stepTitle:"All module manifests loaded"});this.__logger.info("all module manifest are loaded!");if(!this.__resolveDefinitions()){this.__logger.error("There was an error during definitions resolution! Client cannot proceed.");return;}if(!this.__resolveServices()){this.__logger.error("There was an error during services resolution! Client cannot proceed.");return;}this.__loadModules();},__loadModuleTriggeredFor:null,__loadModules:function(){this.__loadModulesContext=Object.keys(this.__moduleId2Modules).length;this.__loadModuleTriggeredFor={};for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d];this.__loadModule(c);}},__loadModule:function(e){if(this.__loadModuleTriggeredFor[e.id]!=undefined){return;}this.__loadModuleTriggeredFor[e.id]=e.id;var d={manifestOnly:false,id:e.id,codebase:e.codebase,module:e};var i=new b.ModuleLoader(d);i.bind("LOAD_COMPLETE",this.__loadModuleSuccess,this);i.bind("LOAD_ERROR",this.__loadModuleError,e);var c=this.__profiler;var f=e.id;var g="load";var h="module";c.begin(f,h,g);i.loadAsync().always(function(){c.end(f,h,g);});},__loadModuleSuccess:function(c){var d=c.target.getOptions().module;this.__progressMonitor.finishStep({stepTitle:"Module loaded: "+d.id});this.__logger.info(d.id+" successfully loaded");d.setLoadedTemplates(c.target.templateList);d.createActivator();this.__loadModulesContext--;if(this.__loadModulesContext==0){this.__loadModulesComplete();}},__loadModuleError:function(d,c){},__loadModulesComplete:function(){this.__logger.info("all modules now loaded are loaded!");for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d];try{c.beforeInitialize();}catch(f){this.__logger.error("Error during beforeInitialize() of =>"+d);throw f;}}for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d];try{c.initialize();}catch(f){this.__logger.error("Error during initialize() of =>"+d);throw f;}}for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d];try{c.afterInitialize();}catch(f){this.__logger.error("Error during afterInitialize() of =>"+d);throw f;}}com.servicemax.client.lib.api.ExtensionRunner.run(this,"com.servicemax.client.onFrameworkLoad").then(SVMX.proxy(this,function(){var e=SVMX.create("com.servicemax.client.lib.core.ClientEvent","READY",this);this.triggerEvent(e);}));},__resolveDefinitions:function(){for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d].resolveDefinitions();if(!c){return false;}}return true;},__resolveServices:function(){for(var d in this.__moduleId2Modules){var c=this.__moduleId2Modules[d].resolveServices();if(!c){return false;}}return true;},getDeclarationRegistry:function(){return this;},getServiceRegistry:function(){return this;},getDeclaration:function(c){if(this.__declarationId2Declarations[c]==undefined){this.__logger.warning("Cannot find declaration <"+c+">!");return null;}return this.__declarationId2Declarations[c];},getDefinitionsFor:function(d){var c="";if(typeof(d)=="string"){c=d;}else{c=d.id;}return this.__declarationId2Definitions[c];
},forEachDefinition:function(c,f){var e=this.getDeclaration(c);var d=this.getDefinitionsFor(e);SVMX.array.forEach(d,f);},registerDeclaration:function(f){var e=f.id;if(this.__declarationId2Declarations[e]!=undefined){var d=this.__declarationId2Declarations[e].module.id;var c=f.module.id;this.__logger.error("Module "+c+" is trying to declare the interface <"+f.id+"> which is already declared by "+d+". Please rectify!");return false;}this.__declarationId2Declarations[e]=f;this.__declarationId2Definitions[e]=[];return true;},registerDefinition:function(d){var e=d.type;if(this.__declarationId2Definitions[e]==undefined){this.__logger.error("Module "+d.module.id+" is trying to define an interface  <"+e+"> which is not declared. Please rectify!");return false;}var c=this.__declarationId2Definitions[e];c[c.length]=d;return true;},iterateOverDefinitionsForDeclaration:function(f,e){var d=this.getDeclaration(f);if(!d){return;}var c=client.getDefinitionsFor(d);SVMX.array.forEach(c,e);},registerService:function(c){var f=c.id;if(this.__serviceId2Services[f]!=undefined){var e=this.__serviceId2Services[f].module.id;var d=c.module.id;this.__logger.error("Module "+d+" is trying to register the service <"+f+"> which is already declared by "+e+". Please rectify!");return false;}this.__serviceId2Services[f]=c;return true;},getServiceInstanceAsync:function(d,c){var e=this.getService(d);if(e){e.getInstanceAsync({handler:function(f){if(c.context){c.handler.call(c.context,f);}else{c.handler(f);}},context:this});}else{if(c.context){c.handler.call(c.context,null);}else{c.handler(null);}}},getService:function(c){if(this.__serviceId2Services[c]==undefined){this.__logger.error("Cannot find service -> "+c);return null;}return this.__serviceId2Services[c];},getServiceInstance:function(d){var c=this.getService(d);if(c){return c.getInstance();}}},{__instance:null,getInstance:function(){if(b.Client.__instance==null){b.Client.__instance=new b.Client();}return b.Client.__instance;}});b.Class("MiniSplash",com.servicemax.client.lib.api.Object,{__pm:null,__outerNode:null,__spinner:null,__ms:null,_width:"100%",_height:"20px",__text:"",__constructor:function(g,e){var f=b.MiniSplash.loadingDivId;b.MiniSplash.loadingDivId++;var c=a("body");g.bind("LOAD_STARTED",this.handleLoadStarted,this);g.bind("STEP_FINISHED",this.handleFinishStep,this);g.bind("LOAD_FINISHED",this.handleFinish,this);this.__pm=g;var h=e&&e["app-config"]["svmx-enable-bootstrap-spinner"];var d=window.__SVMX_CLIENT_LIB_PATH__||"";d+=(d&&!d.match(/\/$/)?"/":"")+"resources/images/loadingAnim.gif";c.append("<div class='loading_div' id='loading_div"+f+"'>"+(h?"":"<img style='padding-left:5px; float:right' src='"+d+"'/>")+"<span style='float:right; margin:2px 0 0 0; padding:0' class='loading_span'></span></div>");this.__ms=a("#loading_div"+f+" .loading_span");this.__outerNode=a("#loading_div"+f);var i={width:this._width,minHeight:this._height,bottom:0,left:0,fontFamily:"tahoma, arial, verdana, sans-serif",textAlign:"right",fontSize:"12px",color:"#000",borderTop:"solid 1px #c7c7c7",padding:"1px 10px",display:"none",position:"absolute",boxSizing:"border-box",background:"#e0dfdf"};this.__outerNode.css(i);if(h){c.append('<div id="spinner" style="position: absolute; top: 50%; left: 50%; width: 50%; height: 50%"></div>');this.__spinner=a("#spinner").get(0);new Spinner({lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,speed:1,trail:60,shadow:false,hwaccel:false,color:"#888888",className:"spinner",top:"-100%",left:"-60%"}).spin(this.__spinner);}this.__disconnectFunc=SVMX.proxy(this,"__onScroll");a(window).on("scroll",this.__disconnectFunc);},__onScroll:function(){if(this.__outerNode){this.__outerNode.css("bottom",-a("body")[0].scrollTop);}},__setText:function(c){this.__text=c;this.__ms.text(this.__text);},handleLoadStarted:function(c){this.__outerNode.show();this.__setText(c.data.stepTitle);},handleFinishStep:function(c){this.__setText(c.data.stepTitle);},handleFinish:function(d){var c=this;this.__ms.text("Loading done");c.__pm.unbind("LOAD_STARTED",this.handleLoadStarted,this);c.__pm.unbind("STEP_FINISHED",this.handleFinishStep,this);c.__pm.unbind("LOAD_FINISHED",this.handleFinish,this);if(this.__spinner){a(this.__spinner).remove();}this.__outerNode.animate({opacity:0},400,null,function(){c.__outerNode.remove();c.__ms=null;c.__outerNode=null;c.__pm=null;if(c.__disconnectFunc){a(window).off("scroll",c.__disconnectFunc);}});}},{loadingDivId:0});})(jQuery);