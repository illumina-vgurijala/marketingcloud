(function(){var a=SVMX.Package("com.servicemax.client.lib.datetimeutils");a.Class("DatetimeUtil",com.servicemax.client.lib.api.Object,{__constructor:function(){}},{__locale:moment.locale("en-US"),_timeZone:moment().utcOffset(),_timeZoneStr:"",_swap:function(d){var b={};for(var c in d){b[d[c]]=c;}return b;},setTimezone:function(b){if(!b){return console.warn("Something tried to set TZ to empty string!");}moment.tz.setDefault(b);a.DatetimeUtil._timeZoneStr=b;},setTimezoneOffset:function(b){a.DatetimeUtil._timeZone=a.DatetimeUtil.parseOffsetString(b);},setDateFormat:function(d){var c=moment.localeData(moment.locale())._longDateFormat;var b=$.extend({},c,{L:d,l:d,lll:"ll LT",LLL:"LL LT"});a.DatetimeUtil.setLocale({longDateFormat:b});},setTimeFormat:function(d){var c=moment.localeData(moment.locale())._longDateFormat;var b=$.extend({},c,{LT:d,lt:d,lll:"ll LT",LLL:"LL LT"});a.DatetimeUtil.setLocale({longDateFormat:b});},setLongDateFormat:function(d){var c=moment.localeData(moment.locale())._longDateFormat;var b=$.extend({},c,{LL:d,ll:d,lll:"ll LT",LLL:"LL LT"});a.DatetimeUtil.setLocale({longDateFormat:b});},getTimezoneOffset:function(b){if(a.DatetimeUtil._timeZoneStr){return moment(b).format("Z");}return moment(b).utcOffset(a.DatetimeUtil._timeZone).format("Z");},getTimezone:function(){return a.DatetimeUtil._timeZoneStr;},getDefaultDateFormat:function(){return moment.localeData(moment.locale())._longDateFormat.l||moment.localeData(moment.locale())._longDateFormat.ll||"MM-DD-YYYY";},getDefaultTimeFormat:function(){return moment.localeData(moment.locale())._longDateFormat.LT||"HH:mm:ss";},getDefaultDatetimeFormat:function(){return a.DatetimeUtil.getDefaultDateFormat()+" "+a.DatetimeUtil.getDefaultTimeFormat();},setLocale:function(b,c){if(typeof b!=="string"){c=b;if(c.value){var d=c.value.split(/[\-_]/);b=d[0];}else{b=a.DatetimeUtil.__locale;}}if(c!==undefined&&c!==null){c.invalidDate="";}a.DatetimeUtil.__locale=moment.locale(b,c);},getLocale:function(){return a.DatetimeUtil.__locale;},setAmPmText:function(e,c){var f=new RegExp(e+"|"+c,"i");var b=function(g){return g===c;};var d=function(g,h,i){if(g>11){return c;}else{return e;}};a.DatetimeUtil.setLocale({meridiemParse:f,isPM:b,meridiem:d});},getDisplayDatetimeFormat:function(b){var c=a.DatetimeUtil.getDefaultDatetimeFormat();if(b.toLowerCase()==="dateonly"||b.toLowerCase()==="date"){c=a.DatetimeUtil.getDefaultDateFormat();}return c;},convertToTimezone:function(b,d,c){if(a.DatetimeUtil._timeZoneStr!==""){if(c){return a.DatetimeUtil.getFormattedDatetime(moment(b).utc(),a.DatetimeUtil.getSaveFormat("datetime"));}else{return a.DatetimeUtil.getFormattedDatetime(moment.utc(b).local(),a.DatetimeUtil.getSaveFormat("datetime"));}}else{var e=a.DatetimeUtil._timeZone;if(d!==undefined&&d!==null){if(typeof d!=="number"){d=a.DatetimeUtil.parseOffsetString(d);}}else{d=e;}if(c){d*=-1;}return a.DatetimeUtil.getFormattedDatetime(moment.utc(b).utcOffset(d),a.DatetimeUtil.getSaveFormat("datetime"));}},chunkOffset:/([+-]|\d\d)/gi,matchOffset:/Z|[+-]?\d\d:?\d\d/gi,parseOffsetString:function(f){if(f.indexOf("-")===-1&&f.indexOf("+")===-1){f="+"+f;}var d=((f||"").match(a.DatetimeUtil.matchOffset)||[]);var b=d[d.length-1]||[];var e=(b+"").match(a.DatetimeUtil.chunkOffset)||["-",0,0];var c=+(e[1]*60)+a.DatetimeUtil.__toInt(e[2]);return e[0]==="+"?c:-c;},__toInt:function(b){var d=+b,c=0;if(d!==0&&isFinite(d)){if(d>=0){c=Math.floor(d);}else{c=Math.ceil(d);}}return c;},macroDrivenDatetime:function(e,b,h,g,d){var c=moment.utc();b=b||a.DatetimeUtil.getDefaultDateFormat();h=h||a.DatetimeUtil.getDefaultTimeFormat();var f;if(e.toLowerCase()!=="now"&&a.DatetimeUtil._timeZoneStr===""){c=c.utcOffset(a.DatetimeUtil._timeZone);}switch(e.toLowerCase()){case"yesterday":c=c.local().subtract(1,"days").startOf("day");break;case"now":break;case"today":c=c.local().startOf("day");break;case"tomorrow":c=c.local().add(1,"days").startOf("day");break;}f=c.format(b+" "+h);if(g!==null&&g!==undefined){if(g==="datetime"){f=c.format(b+" "+h);}else{if(g==="date"){f=c.format(b);}else{f=c.format(b+" "+h);}}}else{if(d!==null&&d!==undefined){f=c.format(b);if(d.length>12){f=c.format(b+" "+h);}}}return f;},manipulateDatetime:function(e,b,c){var d=moment(e);if(!d.isValid()){return e;}if(c<0){c*=-1;return d.subtract(c,b).format("YYYY-MM-DD HH:mm:ss");}return d.add(c,b).format("YYYY-MM-DD HH:mm:ss");},getStartOf:function(d,c){var b=moment(d);if(!b.isValid()){return d;}return b.startOf(c).format("YYYY-MM-DD HH:mm:ss");},getEndOf:function(d,c){var b=moment(d);if(!b.isValid()){return d;}return b.endOf(c).format("YYYY-MM-DD HH:mm:ss");},isFormat24HourTime:function(b){if(b.indexOf("h")>-1){return"12";}else{return"24";}},isValidDate:function(b){return moment(b).isValid();},getSaveFormat:function(c){var b="YYYY-MM-DD";if(c!==undefined&&c!==null&&c.toLowerCase()==="datetime"){b="YYYY-MM-DD HH:mm:ss";}return b;},dateObjFormatter:function(c,b){console.warn("DatetimeUtils.dateObjFormatter is deprecated! Please use getFormattedDatetime in combination with getSaveFormat instead");
return a.DatetimeUtil.getFormattedDatetime(c,a.DatetimeUtil.getSaveFormat(b?"dateOnly":"dateTime"));},getCurrentDatetime:function(b){if(a.DatetimeUtil._timeZoneStr!==""){return a.DatetimeUtil.getFormattedDatetime(moment(),b);}return a.DatetimeUtil.getFormattedDatetime(moment.utc().utcOffset(a.DatetimeUtil._timeZone),b);},getCurrentDatetimeISO:function(){return moment().toISOString();},getCurrentDatetimeGMT:function(b){return a.DatetimeUtil.getFormattedDatetime(moment.utc(),b);},getFormattedDatetime:function(c,b){if(b===null||b===undefined){b=a.DatetimeUtil.getDefaultDatetimeFormat();}return moment(c).format(b);},getFormattedUTCDatetime:function(c,b){if(b===null||b===undefined){b=a.DatetimeUtil.getDefaultDatetimeFormat();}return moment.utc(c).format(b);},parseDate:function(b,c){return moment(b,c).toDate();},parseGMTDate:function(c,f){try{var b=moment.utc(c,f).format("YYYY-MM-DD HH:mm:ss");return moment.utc(b).toDate();}catch(d){throw new Error("Failed to parse date in GMT format: "+c);}},parseDateOnly:function(b,c){return moment(b,c).startOf("day").toDate();},parseGMTDateOnly:function(c,d){var b=moment.utc(c,d).startOf("day");if(b&&!b.isValid()){throw"Failed to parse date in GMT format: "+c;}return b.toDate();},convertDatetimeForExt:function(c,b){return moment.utc(c,b).format("YYYY-MM-DD HH:mm:ss");},convertDateForExt:function(b,c){return moment.utc(b,c).format("YYYY-MM-DD");},humanizeRelativeDate:function(d,c){c=(c===undefined||c===null)?7:c;if(c>7){throw new Error("DatetimeUtils.humanizeRelativeDate: timespan for humanized dates too long");}else{var b=moment().startOf("d").diff(moment(d),"days");if(b>=c||b<-c){return a.DatetimeUtil.getFormattedDatetime(d);}}return moment(d).calendar();},getDurationBetween:function(d,c){var e=moment(d).isValid()&&moment(c).isValid();var b=moment.duration(moment(c).diff(d));b.isValid=function(){return e;};return b;},isSame:function(d,c,b){return moment(d).isSame(moment(c),b);},convertDatetimeForSave:function(c,b){return moment.utc(c,b).format(a.DatetimeUtil.getSaveFormat("dateTime"));},getLocalUTCOffsetString:function(){return moment().format("Z");},getLocalUTCOffset:function(){return moment().utcOffset();},getTimestampWithSaveFormat:function(){return a.DatetimeUtil.macroDrivenDatetime("Now","YYYY-MM-DD","HH:mm:ss");},getWeekDayNameInUserLocale:function(c,b){if(!b){b="ddd";}return moment().day(c).format(b);},addUnitToDateTime:function(b,c,d){return moment(b).add(c,d).toDate();},ext_tokens:{YY:"y",YYYY:"Y",M:"n",MM:"m",MMM:"M",MMMM:"F",w:"W",D:"j",Do:"jS",DD:"d",DDD:"z",ddd:"D",dddd:"l",d:"w",H:"G",HH:"H",h:"g",hh:"h",mm:"i",ss:"s",z:"e",zz:"e"},convertFormatForExt:function(b){b=b||a.DatetimeUtil.getDefaultDatetimeFormat();return a.DatetimeUtil.convertFormatToFormat(b,a.DatetimeUtil.ext_tokens);},convertFormatFromExt:function(c){var b=a.DatetimeUtil._swap(a.DatetimeUtil.ext_tokens);return a.DatetimeUtil.convertFormatToFormat(c,b);},tokens:{d:"D",dd:"DD",ddd:"ddd",dddd:"dddd",f:"S",ff:"SS",fff:"SSS",h:"h",hh:"hh",H:"H",HH:"HH",m:"m",mm:"mm",M:"M",MM:"MM",MMM:"MMM",MMMM:"MMMM",s:"s",ss:"ss",t:"a",tt:"A",y:"YY",yy:"YY",yyy:"YYYY",yyyy:"YYYY",z:"Z",zz:"Z",zzz:"Z",st:"Do",ee:"e",eee:"ddd",eeee:"dddd",EE:"E",EEE:"ddd",EEEE:"dddd"},convertFormatToJSFormat:function(c,b){b=b||a.DatetimeUtil.tokens;return a.DatetimeUtil.convertFormatToFormat(c,b);},convertISODateStringToSpecifiedFormat:function(c,d){var e=moment(a.DatetimeUtil.convertDatetimeForSave(c));var b=a.DatetimeUtil.getFormattedDatetime(e,d);return b;},convertFormatToFormat:function(e,d){var c=e.split(/\W+/),f=e.split(/\w+/),b=1;e="";c.forEach(function(g){if(typeof(d[g])==="string"){g=d[g];}e+=g;if(f[b]!==undefined){e+=f[b];}b++;});return e;},});})();