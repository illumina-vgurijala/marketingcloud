(function(){var a=SVMX.Package("com.servicemax.client.timesheet.engine");a.init=function(){a.Class("DeliveryEngineImpl",com.servicemax.client.sfmconsole.api.AbstractDeliveryEngine,{__constructor:function(b){this.__base();},initAsync:function(b){var c=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.timesheet.impl.TimesheetEngineEventBus",{});c.createNamedInstanceAsync("CONTROLLER",{handler:function(d){c.createNamedInstanceAsync("MODEL",{handler:function(e){d.setModel(e);c.createNamedInstanceAsync("TIMESHEET.VIEW",{handler:function(f){this.__view=f;b.handler.call(b.context);},context:this,additionalParams:{eventBus:this.getEventBus()}});},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});},getEventBus:function(){return this.__eventBus;},__appCurrentState:"",changeApplicationState:function(b){if(this.__appCurrentState===b){return;}this.__appCurrentState=b;if(!this.__loadMask){this.__loadMask=new com.servicemax.client.ui.components.utils.LoadMask({parent:this.__adminRoot});}if(b=="block"){this.__loadMask.show({});this.__loadMask.setZIndex(50000);}else{if(b=="unblock"&&this.__loadMask!==null){if(this.__loadMask!==null){this.__loadMask.hide();}}}},reset:function(){this.getRoot().destroy();this.__adminRoot=null;this.run(this.options);},triggerEvent:function(b){this.getEventBus().triggerEvent(b);},loadTheme:function(){this.__themeService=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.themeservice").getInstance();this.__themeService.loadTheme("TIMESHEET");},run:function(){var c=SVMX.toObject(SVMX.getClient().getApplicationParameter("svmx-timesheet-userinfo"));var b=SVMX.getClient();var d=SVMX.create("com.servicemax.client.lib.api.Event","GLOBAL.HANDLE_USER_INFO",this,c);b.triggerEvent(d);var f,e=[SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetBusinessHours",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetAllTimezones",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetObjectMappingAndSVMXRules",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetWorkDetailOwnership",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetPriorPeriods",this,{request:{fieldName:SVMX.OrgNamespace+"__SM_Prior_Timesheet_Periods__c",objName:SVMX.OrgNamespace+"__ServiceMax_Config_Data__c"}}),SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.GetAllTimesheetProcess",this,{request:{}})];f=SVMX.create("com.servicemax.client.sfmconsole.utils.EventCollection",this.getEventBus(),e);f.triggerAll(function(h){var g=h.items();for(var j=0;j<g.length;j++){var k=g[j];if(k.type()=="TIMESHEET.EVENT.GetAllTimesheetProcess"){this.onGetAllTimesheetsComplete(k.response);}if(k.type()=="TIMESHEET.EVENT.GetBusinessHours"){this.onGetBusinessHours(k.response);}if(k.type()=="TIMESHEET.EVENT.GetObjectMappingAndSVMXRules"){this.onGetObjectMappingAndSVMXRules(k.response);}if(k.type()=="TIMESHEET.EVENT.GetWorkDetailOwnership"){this.onGetWorkDetailOwnership(k.response);}if(k.type()=="TIMESHEET.EVENT.GetAllTimezones"){this.onGetAllTimezones(k.response);}if(k.type()=="TIMESHEET.EVENT.GetPriorPeriods"){this.onGetPriorPeriods(k.response);}}this.__root.unblockApplication();},this);},onGetBusinessHours:function(b){this.businessHours=b.businessHoursList;},onGetAllTimezones:function(b){this.timezones=b.timezoneList;},onGetPriorPeriods:function(b){this.priorperiods=b.priorPeriodList;},onGetObjectMappingAndSVMXRules:function(b){this.workDetailsMappingList=b.workDetailsMappingList;this.workDetailsRuleList=b.workDetailsRuleList;this.taskMappingList=b.taskMappingList;this.taskRuleList=b.taskRuleList;this.eventMappingList=b.eventMappingList;this.eventRuleList=b.eventRuleList;this.servicemaxEventMappingList=b.servicemaxEventMappingList;this.servicemaxEventRuleList=b.servicemaxEventRuleList;},onGetWorkDetailOwnership:function(b){this.workDetailOwnership=b.workDetailOwnershipList;},onGetAllTimesheetsComplete:function(e){this.timesheets=e.timesheetInfoList;this.profiles=e.profileAssociationList;var d=[];for(var c in e.tsHeaderStatusMap){var f={Id:c,tsHeaderStatus:e.tsHeaderStatusMap[c]};d.push(f);}this.headerStatusList=d;var b={__engine:this};if(!this.__root){this.__root=this.__view.createComponent("ROOTCONTAINER",b);}this.__root.run();},getHeaderStatusMap:function(){return this.headerStatusList;},getTemplates:function(){return this.timesheets;},getProfiles:function(){return this.profiles;},getBusinessHours:function(){return this.businessHours;},getAllTimezones:function(){return this.timezones;},getPriorPeriods:function(){return this.priorperiods;},getWorkDetailOwnership:function(){return this.workDetailOwnership;},getWorkDetailsMappingList:function(){return this.workDetailsMappingList;},getWorkDetailsRuleList:function(){return this.workDetailsRuleList;},getTaskMappingList:function(){return this.taskMappingList;
},getTaskRuleList:function(){return this.taskRuleList;},getEventMappingList:function(){return this.eventMappingList;},getEventRuleList:function(){return this.eventRuleList;},getServicemaxEventMappingList:function(){return this.servicemaxEventMappingList;},getServicemaxEventRuleList:function(){return this.servicemaxEventRuleList;},saveTimesheet:function(d){var c=SVMX.create("com.servicemax.client.timesheet.commands.TimesheetResponder",{handler:this.onSaveTimesheetCompleted,context:this});var b=SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.SaveTimesheetConfiguration",this,{request:d,responder:c});this.triggerEvent(b);},onSaveTimesheetCompleted:function(b){if(b.success){this.run();}else{this.__root.unblockApplication();this.__root.onFailure(b.message);}},deleteTimesheets:function(d){var c=SVMX.create("com.servicemax.client.timesheet.commands.TimesheetResponder",{handler:this.onDeleteTimesheetsCompleted,context:this});var b=SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.DeleteTimesheetProcess",this,{request:{timesheetProcessId:d},responder:c});this.triggerEvent(b);},onDeleteTimesheetsCompleted:function(b){if(b.success==false){this.__root.unblockApplication();this.__root.onFailure(b.message);}this.run();},executeBatch:function(f,e){this.changeApplicationState("block");var c=SVMX.create("com.servicemax.client.timesheet.commands.TimesheetResponder",{handler:this.onExecuteBatchCompleted,context:this});var d={timesheetProcessId:f,scheduleType:e};var b=SVMX.create("com.servicemax.client.lib.api.Event","TIMESHEET.EVENT.ExecuteBatch",this,{request:d,responder:c});this.triggerEvent(b);},onExecuteBatchCompleted:function(b,c){this.changeApplicationState("unblock");if(b.success){this.__root.onSuccess(b.message);}else{this.__root.onFailure(b.message);}},getRoot:function(){return this.__adminRoot;},onResize:function(b){this.getRoot().resize(b);}});};})();