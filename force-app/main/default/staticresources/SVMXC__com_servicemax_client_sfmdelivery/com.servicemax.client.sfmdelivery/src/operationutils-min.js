(function(){var a=SVMX.Package("com.servicemax.client.sfmdelivery.operationutils");a.init=function(){var b=com.servicemax.client.sfmdelivery.constants.Constants;a.Class("Utilities",com.servicemax.client.lib.api.Object,{},{addRecords_processData:function(e){if(e.cacheKey){var h=e.request.additionalInfo.module.instance;h.setItemToCache(e.cacheKey,e.data);SVMX.getLoggingService().getLogger("SFM-SAL-MODEL-AddRecords").info("Adding record template for <"+e.request.alias+"> to cache");}function g(q,s){var m=q[0].bubbleInfo,p,n=m.length,r,o=null;for(p=0;p<n;p++){r=m[p];if(r.fieldapiname==s){o=r;break;}}return o;}var f,j,c=e.objectInfo.fields,d=c.length;for(f=0;f<d;f++){j=c[f];if(j.dataType=="boolean"){var k=g(e.data,j.name);if(!k){e.data[0].bubbleInfo[e.data[0].bubbleInfo.length]={fieldapiname:j.name,fieldvalue:{key:"false",value:"false"}};}}}e.data=this.addRecord_doMultiAdd(e.request,e.data,e.optionalNewIds);e.request.data.addNewDetailRecords(e.data,e.request.alias,function(){e.onSuccess(e.data);SVMX.destroy(e);});},addRecord_doMultiAdd:function(f,m,g){var j=m;if(f.multiAddFieldRecordIds&&f.multiAddFieldRecordIds.length>0){var n=f.multiAddFieldRecordIds,c=[],d=f.multiAddFieldRecordValues,h,e=n.length,k=f.multiAddFieldApiName;for(h=0;h<e;h++){c[h]=this.addRecord_mergeFieldToRecordTemplate(SVMX.cloneObject(m[0]),{apiName:k,key:n[h],value:d[h]});if(g){c[h].sobjectinfo.Id=g[h];}}j=c;}return j;},addRecord_mergeFieldToRecordTemplate:function(g,f){var c=g.bubbleInfo,e,d=c.length,j,h=null;for(e=0;e<d;e++){j=c[e];if(j.fieldapiname==f.apiName){h=j;break;}}if(!h){h={fieldapiname:f.apiName,fieldvalue:{}};c[c.length]=h;}h.fieldvalue={key:f.key,value:f.value};return g;},replaceLiteralsWithValue:function(m,f,o,q){var h=m;if(h!=null&&h!=undefined&&h!=""){var k="[SVMX.CURRENTRECORD.",n="[SVMX.CURRENTRECORDHEADER.";if(h.indexOf("'"+k)>0||h.indexOf("'"+n)>0){q=false;}for(var e=0;e<h.length;e++){var g=h.indexOf(k),p;if(g>-1){h=h.replace(k,"*");var d=h.indexOf("*"),c="]",j=h.indexOf(c,d);if(d>-1){p=h.substring(d,j);fieldName1=p.replace("*","");p=p+c;var l=f.getDataBinding().getRelatedBindingValue(fieldName1,"CURRENTRECORD");l=(l===b.NO_VALUE||null)?"":l;if(q){l="'"+l+"'";}h=h.replace(p,l);}}}for(var e=0;e<h.length;e++){var g=h.indexOf(n),p;if(g>-1){h=h.replace(n,"*");var d=h.indexOf("*"),c="]",j=h.indexOf(c,d);if(d>-1){p=h.substring(d,j);fieldName1=p.replace("*","");p=p+c;var l=f.getDataBinding().getRelatedBindingValue(fieldName1,"CURRENTRECORDHEADER");l=(l===b.NO_VALUE||null)?"":l;if(q){l="'"+l+"'";}h=h.replace(p,l);}}}}return h;},replaceBoolToString:function(d){var e=d.indexOf("=true");if(e>-1){d=d.replace(/=true/g,"='true'");}var c=d.indexOf("=false");if(c>-1){d=d.replace(/=false/g,"='false'");}return d;},extractDefWithFiltersToQuery:function(g,q){var h,f,d,c,o=q.advFilters.length,l=g.filtersToQuery,s=false,i=[];if(l!=undefined){for(h=0;h<o;h++){s=false;for(f=0;f<l.length;f++){if(q.advFilters[h].key==l[f]){s=true;var p="SVMX.USERTRUNK",e=g.userTrunk;if(q.advFilters[h].filterCriteria.indexOf(p)>-1){q.advFilters[h].filterCriteria=q.advFilters[h].filterCriteria.replace(p,e);}}}if(!s){i.push(h);}}}else{for(h=0;h<o;h++){if(q.advFilters[h].defaultOn==true||q.advFilters[h].defaultOn=="true"){s=true;var p="SVMX.USERTRUNK",e=g.userTrunk;if(q.advFilters[h].filterCriteria.indexOf(p)>-1){q.advFilters[h].filterCriteria=q.advFilters[h].filterCriteria.replace(p,e);}}else{s=false;}if(!s){i.push(h);}}}for(d=0;d<i.length;d++){delete q.advFilters[i[d]];}var r=[];for(c=0;c<o;c++){if(q.advFilters[c]){r.push(q.advFilters[c]);}}q.advFilters=r;return q;},processDescribeResult:function(j,e){j.recordTypeMapping=[];if(e){if(!(e.recordTypeMappings instanceof Array)){e.recordTypeMappings=[e.recordTypeMappings];}var p=e.recordTypeMappings,k,g=p.length,r,o;for(k=0;k<g;k++){r=p[k];o=r.picklistsForRecordType;if(!o){o=[];}if(!(o instanceof Array)){o=[o];}r.picklistsForRecordType=m(o,j);j.recordTypeMapping.push(r);}}var k,q=j.fields,g=q.length,t,n,d;for(k=0;k<g;k++){t=q[k];if(t.dependentPicklist){n=t.controllerName;d=h(n,j);if(d){c(d,t);}}}function c(w,B){var E=w.picklistValues,A,x=E.length,C,z,v=B.picklistValues,F=v.length,H,D,G,y,I;for(A=0;A<x;A++){if(!E[A].dependendPicklist){E[A].dependendPicklist=[];}D=E[A].dependendPicklist;for(z=0;z<F;z++){C=v[z].validFor;H=s(C,A);if(H){G=null;I=D.length;for(y=0;y<I;y++){if(D[y].fieldAPIName==B.name){G=D[y];break;}}if(!G){G={fieldAPIName:B.name,value:""};D.push(G);}G.value+=z+";";}}for(z=0;z<D.length;z++){var u=D[z].value;if(u.length>0){if(SVMX.stringEndsWith(u,";")){u=u.substring(0,u.length-1);}D[z].value=u;}}}}function s(y,x){var v=y.length*6,A=[],z,w,B,C,u;var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(z=0;z<v;z++){var E=z%6;var D=(z-E)/6;if(D<0){B=Math.ceil(D);}else{B=Math.floor(D);}w=5-(z%6);C=y[B],u=l.indexOf(C);A.push(((u>>w)&1));}return A[x]==1;}function m(z,v){var x,u=z.length,y,w,B,A,C;for(x=0;x<u;x++){y=z[x];var D=y.picklistName;var E=y.picklistValues;if(!(E instanceof Array)){if(E===undefined){E=[];
}else{E=[E];}}B=E.length;C="";for(w=0;w<B;w++){C+=f(D,E[w].value,v)+";";}if(C.length>0){C=C.substring(0,C.length-1);}y.picklistValues=[{value:C}];}return z;}function f(w,y,B){var z=h(w,B),v=0,A,x,u;if(z){A=z.picklistValues;u=A.length;for(x=0;x<u;x++){if(A[x].value==y){v=x;break;}}}return v;}function h(x,z){var w=null,u=z.fields,y,v=u.length;for(y=0;y<v;y++){if(u[y].name==x){w=u[y];break;}}return w;}}});a.Class("SFMTargetRecord",com.servicemax.client.lib.api.Object,{__data:null,__metadata:null,__additionalInfo:null,__constructor:function(e,c,d){this.__data=e;this.__metadata=c;this.__additionalInfo=d;},getParentObjectName:function(){return this.__metadata.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"];},getHeaderLayoutId:function(){return this.__metadata.page.header.hdrLayoutId;},getProcessType:function(){return this.__metadata.response.sfmProcessType;},getHeaderRecords:function(){var o=[],i=this.__data.getRawData().sfmData,f=[];var q=this.getProcessType();if(q=="CHECKLIST"&&i){var h=i[SVMX.OrgNamespace+"__Status__c"];if((!i.hasOwnProperty("Id")||i.Id==undefined)&&i.hasOwnProperty([SVMX.OrgNamespace+"__ChecklistMetaJSON__c"])){var c=120000;var n=i[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"];var g=new Date().getTime();var d=1;if(n.length>c){var m=SVMX.splitLongStringToChunkArray(n,c);for(var j=0;j<m.length;j++){var p=SVMX.cloneObject(i);p[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]=m[j];if(j>0){delete p[SVMX.OrgNamespace+"__ChecklistJSON__c"];}p[SVMX.OrgNamespace+"__SM_Sequence__c"]=d;p[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"]=g;f.push(p);d++;}}else{i[SVMX.OrgNamespace+"__SM_Sequence__c"]=d;i[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"]=g;}}else{if(i.hasOwnProperty("Id")&&this.__additionalInfo&&this.__additionalInfo.hasOwnProperty("lstSobjectinfo")&&i[SVMX.OrgNamespace+"__Status__c"]=="Completed"){var l=this.__additionalInfo.lstSobjectinfo;if(l.length>0){delete i[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"];f.push(i);}for(var k=1;k<l.length;k++){var e=l[k];var p=SVMX.cloneObject(i);delete p.Id;delete p[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"];delete p[SVMX.OrgNamespace+"__ChecklistJSON__c"];delete p[SVMX.OrgNamespace+"__SM_Sequence__c"];delete p[SVMX.OrgNamespace+"__SM_Checklist_Group_Id__c"];p.Id=e.Id;p.Name=e.Name;f.push(p);}}else{delete i[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"];}}}if(f.length==0){f.push(i);}SVMX.array.forEach(f,function(s){var r={targetRecordAsKeyValue:[]},t=null;o.push(r);SVMX.forEachProperty(s,function(v,u){if(v=="attributes"||v.indexOf("_")===0||typeof u==="function"||u&&typeof u=="object"&&!("fieldvalue" in u)){return;}if(v=="sourceRecordID"){return;}var w=s[v];t=null;if(typeof(w)=="object"&&w!==undefined&&w!==null){t={key:v,value:w.fieldvalue.key,value1:w.fieldvalue.value};}else{if(!(v=="RecordTypeId"&&(w===undefined||!(w)))){t={key:v,value:w};}}if(t){r.targetRecordAsKeyValue[r.targetRecordAsKeyValue.length]=t;}});});return o;},getDetailRecords:function(){var o=[],c=this.__data.getRawData().sfmData.details,f=null,j=null;for(j in c){o[o.length]={};}for(j in c){var p=this.getDetailMetadata(j),k=null,t=null,e=null,d=c[j].lines,m,h=d.length,s=null,n=null;f={};f.aliasName=p.dtlLayoutId;f.pageLayoutId=p.dtlLayoutId;f.objName=p.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"];f.parentColumnName=this.getDetailParentColumnName(p);f.records=[];f.deleteRecID=this.getDetailDeletedRecords(j);o[p.DetailLayout[SVMX.OrgNamespace+"__Sequence__c"]-1]=f;for(var m=0;m<h;m++){s=d[m],n={};t=s.Id;if(t){n.targetRecordId=t;}e=s.sourceRecordID;if(e){n.sourceRecordId=e;}n.targetRecordAsKeyValue=[];var g=false;for(var q in s){g=false;if(q=="attributes"||q=="sourceRecordID"||q.indexOf("_")===0||q.indexOf("__key",q.length-"__key".length)!==-1){continue;}var r=s[q];if(s[q+"__key"]){r=s[q+"__key"];g=true;}k=null;if(typeof(r)=="object"&&r!==undefined&&r!==null){if(g){k={key:q,value:r.key,value1:r.value};}else{k={key:q,value:r.fieldvalue.key,value1:r.fieldvalue.value};}}else{if(!(q=="RecordTypeId"&&(r===undefined||!(r)))){k={key:q,value:r};}}if(k){n.targetRecordAsKeyValue[n.targetRecordAsKeyValue.length]=k;}}f.records[f.records.length]=n;}}return o;},getDetailDeletedRecords:function(f){var e=[],h=this.__data.getDeletedRecords(),g,d=h.length,c;for(g=0;g<d;g++){c=h[g];if(c.alias==f){e.push(c.id);}}return e;},getDetailMetadata:function(e){var d=null,g=this.__metadata.page.details,f,c=g.length;for(f=0;f<c;f++){if(g[f].dtlLayoutId==e){d=g[f];break;}}return d;},getDetailParentColumnName:function(g){var e=null,d=g.dtlLayoutId,h=this.__metadata.response.stringMap,f,c=h.length;for(f=0;f<c;f++){if(h[f].key=="PROCESSTYPE"){continue;}if(h[f].key==d){e=h[f].value;break;}}return e;},getRequest:function(){var f={headerRecord:{}};f.sfmProcessId=this.__additionalInfo.sfmProcessId||this.__additionalInfo.processId;f.eventType=this.__additionalInfo.eventType;f.headerRecord.objName=this.getParentObjectName();f.headerRecord.pageLayoutId=this.getHeaderLayoutId();f.headerRecord.records=this.getHeaderRecords();
f.detailRecords=this.getDetailRecords();var e=this.getProcessType();if(e=="STANDALONE EDIT"||e=="STANDALONE CREATE"){f.headerRecord.records[0].targetRecordId=this.__data.getTargetRecordId();}else{if(e=="SOURCE TO TARGET ALL"){var g=this.__data.getTargetRecordId();if(g){f.headerRecord.records[0].targetRecordId=g;var d=f.headerRecord.records[0].targetRecordAsKeyValue;d[d.length]={key:"Id",value:g};}f.headerRecord.records[0].sourceRecordId=this.__data.getSourceRecordId();}else{if(e=="SOURCE TO TARGET CHILD"){f.headerRecord.records[0].targetRecordId=this.__data.getTargetRecordId();f.headerRecord.records[0].sourceRecordId=this.__data.getTargetRecordId();}else{if(e=="VIEW RECORD"){}else{if(e=="CHECKLIST"){var c=this;if(f.eventType==="validated save"){f.eventType="save checklist";}SVMX.array.forEach(f.headerRecord.records,function(h){h.sourceRecordId=c.__data.getSourceRecordId();});}}}}}return f;}},{});a.Class("SFMTargetAttachmentRecord",com.servicemax.client.lib.api.Object,{__data:null,__metadata:null,__additionalInfo:null,_sourceRecordId:null,__attachmentData:null,__constructor:function(e,c,d){this.__data=e.data;this.__additionalInfo=e.additionalInfo;this.__deletedId=[];this.__metadata=c;this.__attachmentData=e.data.__attachementData;this._sourceRecordId=e.data._sourceRecordId;},getParentObjectName:function(){return SVMX.OrgNamespace+"__SM_Checklist_Attachment__c";},getHeaderLayoutId:function(){return this.__metadata.page.header.hdrLayoutId;},getProcessType:function(){return this.__metadata.response.sfmProcessType;},getHeaderRecords:function(){var e=[];if(this.__attachmentData){var c=this.__attachmentData.unSyncedRecord;if(c&&c.length>0){var f=c.length;for(var d=0;d<f;d++){var g=c[d];if(g.hasOwnProperty(SVMX.OrgNamespace+"__SM_Internal_Question_ID__c")){e.push(this.getChecklistAttachment(g));}}}}return e;},getChecklistAttachment:function(d){var c=[];var f={targetRecordAsKeyValue:c,sourceRecordId:this._sourceRecordId};var h=Object.keys(d);var g=h.length;for(var e=0;e<g;e++){c.push(this.getfieldObject(h[e],d[h[e]]));}return f;},getfieldObject:function(c,d){var e={key:c,value:d};return e;},getDeleteAttachmentID:function(){var e=[];if(this.__attachmentData){var f=this.__attachmentData.__deletedRecords;if(f){var h=Object.keys(f);var g=h.length;for(var d=0;d<g;d++){var c=f[h[d]];if(c){e.push(c.Id);}}}}return e;},getRequest:function(){var c={headerRecord:{}};c.sfmProcessId=this.__additionalInfo.sfProcessId||this.__additionalInfo.processId;c.eventType=this.__additionalInfo.eventType;c.headerRecord.objName=this.getParentObjectName();c.headerRecord.pageLayoutId=this.getHeaderLayoutId();c.headerRecord.records=this.getHeaderRecords();c.detailRecords=[];c.headerRecord.deleteRecID=this.getDeleteAttachmentID();return c;}},{});};})();