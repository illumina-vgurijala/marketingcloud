(function(){var a=SVMX.Package("com.servicemax.client.sfmdelivery.engine");a.init=function(){var b=com.servicemax.client.sfmdelivery.constants.Constants;var d=com.servicemax.client.lib.datetimeutils.DatetimeUtil;var e=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("FSA");var c=0;a.Class("DeliveryEngineImpl",com.servicemax.client.sfmconsole.api.AbstractDeliveryEngine,{__logger:null,__sm:null,__page:null,__root:null,recordId:null,record:null,processId:null,__settings:null,returnUrl:null,nextStepId:null,__eventBus:null,__navigationStack:null,__parentContainer:null,__rootContainerId:null,__view:null,__objectNameMap:null,console:null,__extensions:null,isConflict:null,__clonedData:null,__modifiedFields:[],__clientType:null,__constructor:function(){this.__extensions=this.__loadExtensions();d.setAmPmText(e.T("FSA016_TAG005","AM"),e.T("FSA016_TAG006","PM"));this.__navigationStack=[];this.__base();this.__logger=SVMX.getLoggingService().getLogger("SFM-DEL-ENGINE-IMPL");var h=SVMX.getCurrentApplication();this.__clientType=SVMX.getClient().getApplicationParameter("client-type");var f=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.themeservice").getInstance();var g=f.getCurrentTheme();if(g==="LIGHTNING"){SVMX.getClient().addApplicationParameter("svmx-sfm-section-label-align","top");SVMX.getClient().addApplicationParameter("svmx-sfm-section-label-style","font-weight:normal");}h.setApplicationStateHandler(this);h.setApplicationErrorHandler(this);h.setApplicationQuickMessageHandler(h);a.DeliveryEngineImpl.addEngine(this);},initAsync:function(f){var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.sfmdelivery.impl.SFMDeliveryEngineEventBus",{});g.createNamedInstanceAsync("CONTROLLER",{handler:function(h){g.createNamedInstanceAsync("MODEL",{handler:function(i){h.setModel(i);g.createNamedInstanceAsync("SFMDELIVERY.VIEW",{handler:function(j){this.__view=j;f.handler.call(f.context);},context:this,additionalParams:{eventBus:this.getEventBus()}});},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});},__loadExtensions:function(){var g=SVMX.getClient();var i=g.getDeclaration("com.servicemax.client.sfmdelivery.extension");var h=g.getDefinitionsFor(i);var f={};SVMX.array.forEach(h,function(j){var k=j.config["extension-type"];if(!f[k]){f[k]=[];}f[k].push(j);},this);return f;},getExtensions:function(g){var f=this.__extensions[g]||[];return SVMX.array.filter(f,function(n){try{var j=n.config;var k,m,i,h;var k=j.validator;if(!k){return true;}i=SVMX.getClass(j["class-name"]);if(!i){return false;}m=i[k];if(!m){return false;}h=m(this.getPageMetaData(),this.getTargetData());return h;}catch(l){this.__logger.error("Extension failed to validate: "+l+"; "+j["class-name"]);return false;}},this);},__appCurrentState:"",showMessage:function(f){SVMX.getCurrentApplication().showMessage(f);},showQuickMessage:function(f){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(f.message,3000,f.type);},allowSyncPopUp:function(){var f=SVMX.getCurrentApplication().getSyncImpl();f.triggerEvent(new com.servicemax.client.lib.api.Event("EDITMODE_OUT",this,{}));},blockSyncPopUp:function(){var f=SVMX.getCurrentApplication().getSyncImpl();f.triggerEvent(new com.servicemax.client.lib.api.Event("EDITMODE_IN",this,{}));},notifyApplicationError:function(f){if(!f){return;}var g=f.message;if(!(g instanceof Array)){g=[{message:g,msgDetail:f.msgDetail}];}if(this.__root){this.__root.showErrorUI(g);}else{var h=g[0].message;SVMX.getCurrentApplication().showMessage({type:"CUSTOM",title:e.T("FSA008_TAG069","Error"),text:h,buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}]});}},getEventBus:function(){return this.__eventBus;},__loadInternal:function(f){this.__parentContainer=f.container;this.__sourceRecordId=this.recordId=f.recordId;this.record=f.record;this.processId=f.processId;this.additionalInfo=f.additionalInfo||{};this.nextStepId=f.nextStepId;this.returnUrl=f.returnUrl;this.onEngineReady=f.onEngineReady;this.onEngineRendered=f.onEngineRendered;this.requestClose=f.requestClose;this.onLoadFailed=f.onLoadFailed;this.console=f.console;if(this.additionalInfo.sfwActionType!=="CHECKLIST"){var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();g.getQualificationInfo(this.recordId,this.record,this.processId,SVMX.proxy(this,"__onQualificationInfoResponse"));}else{this.__onQualificationInfoResponse({isSFMProcess:true,isQualified:true});}},__onQualificationInfoResponse:function(m){var h=this.getEventBus(),n=null,l=this,f=this;var j=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();if(!m.isSFMProcess||!m.isQualified){l.__logger.error("Not qualified!");var i=j.getBasicDisplayTags();SVMX.getCurrentApplication().showMessage({type:"CUSTOM",title:" ",text:m.errorMessage,buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}],handler:SVMX.proxy(this,function(){this.handleInplaceBackwardNavigation();
})});if(this.onLoadFailed){this.onLoadFailed.handler.apply(this.onLoadFailed.context);}this.unblockApplication();}else{var k=SVMX.getClient().getProgressMonitor();var g=SVMX.create("com.servicemax.client.lib.core.MiniSplash",k);k.start({params:{stepTitle:"Loading SFM Delivery Engine..."}});if(!l.processId&&l.additionalInfo.sfwActionType!=="CHECKLIST"){k.finish();n=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",l,{request:{deliveryEngine:f,message:"Process Id is missing!"},responder:{}});h.triggerEvent(n);}else{n=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_USERINFO",l,{request:{},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.GetUserInfoResponder",l)});h.triggerEvent(n);k.finishStep({stepTitle:"Retrieving user information..."});}}},closeProcess:function(){var g=this.getEventBus();if(g&&this.getRootContainerId()){var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CLOSE_PROCESS",this,{request:{requesterId:this.getRootContainerId()}});g.triggerEvent(f);}},__cleanUp:function(){this.closeProcess();if(this.__root){this.__root.destroy();delete this.__root;}if(this.__page){this.__page.destroy();delete this.__page;}},destroy:function(){this.__cleanUp();delete this.record;var g=SVMX.getCurrentApplication();g.setApplicationStateHandler(null);g.setApplicationErrorHandler(null);g.setApplicationQuickMessageHandler(null);var f=this.getEventBus();if(f){delete f.eventHandlers;}a.DeliveryEngineImpl.removeEngine(this);SVMX.delayedDestroy(this);},doClose:function(){if(this.requestClose){this.requestClose.handler.apply(this.requestClose.context);}else{var f=this.returnUrl;if(f&&f!=""){if(f.indexOf("%2F")!=-1){f="/"+f.substring(3,f.length);}if(SVMX.navigateToCheckExternal){SVMX.navigateToCheckExternal(f,false);}else{SVMX.navigateTo(f);}}SVMX.doLater(function(){this.destroy();},this);}},onCanClose:function(f){if(!this.__root||this.getPageMetaData().isDisplayOnly){f(true);}else{this.__root.cancel(false,f);}},updateNavigationStack:function(g,f){if(g){this.__navigationStack.push(f);}else{return this.__navigationStack.pop();}},getNavigationStack:function(){return this.__navigationStack;},handleInplaceForwardNavigation:function(k){this.closeProcess();var j=null;if(this.getPageMetaData()&&this.getPageMetaData().getData()){j=this.getPageMetaData().getData().processTitle;}this.updateNavigationStack(true,{recordId:this.getSourceRecordId(),record:this.record,processId:this.processId,additionalInfo:this.additionalInfo,sfmProcessTitle:j});var i=k.recordId,l=k.record,f=k.processId;var p=k.additionalInfo||{};var g=this.__parentContainer;var m=this.onEngineReady,n=this.onEngineRendered;var h=this.onLoadFailed;var o={recordId:i,record:l,processId:f,returnUrl:this.returnUrl,nextStepId:"",container:g,onEngineReady:m,onEngineRendered:n,requestClose:this.requestClose,onLoadFailed:this.onLoadFailed,console:this.console,additionalInfo:p};this.__loadInternal(o);},handleInplaceBackwardNavigation:function(){this.closeProcess();var l=this.updateNavigationStack(false);if(!l){this.doClose();}else{var i=l.recordId,j=l.record,f=l.processId;var o=l.additionalInfo||{};var g=this.__parentContainer;var k=this.onEngineReady,m=this.onEngineRendered;var h=this.onLoadFailed;var n={recordId:i,record:j,processId:f,returnUrl:this.returnUrl,nextStepId:"",container:g,onEngineReady:k,onEngineRendered:m,onLoadFailed:h,requestClose:this.requestClose,console:this.console,additionalInfo:o};this.__loadInternal(n);}},navigateToViewprocess:function(j){this.closeProcess();var i=j.recordId;var k=j.record;var f=j.processId;var r=j.additionalInfo||{};var n=j.engine,g=n.getRootContainerId(),o=n.nextStepId;var l=n.returnUrl,m=n.onEngineReady,p=n.onEngineRendered,h=n.onLoadFailed;var q={recordId:i,record:k,processId:f,returnUrl:this.returnUrl,nextStepId:"",container:g,returnUrl:l,nextStepId:o,onEngineReady:m,onEngineRendered:p,onLoadFailed:h,requestClose:this.requestClose,console:this.console,additionalInfo:r};this.__loadInternal(q);},appDataHasBeenUpdated:function(f){if(f.engine==this){return;}if(this.getMetaModel().getProcessType()==="CHECKLIST LIST"){this.processPageData();return;}if(f.changedData){for(var g=0;g<f.changedData.length;g++){var h=f.changedData[g].Id;if(h==this.recordId){this.processPageData();}}}},run:function(n){this.__logger.debug("Finally running delivery engine!!!");var h=n.SVMX_recordId||SVMX.getUrlParameter("SVMX_recordId");var i=n.SVMX_record;var f=n.SVMX_processId||SVMX.getUrlParameter("SVMX_processId");var j=n.SVMX_retURL||SVMX.getUrlParameter("SVMX_retURL");var l=n.SVMX_NxtStepID||SVMX.getUrlParameter("SVMX_NxtStepID");var g=n.SVMX_action||SVMX.getUrlParameter("SVMX_action");g=(g!=="null")?g:null;f=(f!=="null")?f:null;h=(h!=="null")?h:null;var m=n.additionalInfo||{};if(!m.sfwActionType){m.sfwActionType=g;}if(!n.additionalInfo){m.targetId=SVMX.getUrlParameter("SVMX_targetId");m.status=SVMX.getUrlParameter("SVMX_status");m.sfProcessId=SVMX.getUrlParameter("SVMX_sfProcessId");
}var k=SVMX.getClient().getApplicationParameter("sfmconsole-runtime-mode")==="CONSOLE";if(!k&&!i&&!h&&"svmx_sfm_delivery_test_record" in window){h=window.svmx_sfm_delivery_test_record;}if(!k&&!f&&"svmx_sfm_delivery_test_process" in window){f=window.svmx_sfm_delivery_test_process;}var n={recordId:h,record:i,processId:f,returnUrl:j,nextStepId:l,sfwActionType:g,onEngineReady:n.onReady,onEngineRendered:n.onRendered,requestClose:n.requestClose,onLoadFailed:n.onLoadFailed,container:n.container,console:n.console,additionalInfo:m};this.__loadInternal(n);},onGetUserInfoCompleted:function(g){var l=this;var f=SVMX.getClient();var j=SVMX.create("com.servicemax.client.lib.api.Event","GLOBAL.HANDLE_USER_INFO",this,g);f.triggerEvent(j);var k=SVMX.getClient().getProgressMonitor();var i=this.getEventBus();var m=null;if(this.__page&&this.__page.__dataModel&&this.__page.__dataModel.__data&&this.__page.__dataModel.__data.__data&&this.__page.__dataModel.__data.__data.sfmData){m=this.__page.__dataModel.__data.__data.sfmData.sourceRecord;}var h=SVMX.create("com.servicemax.client.sfmconsole.utils.EventCollection",i,[SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_PAGELAYOUT",this,{request:{recordId:this.recordId,processId:this.processId,additionalInfo:this.additionalInfo,sourceRecord:m}}),SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_RECORD_ALREADY_OPEN",this,{request:{recordId:this.recordId,additionalInfo:this.additionalInfo}})]);if(this.getNavigationStack().length==0){h.addEvent(SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.RETRIEVE_SETTINGS",this,{request:{moduleId:"SFM002"}}));}k.finishStep({stepTitle:"Retrieving pagelayout and settings..."});k.start({params:{stepTitle:"Processing pagelayout and settings..."}});h.triggerAll(function(r){var n=r.items(),p=n.length,o,s;var t=null;for(o=0;o<p;o++){var q=n[o];if(q.type()==="SFMDELIVERY.GET_RECORD_ALREADY_OPEN"){s=q.response;}}for(o=0;o<p;o++){var q=n[o];if(q.type()=="SFMDELIVERY.GET_PAGELAYOUT"){this.__cleanUp();if(!SVMX.getClient().getApplicationParameter("svmx-sfm-delivery-disable-test-record-open")){if(s&&(q.response.response.sfmProcessType=="STANDALONE EDIT"||q.response.response.sfmProcessType=="SOURCE TO TARGET CHILD"||q.response.response.sfmProcessType=="CHECKLIST")){if(q.response.response.sfmProcessType=="CHECKLIST"){this.additionalInfo.specialProcessType="VIEW";}else{q.response.response.sfmProcessType="VIEW RECORD";}this.showMessage({type:"CUSTOM",text:e.T("FSA008_TAG123","Opening as view-only because this record is already opened for editing"),buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}],handler:function(){}});}}t=q.response.response.sfmProcessType;if(t&&(t==="CHECKLIST"||t==="CHECKLIST LIST")){this.__page=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMChecklistPageMetaModel",q.response,g,this);if(t==="CHECKLIST"){this.__page._sourceRecord=q.__event.data.request.sourceRecord;}if(q.__event.data.request.additionalInfo.targetId===undefined||q.__event.data.request.additionalInfo.targetId==null){this.__page.checklistStatus="Not Started";}}else{this.__page=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageMetaModel",q.response,g,this);}if(this.__page&&this.__page.getData()&&this.__page.getData().processTitle){this.__page.getData().processTitle=Ext.String.htmlEncode(this.__page.getData().processTitle);}this.__objectNameMap={header:q.response.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"]};SVMX.array.forEach(q.response.page.details,function(u){this.__objectNameMap[u.DetailLayout.Id]=u.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"];},this);this.__lookupDisplayFieldMap=q.response.lookupDisplayFieldMap;}else{if(q.type()=="SFMDELIVERY.RETRIEVE_SETTINGS"){this.__settings=SVMX.create("com.servicemax.client.sfmdelivery.engine.Settings",q.response);}}}this.__page.initialize(function(){k.finishStep({stepTitle:"Processing pagelayout and settings..."});k.start({params:{stepTitle:"Starting to layout..."}});if(this.__rootContainerId==null||this.__rootContainerId==undefined){this.__rootContainerId="svmx_sfm_delivery_root_container"+c++;}var u={id:this.__rootContainerId,deliveryEngine:this,consoleAppInstance:this.console};if(!this.__parentContainer){u.renderTo=SVMX.getDisplayRootId();}var v=null;if(t&&(t==="CHECKLIST"||t==="CHECKLIST LIST")){v=this.__view.createComponent("CHECKLISTROOTCONTAINER",u);}else{v=this.__view.createComponent("ROOTCONTAINER",u);}if(v){v.blockApplication();if(t!="VIEW RECORD"){v.compose(this.__page);}this.__root=v;}k.finish();this.processPageData();if(this.onEngineReady){this.onEngineReady.handler.apply(this.onEngineReady.context);}},this);},this);},getRootContainerId:function(){return this.__rootContainerId;},getObjectNameMap:function(){return this.__objectNameMap;},notifyDataChange:function(f){if(this.recordId===f.recordId){this.processPageData();}},processPageData:function(){var k=this;var f=this.getEventBus();var n=this.getMetaModel().getProcessType();var j=(n==="CHECKLIST LIST")?"SFMDELIVERY.GET_TEMPLATEDATA":"SFMDELIVERY.GET_PAGEDATA";
var l=true;if(n==="CHECKLIST"&&this.additionalInfo){this.checklistId=this.additionalInfo.targetId;if(this.additionalInfo.qualify===false){l=false;}}var i={recordId:this.recordId,targetId:this.checklistId,processId:this.processId,qualify:l,refreshData:false,objectNameMap:this.getObjectNameMap(),lookupDisplayFieldMap:this.__lookupDisplayFieldMap,layout:this.getMetaModel().getDeliveryEngine().__page.getData()};if(this.getNavigationStack().length>0){i.qualify=l;i.requesterId=this.getRootContainerId();}else{i.requesterId=this.getPageMetaData().isDisplayOnly?null:this.getRootContainerId();}var m=SVMX.create("com.servicemax.client.lib.api.Event",j,this,{request:i,responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.GetPageDataResponder",this)});f.triggerEvent(m);var g=this.record&&this.record.attributes&&this.record.attributes.type;var h=SVMX.OrgNamespace+"__Service_Order__c";if(g!==h||(g===h&&!SVMX.getClient().getApplicationParameter("InstallBase"))){if(this.__root){this.__root.run();}}},onGetPageDataCompleted:function(z){var y=this,p=true;if(this.getPageMetaData()&&this.getPageMetaData().isDisplayOnly){try{var m=SVMX.getClient().getApplicationParameter("enable-sla-clock");if(this.__root&&m&&z&&z.__data){var i=z.__data.pageDataSet.sobjectinfo.attributes.type;var r=this.__page.getObjectLabel(i);if(r=="Work Order"||r=="Case"){var f=SVMX.getClient().getDeclaration("com.servicemax.client.sfmdelivery.slaclock");if(f){var x=SVMX.getClient().getDefinitionsFor(f);if(x&&x.length>0){var l=x[0];var v=l.config["class-name"];this.slaclockobj=SVMX.create(v,{object_data:z,object_settings:this.__settings.__data,container:this.__root.__childrenCollection[0],objectType:r,user_info:this.__page.__userInfo,rootId:this.getRootContainerId()});}}}}}catch(u){this.__logger.error("Warning : SLA CLOCK NOT SUPPORTED",u);}}if(z.isQualified==false){this.unblockApplication();SVMX.getCurrentApplication().showMessage({type:"CUSTOM",title:" ",text:e.T("FSA008_TAG124","Record saved successfully, but does not meet the qualification criteria for this SFM transaction any longer. This transaction will now close."),buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}],handler:SVMX.proxy(this,function(B){this.handleInplaceBackwardNavigation();})});this.triggerViewLoadedEvent(p,false,this);return;}if(z&&z.getError()){if($.isEmptyObject(z.getError())==false){this.unblockApplication();SVMX.getCurrentApplication().showMessage({type:"CUSTOM",title:" ",text:z.getError(),buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}],handler:SVMX.proxy(this,function(B){this.doClose();})});this.triggerViewLoadedEvent(p,false,this);return;}}this.recordId=z.getValueFromPath("Id");delete this.record;var o,j=this.__page.getDataModel();if(this.__root&&this.getMetaModel().getProcessType()=="VIEW RECORD"&&!this.getTargetData().getData()){this.__clonedData=SVMX.cloneObject(z.__data.sfmData.getRawValues());this.getTargetData().setData(z,false);this.__root.compose(this.__page);p=true;}else{p=false;if(this.__root&&this.getMetaModel().getProcessType()=="VIEW RECORD"){this.__modifiedFields=this.getModifiedFields(this.__clonedData,z.__data.sfmData.getRawValues());this.__clonedData=SVMX.cloneObject(z.__data.sfmData.getRawValues());p=true;}this.getTargetData().setData(z,true,this.__modifiedFields,p);}if(this.__root&&this.__root.__sfwPanel&&this.__root.__sfwPanel.__sfw.doReload){this.__root.__sfwPanel.__sfw.reload();this.__root.__sfwPanel.__sfw.doReload=false;}var q=SVMX.create("com.servicemax.client.lib.api.Event","DATA_LOADED",this,this.__page.getDataModel());this.getEventBus().triggerEvent(q);this.__userTrunk=z.__data.svmxConstants&&SVMX.array.filter(z.__data.svmxConstants,function(B){return B.key==="SVMX.USERTRUNK";})[0];if(this.__userTrunk){this.__userTrunk=this.__userTrunk.value;}if(com.servicemax.client.automation){var w=new com.servicemax.client.automation.automationclient.impl.AutomationClient({root:this.__root});w.run({tsPath:SVMX.getUrlParameter("svmx-testcase")||""});}var h=this.__page.getHeaderMetaModel().getPageEventInfoFor("On Load");if(h){this.blockApplication();var g=this.getEventBus(),q;q=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.INVOKE_EVENTS",this,{request:{events:[h],data:this.getTargetData().getData(),metadata:this.getPageMetaData().getRawPageMetaData(),deliveryEngine:this,additionalInfo:{sfmProcessId:this.processId,nextStepId:this.nextStepId}},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.InvokeEventsResponder",this)});g.triggerEvent(q);}var i=z.__data.pageDataSet.sobjectinfo.attributes.type;var n=this.__page.getObjectLabel(i);if(this.onEngineRendered){var A=z.__data.pageDataSet.sobjectinfo.getNameValue?z.__data.pageDataSet.sobjectinfo.getNameValue()||"":"";if(this.__root.__sfwPanel){var k=this.__root.__sfwPanel.defaultTitle+": "+A;k=Ext.String.htmlEncode(k);this.__root.__sfwPanel.setTitle(k);}if(A){A=Ext.String.htmlEncode(A)+": &nbsp;&nbsp;";}this.onEngineRendered.handler.apply(this.onEngineRendered.context,[n,A+this.__page._data.processTitle]);
}this.updateConflictState();if(this.getRoot()){this.getRoot().onDataUpdated(this.getTargetData());var s=this.getTargetData().getData().getRawData().sfmData.attributes.type;var t=SVMX.OrgNamespace+"__Service_Order__c";if(s===t&&SVMX.getClient().getApplicationParameter("InstallBase")){if(this.__root){this.__root.run();}}SVMX.timer.job(this.getRoot().getId()+".unblockApplication",50,this,"unblockApplication");this.triggerViewLoadedEvent(p,true,this);}},getModifiedFields:function(i,h){var f=[];for(var g in h){if(h.hasOwnProperty(g)){if(h[g]!==i[g]){f.push(g);}}}return f;},triggerViewLoadedEvent:function(h,k,g){if(h&&this.__clientType&&this.__clientType.toLowerCase()==="laptop"){var i=SVMX.getCurrentApplication(),j=null;if(k){j=g.requestClose.context;}var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.VIEW_LOADED",g,j);i.triggerEvent(f);}},loadViewProcesses:function(h,g,j){if(this.getPageMetaData().isDisplayOnly){var i=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_VIEW_PROCESSES",this,{request:{record:h},responder:SVMX.proxy(this,"viewProcessesLoaded",g,j)});i.triggerEvent(f);}},viewProcessesLoaded:function(f,g,h){if(!g){h=SVMX.array.filter(h,function(i){return this.processId!=i.process_unique_id;},this);}else{h=SVMX.array.map(h,function(i){i.isCurrentView=this.processId===i.process_unique_id;return i;},this);}this.getPageMetaData().setAssociatedViewProcesses(h);if(this.getRoot()){this.getRoot().setAssociatedViewProcesses(this.getPageMetaData().associatedViewProcesses);}if(f){f(h);}},updateConflictState:function(){var g=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_RECORD_CONFLICTED",this,{request:{recordId:this.recordId},responder:SVMX.proxy(this,"setConflictState")});g.triggerEvent(f);},setConflictState:function(f){var g=Boolean(this.__isConflict);this.__isConflict=Boolean(f);if(this.getRoot()){this.getRoot().setConflictState(f);}if(f&&g!=this.__isConflict&&!this.getPageMetaData().isDisplayOnly){this.showMessage({type:SVMX.baseCSSPrefix+"sfmd-sync-conflict-medium-icon",text:e.T("FSA008_TAG125","This record has changed on the server.  Editing this record may result in errors"),buttons:[{text:e.T("FSA016_TAG003","OK"),itemId:"OK"}],handler:function(){}});}},onInvokeEventsComplete:function(){this.unblockApplication();},blockApplication:function(i){var h=i||{newState:"block"};var g=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CHANGE_APP_STATE",this,h);g.triggerEvent(f);},unblockApplication:function(i){var h=i||{newState:"unblock"};var g=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.CHANGE_APP_STATE",this,h);g.triggerEvent(f);},getTargetData:function(){return this.__page.getDataModel();},getPageMetaData:function(){return this.__page;},getMetaModel:function(){return this.__page;},saveToModel:function(g){var f=this.__page.getDataModel().readBindings(g);return f;},resolveModel:function(){var f=this.__page.getDataModel().resolveBindings();return f;},getSettings:function(){return this.__settings;},getRoot:function(){return this.__root;},getUserTrunk:function(){if(this.__userTrunk===null||this.__userTrunk===undefined){return"";}return this.__userTrunk;},getSourceRecordId:function(){return this.__sourceRecordId;},getRecordId:function(){return this.recordId;},isFieldUpdatesEnabled:function(){var f=SVMX.getClient().getApplicationParameter("svmx-fieldvalue-updates-enable");if(f===false){return false;}return true;},refreshFromServer:function(g,i){var h=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.DOWNLOAD_RECORD_ON_DEMAND",this,{request:{data:{recordId:g.recordId,objectName:g.objectName},callback:i}});SVMX.getCurrentApplication().triggerEvent(f);},isRecordDownloadedOnDemand:function(){var h=$.Deferred();var i=this;var g=this.getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.IS_DOD_RECORD",this,{request:{recordId:this.recordId},responder:function(j){if(j&&j.length>0){h.resolve(true);}else{h.resolve(false);}}});g.triggerEvent(f);return h;}},{engines:[],addEngine:function(f){this.engines.push(f);},removeEngine:function(f){SVMX.array.remove(this.engines,f);}});a.Class("EngineUpdaterExtension",com.servicemax.client.lib.api.AbstractExtension,{perform:function(g,f){for(var h=0;h<a.DeliveryEngineImpl.engines.length;h++){var j=a.DeliveryEngineImpl.engines[h];j.appDataHasBeenUpdated(f);}var k=new $.Deferred();k.resolve();return k;}});a.Class("Settings",com.servicemax.client.lib.api.Object,{__data:null,__constructor:function(k){this.__data={};var j=k.stringMap,g,f=j.length,h;for(g=0;g<f;g++){h=j[g];this.__data[h.key]=h.value;}},getSetting:function(g,h){var f=this.__data[g];if(h&&f){if(h=="bool"){if(f.toLowerCase()=="true"){f=true;}else{f=false;}}}return f;}},{});a.Class("SFMPageModel",com.servicemax.client.lib.api.Object,{__allBindings:null,__allBindingsHash:null,__data:null,__detailsBindings:null,__logger:null,__parent:null,__constructor:function(f){this.__allBindings=[];
this.__allBindingsHash={};this.__detailsBindings={};this.__parent=f;this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-PAGE-MODEL");},destroy:function(){if(this.__data){this.__data.unbindContext(this);}SVMX.array.forEach(this.__allBindings,function(f){f.destroy();});SVMX.forEachProperty(this.__allBindingsHash,function(g,f){f.destroy();});SVMX.forEachProperty(this.__detailsBindings,function(g,f){f.destroy();});SVMX.delayedDestroy(this);},setData:function(h,i,g,f){this.__data=h;this.__parent.evaluateFieldUpdateRules();this.__data.bind("MODEL_UPDATED",function(){this.executeBinding();},this);this.__data.bind("DETAIL_RECORDS_ADDED",function(j){this.__onNewRecordsAdded(j.data);},this);this.__data.bind("DETAIL_RECORDS_DELETED",function(k){var l=k.data.bindingPath,j=k.data.lines;this.__detailsBindings[l].onRecordsDeleted(j);},this);if(i){if(f){this.executeBindingForViewWithDetails(g);}else{this.executeBinding();}}},__onNewRecordsAdded:function(n){var h=n.bindingPath,r=n.bindingPath.replace(/^details\./,""),t=n.newRecords.lines,p=n.onSuccess,o,m=t.length;for(o=0;o<m;o++){var q=t[o];t[o]=this.__restructureDetailLine(q,h);}var f=this.__parent.getDeliveryEngine();var g=f.getEventBus();var k=f.processId;var j=SVMX.array.get(this.__parent.getData().page.details,function(i){return i.dtlLayoutId==r;});var s=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_DETAIL_MAPPEDINFO",this,{request:{processId:k,alias:r},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.GetDetailMappedInfoResponder",this,t,n.bindingPath,p)});g.triggerEvent(s);},getModelRoot:function(){return this.__parent;},onGetDetailMappedInfoComplete:function(g,C,B,m){var r=this.__parent.getDetailMetaModel().getDetail(B);var z,x,A,w=C.length,o,u=g.mappedValues,y,s,D;var h=g.mappedLiterals.sort(function(j,i){return(j.value.match(/^SVMX.CURRENTRECORD\./))?1:-1;});var p=r.objectName;var n=this.getModelRoot().getRecordTypesFor(p);var v=r.getRoot().getUserInfo().DateFormat;var f=r.getRoot().getUserInfo().TimeFormat;var q=r.getRoot().objMetadataMap[p];var t=q.fields;SVMX.array.forEach(C,SVMX.proxy(this,function(E,k){var L,H,T;for(L=0;L<u.length;L++){var G,I;H=u[L];T=E[H.key];if(H.key=="RecordTypeId"){G=SVMX.array.get(n,function(i){return i.fixedName==H.value;});if(G){I=G.name;}}if(T){E[H.key]=H.value;var U=r.getFieldInfo(H.key);if(U&&U.datatype==="boolean"){var Q=E[H.key+"__key"];if(Q&&Q.value!=H.value){Q.key=H.value;}}if(H.key=="RecordTypeId"){E[H.key]=I;}}T=E[H.key+"__key"];if(T&&T.value!=H.value){T.value=H.value;if(H.key==="RecordTypeId"){if(G){T.value=G.name;T.key=G.recordTypeId;}else{T.key="";}}}}var M,S,J,N,P;for(var L=0;L<h.length;L++){N=h[L];var j=h[L].key,M=null,l=E[j];P=SVMX.array.filter(t,function(i){return i.name==j;})[0];if(P){M=P.type;}J=N.value;S=J;if(SVMX.array.indexOf(["Now","Today","Tomorrow","Yesterday"],N.value)!=-1){S=d.macroDrivenDatetime(N.value,"YYYY-MM-DD","HH:mm:ss");if(N.value!=="Now"&&M==="datetime"){S=d.convertToTimezone(S,undefined,true);}J=S;}else{if(SVMX.array.indexOf(["SVMX.NOW","SVMX.TODAY","SVMX.TOMORROW","SVMX.YESTERDAY"],N.value)!=-1){S=d.macroDrivenDatetime(N.value.replace(/SVMX\./,""),"YYYY-MM-DD","HH:mm:ss");if(N.value!=="SVMX.NOW"&&M==="datetime"){S=d.convertToTimezone(S,undefined,true);}J=S;}else{if(N.value.match(/SVMX\.CURRENTRECORDHEADER\./)){var F=N.value.match(/SVMX\.CURRENTRECORDHEADER\.(.*)/)[1];var K=r.getRoot();var R=K.getDataModel().__allBindingsHash;if(R[F]){J=R[F].__getter.call(R[F].__context);}else{J=K.getDeliveryEngine().getTargetData().getData().getRawValues()[F];}if(J&&typeof J==="object"&&"fieldapiname" in J&&"fieldvalue" in J){J=J.fieldvalue.value;}S=J;}else{if(N.value.match(/SVMX\.CURRENTRECORD\./)){var F=N.value.match(/SVMX\.CURRENTRECORD\.(.*)/)[1];if(E[F+"__key"]){J=E[F+"__key"].value;S=E[F+"__key"].key;}else{J=E[F];S=J;}}else{if(N.value.match(/SVMX\.USERTRUNK/)){if(!com.servicemax.client.offline){J=r.getRoot().getDeliveryEngine().getUserTrunk();S=J;}else{var O=com.servicemax.client.offline.sal.model.utils;J=O.SystemData.getUserInfo().UserTrunkDetail?O.SystemData.getUserInfo().UserTrunkDetail.Name:null;S=O.SystemData.getUserInfo().UserTrunkDetail?O.SystemData.getUserInfo().UserTrunkDetail.Id:null;}}else{if(N.value.match(/SVMX\.CURRENTUSERID/)){J=com.servicemax.client.offline.sal.model.utils.SystemData.getUserInfo().UserName;S=com.servicemax.client.offline.sal.model.utils.SystemData.getUserInfo().UserId;}}}}}}if(J===null||J===undefined){S=J="";}if(M==="date"&&J&&J.match(/\:/)){}else{if(M==="datetime"&&J&&!J.match(/\:/)){J=d.getFormattedDatetime(d.parseDate(J),d.getDefaultDatetimeFormat());}}if(typeof J==="object"&&"value" in J){E[N.key]=J.value;E[N.key+"__key"]={value:J.value,key:J.key};}else{if(typeof J==="object"&&"fieldvalue" in J){E[N.key]=J.fieldvalue.value;E[N.key+"__key"]={fieldvalue:{value:J.fieldvalue.value,key:J.fieldvalue.key}};}else{if(M=="reference"&&l){E[N.key]=l;}else{E[N.key]=J;if((N.key+"__key") in E){E[N.key+"__key"].key=S;E[N.key+"__key"].value=J;
}else{E[N.key+"__key"]={key:S,value:J};}}}}}}));this.__detailsBindings[B].onNewRecordsAdded({lines:C});m();},__restructureDetailLine:function(i,l){var f,h={},k=null,j;for(f in i){if(f=="attributes"||f=="attributes__key"){continue;}if(f=="__new"){h[f]=i[f];}else{var g=i[f];if(g&&typeof(g)=="object"){k=g.fieldvalue;if(k){h[f+"__key"]=k;j=this.__parent.getDetailMetaModel().getDetail(l).translate(g.fieldapiname,f=="RecordTypeId"&&k.key?k.key:k.value,k);h[f]=j;}}}}for(f in h){i[f]=h[f];}return i;},resolveBindings:function(){var h,f=this.__allBindings.length,g=[];for(h=0;h<f;h++){g.push(this.__allBindings[h].resolveBinding());}return g;},validateBindings:function(){var h,f=this.__allBindings.length,g=[];for(h=0;h<f;h++){g.push(this.__allBindings[h].validateBinding());}return g;},readBindings:function(m){var k=[],n=[],j,f,h={canContinue:true,validations:k,hasWarnings:false};var g=[];if(m){k=this.validateBindings();h.validations=k;f=k.length;for(j=0;j<f;j++){if(!k[j].isValid){n.push(k[j]);}else{if(k[j].additionalInfo){g.push(k[j]);}}}}h.errors=n;h.warnings=g;h.hasWarnings=g.length>0;if(n.length>0){h.canContinue=false;}else{f=this.__allBindings.length;for(j=0;j<f;j++){this.__allBindings[j].persistBinding();}}return h;},getData:function(){return this.__data;},getValueFromPath:function(g){var f=this.__data.getValueFromPath(g);if(f&&typeof(f)=="object"){if(g=="RecordTypeId"){f=f.fieldvalue.key;}else{f=f.fieldvalue.value;}}return f;},setValueToPath:function(g,f){if(f&&typeof(f)=="object"){f={fieldvalue:f};}this.__data.setValueToPath(g,f);},getReferenceValueFromPath:function(g){var f=this.__data.getValueFromPath(g);return f;},setReferenceValueToPath:function(g,f){this.__data.setValueToPath(g,f);},getDetailValueFromPath:function(m){var k=SVMX.toJSON(this.__data.getValueFromPath(m));k=SVMX.toObject(k)||{};var h,g=k.lines||[],f=g.length;for(h=0;h<f;h++){var j=g[h];g[h]=this.__restructureDetailLine(j,m);}return k;},setDetailValueToPath:function(i,g){var h=this.__data.getValueFromPath(i),f=this.updateRecords(h,g);this.__data.setValueToPath(i,f);},updateRecords:function(o,p){var k,j=p.lines.length,n=null,m=null;if(!o){o={lines:[]};}var g=SVMX.array.filter(o.lines,function(i){return !i.Id;});for(k=0;k<j;k++){n=p.lines[k];m=SVMX.array.get(o.lines,function(i){return i.Id&&i.Id==n.Id;});if(!m){m=g.shift();}for(var f in n){if(f.indexOf("__key",f.length-"__key".length)!==-1){continue;}if(f.indexOf("_")==0){continue;}var r=n[f];var h=n[f+"__key"];if(h!==undefined&&h!==""&&h!=null){r=h;}var q=null;if(f=="attributes"){q=r;}else{if(r&&typeof(r)=="object"){q={fieldapiname:f,fieldvalue:{key:r.key,value:r.value}};}else{q=r;}}if(m){m[f]=q;}}}return o;},executeBinding:function(){this.__logger.info("Executing data bindings...");var g,f=this.__allBindings.length;for(g=0;g<f;g++){this.__allBindings[g].executeBinding();}},executeBindingForViewWithDetails:function(k){var f=k.length,g,l=[];for(g=0;g<f;g++){var j=k[g];var h=SVMX.array.filter(this.__allBindings,function(i){return i.__path===j;});if(h.length>0){h[0].executeBinding();}}l=SVMX.array.filter(this.__allBindings,function(i){return i.__path.indexOf("details.")>=0;});f=l.length;for(g=0;g<f;g++){l[g].executeBinding();}},createBinding:function(h,j,f,g){var i=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelBinding",this,h,j,f,g);this.__allBindings[this.__allBindings.length]=i;this.__allBindingsHash[h]=i;return i;},createPicklistBinding:function(h,j,f,g){var i=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelPicklistBinding",this,h,j,f,g);this.__allBindings[this.__allBindings.length]=i;this.__allBindingsHash[h]=i;return i;},createReferenceBinding:function(h,j,f,g){var i=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelReferenceBinding",this,h,j,f,g);this.__allBindings[this.__allBindings.length]=i;this.__allBindingsHash[h]=i;return i;},createDetailBinding:function(h,j,f,g){var i=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailBinding",this,h,j,f,g);this.__allBindings[this.__allBindings.length]=i;this.__detailsBindings[h]=i;this.__allBindingsHash[h]=i;return i;},getRelatedBindingValue:function(g,f){}},{});a.Class("SFMChecklistPageModel",com.servicemax.client.sfmdelivery.engine.SFMPageModel,{__constructor:function(f){this.__base(f);},setData:function(h,m){var i={};if(h&&h.__data&&h.__data.pageDataSet){h.__data.pageDataSet.sobjectinfo=h.__data.pageDataSet.sobjectinfo||{};h.__data.sfmData=h.__data.sfmData||{};if(h.__data.pageDataSet.sobjectinfo&&h.__data.pageDataSet.sobjectinfo[SVMX.OrgNamespace+"__ChecklistJSON__c"]){try{i=SVMX.toObject(h.__data.pageDataSet.sobjectinfo[SVMX.OrgNamespace+"__ChecklistJSON__c"]);}catch(j){console.error("Unable to parse question answers for record: "+(h&&h._targetRecordId));}}else{if(h.__data.pageDataSet.sobjectinfo&&h.__data.pageDataSet.sobjectinfo.LIST_SECTION_FIELD_ID){h.__data.pageDataSet.sobjectinfo.LIST_SECTION_FIELD_ID.fieldvalue.value=this.__parseTemplateResults(h.__data.pageDataSet.sobjectinfo.LIST_SECTION_FIELD_ID.fieldvalue.value);
h.__data.sfmData.LIST_SECTION_FIELD_ID.fieldvalue.value=h.__data.pageDataSet.sobjectinfo.LIST_SECTION_FIELD_ID.fieldvalue.value;}else{if(h&&h._targetRecordId){console.warn("No checklist data for record: "+h._targetRecordId);}}}var l=this.getModelRoot();var o={};if(l&&l.getQuestionTypes){o=l.getQuestionTypes();}var k,g,f;for(k in i){g=i[k];f=o[k];if(g&&g.fieldvalue&&(f==="multi-select picklist"||f==="picklist")){g=g.fieldvalue.key||g;}h.__data.sfmData[k]=g;}}else{console.error("Missing data to set for record: "+(h&&h._targetRecordId));}var n=this.__parent.getProcessType();if(n.toUpperCase()==="CHECKLIST"){this.getDefaultValueFromQuestion();}this.__base(h,m);},getDefaultValueFromQuestion:function(){this.defaultValues={};var r=this.__parent.getDeliveryEngine().__page.getChildNode("header").getChildNode("sections");var j=r.length;for(var m=0;m<j;m++){var p=r[m];var i=p.getChildNode("fields");var l=i.length;for(var q=0;q<l;q++){var n=i[q];if(n.datatype.toUpperCase()==="QUESTION"){if(n.dynamicResponseField){var f=n.defaultDyamicValue;if(f){var o=f.value;if(n.questionType.toUpperCase()==="DATETIME"){if(f.ftype==="DATE"){o=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(o,null,true);}}else{if(n.questionType.toUpperCase()==="PICKLIST"||n.questionType.toUpperCase()==="RADIO BUTTON"){o=this.getValueFromPicklist(f);}}if(n.questionType.toUpperCase()==="DATETIME"||n.questionType.toUpperCase()==="DATE"){if(o&&typeof o!=="string"&&(o instanceof Date)){o=d.getFormattedDatetime(o,"DD-MM-YYYY HH:MM:SS");}}this.defaultValues[n.fieldName]=o;}}else{if(!n.isliteralUsedInDefaultValue){var k=n.defaultValueObject;if(k){if(n.questionType.toUpperCase()==="NUMBER"){if(k.listOfDefaultValues&&k.listOfDefaultValues.length>0){var h=this.isNumbericValue(k.listOfDefaultValues[0]);if(h){this.defaultValues[n.fieldName]=h;}}}else{if(n.questionType.toUpperCase()==="DATETIME"){if(k.listOfDefaultValues&&k.listOfDefaultValues.length>0){this.defaultValues[n.fieldName]=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(k.listOfDefaultValues[0],null,true);}}else{if(n.questionType.toUpperCase()==="MULTI-SELECT PICKLIST"||n.questionType.toUpperCase()==="CHECKBOX"){this.defaultValues[n.fieldName]=k.listOfDefaultValues;}else{if(k.listOfDefaultValues&&k.listOfDefaultValues.length>0){this.defaultValues[n.fieldName]=k.listOfDefaultValues.join();}}}}}}else{var k=n.defaultValueObject;if(k&&k.literalValue){var g=k.literalValue;if(g==="Tomorrow"||g==="Now"||g==="Today"||g==="Yesterday"){g=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime(g,"YYYY-MM-DD","HH:mm:ss");if(n.questionType.toUpperCase()==="DATETIME"){if(k.literalValue!=="Now"){this.defaultValues[n.fieldName]=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(g,null,true);}else{this.defaultValues[n.fieldName]=g;}}else{if(n.questionType.toUpperCase()==="DATE"){this.defaultValues[n.fieldName]=g;}}}}}}}}}return this.defaultValues;},getValueFromPicklist:function(h){var j="";if(h){var j=h.value;var i=h.picklistLabelValue;if(j&&i){var f=i.length;for(var g=0;g<f;g++){var k=i[g];if(k.value===j){j=k.key;break;}}}}return j;},isNumbericValue:function(g){var f;if(!isNaN(g)||(!isNaN(g)&&g.toString().indexOf(".")!=-1)){f=g;}return f;},getValueFromPath:function(g){var f=this.__data.getValueFromPath(g);if(f&&typeof(f)=="object"&&!(f instanceof Array)){if(g=="RecordTypeId"){f=f.fieldvalue.key;}else{f=f.fieldvalue.value;}}else{if("undefined"===typeof f){f=this.getDefaultValue(g);}}return f;},getAttachmentValueFromPath:function(g){var f=this.__data.__attachementData.getAttachmentValuefromPath(g);return f;},setAttachmentValueToPath:function(g,f){var f=this.__data.__attachementData.setAttachmentValueToPath(g,f);return f;},getDefaultValue:function(g){var f;if(this.defaultValues){f=this.defaultValues[g];}return f;},_processDateToUserTimezone:function(g){var f=this.__parent.getUserInfo().TimezoneOffset;return com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(g,f,false);},createAttachmentBinding:function(h,j,f,g){var i=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelAttachmentBinding",this,h,j,f,g);this.__allBindings[this.__allBindings.length]=i;this.__allBindingsHash[h]=i;return i;},__parseTemplateResults:function(j){j=j||[];var k,m,g,n,h,l=j.length;var f={},o=[];for(k=0;k<l;k++){m=j[k];g=(m.status!=="Qualified");n=(m.status==="Qualified");h=(m.status!=="In Process");if(f[m.processId]){f[m.processId].removeTemplate=g||f[m.processId].removeTemplate;f[m.processId].allowNew=(f[m.processId].allowNew===false)?false:h;f[m.processId].hasTemplate=(f[m.processId].hasTemplate===false)?n:true;}else{f[m.processId]={allowNew:h,removeTemplate:g,hasTemplate:n};}m.statusLabel="";switch(m.status){case"Qualified":m.statusLabel=e.T("FSA008_TAG116","Not Started");m.actionLabel=e.T("TODO","");m.internalLabel="";break;case"In Process":m.statusLabel=e.T("FSA008_TAG117","In Progress");m.actionLabel=e.T("TODO","");m.internalLabel="";
break;case"Completed":m.statusLabel=e.T("FSA008_TAG118","Completed");m.actionLabel=e.T("FSA008_TAG119","Start New");m.internalLabel="Start New";break;default:m.statusLabel=m.status;}}for(k=0;k<l;k++){m=j[k];if(m.status==="Qualified"){if(!f[m.processId].removeTemplate){m.allowNew=f[m.processId].allowNew&&f[m.processId].hasTemplate;o.push(m);}}else{m.allowNew=f[m.processId].allowNew&&f[m.processId].hasTemplate;if(!m.allowNew){m.actionLabel=e.T("TODO","");}o.push(m);}}o.sort(function(q,i){var u=(q.processName)?q.processName.toLowerCase():"";var s=(i.processName)?i.processName.toLowerCase():"";if(u<s){return -1;}if(u>s){return 1;}var v=(q.status==="In Process")?1:(q.status==="Qualified")?2:3;var p=(i.status==="In Process")?1:(i.status==="Qualified")?2:3;if(v<p){return -1;}if(v>p){return 1;}var t=(q.completionDate)?q.completionDate.toLowerCase():"";var r=(i.completionDate)?i.completionDate.toLowerCase():"";if(t<r){return -1;}if(t>r){return 1;}return 0;});return o;}},{});a.Class("SFMPageModelBinding",com.servicemax.client.lib.api.Object,{__path:null,__setter:null,__getter:null,__context:null,__parent:null,_logger:null,__validator:null,__resolver:null,__bizzRuleValidator:null,__constructor:function(h,i,j,f,g){this.__path=i;this.__setter=j;this.__getter=f;this.__context=g;this.__parent=h;this._logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-PAGE-MODEL-BINDING");},destroy:function(){SVMX.delayedDestroy(this);},toString:function(){return this.__base(this.__path);},setValidator:function(f){this.__validator=f;},setBizRuleValidator:function(f){this.__bizzRuleValidator=f;},setResolver:function(f){this.__resolver=f;},resolveBinding:function(){var f={isResolved:true};if(this.__resolver&&this.__resolver.handler){f=this.__resolver.handler.call(this.__resolver.context);}return f;},validateBinding:function(){var f={isValid:true};if(this.__validator&&this.__validator.handler){f=this.__validator.handler.call(this.__validator.context);}return f;},executeBinding:function(){var f=this.__parent.getValueFromPath(this.__path);this._logger.info("Executing (set)binding for => "+this.__path);this.__setter.call(this.__context,f);},getValue:function(){var f=this.__getter.call(this.__context);return f;},setValue:function(f){this.__setter.call(this.__context,f);},persistBinding:function(){var f=this.__getter.call(this.__context);this.__parent.setValueToPath(this.__path,f);},getRelatedBindingValue:function(l,f){var i="";if(this.__parent.__allBindingsHash[l]){i=this.__parent.__allBindingsHash[l].getValue();}var j=this.__parent.__allBindingsHash[l];if(j||this.__context.getCompositionMetamodel){var k=this.__context.getCompositionMetamodel?this.__context.getCompositionMetamodel():j.__context.compositionMetamodel;if(k.datatype=="datetime"){var h=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();var g=this.__parent.__parent.getUserInfo().TimezoneOffset;i=h.getFormattedDateTimeValue(i,g);}else{if(k.datatype=="date"){var h=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();i=h.getFormattedDateValue(i);}}}if(i&&typeof(i)=="object"){i=i.key;}return i;}},{});a.Class("SFMPageModelAttachmentBinding",com.servicemax.client.lib.api.Object,{__path:null,__setter:null,__getter:null,__context:null,__parent:null,_logger:null,__validator:null,__resolver:null,__bizzRuleValidator:null,__constructor:function(h,i,j,f,g){this.__path=i;this.__setter=j;this.__getter=f;this.__context=g;this.__parent=h;this._logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-PAGE-MODEL-BINDING");},executeBinding:function(){var f=this.__parent.getAttachmentValueFromPath(this.__path);this._logger.info("Executing (set)binding for => "+this.__path);this.__setter.call(this.__context,f);},persistBinding:function(){var f=this.__getter.call(this.__context);this.__parent.setAttachmentValueToPath(this.__path,f);},setValidator:function(f){},destroy:function(){SVMX.delayedDestroy(this);},validateBinding:function(){var f={isValid:true};if(this.__validator&&this.__validator.handler){f=this.__validator.handler.call(this.__validator.context);}return f;}},{});a.Class("SFMPageModelPicklistBinding",a.SFMPageModelBinding,{__constructor:function(h,i,j,f,g){this.__base(h,i,j,f,g);},executeBinding:function(){var f=this.__parent.getValueFromPath(this.__path);this._logger.info("Executing (set)binding for => "+this.__path);this.__context.forceSelection=false;this.__setter.call(this.__context,f);this.__context.forceSelection=true;}},{});a.Class("SFMPageModelReferenceBinding",a.SFMPageModelBinding,{__constructor:function(h,i,j,f,g){this.__base(h,i,j,f,g);},executeBinding:function(){var f=this.__parent.getReferenceValueFromPath(this.__path);this._logger.info("Executing (set) reference binding for => "+this.__path);if(f&&typeof(f)=="object"){f={key:f.fieldvalue.key,value:f.fieldvalue.value,isNameSyncData:f.fieldvalue.isNameSyncData,hasViewSFM:f.fieldvalue.hasViewSFM};this.__setter.call(this.__context,f);
}else{this.__setter.call(this.__context,f);}},getValue:function(){var f=this.__getter.call(this.__context);return f;},setValue:function(f,g){this.__setter.call(this.__context,f,g);},persistBinding:function(){var g=this.getValue(),f={fieldvalue:{key:null,value:null}};if(g&&typeof(g)=="object"){f.fieldvalue.key=g.key;f.fieldvalue.value=g.value;}this.__parent.setReferenceValueToPath(this.__path,f);}},{});a.Class("SFMPageModelDetailBinding",a.SFMPageModelBinding,{__path:null,__setter:null,__getter:null,__context:null,__parent:null,__constructor:function(h,i,j,f,g){this.__base(h,i,j,f,g);},executeBinding:function(){var f=this.__parent.getDetailValueFromPath(this.__path);this.__setter.call(this.__context,f);},getValue:function(){var f=this.__getter.call(this.__context);return f;},onNewRecordsAdded:function(f,g){this.__setter.call(this.__context,f,{type:"ADDED",onSuccess:g});},onRecordsDeleted:function(f){this.__setter.call(this.__context,f,{type:"DELETED"});},persistBinding:function(){var f=this.getValue();this.__parent.setDetailValueToPath(this.__path,f);}},{});a.Class("SFMPageLookupModel",com.servicemax.client.lib.api.Object,{__refMetaModel:null,__callback:null,__lookupData:null,__constructor:function(f){this.__refMetaModel=f;},destroy:function(){SVMX.delayedDestroy(this);},getResultFieldsInfo:function(){var g=[],k=this.__lookupData,j=null;var f=(k)?k.namesearchinfo.namedSearch[0].namedSearchDetails[0].fields:[];for(var h=0;h<f.length;h++){if(f[h][SVMX.OrgNamespace+"__Search_Object_Field_Type__c"]=="Result"&&f[h][SVMX.OrgNamespace+"__Field_Name__c"]!="Id"){j={fieldLabel:this.__refMetaModel.getFieldLabelFromRelatedObject(f[h][SVMX.OrgNamespace+"__Field_Name__c"]),fieldType:this.__refMetaModel.getFieldTypeFromRelatedObject(f[h][SVMX.OrgNamespace+"__Field_Name__c"]),fieldName:f[h][SVMX.OrgNamespace+"__Field_Name__c"],fieldSequence:f[h][SVMX.OrgNamespace+"__Sequence__c"]};g[g.length]=j;}}g=SVMX.sort(g,"fieldSequence");return g;},getReferenceMetaModel:function(){return this.__refMetaModel;},getResultData:function(){var p=this.__lookupData;var q=p&&p.data;var n;var t=(q)?q.length:0;var g=[];for(n=0;n<t;n++){var w=q[n].FieldMap;if(!w){continue;}var m,u=w.length;var v={};for(m=0;m<u;m++){var f=w[m];if(f.ftype=="Result"||f.ftype=="Reference"){v[f.key]=f.value===undefined?null:f.value;var s=this.__refMetaModel.getFieldTypeFromRelatedObject(f.key);if(s=="picklist"){var r,h;r=this.__refMetaModel.getPicklistValuesFromRelatedObject(f.key);h=r.length;for(var o=0;o<h;o++){if(r[o].value==f.value){v[f.key]=r[o].label;v[f.key+"__m"]=r[o].value;break;}}}}}g[g.length]=v;}return g;},getDefaultColumnName:function(){var h=this.__lookupData,f=h.namesearchinfo.namedSearch[0].namedSearchHdr,g=f[SVMX.OrgNamespace+"__Default_Lookup_Column__c"];if(!g){g=this.__refMetaModel.nameFieldName;}return g;},getNameColumnName:function(){return this.__refMetaModel.nameFieldName;},getLookupObjectName:function(){return this.__refMetaModel.objectName;},getNameColumnNameLabel:function(g,f){return this.__refMetaModel.getRoot().getLabel(g,f);},getLookupId:function(){var f=this.__refMetaModel.namedSearchId;if(!f){f=this.__refMetaModel.objectName;}return f;},invoke:function(h,o){var j={};this.__callback=o;j.KeyWord=h.keyword;j.callType=h.callType;j.filtersToQuery=h.filtersToQuery;j.formFillFields=this.__refMetaModel.getRoot().__fieldMappings.getFieldList(this.__refMetaModel.fieldMappingId);j.userTrunk=h.userTrunk;j.SearchOperator=h.searchOperator?h.searchOperator:"contains";j.priqChecked=h.priqChecked;j.searchOnlineRecord=h.searchOnlineRecord;var p=this.__refMetaModel.namedSearchId;if(p){j.LookupRecordId=p;j.ObjectName=this.__refMetaModel.objectName;}else{j.ObjectName=this.__refMetaModel.objectName;}if(h.bOverrideRelatedLookup===false){var k=this.__refMetaModel.lookupContext;if(k){var i;if(this.record){var l=this.record[k+"__key"],n=this.record[k];i=l===n?undefined:l;}else{i=this.__refMetaModel.lookupContextFieldInfo.getDataBinding().getValue();}var g=this.__refMetaModel.lookupContextFieldInfo.datatype;if(i&&typeof(i)=="object"){if(i.extendedEditExtra==true){i=(i.key===i.value&&g==="reference")?undefined:i.key;}else{if(this.__refMetaModel.lookupQueryField=="Name"){i=i.value;}else{i=i.key;}}}j.LookupContext=i;j.LookupQueryField=this.__refMetaModel.lookupQueryField;}}var f=this.__refMetaModel.getRoot().getDeliveryEngine().getEventBus();var m=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_LOOKUPCONFIG",this,{request:j,responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.GetLookupConfigResponder",this)});f.triggerEvent(m);},onGetLookupConfigComplete:function(f){this.__lookupData=f;this.__refMetaModel.getRoot().describeObject(this.__refMetaModel.objectName,{handler:function(){this.__callback.handler.call(this.__callback.context,f);delete this.__callback;},context:this});},onGetLookupConfigError:function(f){this.__callback.handler.call(this.__callback.context,f);}},{});a.Class("SFMPageMetaModel",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{title:null,objMetadataMap:null,__dataModel:null,__initializeCallback:null,__initializeCallbackContext:null,__logger:null,__userInfo:null,__deliveryEngine:null,__recordTypesMap:null,destroy:function(){if(this.__dataModel){this.__dataModel.destroy();
}SVMX.delayedDestroy(this);},__constructor:function(h,f,g){this.__logger=SVMX.getLoggingService().getLogger("SFMD-PAGE-META-MODEL");this.__base(h,null);this.__userInfo=f;this.__deliveryEngine=g;this.__recordTypesMap={};var i=this.getProcessType();this.isDisplayOnly=i==="VIEW RECORD"?true:false;this.__dataModel=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModel",this);this.__fieldMappings=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMFieldMappingModel",h);this.__fieldUpdateRuleValidator=SVMX.create("com.servicemax.client.sfmbizrules.impl.FieldUpdateRuleValidator");},__retrieveSortingFields:function(j){var h={};var g;var f=j.response.stringMap;for(g=0;g<f.length;g++){if(f[g].value1){h[f[g].key]=SVMX.toObject(f[g].value1);}}return h;},getSortingFields:function(f){if(this.__configSorting[f]){return this.__configSorting[f];}return null;},getDeliveryEngine:function(){return this.__deliveryEngine;},getDataModel:function(){return this.__dataModel;},getRawPageMetaData:function(){return this._data;},getUserInfo:function(){return this.__userInfo;},getObjectInfo:function(f){return this.objMetadataMap[f];},getObjectLabel:function(g){var f=this.getObjectInfo(g);return f.label;},getObjectNameField:function(h){var g=this.getObjectInfo(h);var f=SVMX.array.get(g.fields,function(i){return i.nameField;});return f.name;},getObjectPluralLabel:function(g){var f=this.getObjectInfo(g);return f.labelPlural;},getFieldInfo:function(j,h){function g(l){var k=null;if(l.fieldDetail){k=l.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];}else{if(l.name){k=l.name;}}return k;}var i=g(h),f=null;f=this.getFieldInfoFromName(j,i);return f;},getFieldInfoFromName:function(o,n){var m=this.objMetadataMap[o],f=m.fields,k,g=f.length,h=null;for(k=0;k<g;k++){var j=f[k];if(j.name==n){h=j;break;}}return h;},getFieldHelpText:function(i,h){var g=this.getFieldInfo(i,h),f=h.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];if(g!=null){f=g.inlineHelpText;}return f;},getPrecision:function(i,h){var g=this.getFieldInfo(i,h),f=0;if(g){f=g.precision;}return f;},getScale:function(i,h){var g=this.getFieldInfo(i,h),f=0;if(g){f=g.scale;}return f;},getFieldLabel:function(i,h){var g=this.getFieldInfo(i,h),f=h.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];if(g!=null){f=g.label;}return f;},isFieldAccessible:function(i,h){var g=this.getFieldInfo(i,h),f=false;if(g){f=g.accessible;}return f;},isFieldRequired:function(j,i){var f=true,g=this.getFieldInfo(j,i);if(g!=null){var h=g.nillable;f=!h;}return f;},isFieldReadOnly:function(j,h){var f=true,g=this.getFieldInfo(j,h);if(g!=null){var i=g.updateable;f=!i;}return f;},getControllingPicklist:function(i,h){var g=this.getFieldInfo(i,h),f=null;if(g&&g.dependentPicklist){f=g.controllerName;}return f;},getAllPicklists:function(k){var j=this.objMetadataMap[k].fields;var h,g=j.length,f=[];for(h=0;h<g;h++){if(j[h].dataType=="picklist"||j[h].dataType=="boolean"){f.push(j[h]);}}return f;},getPicklistValues:function(i,h){var g=this.getFieldInfo(i,h),f=[];if(g!=null){f=g.picklistValues;}return f;},getPicklistValuesFromFieldName:function(i,h){var g=this.getFieldInfoFromName(i,h),f=[];if(g){f=g.picklistValues;}return f;},getLabel:function(o,n){var m=this.getObjectInfo(o),f=m.fields,k,g=f.length,h=n;for(k=0;k<g;k++){var j=f[k];if(j.name==n){h=j.label;break;}}return h;},getFieldType:function(o,n){var m=this.getObjectInfo(o),f=m.fields,k,g=f.length,h=null;for(k=0;k<g;k++){var j=f[k];if(j.name==n){h=j.dataType;break;}}return h;},getFieldTypes:function(){var j={};var h,m,g,f,l;var k=this.objMetadataMap;for(m in k){j[m]={};f=k[m].fields;for(h=0;h<f.length;h++){l=f[h];j[m][l.name]=l.dataType||l.type;}}return j;},describeObject:function(j,i){var g=this.getObjectInfo(j);if(!g){var h=this.getDeliveryEngine().getEventBus();var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.DESCRIBE_OBJECT",this,{request:{objectName:j},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.DescribeObjectResponder",j,this,{callback:i})});h.triggerEvent(f);}else{i.handler.call(i.context);}},onDescribeObjectComplete:function(h,f,g){this.objMetadataMap[h]=f;g.callback.handler.call(g.callback.context);},initialize:function(q,h){this.__logger.info("initializing the meta model...");this.__initializeCallbackContext=h;this.__initializeCallback=q;var s=[this._data.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"]];var f=this._data.page.details,k,j=f.length;for(k=0;k<j;k++){var m=f[k];s[k+1]=m.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"];}this.objMetadataMap={};j=s.length;var p=[];var o=[];for(k=0;k<j;k++){if(o.indexOf(s[k])==-1){var r=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.DESCRIBE_OBJECT",this,{request:{objectName:s[k]}});p.push(r);o.push(s[k]);}}var g=this.getDeliveryEngine().getEventBus();var n=SVMX.create("com.servicemax.client.sfmconsole.utils.EventCollection",g,p);this.__logger.info("triggering request to describe objects");n.triggerAll(this.onDescribeObjectsComplete,this);
},onDescribeObjectsComplete:function(l){var k=l.items(),p=k.length,f;for(f=0;f<p;f++){var n=k[f],g=n.getEventObj().data.request.objectName;var j=n.response;var o=l.__context._data.response.sfmProcessType;if((o=="SOURCE TO TARGET ALL"||o=="SOURCE TO TARGET CHILD"||o=="STANDALONE CREATE")&&j.createable==true&&j.updateable==false){j.updateable=true;for(var m=0;m<j.fields.length;m++){var h=j.fields[m];if(h.createable&&!h.updateable){h.updateable=true;}}}this.objMetadataMap[g]=j;}this.__processRecordTypes(function(){this.title=SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")?"":window.svmx_sfm_delivery_process_title;if(!this.title){this.title="";}this._children.header=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageHeader",this._data.page.header,this);this._children.header.initialize();this.initializeDetails();},this);},__processRecordTypes:function(r,h){var k,j,p=[],f=this._data.page.details,n=null;p.push({objectName:this._data.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"]});j=f.length;for(k=0;k<j;k++){n=f[k];p.push({objectName:n.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"]});}if(p.length>0){var m=[],j=p.length;for(k=0;k<j;k++){var q=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.GET_RECORD_TYPES",this,{request:{objectName:p[k].objectName}});m[k]=q;}var g=this.getDeliveryEngine().getEventBus();var o=SVMX.create("com.servicemax.client.sfmconsole.utils.EventCollection",g,m);this.__logger.info("triggering request to get record types");o.triggerAll(function(w){var l=w.items(),u=l.length,t;for(t=0;t<u;t++){var v=l[t],x=v.getEventObj().data.request.objectName;var s=v.response;this.__recordTypesMap[x]=s;}r.call(h);},this);}else{r.call(h);}},getRecordTypesFor:function(f){return this.__recordTypesMap[f];},getCurrentRecordTypeInfo:function(m,k){var h=null,f=null,j,g;if(m){f=this.getRecordTypesFor(k);if(f){g=f.length;for(j=0;j<g;j++){if(f[j].recordTypeId==m){h=f[j];break;}}}}return h;},getProcessType:function(){return this._data.response.sfmProcessType;},getAssociatedViewProcesses:function(){return this._data.response.associatedViewProcesses;},setAssociatedViewProcesses:function(h){var g,f,i=[];if(h){f=h.length;}else{f=0;}for(g=0;g<f;g++){var j=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageAssociatedViewProcesses",h[g]);i.push(j);}this.associatedViewProcesses=i;},resolveDependencies:function(){for(var f in this._children){this._children[f].resolveDependencies();}},initializeDetails:function(){this._children.details=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetails",this._data.page.details,this);this._children.details.initialize(this.onDetailsInitalizeComplete,this);},onDetailsInitalizeComplete:function(){this.resolveDependencies();this.__initializeCallback.call(this.__initializeCallbackContext);},getHeaderMetaModel:function(){return this._children.header;},getDetailMetaModel:function(){return this._children.details;},getBusinessRules:function(){var g=this._data.page.businessRules||[],f=[];g.forEach(function(h){if((h.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]!=="Field Update Rule")&&(h.ruleInfo.bizRuleDetails.length>0&&h.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Expression_Type__c"]==="Business_Rule")){f.push(h);}});return f;},getBusinessRulesHash:function(){var g=this.getBusinessRules();var f=this.__commonMethodForBusinessRule(g);return f;},__commonMethodForBusinessRule:function(o){var k;var g=this.getData().page.details;var p={header:{key:"",rules:[]}};for(k=0;k<g.length;k++){var l=g[k];var j=l.DetailLayout[SVMX.OrgNamespace+"__Page_Layout_ID__c"];var h=l.DetailLayout[SVMX.OrgNamespace+"__Name__c"];var n=l.dtlLayoutId;p[j]={key:n,id:j,name:h,rules:[]};}for(k=0;k<o.length;k++){var f=o[k];var m=f.aliasName;if(p[m]){p[m].rules.push(f);}else{p.header.rules.push(f);}}return p;},getFieldUpdateRules:function(){var g=this._data.page.businessRules||[],f=[];g.forEach(function(h){if((h.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]==="Field Update Rule")||(h.ruleInfo.bizRuleDetails.length>0&&h.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Expression_Type__c"]==="Field_Update_Rule")){f.push(h);}});return f;},getFieldUpdateRulesHash:function(){var k;var q=this.getFieldUpdateRules();var h=this.getData().page.details;var m=this.getData().page.header;var l=m.headerLayout[SVMX.OrgNamespace+"__Page_Layout_ID__c"];var s={header:{id:l,key:m.hdrLayoutId,rules:[]}};for(k=0;k<h.length;k++){var n=h[k];var j=n.DetailLayout[SVMX.OrgNamespace+"__Page_Layout_ID__c"];var g=n.DetailLayout[SVMX.OrgNamespace+"__Name__c"];var p=n.dtlLayoutId;s[j]={key:p,id:j,name:g,rules:[]};}for(k=0;k<q.length;k++){var f=q[k];var o=f.aliasName;if(s[o]){s[o].rules.push(f);}else{s.header.rules.push(f);}}return s;},evaluateFieldUpdateRules:function(){if(!this.getDeliveryEngine().isFieldUpdatesEnabled()){return;}var k=this.getFieldTypes();var h=this.getDataModel().getData();var n=this.getFieldUpdateRulesHash();var m=h.getRawValues();var i=this.__fieldUpdateRuleValidator.evaluateFieldUpdateRules({rules:n,data:m,fields:k,pageModel:h});
var g=i.errors.length||(i.warnings.length);if(!g){var j=this.__fieldUpdateRuleValidator.getUpdatableFields(n);this.applyFieldUpdateResults(m,i.response,j,k);}else{var f=this.getDeliveryEngine().getEventBus();var l=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.FIELD_UPDATE_VALIDATION_ERROR",this,{request:{original:{request:{},responder:{}},deliveryEngine:this.getDeliveryEngine(),result:i,eventType:"onload"},responder:{}});return f.triggerEvent(l);}},applyFieldUpdateResults:function(i,n,j,k){var g,f,l,m,h=this.__fieldUpdateRuleValidator.getRawData(i,this.getDataModel().getData(),false);n=this.__fieldUpdateRuleValidator.parseResult(n,j,k);for(m in n){if(m!=="details"&&m in j){g=n[m];f=h[m];if(g!==f){l=i[m];if(l&&typeof l==="object"&&"fieldvalue" in l){l.fieldvalue.key=g;l.fieldvalue.value=g;}else{l=g;}i[m]=l;}}}if(!n.details||!i.details){return;}for(m in n.details){if(m in i.details){this.__applyChildFieldUpdateResults(i.details[m].lines||[],n.details[m].lines||[],j.details[m]||{},k);}}},__applyChildFieldUpdateResults:function(f,g,m,n){var k,h=f.length,j={},p={};for(k=0;k<h;k++){j[f[k].Id]=f[k];}h=g.length;for(k=0;k<h;k++){p[g[k].Id]=g[k];}for(var o in p){if(o in j){if(j[o].Id&&j[o].Id.indexOf("tempChildId_")>=0){j[o].Id=p[o].Id=undefined;}this.applyFieldUpdateResults(j[o],p[o],m,n);}}},getBindingHash:function(){return this.__dataModel.__allBindingsHash;},executeFieldMappings:function(o,l,j,f,q){var m=j||this.getBindingHash();var n,i,g,k;g=o;if(q){n=q;}else{while(!g.getFieldTypes){g=g._parent;}n=g.getFieldTypes();}var h=this.getRoot().getDataModel();k=o.getRoot().__fieldMappings;k.forEachField(o.fieldMappingId,function(s,r){var p=n[s];var t;if(r.value){t=r.value;switch(t){case"Tomorrow":case"Yesterday":case"Today":t=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime(t,"YYYY-MM-DD","HH:mm:ss");if(p=="datetime"){t=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(t,null,true);}break;case"Now":t=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime(t,"YYYY-MM-DD","HH:mm:ss");break;}}else{if(p==="reference"&&r.field+"__key" in l){t=l[r.field+"__key"];if(!t&&r.field2){t=l[r.field2+"__key"];}if(!t&&r.field3){t=l[r.field3+"__key"];}if(t&&typeof t=="object"){t={key:t.key,value:t.value};}}else{t=l[r.field+"__m"];if(!t){t=l[r.field];}if(!t&&r.field2){t=l[r.field2];}if(!t&&r.field3){t=l[r.field3];}}}var u=m[s];if(u){u.setValue(t);}else{if(f){f[s]=t;}else{h.setValueToPath(s,t);}}});},getRelatedBindingValue:function(n,m){var f=this._data.page.header.sections.length,j;for(j=0;j<f;j++){var h=this._data.page.header.sections[j].fields.length;for(var g=0;g<h;g++){this._data.page.header.sections[j].fields[g];}}this._data.getRelatedBindingValue(n,m);}},{});a.Class("SFMChecklistPageMetaModel",com.servicemax.client.sfmdelivery.engine.SFMPageMetaModel,{__constructor:function(h,f,g){this.__base(h,f,g);g=g||{};g.additionalInfo=g.additionalInfo||{};if(g.additionalInfo.specialProcessType==="VIEW"){this.isDisplayOnly=true;}this.__dataModel=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMChecklistPageModel",this);},initialize:function(i,h){this.__logger.info("initializing the meta model...");this.__initializeCallbackContext=h;this.__initializeCallback=i;this.objMetadataMap={};var j=this._data.page.header.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"];this.__buildDescribeObject(j);this.title=SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")?"":window.svmx_sfm_delivery_process_title;if(!this.title&&!SVMX.getClient().getApplicationParameter("svmx-sfm-hide-title-bar")){if(this._data&&this._data.page&&this._data.page.processTitle){this.title=this._data.page.processTitle;}}this.title=(this.title)?this.title:"";var g=this.getDeliveryEngine().getEventBus();if(this._sourceRecord&&this._sourceRecord.length>0&&this.objMetadataMap[j]["fields"]&&this.objMetadataMap[j]["fields"].length>0&&this.objMetadataMap[j]["fields"][0]["dataType"]==="question"&&this.checklistStatus==="Not Started"){var f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.EVALUATE_ENTRY_CRITERIA",this,{request:{data:this._sourceRecord,sourceRecordId:this.__deliveryEngine.getSourceRecordId(),metadata:this.__deliveryEngine.getPageMetaData().getRawPageMetaData(),deliveryEngine:this.__deliveryEngine,additionalInfo:{toModelOnly:false,eventType:"Checklist_Section_Entry_Criteria",}},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.ChecklistEntryResponder",this)});g.triggerEvent(f);}else{this.continueIntializing();}},continueIntializing:function(){this._children.header=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageHeader",this._data.page.header,this);this._children.header.initialize();this.__initializeCallback.call(this.__initializeCallbackContext);},onEntryCriteriaExecutionComplete:function(){var g=this;var f=this.__deliveryEngine.getPageMetaData().getRawPageMetaData();if(this.__isAnySectionSatisfyEntryCriteria(f.page.header.sections)){this.continueIntializing();
}else{var h=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("SFMDELIVERY");SVMX.getCurrentApplication().showMessage({type:"CUSTOM",title:" ",text:h.T("TAG116"),buttons:[{text:h.T("TAG0066"),itemId:"OK"}],handler:function(i){g.closeAndGoBack();}});}},__isAnySectionSatisfyEntryCriteria:function(l){var k=false;if(l){var i=l.length;for(var h=0;h<i;h++){var j=l[h];var f=j.sectionDetail;if(f){var g=f[SVMX.OrgNamespace+"__Entry_Criteria__c"]||false;if(!g){k=true;break;}}}}return k;},closeAndGoBack:function(){var f=this.getDeliveryEngine().getNavigationStack();if(f.length==0){this.__logger.info("Closing Checklist and going back");this.getDeliveryEngine().doClose();}else{this.getDeliveryEngine().handleInplaceBackwardNavigation();}},__getEntryCriteriaBusinessRule:function(j){j="Checklist_Section_Entry_Criteria";var i=this._data.page.businessRules||[],f=[];var k=this._data.page.header.sections||[],h=[],g={};k.forEach(function(m){if(m.sectionDetail&&m.sectionDetail[SVMX.OrgNamespace+"__ServiceMax_Processes__r"]){var l=m.sectionDetail[SVMX.OrgNamespace+"__ServiceMax_Processes__r"].records;l.forEach(function(n){if(n[SVMX.OrgNamespace+"__Rule_Type__c"]===j&&n[SVMX.OrgNamespace+"__Active__c"]===true){var p=n[SVMX.OrgNamespace+"__Process3__c"];h.push(p);if(g[p]===undefined){g[p]=[n[SVMX.OrgNamespace+"__SM_Section__c"]];}else{var o=g[p];o.push(n[SVMX.OrgNamespace+"__SM_Section__c"]);}}});}});i.forEach(function(n){if((n.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]===j)&&(n.ruleInfo.bizRuleDetails.length>0)&&(h.indexOf(n.ruleInfo.bizRule.Id)>-1)){var l=g[n.ruleInfo.bizRule.Id];var m=l.splice(0,1);n.ruleInfo.bizRule[SVMX.OrgNamespace+"__SM_Section__c"]=m[0];f.push(n);}});return f;},__getExitCriteriaBusinessRule:function(j){var m=j.additionalInfo.eventType;var f=j.sectionExitRules;var k=j.additionalInfo.skippedQuestions||[];var l=this._data.page.businessRules||[],g=[];var i=[],h={};f.forEach(function(n){if(n[SVMX.OrgNamespace+"__Rule_Type__c"]===m&&n[SVMX.OrgNamespace+"__Active__c"]===true){var p=n[SVMX.OrgNamespace+"__Process3__c"];i.push(p);var o={};o[SVMX.OrgNamespace+"__SM_Section__c"]=n[SVMX.OrgNamespace+"__SM_Section__c"];o[SVMX.OrgNamespace+"__SM_Target_Section__c"]=n[SVMX.OrgNamespace+"__SM_Target_Section__c"];o[SVMX.OrgNamespace+"__Sequence__c"]=n[SVMX.OrgNamespace+"__Sequence__c"];h[p]=o;}});l.forEach(function(o){if((o.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]===m)&&(o.ruleInfo.bizRuleDetails.length>0)&&(i.indexOf(o.ruleInfo.bizRule.Id)>-1)&&(k.indexOf(o.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Field_Name__c"])===-1)){var n=h[o.ruleInfo.bizRule.Id];o.ruleInfo.bizRule[SVMX.OrgNamespace+"__SM_Section__c"]=n[SVMX.OrgNamespace+"__SM_Section__c"];o.ruleInfo.bizRule[SVMX.OrgNamespace+"__SM_Target_Section__c"]=n[SVMX.OrgNamespace+"__SM_Target_Section__c"];o.ruleInfo.bizRule[SVMX.OrgNamespace+"__Sequence__c"]=n[SVMX.OrgNamespace+"__Sequence__c"];o.ruleInfo.bizRule[SVMX.OrgNamespace+"__Message_Type__c"]="Error";o.message=o.ruleInfo.bizRule.Id;g.push(o);}});return g;},removeChecklistSkippedQuestionRules:function(g){for(var i=g.length-1;i>=0;i--){var f=g[i];var h=f.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Field_Name__c"];if(this.__deliveryEngine.skippedQuestions.indexOf(h)>-1){g.splice(i,1);}}},getEntryExitCriteriaBusinessRuleHash:function(g){var h=null;if(g.additionalInfo.eventType==="Checklist_Section_Entry_Criteria"){h=this.__getEntryCriteriaBusinessRule(g.additionalInfo.eventType);}else{h=this.__getExitCriteriaBusinessRule(g);}var f=this.__commonMethodForBusinessRule(h);return f;},getBusinessRules:function(){var g=this._data.page.businessRules||[],f=[];g.forEach(function(h){if(((h.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]!=="Field Update Rule")&&(h.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]!=="Checklist_Section_Entry_Criteria")&&(h.ruleInfo.bizRule[SVMX.OrgNamespace+"__Rule_Type__c"]!=="Checklist_Section_Exit_Criteria"))&&(h.ruleInfo.bizRuleDetails.length>0&&h.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Expression_Type__c"]==="Business_Rule")){f.push(h);}});return f;},getBusinessRulesHash:function(){var g=this.getBusinessRules();this.removeChecklistSkippedQuestionRules(g);var f=this.__commonMethodForBusinessRule(g);return f;},__commonMethodForBusinessRule:function(o){var k;var g=this.getData().page.details;var p={header:{key:"",rules:[]}};for(k=0;k<g.length;k++){var l=g[k];var j=l.DetailLayout[SVMX.OrgNamespace+"__Page_Layout_ID__c"];var h=l.DetailLayout[SVMX.OrgNamespace+"__Name__c"];var n=l.dtlLayoutId;p[j]={key:n,id:j,name:h,rules:[]};}for(k=0;k<o.length;k++){var f=o[k];var m=f.aliasName;if(p[m]){p[m].rules.push(f);}else{p.header.rules.push(f);}}return p;},getFieldInfo:function(h,g){var f={};if(g&&g.fieldDetail&&g.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]){f=SVMX.toObject(g.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]);}else{f=g;}return f;},getFieldTypes:function(){var j={};var h,m,g,f,l;
var k=this.objMetadataMap;for(m in k){j[m]={};f=k[m].fields;for(h=0;h<f.length;h++){l=f[h];j[m][l.question.questionID]=l.dataType;}}return j;},getQuestionTypes:function(){var j={};var h,m,g,f,l;var k=this.objMetadataMap;for(m in k){f=k[m].fields;for(h=0;h<f.length;h++){l=f[h];j[l.question.questionID]=l.question.responseType.toLowerCase();}}return j;},getQuestionNames:function(){var j=[];var h,m,g,f,l;var k=this.objMetadataMap;for(m in k){f=k[m].fields;for(h=0;h<f.length;h++){l=f[h];j.push(l.question.questionID);}}return j;},getQuestionData:function(j){var f={};var k=this.getQuestionNames();var m=this.getQuestionTypes();var g;for(var h=0;h<k.length;h++){value=j[k[h]];var l=m[k[h]];if(value&&value.fieldvalue&&(l=="multi-select picklist"||l=="picklist"||l=="checkbox")){value=value.fieldvalue.key;}if(l=="number"&&value===0){value="0";}f[k[h]]=value||"";}return f;},removeQuestionData:function(g){var h=this.getQuestionNames();for(var f=0;f<h.length;f++){delete g[h[f]];}},getObjectLabel:function(g){var f=this.getObjectInfo(g);return f&&f.label||"Unknown";},getPicklistValues:function(i,h){var g=this.getFieldInfo(i,h),f=[];if(g!=null){f=g.questionResponses;if(f instanceof Array){f.sort(function(l,j){var m=l.sequence||0;var k=j.sequence||0;return m-k;});}}return f;},__buildDescribeObject:function(n){var o={activateable:false,childRelationships:[],fields:[],name:"Checklist__c",label:"Checklist",recordTypeInfos:[],recordTypeMapping:[]};var m,k,j,h,q,p;var g=SVMX.OrgNamespace+"__QuestionInfoJSON__c";if(this._data&&this._data.page&&this._data.page.header&&this._data.page.header.sections&&this._data.page.header.sections.length>0){k=this._data.page.header.sections.length;for(m=0;m<k;m++){q=this._data.page.header.sections[m];var r=q.sectionDetail;if(!r.hasOwnProperty(SVMX.OrgNamespace+"__Entry_Criteria__c")){q.sectionDetail[SVMX.OrgNamespace+"__Entry_Criteria__c"]=false;}if(q.fields&&q.fields.length>0){h=q.fields.length;for(j=0;j<h;j++){p=q.fields[j];if(p.fieldDetail&&p.fieldDetail[g]){var f=SVMX.toObject(p.fieldDetail[g]);f.dataType="question";o.fields.push(f);}}}else{console.warn("Checklist Page Layout Section '"+m+"' Missing Questions");}}}else{console.warn("Checklist Page Layout Missing Sections");}this.objMetadataMap[n]=o;}},{});a.Class("SFMFieldMappingModel",com.servicemax.client.lib.api.Object,{__mapping:null,__constructor:function(g){var f=this.__mapping={};if(g.page.lstObjectMapInfo){SVMX.array.forEach(g.page.lstObjectMapInfo,function(i){var h=f[i.mapId]={};SVMX.array.forEach(i.objectMap.fields,function(j){var k=j.fieldMapRecord[SVMX.OrgNamespace+"__Source_Field_Name__c"];if(k){h[j.fieldMapRecord[SVMX.OrgNamespace+"__Target_Field_Name__c"]]={field:j.fieldMapRecord[SVMX.OrgNamespace+"__Source_Field_Name__c"],field2:j.fieldMapRecord[SVMX.OrgNamespace+"__Preference_2__c"],field3:j.fieldMapRecord[SVMX.OrgNamespace+"__Preference_3__c"]};}else{h[j.fieldMapRecord[SVMX.OrgNamespace+"__Target_Field_Name__c"]]={value:j.fieldMapRecord[SVMX.OrgNamespace+"__Display_Value__c"]};}});});}},getFieldList:function(g){var f=[];var h=this.__mapping[g];if(h){SVMX.forEachProperty(h,function(i,j){if(j.field){f.push(j.field);}if(j.field2){f.push(j.field2);}if(j.field3){f.push(j.field3);}});}return f;},forEachField:function(g,f){if(!g){return;}var h=this.__mapping[g];if(h){SVMX.forEachProperty(h,f);}}},{});a.Class("SFMPageAssociatedViewProcesses",com.servicemax.client.lib.api.Object,{title:null,processId:null,__constructor:function(f){this.initialize(f);},initialize:function(f){this.title=f.process_name;this.processId=f.process_unique_id;}});a.Class("SFMPageHeader",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{objectName:null,actions:null,helpURL:"",hideQuickSave:false,hideSave:false,hideSaveAndNew:false,hideChatter:false,pageEvents:null,pageHelp:null,__recordTypeField:null,__currentRecordType:null,__controllingPicklistFields:null,__constructor:function(g,f){this.__base(g,f);this.pageEvents=[];this.__controllingPicklistFields=[];},destroy:function(){var g=this.getChildNode("sections");if(g){SVMX.array.forEach(g,function(h){h.destroy();});}var f=this.getChildNode("actions");if(f){SVMX.array.forEach(f,function(h){h.destroy();});}SVMX.destroy(this);},initialize:function(){var s=this._parent.getProcessType();var E=false;if(this.getRoot()&&this.getRoot().getDeliveryEngine()&&this.getRoot().getDeliveryEngine().additionalInfo&&this.getRoot().getDeliveryEngine().additionalInfo.specialProcessType==="VIEW"){E=true;}var g=(E||s=="VIEW RECORD"||s=="CHECKLIST LIST");this.isDisplayOnly=g;this.objectName=this._data.headerLayout[SVMX.OrgNamespace+"__Object_Name__c"];this.helpURL=this._data.headerLayout[SVMX.OrgNamespace+"__Help_URL__c"];this.hideQuickSave=g||this._data.headerLayout[SVMX.OrgNamespace+"__Hide_Quick_Save__c"]||(s!="STANDALONE EDIT"&&s!="CHECKLIST");this.hideSave=g||this._data.headerLayout[SVMX.OrgNamespace+"__Hide_Save__c"];this.hideSaveAndNew=(s!="STANDALONE CREATE");this.hideChatter=(s!="STANDALONE EDIT");this.pageHelp=this._data.headerLayout[SVMX.OrgNamespace+"__Page_Help__c"];
if(this.isDisplayOnly){this.associatedViewProcesses=this._parent.associatedViewProcesses;}var G=this._data.pageEvents,B,w=G.length,I,u;var o=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(B=0;B<w;B++){u=G[B][SVMX.OrgNamespace+"__Event_Type__c"];if(u=="Before Save/Update"||u=="Before Save/Insert"){u="Before Save";}else{if(u=="After Save/Update"||u=="After Save/Insert"){u="After Save";}}I=G[B][SVMX.OrgNamespace+"__Event_Call_Type__c"];if(!I){I="WEBSERVICE";G[B][SVMX.OrgNamespace+"__Event_Call_Type__c"]=I;}if(!o.isEventSupported(G[B])){continue;}this.pageEvents[this.pageEvents.length]={callType:I,target:G[B][SVMX.OrgNamespace+"__Target_Call__c"],eventType:u,eventId:G[B].Id,eventRawData:G[B]};}w=this._data.sections.length;var m=[];var p=SVMX.getClient().getApplicationParameter("enable-sla-clock");for(B=0;B<w;B++){if(p||this._data.sections[B].sectionDetail){var n=this._data.sections[B];var H=n.sectionDetail[SVMX.OrgNamespace+"__Entry_Criteria__c"]||false;if(!H){var t=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageSection",this._data.sections[B],this);t.initialize();if(t){m.push(t);}}}}this._children.sections=SVMX.sort(m,"sequence");var q=this.getRecordTypeField();if(!q&&this._children.sections.length>0){q=this.createHiddenRecordTypeField(this._children.sections[0]);this.registerRecordTypeField(q);}var A=this.getAllPageFields();var h=this._parent.getAllPicklists(this.objectName);var v=[],F,B,z,r;var w=h.length,y=A.length;for(B=0;B<w;B++){r=false;for(z=0;z<y;z++){if(h[B].name==A[z].fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"]){r=true;break;}}if(!r){v.push(h[B]);}}var x,D=v.length;for(x=0;x<D;x++){F=this.createHiddenControllingPicklistField(v[x]);this.registerControllingPicklistField(F);}var C=this._data.buttons,f;w=C.length;m=[];for(B=0;B<w;B++){if(o.isActionButtonVisible(C[B])){f=m[m.length]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageAction",C[B],this);f.initialize();}}this._children.actions=m;},getAllPageFields:function(){var m=this._children.sections,h,g=m.length,j,f=[];for(j=0;j<g;j++){for(h=0;h<m[j].getData().fields.length;h++){f.push(m[j].getData().fields[h]);}}return f;},getFieldTypes:function(){var g=this.getAllFields();var j={};for(var h=0;h<g.length;h++){var k=g[h];j[k.name]=k.type;}return j;},getAllFields:function(){var g=this.getRoot();var h=g.objMetadataMap[this.objectName];var f=h?h.fields:[];return f;},getPageEventInfoFor:function(j){var h,f=this.pageEvents.length,g=null;for(h=0;h<f;h++){if(this.pageEvents[h].eventType==j){g=this.pageEvents[h];break;}}return g;},getAttachmentsHidden:function(){if(!this._data||!this._data.headerLayout[SVMX.OrgNamespace+"__Enable_Attachments__c"]){return true;}var f=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();return !f.getAttachmentsEnabled();},getPrecision:function(f){return this._parent.getPrecision(this.objectName,f);},getScale:function(f){return this._parent.getScale(this.objectName,f);},getFieldLabel:function(f){return this._parent.getFieldLabel(this.objectName,f);},isFieldAccessible:function(f){return this._parent.isFieldAccessible(this.objectName,f);},isFieldRequired:function(f){return this._parent.isFieldRequired(this.objectName,f);},isFieldReadOnly:function(f){return this._parent.isFieldReadOnly(this.objectName,f);},getPicklistValues:function(f){return this._parent.getPicklistValues(this.objectName,f);},getControllingPicklist:function(f){return this._parent.getControllingPicklist(this.objectName,f);},resolveDependencies:function(){var h=this._children.sections,g,f=h.length;for(g=0;g<f;g++){h[g].resolveDependencies();}},getFieldMetaInfoFromName:function(f){return this._parent.getFieldInfoFromName(this.objectName,f);},getFieldInfoFromName:function(k){var j=this._children.sections,g=null,h,f=j.length;for(h=0;h<f;h++){g=j[h].getFieldInfo(k);if(g){break;}}return g;},getControllingPicklistFieldDataFromName:function(j){var g=this.getFieldInfoFromName(j);if(g){g=g.getFieldData();}if(!g){var h,f=this.__controllingPicklistFields.length;for(h=0;h<f;h++){if(this.__controllingPicklistFields[h].fieldName==j){g=this.__controllingPicklistFields[h].getFieldData();break;}}}return g;},getLookupContextFieldInfo:function(k){var j=this._children.sections,g=null,h,f=j.length;for(h=0;h<f;h++){g=j[h].getFieldInfo(k);if(g){break;}}return g;},getObjectName:function(){return this.objectName;},createHiddenRecordTypeField:function(f){if(this.__recordTypeField==null){this.__recordTypeField=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageRecordTypeField",null,f);this.__recordTypeField.initialize();}return this.__recordTypeField;},createHiddenControllingPicklistField:function(g){var h=g.name,f=this.getRoot();var g=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageHiddenPicklistField",g,f);g.initialize(h);return g;},registerRecordTypeField:function(f){if(this.__recordTypeField==null){this.__recordTypeField=f;
}},registerControllingPicklistField:function(f){return this.__controllingPicklistFields.push(f);},getRecordTypeField:function(){return this.__recordTypeField;},getControllingPicklistFields:function(){return this.__controllingPicklistFields;},setCurrentRecordType:function(f){this.__currentRecordType=f;},getCurrentRecordTypeInfo:function(){return this._parent.getCurrentRecordTypeInfo(this.__currentRecordType,this.objectName);}},{});a.Class("SFMPageSection",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{title:null,colCount:0,labelAlignment:"",labelStyle:"",sequence:0,__constructor:function(g,f){this.__base(g,f);},destroy:function(){var f=this.getChildNode("fields");if(f){SVMX.array.forEach(f,function(g){g.destroy();});}SVMX.destroy(this);},initialize:function(){this.title=this._data.sectionDetail[SVMX.OrgNamespace+"__Title__c"];this.colCount=this.__extractColumnCount();this.labelAlignment=SVMX.getClient().getApplicationParameter("svmx-sfm-section-label-align");this.labelStyle=SVMX.getClient().getApplicationParameter("svmx-sfm-section-label-style");this.sequence=this._data.sectionDetail[SVMX.OrgNamespace+"__Sequence__c"];var m,f=this._data.fields.length,j=[],h=null;for(m=0;m<f;m++){var k=this._data.fields[m];var n=k.fieldDetail[SVMX.OrgNamespace+"__DataType__c"];var g=k.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];var o=k.fieldDetail[SVMX.OrgNamespace+"__Detail_Type__c"];if(g==b.RECORD_TYPE_ID){h=j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageRecordTypeField",k,this);}else{if(n=="reference"&&o==="Question"){if(this.getRoot()&&this.getRoot().getDeliveryEngine()&&this.getRoot().getDeliveryEngine().additionalInfo&&this.getRoot().getDeliveryEngine().additionalInfo.specialProcessType==="VIEW"){k.fieldDetail[SVMX.OrgNamespace+"__Readonly__c"]=true;}j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageQuestionField",k,this);}else{if(n=="reference"&&o==="List"){j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageListField",k,this);}else{if(n=="reference"){j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageReferenceField",k,this);}else{if(n=="picklist"){j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPagePicklistField",k,this);}else{if(n=="multipicklist"){j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageMultiPicklistField",k,this);}else{if(n=="boolean"){j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageBooleanField",k,this);}else{j[m]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageField",k,this);}}}}}}}j[m].initialize();}this._children.fields=j;if(h!=null){this._parent.registerRecordTypeField(h);}},registerControllingPicklistField:function(f){return this._parent.registerControllingPicklistField(f);},__extractColumnCount:function(){var g=this._data.sectionDetail[SVMX.OrgNamespace+"__No_Of_Columns__c"]||1;var f=SVMX.getUrlParameter("column-count");if(f&&f!=""){try{f=parseInt(f);if(!isNaN(f)){g=f;}}catch(h){}}return g;},getRecordTypeField:function(){return this._parent.getRecordTypeField();},getControllingPicklistFields:function(){return this._parent.getControllingPicklistFields();},setCurrentRecordType:function(f){this._parent.setCurrentRecordType(f);},getCurrentRecordTypeInfo:function(){return this._parent.getCurrentRecordTypeInfo();},getFieldLabel:function(f){return this._parent.getFieldLabel(f);},getPrecision:function(f){return this._parent.getPrecision(f);},getScale:function(f){return this._parent.getScale(f);},getObjectName:function(){return this._parent.getObjectName();},isFieldAccessible:function(f){return this._parent.isFieldAccessible(f);},isFieldRequired:function(f){return this._parent.isFieldRequired(f);},isFieldReadOnly:function(f){return this._parent.isFieldReadOnly(f);},getPicklistValues:function(f){return this._parent.getPicklistValues(f);},resolveDependencies:function(){var f=this._children.fields,h,g=f.length;for(h=0;h<g;h++){f[h].resolveDependencies();}},getFieldInfoFromName:function(f){return this._parent.getFieldInfoFromName(f);},getFieldInfo:function(k){var f=this._children.fields,h=null,j,g=f.length;for(j=0;j<g;j++){if(f[j].fieldName==k){h=f[j];break;}}return h;},getLookupContextFieldInfo:function(f){return this._parent.getLookupContextFieldInfo(f);},getControllingPicklist:function(f){return this._parent.getControllingPicklist(f);},getFieldMetaInfoFromName:function(f){return this._parent.getFieldMetaInfoFromName(f);},getControllingPicklistFieldDataFromName:function(f){return this._parent.getControllingPicklistFieldDataFromName(f);},getData:function(){return this._data;},getRelatedBindingValue:function(g,f){this._parent.getRelatedBindingValue(g,f);}},{});a.Class("SFMPageField",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{fieldName:null,fieldLabel:null,datatype:null,readOnly:false,required:false,sequence:0,row:null,column:null,__dataBinding:null,fieldEvents:null,_logger:null,fieldWidth:0,charLength:0,__constructor:function(g,f){this.__base(g,f);this._logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-SFMPAGEFIELD");
},destroy:function(){SVMX.destroy(this);},initialize:function(){this.fieldLabel=this.getFieldLabel();this.datatype=this._data.fieldDetail[SVMX.OrgNamespace+"__DataType__c"];this.readOnly=this._isFieldReadOnly();this.required=this._isFieldRequired();this.fieldName=this._data.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];var j=this.getRoot().getFieldInfo(this._parent.getObjectName(),this._data);this.charLength=j?j.length:0;this.row=this._data.fieldDetail[SVMX.OrgNamespace+"__Display_Row__c"];this.column=this._data.fieldDetail[SVMX.OrgNamespace+"__Display_Column__c"];this.fieldWidth=this._data.fieldDetail[SVMX.OrgNamespace+"__Width__c"];this.fieldEvents=[];var g=this._data.fieldEvents,h,f=g.length;var k=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(h=0;h<f;h++){if(!k.isEventSupported(g[h])){continue;}this.fieldEvents[this.fieldEvents.length]={callType:g[h][SVMX.OrgNamespace+"__Event_Call_Type__c"],target:g[h][SVMX.OrgNamespace+"__Target_Call__c"],eventType:g[h][SVMX.OrgNamespace+"__Event_Type__c"],eventId:g[h].Id,eventRawData:g[h]};}this.sequence=this._data.fieldDetail[SVMX.OrgNamespace+"__Sequence__c"];this.precision=this.getPrecision();this.scale=this.getScale();},getEventInfoFor:function(j){var h,f=this.fieldEvents.length,g=null;for(h=0;h<f;h++){if(this.fieldEvents[h].eventType==j){g=this.fieldEvents[h];break;}}return g;},getFieldData:function(){return this._data;},getPrecision:function(){return this._parent.getPrecision(this._data);},getScale:function(){return this._parent.getScale(this._data);},getFieldLabel:function(){return this._parent.getFieldLabel(this._data);},isFieldAccessible:function(){return this._parent.isFieldAccessible(this._data);},_isFieldRequired:function(){if(this.datatype=="boolean"){return false;}var f=this._parent.isFieldRequired(this._data);if(f==false){f=this._data.fieldDetail[SVMX.OrgNamespace+"__Required__c"];}return f;},_isFieldReadOnly:function(){var f=this._parent.isFieldReadOnly(this._data);if(f==false){f=this._data.fieldDetail[SVMX.OrgNamespace+"__Readonly__c"];}return f;},getPicklistValues:function(){SVMX.getLoggingService().getLogger().warning("SFMPageField::getPicklistValues() is deprecated!");return SVMX.cloneObject(this._parent.getPicklistValues(this._data));},createBinding:function(h,f,g){this.__dataBinding=this.getRoot().getDataModel().createBinding(this.fieldName,h,f,g);return this.__dataBinding;},createAttachmentBinding:function(h,f,g){this.__dataBinding=this.getRoot().getDataModel().createAttachmentBinding(this.fieldName,h,f,g);return this.__dataBinding;},getDataBinding:function(){if(this.__dataBinding){return this.__dataBinding;}else{return this._parent.getDataBinding();}}},{});a.Class("SFMPagePicklistField",a.SFMPageField,{isDependentPickList:false,controllingPicklist:null,__constructor:function(g,f){this.__base(g,f);this.isDependentPickList=false;},initialize:function(){this.__base();this.controllingPicklist=this._parent.getControllingPicklist(this._data);if(this.controllingPicklist){this.isDependentPickList=true;}},registerControllingPicklistField:function(f){return this._parent.registerControllingPicklistField(f);},__getParentIndexFor:function(j){var k=this._parent.getFieldInfoFromName(this.controllingPicklist);var m=this._parent.getPicklistValues(k.getFieldData()),h,f=m.length,g=-1;for(h=0;h<f;h++){if(m[h].value===j){g=h;break;}}return g;},__getParentPicklistEntryFor:function(j){var k=this._parent.getControllingPicklistFieldDataFromName(this.controllingPicklist),g=null;if(k){var m=this._parent.getPicklistValues(k),h,f=m.length;for(h=0;h<f;h++){if(m[h].value===j){g=m[h];break;}}}return g;},getPicklistEntryLabelFor:function(j){var k=this.getPicklistValues({},true),h,f=k.length,g="";if(j!==undefined&&j!==null){for(h=0;h<f;h++){if(k[h].value==j){g=k[h].label;break;}}}return g;},getPicklistValues:function(m,f){var r=this._parent.getPicklistValues(this._data),u=r,p,h,o,n;if(this.isDependentPickList&&!f&&!this.isDisplayOnly){u=[];if(m){var t=this.__getParentPicklistEntryFor(m.value);if(t){var s=t.dependendPicklist;if(s){h=s.length;for(p=0;p<h;p++){if(s[p].fieldAPIName==this.fieldName){var y=s[p].value;if(y){y=y.split(";");var z=r.length;for(o=0,n=0;o<z;o++){if(y[n]==o){u.push(r[o]);n++;}}}break;}}}}}}var v=this._getCurrentRecordTypeInfo(m);if(v){var q=this._extractPicklistFromRecordTypeInfo(v);if(q&&q.length>0){var x=[],w=q.length;h=u.length;for(p=0;p<h;p++){for(o=0;o<w;o++){if(u[p].value==q[o].value){x.push(u[p]);break;}}}u=x;}}var g=e.T("FSA008_TAG065","--None--");u=SVMX.cloneObject(u);u.splice(0,0,{label:g,value:b.NO_VALUE});return u;},_getCurrentRecordTypeInfo:function(f){return this._parent.getCurrentRecordTypeInfo();},_extractPicklistFromRecordTypeInfo:function(g){if(!g.picklistsForRecordType){return[];}var r=null,q=g.picklistsForRecordType,o,h=q.length,t,n,m;for(o=0;o<h;o++){if(q[o].picklistName==this.fieldName){t=q[o].picklistValues;break;}}if(t){var p=this._parent.getPicklistValues(this._data);
var f=t[0].value;if(f){var s=f.split(";");var u=p.length;r=[];for(n=0,m=0;n<u;n++){if(s[m]==n){r.push(p[n]);m++;}}}}return r;},createBinding:function(h,f,g){this.__dataBinding=this.getRoot().getDataModel().createPicklistBinding(this.fieldName,h,f,g);return this.__dataBinding;},getControllerBinding:function(){var h,g,f=null;g=this._parent.getFieldMetaInfoFromName(this.controllingPicklist);h=this._parent.getControllingFieldInfo(this.controllingPicklist);if(h){f=h.getDataBinding();}return f;},getRecordTypeField:function(){return this._parent.getRecordTypeField();},getControllingPicklistFields:function(){if(this._parent.getControllingPicklistFields()!=undefined){return this._parent.getControllingPicklistFields();}},resolveDependencies:function(){var m,k;if(this.isDependentPickList){k=this._parent.getFieldMetaInfoFromName(this.controllingPicklist);m=this._parent.getFieldInfoFromName(this.controllingPicklist);if(m){m.bind("CHANGED",this._parentValueChanged,this);m.bind("AFTER_CHANGED",this._afterValueChanged,this);}else{var h=this.getControllingPicklistFields();var j,f=h.length;if(k&&k.name){for(j=0;j<f;j++){if(h[j]._data.name==k.name){h[j].bind("CHANGED",this._parentValueChanged,this);h[j].bind("AFTER_CHANGED",this._afterValueChanged,this);}}}this._logger.warning(this.fieldName+" is a dependent picklist but the controlling picklist is not modeled!");}}else{if(this.shouldParticipateInDependencyChain()){var g=this.getRecordTypeField();if(g){g.bind("CHANGED",this._parentValueChanged,this);g.bind("AFTER_CHANGED",this._afterValueChanged,this);}}}},_parentValueChanged:function(f){var g=SVMX.create("com.servicemax.client.lib.api.Event","PARENT_CHANGED",this,f.data);this.triggerEvent(g);},_afterValueChanged:function(f){var g=SVMX.create("com.servicemax.client.lib.api.Event","AFTER_CHANGED",this,f.data);this.triggerEvent(g);},shouldParticipateInDependencyChain:function(){return true;}},{});a.Class("SFMPageBooleanField",a.SFMPageField,{__constructor:function(g,f){this.__base(g,f);},resolveDependencies:function(){var f=this._parent.getRecordTypeField();if(f){f.bind("CHANGED",this._parentValueChanged,this);f.bind("AFTER_CHANGED",this._afterValueChanged,this);}},_parentValueChanged:function(f){var g=SVMX.create("com.servicemax.client.lib.api.Event","PARENT_CHANGED",this,f.data);this.triggerEvent(g);},_afterValueChanged:function(f){var g=SVMX.create("com.servicemax.client.lib.api.Event","AFTER_CHANGED",this,f.data);this.triggerEvent(g);}},{});a.Class("SFMPageMultiPicklistField",a.SFMPagePicklistField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();}},{});a.Class("SFMPageRecordTypeField",a.SFMPagePicklistField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){if(this._data==null){this.fieldName="RecordTypeId";this._initializeHiddenMode();}else{this.__base();}this.datatype="recordtype";this.fieldLabel=e.T("FSA008_TAG126","Record Type");},_initializeHiddenMode:function(){var f=null;this.__dataBinding=this.getRoot().getDataModel().createBinding(this.fieldName,function(h){f=h;var g=SVMX.create("com.servicemax.client.lib.api.Event","CHANGED",this,{value:f});this.triggerRecordTypeChanged(g);},function(){return f;},this);},getPicklistValues:function(o,n){var m=this._parent.getObjectName(),h=this.getRoot().getRecordTypesFor(m),k=e.T("FSA008_TAG065","--None--"),g=[{label:k,value:b.NO_VALUE}],j,f=h.length;for(j=0;j<f;j++){g.push({label:h[j].name,value:h[j].recordTypeId});}return g;},triggerRecordTypeChanged:function(f){var g=f.data.value;if(g===b.NO_VALUE){g=null;}this._parent.setCurrentRecordType(g);this.triggerEvent(f);},shouldParticipateInDependencyChain:function(){return false;}},{});a.Class("SFMPageHiddenPicklistField",a.SFMPagePicklistField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.fieldName=this._data.name;var f=null;this.__dataBinding=this.getRoot().getDataModel().createBinding(this.fieldName,function(h){if(typeof(h)=="boolean"){f=h.toString();}else{f=h;}var g=SVMX.create("com.servicemax.client.lib.api.Event","CHANGED",this,{value:f});this.triggerHiddenPicklistChanged(g);},function(){var g=f;if(this._data.dataType=="boolean"&&(f===undefined||f===null||f==="")){g=!!f;}return g;},this);},triggerHiddenPicklistChanged:function(f){this.triggerEvent(f);}},{});a.Class("SFMPageReferenceField",a.SFMPageField,{objectName:null,namedSearchId:null,bOverrideRelatedLookup:true,lookupContext:null,lookupQueryField:null,lookupContextFieldInfo:null,__lookupModel:null,enableRecentItems:false,nameFieldName:null,fieldMappingId:null,__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();this.objectName=this._data.fieldDetail[SVMX.OrgNamespace+"__Related_Object_Name__c"];this.namedSearchId=this._data.fieldDetail[SVMX.OrgNamespace+"__Named_Search__c"];this.bOverrideRelatedLookup=this._data.fieldDetail[SVMX.OrgNamespace+"__Override_Related_Lookup__c"];this.lookupQueryField=this._data.fieldDetail[SVMX.OrgNamespace+"__Lookup_Query_Field__c"];
this.lookupContext=this._data.fieldDetail[SVMX.OrgNamespace+"__Lookup_Context__c"];this.nameFieldName=this._data.fieldDetail[SVMX.OrgNamespace+"__Related_Object_Name_Field__c"];this.fieldMappingId=this._data.fieldDetail[SVMX.OrgNamespace+"__Field_Mapping__c"];this.autoResolveLookup=this.getRoot().getDeliveryEngine().getSettings().getSetting("SET001","bool");this.enableRecentItems=this.getRoot().getDeliveryEngine().getSettings().getSetting("SET003","bool");},createBinding:function(h,f,g){this.__dataBinding=this.getRoot().getDataModel().createReferenceBinding(this.fieldName,h,f,g);return this.__dataBinding;},resolveDependencies:function(){if(this.lookupContext){this.lookupContextFieldInfo=this._parent.getLookupContextFieldInfo(this.lookupContext);}},getLookupModel:function(f){if(this.__lookupModel==null){this.__lookupModel=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageLookupModel",this);}if(f){this.__lookupModel=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageLookupModel",this);}return this.__lookupModel;},getFieldLabelFromRelatedObject:function(f){return this.getRoot().getLabel(this.objectName,f);},getFieldTypeFromRelatedObject:function(f){return this.getRoot().getFieldType(this.objectName,f);},getRelatedObjectLabel:function(){return this.getRoot().getObjectLabel(this.objectName);},getRelatedObjectPluralLabel:function(){return this.getRoot().getObjectPluralLabel(this.objectName);},getPicklistValuesFromRelatedObject:function(f){return this.getRoot().getPicklistValuesFromFieldName(this.objectName,f);}},{});a.Class("SFMPageQuestionField",a.SFMPageField,{__fieldInfo:{},__constructor:function(g,f){this.__base(g,f);},initialize:function(){if(this._data.fieldDetail&&this._data.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]){this.__fieldInfo=SVMX.toObject(this._data.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]);}this.fieldLabel=this.getFieldLabel();this.datatype=this.__getDataType();this.readOnly=this._isFieldReadOnly();this.required=this._isFieldRequired();this.fieldName=this.__getFieldName();this.isDisplayOnly=this._isFieldReadOnly();this.defaultValueObject=this.__getDefaultValue();this.isliteralUsedInDefaultValue=this.isliteralUsedInDefaultValue();this.questionType=this.getQuestionDataType();this.dynamicResponseField=this.getDynamicResponseField();this.questionSFID=this.getQuestionId();this.questionName=this.getQuestionName();this.isDescriptionRequired=this.getDescriptionRequired();this.charLength=this.__fieldInfo&&this.__fieldInfo.question&&this.__fieldInfo.question.length?this.__fieldInfo.question.length:0;var k=this.getFieldObject(this.dynamicResponseField);if(k){this.defaultDyamicValue=k;}this.row=this._data.fieldDetail[SVMX.OrgNamespace+"__Sequence__c"];this.column=1;this.fieldWidth=this._data.fieldDetail[SVMX.OrgNamespace+"__Width__c"];this.fieldEvents=[];var g=this._data.fieldEvents,h,f=g.length;var j=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(h=0;h<f;h++){if(!j.isEventSupported(g[h])){continue;}this.fieldEvents[this.fieldEvents.length]={callType:g[h][SVMX.OrgNamespace+"__Event_Call_Type__c"],target:g[h][SVMX.OrgNamespace+"__Target_Call__c"],eventType:g[h][SVMX.OrgNamespace+"__Event_Type__c"],eventId:g[h].Id,eventRawData:g[h]};}this.sequence=this._data.fieldDetail[SVMX.OrgNamespace+"__Sequence__c"];this.precision=this.getPrecision();this.scale=this.getScale();},getFieldObject:function(k){var h=this._parent._parent._parent._sourceRecord;if(h){var j=h.length;var g;for(var f=0;f<j;f++){var i=h[f];if(i.key===k){g=i;break;}}}return g;},__getDataType:function(){var f="";if(this._data&&this._data.fieldDetail[SVMX.OrgNamespace+"__Detail_Type__c"]){f=this._data.fieldDetail[SVMX.OrgNamespace+"__Detail_Type__c"];f=f&&f.toLowerCase();}return f;},__getQuestionInfo:function(g){var f=null;if(g&&this.__fieldInfo&&this.__fieldInfo.question){f=this.__fieldInfo.question[g]||null;}return f;},__getFieldName:function(){return this.__getQuestionInfo("questionID");},_isFieldReadOnly:function(){var f=this._data.fieldDetail[SVMX.OrgNamespace+"__Readonly__c"];return f;},_isFieldRequired:function(){if(this.datatype=="boolean"){return false;}var f=this._data.fieldDetail[SVMX.OrgNamespace+"__Required__c"];return f;},getQuestionType:function(){var f=this.__getQuestionInfo("responseType");f=f&&f.toLowerCase();return f;},getFieldLabel:function(){return this.__getQuestionInfo("question");},getPrecision:function(){return this.__getQuestionInfo("precision")||0;},getScale:function(){return this.__getQuestionInfo("scale")||0;},getHelpURL:function(){var f=this.__getQuestionInfo("helpURL")||undefined;var h=/^((http|https):\/\/)/;var g=f!=undefined?f.toLowerCase():undefined;if(g&&g.length>0&&!h.test(g)){f="http://"+f;}return f;},isFieldRequired:function(){return this.required;},isFieldAccessible:function(){return this.__getQuestionInfo("active")||false;},__getDefaultValue:function(){var f;if(this.__fieldInfo.defaultChecklistRes&&this.__fieldInfo.defaultChecklistRes[SVMX.OrgNamespace+"__SM_Default_Response__c"]){f=SVMX.toObject(this.__fieldInfo.defaultChecklistRes[SVMX.OrgNamespace+"__SM_Default_Response__c"]);
}return f;},isliteralUsedInDefaultValue:function(){var f=false;if(this.__fieldInfo.defaultChecklistRes&&this.__fieldInfo.defaultChecklistRes[SVMX.OrgNamespace+"__SM_Is_literal_Used__c"]){f=this.__fieldInfo.defaultChecklistRes[SVMX.OrgNamespace+"__SM_Is_literal_Used__c"];}return f;},getQuestionDataType:function(){return this.__getQuestionInfo("responseType");},getDynamicResponseField:function(){var f;if(this._data.fieldDetail[SVMX.OrgNamespace+"__SM_Checklist_Source_Field_API_Name__c"]){f=this._data.fieldDetail[SVMX.OrgNamespace+"__SM_Checklist_Source_Field_API_Name__c"];}return f;},getQuestionId:function(){var f=this._data.fieldDetail[SVMX.OrgNamespace+"__Question__c"];return f;},getQuestionName:function(){var f=this._data.fieldDetail.Name;return f;},getDescriptionRequired:function(){var f=false;if(this.__fieldInfo.question){f=this.__fieldInfo.question.descriptionRequired;}return f;}},{});a.Class("SFMPageListField",a.SFMPageField,{__fieldInfo:{},__constructor:function(g,f){this.__base(g,f);},initialize:function(){if(this._data.fieldDetail&&this._data.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]){this.__fieldInfo=SVMX.toObject(this._data.fieldDetail[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]);}this.fieldLabel=this.getFieldLabel();this.datatype=this.__getDataType();this.readOnly=this._isFieldReadOnly();this.required=this._isFieldRequired();this.fieldName=this.__getFieldName();this.isDisplayOnly=this._isFieldReadOnly();this.charLength=0;this.row=this._data.fieldDetail[SVMX.OrgNamespace+"__Sequence__c"];this.column=1;this.fieldWidth=this._data.fieldDetail[SVMX.OrgNamespace+"__Width__c"];this.fieldEvents=[];var g=this._data.fieldEvents,h,f=g.length;var j=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(h=0;h<f;h++){if(!j.isEventSupported(g[h])){continue;}this.fieldEvents[this.fieldEvents.length]={callType:g[h][SVMX.OrgNamespace+"__Event_Call_Type__c"],target:g[h][SVMX.OrgNamespace+"__Target_Call__c"],eventType:g[h][SVMX.OrgNamespace+"__Event_Type__c"],eventId:g[h].Id,eventRawData:g[h]};}this.sequence=this._data.fieldDetail[SVMX.OrgNamespace+"__Sequence__c"];this.precision=this.getPrecision();this.scale=this.getScale();},__getDataType:function(){var f="list";return f;},__getFieldName:function(){return this._data.fieldDetail.Id||"";},_isFieldReadOnly:function(){var f=this._data.fieldDetail[SVMX.OrgNamespace+"__Readonly__c"];return f;},getFieldLabel:function(){return"";},getPrecision:function(){return 0;},getScale:function(){return 0;},isFieldAccessible:function(){return true;}},{});a.Class("SFMPageAction",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{title:null,events:null,destroy:function(){SVMX.destroy(this);},__constructor:function(g,f){this.__base(g,f);this.events=[];},initialize:function(){this.title=this._data.buttonDetail[SVMX.OrgNamespace+"__Title__c"];var g=this._data.buttonEvents,h,f=g.length;var j=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(h=0;h<f;h++){if(!j.isEventSupported(g[h])){continue;}this.events[this.events.length]={callType:g[h][SVMX.OrgNamespace+"__Event_Call_Type__c"],target:g[h][SVMX.OrgNamespace+"__Target_Call__c"],eventType:g[h][SVMX.OrgNamespace+"__Event_Type__c"],eventId:g[h].Id,eventRawData:g[h]};}}},{});a.Class("SFMPageDetails",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{__path:null,__constructor:function(g,f){this.__base(g,f);this.__path="details";},destroy:function(){var f=this.getChildNode("details");if(f){SVMX.array.forEach(f,function(g){g.destroy();});}SVMX.destroy(this);},initialize:function(k,j){var h,f=this._data.length,g=[];for(h=0;h<f;h++){g[h]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetail",this._data[h],this);g[h].initialize();}this._children.details=SVMX.sort(g,"sequence");f=this._children.details.length;for(h=0;h<f;h++){this._children.details[h].afterSort(h+1);}k.call(j);},getCurrentRecordTypeInfo:function(g,f){return this._parent.getCurrentRecordTypeInfo(g,f);},getFieldLabel:function(g,f){return this._parent.getFieldLabel(g,f);},getPrecision:function(g,f){return this._parent.getPrecision(g,f);},getScale:function(g,f){return this._parent.getScale(g,f);},isFieldAccessible:function(g,f){return this._parent.isFieldAccessible(g,f);},isFieldRequired:function(h,g){var f=this._parent.isFieldRequired(h,g);if(!f){f=g.fieldDetail[SVMX.OrgNamespace+"__Required__c"];}return f;},isFieldReadOnly:function(g,f){return this._parent.isFieldReadOnly(g,f);},getPicklistValues:function(g,f){return this._parent.getPicklistValues(g,f);},getControllingPicklist:function(g,f){return this._parent.getControllingPicklist(g,f);},getAllPicklists:function(k){var j=this._parent.objMetadataMap[k].fields;var h,g=j.length,f=[];for(h=0;h<g;h++){if(j[h].dataType=="picklist"||j[h].dataType=="boolean"){f.push(j[h]);}}return f;},getFieldMetaInfoFromName:function(g,f){return this._parent.getFieldInfoFromName(g,f);},resolveDependencies:function(){var h=this._children.details,g,f=h.length;
for(g=0;g<f;g++){h[g].resolveDependencies();}},getParent:function(){return this._parent;},getDetail:function(k){var j=this._children.details,h,f=j.length,g=null;for(h=0;h<f;h++){if(j[h].layoutId==k.split(".")[1]){g=j[h];break;}}return g;},getPath:function(){return this.__path;},getControllingPicklistFieldDataFromName:function(k,j){var g=this._parent.getFieldInfoFromName(k,j);if(!g){var h,f=this.__controllingPicklistFields.length;for(h=0;h<f;h++){if(this.__controllingPicklistFields[h].fieldName==j){g=this.__controllingPicklistFields[h].getFieldData();break;}}}return g;},getRelatedBindingValue:function(o,f,h){var n="";if(f=="CURRENTRECORD"){if(h&&h.valueHash){var j=h.valueHash[o+"__key"];if(j!=null&&j!=undefined&&j!=""&&typeof(j)=="object"){n=j.key;if(h.isDateTime){n=com.servicemax.client.lib.datetimeutils.DatetimeUtil.getFormattedDatetime(n);var l=h.userInfo.TimezoneOffset;var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();n=g.getFormattedDateTimeValue(n,l);}else{if(h.isDateOnly){var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();n=g.getFormattedDateValue(n);}}}else{n=h.valueHash[o];}}}else{n=this.getRoot().__dataModel.__allBindingsHash[o].getValue();var k=this.getRoot().__dataModel.__allBindingsHash[o];var i=k.__context;if(i!=null){var m=(i.getCompositionMetamodel&&i.getCompositionMetamodel())||i.compositionMetamodel;if(m.datatype=="datetime"){var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();var l=this.getRoot().getUserInfo().TimezoneOffset;n=g.getFormattedDateTimeValue(n,l);}else{if(m.datatype=="date"){var g=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();n=g.getFormattedDateValue(n);}}}if(n&&typeof(n)=="object"){n=n.key;}}return n;}},{});a.Class("SFMPageDetail",com.servicemax.client.sfmconsole.api.CompositionMetaModel,{__logger:null,title:"",sequence:0,allowNewLines:false,allowDeleteLines:false,actionOnZeroLines:"",objectName:"",layoutId:null,__dataBinding:null,__allColumnDataBindings:null,__allColumnDataBindingsHash:null,colCount:0,labelAlignment:null,events:null,labelStyle:null,__recordTypeField:null,multiAddSearchObject:null,multiAddSearchField:null,enableRecentItems:true,__controllingPicklistFields:[],__constructor:function(g,f){this.__base(g,f);this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-PAGE-DETAIL-MODEL");this.events=[];},destroy:function(){var f=this.getChildNode("fields");if(f){SVMX.array.forEach(f,function(g){g.destroy();});}SVMX.destroy(this);},initialize:function(){this.__allColumnDataBindings=[];this.__allColumnDataBindingsHash={};this.colCount=1;this.labelAlignment=SVMX.getClient().getApplicationParameter("svmx-sfm-section-label-align");this.labelStyle=SVMX.getClient().getApplicationParameter("svmx-sfm-section-label-style");this.title=this._data.DetailLayout[SVMX.OrgNamespace+"__Name__c"];this.sequence=this._data.DetailLayout[SVMX.OrgNamespace+"__Sequence__c"];this.allowNewLines=this._data.DetailLayout[SVMX.OrgNamespace+"__Allow_New_Lines__c"];this.allowDeleteLines=this._data.DetailLayout[SVMX.OrgNamespace+"__Allow_Delete_Lines__c"];this.actionOnZeroLines=this._data.DetailLayout[SVMX.OrgNamespace+"__Action_On_Zero_Lines__c"];this.objectName=this._data.DetailLayout[SVMX.OrgNamespace+"__Object_Name__c"];this.layoutId=this._data.DetailLayout.Id;this.multiAddSearchField=this._data.DetailLayout[SVMX.OrgNamespace+"__Multi_Add_Search_Field__c"];this.multiAddSearchObject=this._data.DetailLayout[SVMX.OrgNamespace+"__Multi_Add_Search_Object__c"];this.enableRecentItems=this.getRoot().getDeliveryEngine().getSettings().getSetting("SET003","bool");var w,g=this._data.linkedProcesses,B=[];if(g){len=g.length;}else{len=0;}for(w=0;w<len;w++){var o=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailLinkedProcess",g[w]);B.push(o);}this.linkedProcesses=SVMX.sort(B,"sequence");var y=this._data.events,A,u=y.length;var n=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.platformspecifics").getInstance();for(A=0;A<u;A++){if(!n.isEventSupported(y[A])){continue;}this.events[this.events.length]={callType:y[A][SVMX.OrgNamespace+"__Event_Call_Type__c"],target:y[A][SVMX.OrgNamespace+"__Target_Call__c"],eventType:y[A][SVMX.OrgNamespace+"__Event_Type__c"],eventId:y[A].Id,eventRawData:y[A]};}u=this._data.fields.length;var t=[];for(A=0;A<u;A++){var h=this._data.fields[A],r=h.fieldDetail[SVMX.OrgNamespace+"__DataType__c"],s=h.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];if(s==b.RECORD_TYPE_ID){this.__recordTypeField=t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailRecordTypeField",h,this);}else{if(r=="reference"){t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailReferenceField",h,this);}else{if(r=="picklist"){t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailPicklistField",h,this);
}else{if(r=="multipicklist"){t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailMultiPicklistField",h,this);}else{if(r=="datetime"||r=="date"){t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailDatetimeField",h,this);}else{t[A]=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailField",h,this);}}}}}t[A].initialize();}if(this.__recordTypeField==null){this.__recordTypeField=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailRecordTypeField",null,this);this.__recordTypeField.initialize();}var x=this.getAllDetailFields();var m=this._parent.getAllPicklists(this.objectName);var q=[],C,A,z,p;var u=m.length,v=x.length;for(A=0;A<u;A++){p=false;for(z=0;z<v;z++){if(m[A].name==x[z].fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"]){p=true;break;}}if(!p){q.push(m[A]);}}var w,f=q.length;for(w=0;w<f;w++){C=this.createHiddenControllingPicklistField(q[w]);this.registerControllingPicklistField(C);}this._children.fields=SVMX.sort(t,"sequence");},getAllFieldData:function(){return this._children.fields;},getAllDetailFields:function(){return this._data.fields;},getAllObjectFieldTypes:function(){var f={};SVMX.array.forEach(this.getRoot().getObjectInfo(this.objectName).fields,function(g){f[g.name]=g.type;},this);return f;},getFieldTypes:function(){var g=this.getAllDetailFields();var j={};for(var h=0;h<g.length;h++){var k=g[h];j[k.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"]]=k.fieldDetail[SVMX.OrgNamespace+"__DataType__c"];}return j;},getAllFieldTypes:function(){var h=this.getRoot().objMetadataMap[this.objectName];var f=h?h.fields:[];var g={};SVMX.array.forEach(f,function(i){g[i.name]=i.type;},this);return g;},registerControllingPicklistField:function(f){return this.__controllingPicklistFields.push(f);},getControllingPicklistFieldDataFromName:function(f){return this._parent.getControllingPicklistFieldDataFromName(this.objectName,f);},createHiddenControllingPicklistField:function(g){var h=g.name,f=this.getRoot();var g=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageDetailHiddenPicklistField",g,this);g.initialize(h);return g;},afterSort:function(f){this.sequence=this._data.DetailLayout[SVMX.OrgNamespace+"__Sequence__c"]=f;},getEventInfoFor:function(j){var h,f=this.events.length,g=null;for(h=0;h<f;h++){if(this.events[h].eventType==j){g=this.events[h];break;}}return g;},getRecordTypeField:function(){return this.__recordTypeField;},getControllingPicklistFields:function(){return this.__controllingPicklistFields;},getCurrentRecordTypeInfo:function(f){return this._parent.getCurrentRecordTypeInfo(f,this.objectName);},getObjectName:function(){return this.objectName;},getPrecision:function(f){return this._parent.getPrecision(this.objectName,f);},getScale:function(f){return this._parent.getScale(this.objectName,f);},getFieldLabel:function(f){return this._parent.getFieldLabel(this.objectName,f);},isFieldAccessible:function(f){return this._parent.isFieldAccessible(this.objectName,f);},isFieldRequired:function(f){return this._parent.isFieldRequired(this.objectName,f);},isFieldReadOnly:function(f){return this._parent.isFieldReadOnly(this.objectName,f);},getPicklistValues:function(f){return this._parent.getPicklistValues(this.objectName,f);},getControllingPicklist:function(f){return this._parent.getControllingPicklist(this.objectName,f);},getFieldMetaInfoFromName:function(f){return this._parent.getFieldMetaInfoFromName(this.objectName,f);},createBinding:function(h,f,g){this.__dataBinding=this.getRoot().getDataModel().createDetailBinding(this._parent.getPath()+"."+this.layoutId,h,f,g);return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;},resolveDependencies:function(){var f=this._children.fields,h,g=f.length;for(h=0;h<g;h++){f[h].resolveDependencies();}},getFieldInfo:function(k){var f=this._children.fields,h=null,j,g=f.length;for(j=0;j<g;j++){if(f[j].fieldName==k){h=f[j];break;}}return h;},getControllingFieldInfo:function(j){var h=this.getFieldInfo(j);if(!h){var g,f=this.__controllingPicklistFields.length;for(g=0;g<f;g++){if(j==this.__controllingPicklistFields[g].fieldName){h=this.__controllingPicklistFields[g];break;}}}return h;},getFieldInfoFromName:function(f){return this.getFieldInfo(f);},getControllingPicklistFieldDataFromName:function(f){return this._parent.getControllingPicklistFieldDataFromName(this.objectName,f);},getLookupContextFieldInfo:function(h,g){var f=null;if(g=="CURRENT_RECORD"){f=this.getFieldInfo(h);}else{if(g=="PARENT_RECORD"){f=this._parent.getParent().getHeaderMetaModel().getLookupContextFieldInfo(h);}else{f=this.getFieldInfo(h);SVMX.getLoggingService().getLogger("SFMPageDetail").warn("Unknown context source type, defaulting to current record! =>"+g);}}return f;},getBindingHash:function(){return this.__allColumnDataBindingsHash;},__addBinding:function(f,g){this.__allColumnDataBindings[this.__allColumnDataBindings.length]=g;this.__allColumnDataBindingsHash[f]=g;},createColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailFieldBinding",this,g);
this.__addBinding(g,f);return f;},createHiddenColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelHiddenFieldBinding",this,g);this.__addBinding(g,f);return f;},createPicklistColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailPicklistFieldBinding",this,g);this.__addBinding(g,f);return f;},createMultiPicklistColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailMultiPicklistFieldBinding",this,g);this.__addBinding(g,f);return f;},createRecordTypeColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailRecordTypeFieldBinding",this,g);this.__addBinding(g,f);return f;},createHiddenPicklistColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailHiddenPicklistFieldBinding",this,g);this.__addBinding(g,f);return f;},createReferenceColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailReferenceFieldBinding",this,g);this.__addBinding(g,f);return f;},createDatetimeColumnBinding:function(g){var f=SVMX.create("com.servicemax.client.sfmdelivery.engine.SFMPageModelDetailDatetimeFieldBinding",this,g);this.__addBinding(g,f);return f;},resetRowBindingContext:function(){this.__currentRowContext=null;var g,h=this.__allColumnDataBindings,f=h.length;for(g=0;g<f;g++){h[g].setContextInternal(null);}},setRowBindingContext:function(h){this.__currentRowContext=h;var g,j=this.__allColumnDataBindings,f=j.length;for(g=0;g<f;g++){j[g].setContextInternal(h);}},setExtendedEditRowBindingContext:function(f){this.__extendedEditData=SVMX.cloneObject(f.raw);this.setRowBindingContext(f);},executeBindings:function(){var g,h=this.__allColumnDataBindings,f=h.length;for(g=0;g<f;g++){h[g].executeBinding();}},persistBindings:function(){if(this.isDisplayOnly){return;}this.getRecordTypeField().getDataBinding().persistBinding();var g,h=this.__allColumnDataBindings,f=h.length;for(g=0;g<f;g++){h[g].persistBinding();}},extendedEditPersistBindings:function(){var i=this.__extendedEditData;var f=this.__currentRowContext;var h=SVMX.array.map(this.getAllDetailFields(),function(j){return j.fieldDetail[SVMX.OrgNamespace+"__Field_API_Name__c"];});var g=this.getAllObjectFieldTypes();SVMX.forEachProperty(i,function(k,j){if(SVMX.array.indexOf(h,k)==-1&&g[k]){if(i[k+"__key"]){f.raw[k+"__key"]=f.data[k+"__key"]=i[k+"__key"];f.set(k,j);}else{f.set(k,j);}}});this.persistBindings();},validateFields:function(){var f=[];SVMX.array.forEach(this.__allColumnDataBindings,function(h){if(h.__validator){var g=h.__validator.handler.call(h.__validator.context);if(!g.isValid){f.push(g);}}});return f;},translate:function(u,g,s){var f=this.getFieldInfoFromName(u),r=g,p,o,n,m;var h=SVMX.getClient().getApplicationParameter("svmx-sfm-disable-translate-dates");if(f&&f.fieldName==b.RECORD_TYPE_ID){var k=this.getCurrentRecordTypeInfo(g);if(k){r=k.name;s.value=r;}}else{if(f&&f.datatype=="picklist"){p=this.getPicklistValues(f.getFieldData()),m=p.length;for(o=0;o<m;o++){if(p[o].value==g){r=p[o].label;break;}}}else{if(f&&f.datatype=="multipicklist"&&g){g=g.split(";");r="";p=this.getPicklistValues(f.getFieldData()),m=p.length;var t=g.length,q=[];for(n=0;n<t;n++){for(o=0;o<m;o++){if(p[o].value==g[n]){q.push(p[o].label);}}}r=q.join(";");}else{if(f&&f.datatype=="date"&&g&&!h){s.key=g;s.value=g;}else{if(f&&f.datatype=="datetime"&&g&&!h){s.key=g;s.value=g;}else{if(f&&(f.datatype=="textarea"||f.datatype=="string")&&g){if(r){if(typeof r!=="string"){r=""+r+"";}r=r.split("<").join("&lt;");r=r.split(">").join("&gt;");r=r.split('"').join("&quot;");}}}}}}}return r;},executeFieldMappings:function(j,i){var f=this.getBindingHash();var h=this._parent;while(!h.executeFieldMappings){h=h._parent;}if(h.executeFieldMappings){var g=this.getAllObjectFieldTypes();h.executeFieldMappings(j,i,f,this.__extendedEditData,g);}},executeGridFieldMappings:function(n,j,h){if(!h){return;}var m=this.getAllFieldTypes();var k=this.getRoot().__fieldMappings;var i=h.data;var f=this.getRoot().getUserInfo().DateFormat;var g=this.getRoot().getUserInfo().TimeFormat;var l=com.servicemax.client.lib.datetimeutils.DatetimeUtil.isFormat24HourTime(g);k.forEachField(n.fieldMappingId,function(r,q){var o=m[r];var p;if(q.value){p=q.value;switch(p){case"Tomorrow":case"Yesterday":case"Today":p=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime(p,"YYYY-MM-DD","HH:mm:ss");if(o=="datetime"){p=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(p,null,true);}break;case"Now":p=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime(p,"YYYY-MM-DD","HH:mm:ss");break;}i[r+"__key"]={key:p,value:p};}else{if(o==="reference"&&q.field+"__key" in j){var s=j[q.field+"__key"];if(!s&&q.field2){s=j[q.field2+"__key"];}if(!s&&q.field3){s=j[q.field3+"__key"];}if(s){i[r+"__key"]={key:s.key,value:s.value};p=i[r+"__key"].value;}else{p=s;
}p=i[r+"__key"].value;}else{p=j[q.field+"__m"];if(!p){p=j[q.field];}if(!p&&q.field2){p=j[q.field2];}if(!p&&q.field3){p=j[q.field3];}i[r+"__key"]={key:p,value:p};}}h.set(r,p);});},getRelatedBindingValue:function(j,h,g){var i;if(h=="CURRENTRECORD"&&this.getFieldInfo(j)){var f=this.getFieldInfo(j).getRoot().getUserInfo();if(this.getFieldInfo(j).datatype=="datetime"){i={valueHash:g,isDateTime:true,userInfo:f,isDateOnly:false};}else{if(this.getFieldInfo(j).datatype=="date"){i={valueHash:g,isDateOnly:true,userInfo:f};}else{i={valueHash:g,isDateTime:false,isDateOnly:false};}}return this._parent.getRelatedBindingValue(j,h,i);}else{return this._parent.getRelatedBindingValue(j,h);}},addNew:function(i){var h=this.getRoot().getDeliveryEngine();var j=h.processId;this.__logger.info("Performing addNew()");h.blockApplication();var g=h.getEventBus(),f;f=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.ADD_RECORDS",this,{request:{processId:j,alias:this.layoutId,data:h.getTargetData().getData(),objectName:this.objectName},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.AddRecordsResponder",this,[],i)});g.triggerEvent(f);},addMultipleNew:function(h,p,o){var g=this.getRoot().getDeliveryEngine();var k=g.processId;this.__logger.info("Performing multiAdd()");g.blockApplication();var r=[],n,m=p.length,f=[];for(n=0;n<m;n++){r.push(p[n].key);f.push(p[n].value);}var j=g.getEventBus(),q;q=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.ADD_RECORDS",this,{request:{processId:k,alias:this.layoutId,multiAddFieldApiName:this.multiAddSearchField,multiAddFieldRecordIds:r,multiAddFieldRecordValues:f,data:g.getTargetData().getData(),objectName:this.objectName},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.AddRecordsResponder",this,o,h)});j.triggerEvent(q);},onAddRecordsComplete:function(m,n,h){var f=this.getRoot().getDeliveryEngine(),k=f.getEventBus(),s=null;if(n&&n.length){var j=this;while(!j.executeFieldMappings){j=j._parent;}var g=this.getFieldInfo(this.multiAddSearchField);var r=h.getStore();var o=r.getCount();for(var l=0;l<n.length;l++){var t=r.getAt(o-n.length+l);j.executeGridFieldMappings(g,n[l],t);}}var q=this.getEventInfoFor("After Add Record");this.__sfmdetail=h;this.__dataLength=m.length;if(SVMX.getClient().getApplicationParameter("svmx-sfm-disable-events")){q=null;}if(q){s=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.INVOKE_EVENTS",this,{request:{events:[q],data:f.getTargetData().getData(),metadata:f.getPageMetaData().getRawPageMetaData(),deliveryEngine:f,additionalInfo:{processId:f.processId,nextStepId:this.getRoot().getDeliveryEngine().nextStepId}},responder:SVMX.create("com.servicemax.client.sfmdelivery.responders.InvokeEventsResponder",this)});k.triggerEvent(s);}else{f.unblockApplication();h.onAddRecordsComplete(m.length,m);}},onInvokeEventsComplete:function(){var f=this.getRoot().getDeliveryEngine();f.unblockApplication();this.__sfmdetail.onAddRecordsComplete(this.__dataLength);this.__sfmdetail=null;this.__dataLength=null;}},{});a.Class("SFMPageDetailLinkedProcess",com.servicemax.client.lib.api.Object,{title:null,processId:null,sequence:null,__constructor:function(f){this.initialize(f);},initialize:function(f){this.title=f.title;this.processId=f.processId;this.sequence=f.sequence;}});a.Class("SFMPageDetailField",a.SFMPageField,{__constructor:function(g,f){this.__base(g,f);},destroy:function(){SVMX.destroy(this);},initialize:function(){this.__base();this.createDetailBinding(this.fieldName);},createBinding:function(h,f,g){this.__dataBinding.setter=h;this.__dataBinding.getter=f;this.__dataBinding.bindingContext=g;return this.__dataBinding;},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createColumnBinding(f);}return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;}},{});a.Class("SFMPageDetailPicklistField",a.SFMPagePicklistField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();this.createDetailBinding(this.fieldName);},createBinding:function(h,f,g){this.__dataBinding.setter=h;this.__dataBinding.getter=f;this.__dataBinding.bindingContext=g;return this.__dataBinding;},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createPicklistColumnBinding(f);this.__dataBinding.field=this;}return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;},_parentValueChanged:function(f){this.__base(f);var g=null;if(this.getDataBinding().getter){g=this.getDataBinding().getLocalValue();if(g){g=g.value;}}else{g=this.getDataBinding().getValue();}if(f.data.persistInDataModel){var h=this.getPicklistValues({value:f.data.value}),g=h[0].value;this.getDataBinding().persistBinding({key:g,value:g});}var f=SVMX.create("com.servicemax.client.lib.api.Event","CHANGED",this,{value:g,persistInDataModel:f.data.persistInDataModel,passOnInformation:f.data.passOnInformation});this.triggerEvent(f);},_getCurrentRecordTypeInfo:function(j){var h=null;
if(j&&j.passOnInformation&&j.passOnInformation.recordType){h=this._parent.getCurrentRecordTypeInfo(j.passOnInformation.recordType);}else{if(this.__dataBinding){var f=this.__dataBinding.getContext();if(f){var g=f.data[b.RECORD_TYPE_ID+"__key"]||f.data[b.RECORD_TYPE_ID];if(g){var i=null;if(typeof(g)=="string"){i=g;}else{i=g.key;}h=this._parent.getCurrentRecordTypeInfo(i);}}}}return h;},triggerEvent:function(g){if(!g.data.passOnInformation){var h=this.getRecordTypeField().getDataBinding();if(h&&h.setter){var h=this.getRecordTypeField().getDataBinding();if(h){var f=h.getLocalValue();if(f!==undefined){g.data.passOnInformation={recordType:f.key};}}}}this.__base(g);}},{});a.Class("SFMPageDetailMultiPicklistField",a.SFMPageDetailPicklistField,{__constructor:function(g,f){this.__base(g,f);},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createMultiPicklistColumnBinding(f);this.__dataBinding.field=this;}return this.__dataBinding;},getPicklistEntryLabelFor:function(o){var p=this.getPicklistValues({},true),m,h,g=p.length,k="";if(o!==undefined&&o!==null){var n=o.split(";"),f=n.length;for(m=0;m<g;m++){for(h=0;h<f;h++){if(p[m].value==n[h]){k=p[m].label+";"+k;}}}if(k.charAt(k.length-1)==";"){k=k.substring(0,k.length-1);}}return k;}},{});a.Class("SFMPageDetailRecordTypeField",a.SFMPageRecordTypeField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();if(this._data!=null){this.createDetailBinding(this.fieldName);}},_initializeHiddenMode:function(){this.__dataBinding=this._parent.createHiddenColumnBinding(this.fieldName);},createBinding:function(h,f,g){this.__dataBinding.setter=h;this.__dataBinding.getter=f;this.__dataBinding.bindingContext=g;return this.__dataBinding;},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createRecordTypeColumnBinding(f);this.__dataBinding.field=this;}return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;},triggerRecordTypeChanged:function(f){var g=f.data.value;if(g===b.NO_VALUE){g=null;}f.data.passOnInformation={recordType:g};this.triggerEvent(f);},_getCurrentRecordTypeInfo:function(f){return null;}},{});a.Class("SFMPageDetailHiddenPicklistField",a.SFMPageHiddenPicklistField,{__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.fieldName=this._data.name;this.__dataBinding=this._parent.createHiddenPicklistColumnBinding(this.fieldName);var f=null,g=this;this.__dataBinding.setter=function(i){if(typeof(i)=="boolean"){f=i.toString();}else{f=i;}var h=SVMX.create("com.servicemax.client.lib.api.Event","CHANGED",g,{value:f});g.triggerHiddenPicklistChanged(h);};this.__dataBinding.getter=function(){var h=f;if(g._data.dataType=="boolean"&&(f===undefined||f===null||f==="")){h=!!f;}return h;};}},{});a.Class("SFMPageDetailReferenceField",a.SFMPageReferenceField,{contextSource:null,__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();this.contextSource=this._data.fieldDetail[SVMX.OrgNamespace+"__Context_Source_Object__c"];this.createDetailBinding(this.fieldName);},createBinding:function(h,f,g){this.__dataBinding.setter=h;this.__dataBinding.getter=f;this.__dataBinding.bindingContext=g;return this.__dataBinding;},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createReferenceColumnBinding(f);}return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;},resolveDependencies:function(){if(this.lookupContext){this.lookupContextFieldInfo=this._parent.getLookupContextFieldInfo(this.lookupContext,this.contextSource);}}},{});a.Class("SFMPageDetailDatetimeField",a.SFMPageField,{contextSource:null,__constructor:function(g,f){this.__base(g,f);},initialize:function(){this.__base();this.createDetailBinding(this.fieldName);},createBinding:function(h,f,g){this.__dataBinding.setter=h;this.__dataBinding.getter=f;this.__dataBinding.bindingContext=g;return this.__dataBinding;},createDetailBinding:function(f){if(!this.__dataBinding){this.__dataBinding=this._parent.createDatetimeColumnBinding(f);}return this.__dataBinding;},getDataBinding:function(){return this.__dataBinding;}},{});a.Class("SFMPageModelDetailFieldBinding",com.servicemax.client.lib.api.Object,{_path:null,_parent:null,_context:null,setter:null,getter:null,bindingContext:null,__constructor:function(f,g){this._path=g;this._parent=f;},getValue:function(){var f=null;if(this.bindingContext!=null&&this.getter!=null){f=this.getter.call(this.bindingContext);}else{f=this.getValueFromContext();}return f;},getValueFromContext:function(){var g=null;if(this._context){g=this._context.data[this._path];if(this._context.data[this._path+"__key"]){g=this._context.data[this._path+"__key"];}if(g&&typeof(g)=="object"){if(g.hasOwnProperty("value")&&g.hasOwnProperty("key")){g=g.value;}else{function i(k){var j=null;if(k&&typeof(k)==="object"){if(k.hasOwnProperty("value")&&k.hasOwnProperty("key")){j=k.value;}else{for(var l in k){j=i(k[l]);if(j){break;
}}}}return j;}for(var h in g){var f=i(g[h]);if(f){g=f;break;}}}}}return g;},setValue:function(f,g){if(this.setter){this.setter.call(this.bindingContext,f,g);}},setValidator:function(f){this.__validator=f;},setBizRuleValidator:function(){},setResolver:function(f){},setContext:function(f){this._parent.setRowBindingContext(f);},resetContext:function(){this._parent.resetRowBindingContext();},setContextInternal:function(f){this._context=f;if(!f){this.setter=null;this.getter=null;this.bindingContext=null;}},executeBinding:function(){var f=this.getValueFromContext();if(this.setter){this.setter.call(this.bindingContext,f);}},getLocalValue:function(){return this.getter.call(this.bindingContext);},persistBinding:function(){if(this.getter){var g=this.getter.call(this.bindingContext);if(typeof(g)=="object"&&g!=null&&g!=undefined){this._context.data[this._path+"__key"]=g;this._context.set(this._path,g.value);}else{var h=this.bindingContext.getCompositionMetamodel?this.bindingContext.getCompositionMetamodel():this.bindingContext.compositionMetamodel;var f=com.servicemax.client.sfmdelivery.utils.SFMUtils.prepareDataForDisplay(g,h.datatype);this._context.data[this._path+"__key"]={key:g,value:g};this._context.set(this._path,f);}}},getContext:function(){return this._context;},getRelatedBindingValue:function(m,k){var j=null;var h=null;var i=null;var g=this.getContext();if(g){j=SVMX.cloneObject(this.getContext().data);if(k=="CURRENTRECORD"){var l=this._parent.__allColumnDataBindingsHash[m];if(l&&l.getter){j[m+"__key"]=l.getter.call(l.bindingContext);j[m]=j[m]&&typeof j[m]=="object"?j[m].key:j[m];}}}var f=this._parent.getRelatedBindingValue(m,k,j);if(this.getContext()){i=this.getContext().raw[m];}h=f;if(!f&&i){h=i;}return h;}},{});a.Class("SFMPageModelHiddenFieldBinding",a.SFMPageModelDetailFieldBinding,{__constructor:function(f,g){this.__base(f,g);this.setValidator({context:this,handler:function(){return{isValid:true};}});},persistBinding:function(){},executeBinding:function(){},setValue:function(f){},getValue:{},getLocalValue:function(){}},{});a.Class("SFMPageModelDetailPicklistFieldBinding",a.SFMPageModelDetailFieldBinding,{field:null,__constructor:function(f,g){this.__base(f,g);},getValue:function(){var f=this.__base();return f;},executeBinding:function(){var f=this.getValueFromContext();if(this.setter){if(this.bindingContext){this.bindingContext.forceSelection=false;}this.setter.call(this.bindingContext,f);if(this.bindingContext){this.bindingContext.forceSelection=true;}}},persistBinding:function(g){if(g===undefined){g=this.getter.call(this.bindingContext);}if(g===undefined||(this.field===undefined||this.field==null)){return;}var f="";if(g&&g.value){f=this.field.getPicklistEntryLabelFor(g.value);}this._context.data[this._path+"__key"]=g;this._context.set(this._path,f);}},{});a.Class("SFMPageModelDetailMultiPicklistFieldBinding",a.SFMPageModelDetailPicklistFieldBinding,{field:null,__constructor:function(f,g){this.__base(f,g);},persistBinding:function(g){if(g===undefined){g=this.getter.call(this.bindingContext);}if(g===undefined||(this.field===undefined||this.field==null)){return;}var f="";if(g&&g.value){f=g.value;}this._context.data[this._path+"__key"]=g;this._context.set(this._path,f);}},{});a.Class("SFMPageModelDetailRecordTypeFieldBinding",a.SFMPageModelDetailPicklistFieldBinding,{field:null,__constructor:function(f,g){this.__base(f,g);},getValueFromContext:function(){var f=null;if(this._context){f=this._context.data[this._path];if(this._context.data[this._path+"__key"]){f=this._context.data[this._path+"__key"];}if(f&&typeof(f)=="object"){f=f.key;}}return f;},persistBinding:function(f){if(f===undefined){f=this.getter.call(this.bindingContext);}if(f){this._context.data[this._path+"__key"]=f;this._context.set(this._path,f.value);}}},{});a.Class("SFMPageModelDetailHiddenPicklistFieldBinding",a.SFMPageModelDetailPicklistFieldBinding,{field:null,__constructor:function(f,g){this.__base(f,g);this.setValidator({context:this,handler:function(){return{isValid:true};}});},getValueFromContext:function(){var f=null;if(this._context&&this._context.data&&this._context.data[this._path]!==undefined){f=this._context.data[this._path];}else{if(this._context&&this._context.raw&&this._context.raw[this._path]!==undefined){f=this._context.raw[this._path];}}return f;},setContextInternal:function(f){this._context=f;if(!f){this.bindingContext=null;}}},{});a.Class("SFMPageModelDetailReferenceFieldBinding",a.SFMPageModelDetailFieldBinding,{__constructor:function(f,g){this.__base(f,g);},getValueFromContext:function(){if(this._context){return SVMX.cloneObject(this._context.data[this._path+"__key"]);}else{return null;}},executeBinding:function(){var f=this.getValueFromContext();this.setter.call(this.bindingContext,f);},persistBinding:function(){var f=this.getter.call(this.bindingContext);this._context.data[this._path+"__key"]=f;this._context.set(this._path,f.value);}},{});a.Class("SFMPageModelDetailDatetimeFieldBinding",a.SFMPageModelDetailFieldBinding,{__constructor:function(f,g){this.__base(f,g);
},persistBinding:function(){var f=this.getter.call(this.bindingContext);this._context.data[this._path+"__key"]={key:f,value:f};this._context.set(this._path,f);}},{});};})();