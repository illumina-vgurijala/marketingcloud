(function(){var a=SVMX.Package("com.servicemax.client.sfmdelivery.commands");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("FSA");a.Class("GetPageLayout",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(f,c){if(f&&f.additionalInfo&&f.additionalInfo.targetId){var g=null;var d=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if(d&&d===true){g=SVMX.create("com.servicemax.client.sfmdelivery.responders.GetExistingCheckListPageLayoutResponder",c);}else{g=g=SVMX.create("com.servicemax.client.sfmdelivery.responders.GetExistingCheckListPageLayoutResponderOffline",c);}var e={recordId:f.recordId,targetId:f.additionalInfo.targetId,processId:f.processId,qualify:false,refreshData:false};this._executeOperationAsync(e,g,{operationId:"SFMDELIVERY.GET_PAGEDATA"});}else{if(f&&!f.processId&&f.additionalInfo&&f.additionalInfo.sfwActionType==="CHECKLIST"){if(c){c.result(this._generateStaticChecklistSelection());}}else{this._executeOperationAsync(f,c,{operationId:"SFMDELIVERY.GET_PAGELAYOUT"});}}},_generateStaticChecklistSelection:function(){var h=b.T("FSA002_TAG002","Checklists");var f={response:{stringMap:[{value1:null,value:"CHECKLIST LIST",key:"PROCESSTYPE",fieldsToNull:null}],sfmProcessType:"CHECKLIST LIST"},page:{processTitle:h,header:{sourceRecordId:null,sections:[{sectionDetail:{attributes:{type:SVMX.OrgNamespace+"__Page_Layout_Detail__c",url:"/services/data/v33.0/sobjects/SVMXC__Page_Layout_Detail__c/"},Name:"LIST_SECTION",Id:""},fieldsToNull:null,fields:[{fieldsToNull:null,fieldEvents:[],fieldDetail:{attributes:{type:SVMX.OrgNamespace+"__Page_Layout_Detail__c",url:"/services/data/v33.0/sobjects/"+SVMX.OrgNamespace+"__Page_Layout_Detail__c/"},Name:"LIST_SECTION_FIELD",Id:"LIST_SECTION_FIELD_ID"},bubbleinfo:{response:{tagId:null,success:null,stringMap:[],StringLstMap:[],stringFieldMap:[],sobjectMap:[],resultIds:[],records:[],profileData:null,msgDetails:null,messageType:null,messages:[],message:null,MapStringMap:[],lstQuestionBank:[],lstFieldSetWithSorting:[],lstChecklistInfo:[],lstBizRuleInfo:[],logMsg:null,eventType:null,docTemplate:null},fieldvalue:{value1:null,value:null,key:null,fieldsToNull:null},fieldapiname:null,bubbleinfo:[]}}]}],pageEvents:[],headerLayout:{attributes:{type:SVMX.OrgNamespace+"__Page_Layout__c",url:"/services/data/v33.0/sobjects/"+SVMX.OrgNamespace+"__Page_Layout__c/xxxxxxxxxxxx"},OwnerId:"",Name:"9999999999",LastModifiedDate:"2015-03-18T11:18:46.000+0000",LastModifiedById:"",IsDeleted:false,Id:"xxx",CreatedDate:"2015-03-01T12:58:46.000+0000",CreatedById:""},hdrLayoutId:"xxx",hdrData:null,fieldsToNull:null,enableAttachment:false,buttons:[]},fieldsToNull:null,details:[],businessRules:[]},processTitle:h};var c={__Field_Mapping__c:null,__Show_In_iPad__c:false,__Width__c:null,__Section__r:null,__Show_In_Web__c:false,__Related_Object_Name_Field__c:null,__Context_Source_Object__c:null,__Title__c:"List",__IsStandard__c:false,__Sequence__c:1,__Section__c:null,__Page_Layout_Detail_Id__c:null,__Required__c:false,__Related_Object_Name__c:null,__Readonly__c:false,__Page_Layout__c:"",__Override_Related_Lookup__c:false,__Named_Search__c:null,__Named_Search__r:null,__Lookup_Query_Field__c:null,__Lookup_Context__c:null,__Field_API_Name__c:"Virtual_Field_1",__Display_Row__c:null,__Display_Column__c:null,__Detail_Type__c:"Section",__DataType__c:null,__No_Of_Columns__c:1,__Enable_Chatter__c:false,__Control_Type__c:"Standard",__Maximum_Value__c:null,__Minimum_Value__c:null,__Use_For_SLA_Clock__c:false,__Enable_Comments__c:false,__Expression__c:null,__Question__c:null,__QuestionInfoJSON__c:null};var e={__Field_Mapping__c:null,__Show_In_iPad__c:false,__Width__c:null,__Section__r:{attributes:{type:SVMX.OrgNamespace+"__Page_Layout_Detail__c",url:"/services/data/v33.0/sobjects/"+SVMX.OrgNamespace+"__Page_Layout_Detail__c/"}},__Show_In_Web__c:false,__Related_Object_Name_Field__c:null,__Context_Source_Object__c:null,__Title__c:null,__IsStandard__c:false,__Sequence__c:1,__Section__c:"",__Page_Layout_Detail_Id__c:null,__Required__c:false,__Related_Object_Name__c:null,__Readonly__c:false,__Page_Layout__c:"",__Override_Related_Lookup__c:false,__Named_Search__c:null,__Named_Search__r:null,__Lookup_Query_Field__c:null,__Lookup_Context__c:null,__Field_API_Name__c:null,__Display_Row__c:null,__Display_Column__c:null,__Detail_Type__c:"List",__DataType__c:"reference",__No_Of_Columns__c:null,__Enable_Chatter__c:false,__Control_Type__c:"Standard",__Maximum_Value__c:null,__Minimum_Value__c:null,__Use_For_SLA_Clock__c:false,__Enable_Comments__c:false,__Expression__c:null};var d={__No_Of_Columns__c:1};var g={__Type__c:"Header",__Sequence__c:null,__Prompt_For_New_Event__c:false,__Enable_Attachments__c:false,__Enable_Chatter__c:false,__Show_Account_History__c:false,__Show_All_Sections_By_Default__c:false,__Show_Product_History__c:false,__Hide_Save__c:false,__Hide_Quick_Save__c:false,__Page_Layout_ID__c:"Checklist",__Page_Help__c:null,__Object_Name__c:SVMX.OrgNamespace+"__Checklist__c",__Multi_Add_Search_Object__c:null,__Multi_Add_Search_Field__c:null,__Multi_Add_Configuration__c:null,__IsStandard__c:false,__Enable_Service_Report_View__c:false,__Enable_Troubleshooting__c:false,__Enable_Service_Report_Generation__c:false,__Help_URL__c:"http://userdocs.servicemax.com:8080/ServiceMaxHelp/Summer14/en_us/svmx_redirector.htm?uid=SFM01_16",__Header_Reference_Field__c:null,__Header_Page_Layout__c:null,__Action_On_Zero_Lines__c:null,__Name__c:"Default Checklist Layout",__Allow_New_Lines__c:false,__Allow_Delete_Lines__c:false};
this.__createOrgProperties(f.page.header.sections[0].sectionDetail,c);this.__createOrgProperties(e.__Section__r,d);this.__createOrgProperties(f.page.header.sections[0].fields[0].fieldDetail,e);this.__createOrgProperties(f.page.header.headerLayout,g);return f;},__createOrgProperties:function(e,d){for(var c in d){e[SVMX.OrgNamespace+c]=d[c];}}},{});a.Class("GetLookupConfig",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_LOOKUPCONFIG"});}},{});a.Class("DescribeObject",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.DESCRIBE_OBJECT"});}},{});a.Class("GetRecordTypes",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_RECORD_TYPES"});}},{});a.Class("GetPageData",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_PAGEDATA"});}},{});a.Class("GetTemplateData",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_TEMPLATEDATA"});}},{});a.Class("CloseProcess",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.CLOSE_PROCESS"});}},{});a.Class("RetrieveSettings",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.RETRIEVE_SETTINGS"});}},{});a.Class("GetUserInfo",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_USERINFO"});}},{});a.Class("GetRecordConflicted",com.servicemax.client.mvc.api.CommandWithResponder,{__constructor:function(){this.__base();},executeAsync:function(d,c){this.__base(d,c);this._executeOperationAsync(d,this,{operationId:"SFMDELIVERY.GET_RECORD_CONFLICTED"});}},{});a.Class("GetViewProcesses",com.servicemax.client.mvc.api.CommandWithResponder,{__constructor:function(){this.__base();},executeAsync:function(d,c){this.__base(d,c);this._executeOperationAsync(d,this,{operationId:"SFMDELIVERY.GET_VIEW_PROCESSES"});}},{});a.Class("GetRecordAlreadyOpen",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_RECORD_ALREADY_OPEN"});}},{});a.Class("SaveTargetRecordWarning",com.servicemax.client.mvc.api.CommandWithResponder,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.SAVE_TARGETRECORD_WARNING"});}},{});a.Class("SaveTargetRecord",com.servicemax.client.mvc.api.CommandWithResponder,{__request:null,__responder:null,__inProgress:"",__saveResult:null,__logger:null,__constructor:function(){this.__base();this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-COMMAND-SAVE_TARGETRECORD");this.__businessRuleValidator=SVMX.create("com.servicemax.client.sfmbizrules.impl.BusinessRuleValidator");this.__fieldUpdateRuleValidator=SVMX.create("com.servicemax.client.sfmbizrules.impl.FieldUpdateRuleValidator");},executeAsync:function(d,c){if(d.deliveryEngine.getRoot()){d.deliveryEngine.getRoot().doBeforeSave();d.deliveryEngine.getRoot().hideErrorUI(true,true);}this.__request=d;this.__responder=c;this.saveToModel(d,c);},saveToModel:function(k,j){var p=this,o=k.additionalInfo.toModelOnly;if(o==undefined||o==null){o=false;}var q=k.deliveryEngine.saveToModel(true);var f=k.additionalInfo.returnWarningsWithErrors;if(!q.canContinue||(f&&(q.hasWarnings&&!k.fieldValidatioConfirmed))){var c=k.deliveryEngine.getEventBus(),r;if(k.deliveryEngine.getRoot()){k.deliveryEngine.getRoot().unblockApplication();r=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",this,{request:{deliveryEngine:k.deliveryEngine,message:q.errors},responder:{}});c.triggerEvent(r);}else{r=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.VALIDATION_ERROR",this,{message:q.errors,warnings:q.warnings,request:{result:{errors:q.errors,warnings:q.warnings,},original:{request:k,responder:j,context:p}},responder:p});c.triggerEvent(r);}return;}else{if(o===false&&!f){var n,e=q.validations,h=e.length,g,s,m=[];for(n=0;n<h;n++){g=e[n],s=g.additionalInfo;if(s&&s.isWarning===true){m.push(g.message);}}if(m.length>0){if(k.deliveryEngine.getRoot()){k.deliveryEngine.getRoot().unblockApplication();}h=m.length;var d="";for(n=0;n<h;n++){d+="<div>"+m[n]+"</div>";}var c=k.deliveryEngine.getEventBus();var r=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.SAVE_TARGETRECORD_WARNING",this,{request:{message:d,original:{request:k,responder:j,context:p}},responder:p});
c.triggerEvent(r);}else{p.__decideWhatToResolveBeforeSave(k,j);}}else{p.__decideWhatToResolveBeforeSave(k,j);}}},__decideWhatToResolveBeforeSave:function(e,d){var c=SVMX.getClient().getApplicationParameter("svmx-sfm-disable-lookup-autoresolve");c=!!c;if(!c){this.__doResolveValuesBeforeSave(e,d);}else{this.__doResolveBusinessRulesBeforeSave(e,d);}},__doResolveValuesBeforeSave:function(f,e){var k=f.deliveryEngine.resolveModel(),j=this,g,d,h=[],m=[],c=[];if(k.length>0){d=k.length;for(g=0;g<d;g++){if(!k[g].isResolved){if(k[g].isDetailsSection){c.push(k[g]);}else{if(k[g].context.__metamodel&&k[g].context.__metamodel.lookupContext){m.push(k[g]);}else{h.push(k[g]);}}}}this.__resolveHeaderLookup(h,m,c,f,e);}else{this.__doResolveBusinessRulesBeforeSave(f,e);}},__resolveHeaderLookup:function(j,m,c,h,g){var l=this;if(j.length>0||m.length>0||c.length>0){var f=true;var e=[],i=[];var k=this.__cycleResolveValuesBeforeSave(l,j,e);k=k.then(function(d){return l.__cycleResolveValuesBeforeSave(l,m,d);});k=k.then(function(d){return l.__cycleResolveValuesBeforeSave(l,c,d);});k=k.done(function(n){var d={me:l,paramsArray:n,errorDetails:i,canContinueAfterResolve:f,request:h,responder:g};l.__doResolveValuesBeforeSaveFinished(d);});}else{this.__doResolveBusinessRulesBeforeSave(h,g);}},__cycleResolveValuesBeforeSave:function(h,c,j){var d=c.length;var k=d;var f=h;var e=SVMX.Deferred();if(d>0){for(var g=0;g<d;g++){c[g].resolver.call(c[g].context,{handler:function(l,i){l&&j.push(l);if(i){k--;}if(k<=0){e.resolve(j);}}});}}else{e.resolve(j);}return e;},__doResolveValuesBeforeSaveFinished:function(f){for(var d=0;d<f.paramsArray.length;d++){if(f.paramsArray[d].countIsZero==true){if(f.paramsArray[d].errorDetails instanceof Array){for(var g=0;g<f.paramsArray[d].errorDetails.length;g++){f.errorDetails.push(f.paramsArray[d].errorDetails[g]);}}else{f.errorDetails.push(f.paramsArray[d].errorDetails);}}if(f.paramsArray[d].canContinueAfterResolve==false){f.canContinueAfterResolve=false;}}if(f.request.additionalInfo.toModelOnly===true){f.request.deliveryEngine.saveToModel(false);f.request.deliveryEngine.getRoot().unblockApplication();return;}if(f.errorDetails.length==0&&f.canContinueAfterResolve){if(f.request.deliveryEngine.getRoot().getDiscardUnresolvedLUPIndicatorAction().isVisible()){f.request.deliveryEngine.getRoot().getDiscardUnresolvedLUPIndicatorAction().hide();}f.request.deliveryEngine.saveToModel(false);f.me.__doResolveBusinessRulesBeforeSave(f.request,f.responder);}else{if(!f.request.deliveryEngine.getRoot().getDiscardUnresolvedLUPIndicatorAction().isVisible()){f.request.deliveryEngine.getRoot().getDiscardUnresolvedLUPIndicatorAction().show();}f.request.deliveryEngine.getRoot().unblockApplication();if(f.errorDetails.length>0){var e=f.request.deliveryEngine.getEventBus(),c;c=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.NOTIFY_APP_ERROR",this,{request:{deliveryEngine:f.request.deliveryEngine,message:f.errorDetails},responder:{}});e.triggerEvent(c);}}},__doResolveFieldUpdateRulesBeforeSave:function(h,g){if(!h.deliveryEngine.isFieldUpdatesEnabled()){return;}var j=h.deliveryEngine.getMetaModel().getFieldTypes();var e=h.deliveryEngine.getTargetData().getData();var m=h.deliveryEngine.getMetaModel().getFieldUpdateRulesHash();var l=e.getRawValues();var f=this.__fieldUpdateRuleValidator.evaluateFieldUpdateRules({rules:m,data:l,fields:j,pageModel:e});var d=f.errors.length||(f.warnings.length&&!h.confirmed);if(!d){var i=this.__fieldUpdateRuleValidator.getUpdatableFields(m);h.deliveryEngine.getMetaModel().applyFieldUpdateResults(l,f.response,i,j);h.deliveryEngine.getTargetData().executeBinding();}else{var c=h.deliveryEngine.getEventBus();var k=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.FIELD_UPDATE_VALIDATION_ERROR",this,{request:{original:{request:h,responder:g},deliveryEngine:h.deliveryEngine,result:f,eventType:"onsave"},responder:{}});c.triggerEvent(k);}return d;},__evalauteBusinessRules:function(g){var d=g.deliveryEngine.__page.getFieldTypes();var c=g.deliveryEngine.getTargetData().getData();var e=c.getRawValues();var i=g.deliveryEngine.__page.getBusinessRulesHash();var h=g.deliveryEngine.getPageMetaData().__recordTypesMap;var f=this.__businessRuleValidator.evaluateBusinessRules({rules:i,data:e,fields:d,pageModel:c,recordTypeMaps:h});return f;},__doResolveBusinessRulesBeforeSave:function(g,d){if(this.__doResolveFieldUpdateRulesBeforeSave(g,d)){return;}var h=this.__evalauteBusinessRules(g);var f=h.errors.length||(h.warnings.length&&!g.confirmed);if(f){var e=g.deliveryEngine.getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.ADV_VALIDATION_ERROR",this,{request:{original:{request:g,responder:d},deliveryEngine:g.deliveryEngine,result:h},responder:{}});return e.triggerEvent(c);}this.__doSave(g,d);},__doSave:function(g,e){var h={startSave:true,eventType:g.additionalInfo.eventType};if(g.deliveryEngine.getRoot()){g.deliveryEngine.getRoot().updateQuickSaveIcon(h);}var c=!SVMX.getClient().getApplicationParameter("svmx-sfm-disable-events")&&g.deliveryEngine.getPageMetaData().getHeaderMetaModel().getPageEventInfoFor("Before Save");
if(c){this.__inProgress="Before Save";this.__logger.info("Performing => "+this.__inProgress);var f=this.getEventBus();var d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.INVOKE_EVENTS",this,{request:{events:[c],data:g.deliveryEngine.getTargetData().getData(),metadata:g.deliveryEngine.getPageMetaData().getRawPageMetaData(),deliveryEngine:g.deliveryEngine,bypassSave:true,additionalInfo:{processId:g.deliveryEngine.processId,nextStepId:g.deliveryEngine.nextStepId}},responder:this});f.triggerEvent(d);}else{this.__inProgress="Save";this.__logger.info("Performing => "+this.__inProgress);this._executeOperationAsync(g,this,{operationId:"SFMDELIVERY.SAVE_TARGETRECORD"});}},result:function(e){if(this.__inProgress=="Before Save"){this.__inProgress="Save";this.__logger.info("Performing => "+this.__inProgress);this._executeOperationAsync(this.__request,this,{operationId:"SFMDELIVERY.SAVE_TARGETRECORD"});}else{if(this.__inProgress=="Save"){this.__saveResult=e;var f=this.__saveResult.error?false:!SVMX.getClient().getApplicationParameter("svmx-sfm-disable-events")&&this.__request.deliveryEngine.getPageMetaData().getHeaderMetaModel().getPageEventInfoFor("After Save");if(f){this.__inProgress="After Save";this.__logger.info("Performing => "+this.__inProgress);var d=this.getEventBus();var c=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.INVOKE_EVENTS",this,{request:{events:[f],data:this.__request.deliveryEngine.getTargetData().getData(),metadata:this.__request.deliveryEngine.getPageMetaData().getRawPageMetaData(),deliveryEngine:this.__request.deliveryEngine,bypassSave:true,additionalInfo:{processId:this.__request.deliveryEngine.processId,nextStepId:this.__request.deliveryEngine.nextStepId}},responder:this});d.triggerEvent(c);}else{this.__responder.result(this.__saveResult);}}else{this.__responder.result(this.__saveResult);}}},fault:function(c){}},{});a.Class("SaveTargetAttachmentRecord",com.servicemax.client.mvc.api.CommandWithResponder,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.SAVE_TARGETATTACHMENTRECORD"});}},{});a.Class("SaveChecklistTargetRecord",com.servicemax.client.sfmdelivery.commands.SaveTargetRecord,{__constructor:function(){this.__base();},saveToModel:function(f,d){var c=f.additionalInfo.toModelOnly;if(c==undefined||c==null){c=false;}if(c){var e=f.deliveryEngine.saveToModel(false);if(!e.canContinue){return;}this.__doSave(f,d);}else{this.__executeValidationsAndBusinessRules(f,d);}},__isSubmitEvent:function(c){return c.additionalInfo.eventType==="validated save"||c.additionalInfo.eventType==="submit";},removeTheSkippedQuestionsFromSFMData:function(c){var f=c.deliveryEngine.getTargetData().getData().getRawData().sfmData;var d=c.deliveryEngine.skippedQuestions;for(var e=0;e<d.length;e++){delete f[d[e]];}},removeTheSkippedQuestionsFromValidationResult:function(d,c){var f=d.deliveryEngine.skippedQuestions;for(var e=c.errors.length-1;e>=0;e--){if(f.indexOf(c.errors[e].questionNumber)>-1){c.errors.splice(e,1);}}},__executeValidationsAndBusinessRules:function(i,f){var e=i.deliveryEngine.saveToModel(true);this.removeTheSkippedQuestionsFromSFMData(i);this.removeTheSkippedQuestionsFromValidationResult(i,e);var h=this.__evalauteBusinessRules(i);if((e.errors.length===0&&h.errors.length===0)&&(h.warnings.length===0||(h.warnings.length&&i.confirmed))){this.__doSave(i,f);}else{var j=this.__formatBizzRuleResults(i,h);var g=i.deliveryEngine.getEventBus();var c=this.__mergeValidationAndBizzRuleResults(e,j);var d=SVMX.create("com.servicemax.client.lib.api.Event","SFMDELIVERY.ADV_VALIDATION_ERROR",this,{message:c.errors,warnings:c.warnings,request:{result:{errors:c.errors,warnings:c.warnings},original:{request:i,responder:f,context:this}},responder:this});return g.triggerEvent(d);}},__mergeValidationAndBizzRuleResults:function(g,e){var f=this.__removeDuplicatesFromBizzRulesResults(g.errors,e.errors);g.errors.push.apply(g.errors,f);var d=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if((d&&d===false)||d===undefined){SVMX.sort(g.errors,"questionNumber");}var c=this.__removeDuplicatesFromBizzRulesResults(g.warnings,e.warnings);g.warnings.push.apply(g.warnings,c);if((d&&d===false)||d===undefined){SVMX.sort(g.warnings,"questionNumber");}return g;},__removeDuplicatesFromBizzRulesResults:function(d,j){var f=0;var c=d.length;for(f;f<c;f++){var h=d[f].questionNumber;var e=SVMX.array.filter(j,function(i){return i.questionNumber===h;});if(e.length){var g=SVMX.array.map(j,function(k,i){if(k.questionNumber===h){return i;}});if(g.length){j.splice(g[0],1);}}}return j;},__extractQuestionForFailedBizRules:function(e){var g=0;var d=e.length;var c=[];for(g;g<d;g++){var h=e[g].ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Field_Name__c"];var f={};f[h]=e[g].message;c.push(f);}return c;},__formatBizzRuleResults:function(e,d){var c={};c.errors=this.__getFormattedBizzRuleResult(e,d.errors,"error");c.warnings=this.__getFormattedBizzRuleResult(e,d.warnings,"warning");
return c;},__getFormattedBizzRuleResult:function(l,d,q){var p=this.__extractQuestionForFailedBizRules(d);var g=[];var m=0;var n=p.length;var r=l.deliveryEngine.__page.getDataModel();var e=r.__allBindings;for(m;m<n;m++){var f=p[m];for(var c in f){var o=SVMX.array.filter(e,function(i){return i.__path===c;});if(o.length){var k=o[0];var h=f[c];var j={type:q,message:h};if(k.__bizzRuleValidator&&k.__bizzRuleValidator.handler){g.push(k.__bizzRuleValidator.handler.call(k.__bizzRuleValidator.context,j));}}}}return g;},__doSave:function(f,e){f=f||{};f.additionalInfo=f.additionalInfo||{};var n=this.__isSubmitEvent(f);f.deliveryEngine.getPageMetaData().getChildNode("header").getData().activeSectionIndex=n?0:f.additionalInfo.activeSectionIndex;var o=f.deliveryEngine.getPageMetaData().getRawPageMetaData();o=(o)?SVMX.toJSON(o):"";var c=f.deliveryEngine.getTargetData().getData().getRawData().sfmData;var h=f.deliveryEngine.skippedQuestions;var k=SVMX.toObject(f.data.__data.sfmData[SVMX.OrgNamespace+"__ChecklistJSON__c"])||{};var i=this.getCurrentSectionQuestion(f,f.deliveryEngine.getMetaModel().getQuestionData(c));var g=Object.assign(k,i);if(h&&h.length){for(var l=0;l<h.length;l++){delete g[h[l]];}}var g=(g)?SVMX.toJSON(g):"";c[SVMX.OrgNamespace+"__ChecklistMetaJSON__c"]=o;c[SVMX.OrgNamespace+"__ChecklistJSON__c"]=g;if(!c[SVMX.OrgNamespace+"__What_Id__c"]){c[SVMX.OrgNamespace+"__What_Id__c"]=f.sourceRecordId;}c[SVMX.OrgNamespace+"__ChecklistProcessID__c"]=f.additionalInfo.sfProcessId;f.skipAggressiveSync=!n;f.doSourceObjectUpdate=n;f.skipStatusMsg=true,c[SVMX.OrgNamespace+"__Status__c"]=(n)?"Completed":"In Process";if(n){var m=null;if(f.deliveryEngine&&f.deliveryEngine.getMetaModel()&&f.deliveryEngine.getMetaModel().getUserInfo()){m=f.deliveryEngine.getMetaModel().getUserInfo();}if(m){var d=com.servicemax.client.lib.datetimeutils.DatetimeUtil.macroDrivenDatetime("Now","YYYY-MM-DD","HH:mm:ss");var j=SVMX.getClient().getApplicationParameter("svmx-sfm-sal-model-use-jsr");if(j&&j===true){d=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(d,m.TimezoneOffset,false);}c[SVMX.OrgNamespace+"__Completed_By__c"]=m.UserId;c[SVMX.OrgNamespace+"__Completed_On__c"]=d;}}f.deliveryEngine.getMetaModel().removeQuestionData(c);this.__inProgress="Save";this.__logger.info("Performing => "+this.__inProgress);this._executeOperationAsync(f,this,{operationId:"SFMDELIVERY.SAVE_TARGETRECORD"});},getCurrentSectionQuestion:function(g,f){var e={};if("undefined"===typeof g.additionalInfo.currentIndex){return f;}else{if(g){var j=g.deliveryEngine.__page.getChildNode("header").getChildNode("sections");if(j.length>g.additionalInfo.currentIndex){var c=j[g.additionalInfo.currentIndex].getChildNode("fields");var h=c.length;for(var d=0;d<h;d++){var i=c[d].fieldName;if(i){e[i]=f[i];}}}}}return e;}},{});a.Class("ChecklistEntryCriteria",com.servicemax.client.mvc.api.CommandWithResponder,{__request:null,__responder:null,__logger:null,__constructor:function(){this.__base();this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-EVALUATE_CHECKLIST_ENTRY_CRITERIA");this.__businessRuleValidator=SVMX.create("com.servicemax.client.sfmbizrules.impl.BusinessRuleValidator");},executeAsync:function(d,c){this.__request=d;this.__responder=c;this.__executeEntryCriteriaBusinessRules(d,c);},__executeEntryCriteriaBusinessRules:function(d,c){var n=d.deliveryEngine.__page.getEntryExitCriteriaBusinessRuleHash(d);var o=null;var g={};for(var f=0;f<n.header.rules.length;f++){n.header.rules[f].ruleInfo.bizRule[SVMX.OrgNamespace+"__Message_Type__c"]="Error";}if(n.header&&n.header.rules&&n.header.rules.length>0){o=n.header.rules[0].ruleInfo.bizRule[SVMX.OrgNamespace+"__Source_Object_Name__c"];}if(o){var p=this.__modifySourceObectData(d.data);g[o]=p.sourceObjectFieldsDict;for(var j=n.header.rules.length-1;j>=0;j--){var k=n.header.rules[j].ruleInfo.bizRuleDetails;for(var m=k.length-1;m>=0;m--){var l=k[m][SVMX.OrgNamespace+"__Field_Name__c"];if(p.fieldValueData[l]===undefined){k.splice(m,1);}}if(k.length===0){n.header.rules.splice(j,1);}}var h=this.__businessRuleValidator.evaluateEntryCriteriaBusinessRules({rules:n,data:d.data,fields:g,fieldValueData:p.fieldValueData});if(h.skipSections&&h.skipSections.length>0){var e=this.__processSectionListToRemoveEntryCriteriaUnQualifiedSections(h.skipSections);this.deleteRulesofDeletedQuestions(d.deliveryEngine.__page,e);}}this.__responder.result(d.additionalInfo.eventType);},__modifySourceObectData:function(d){var f={};var g={};for(var e=0;e<d.length;e++){if(d[e].key&&d[e].key.length>0){if(d[e].ftype.toLowerCase()==="reference"){d[e].value=d[e].fieldsToNull;}else{d[e].value=this.__convertFieldValue(d[e].value,d[e].ftype.toLowerCase());}g[d[e].key]=d[e].value;f[d[e].key]=d[e].ftype.toLowerCase();}}var c={fieldValueData:g,sourceObjectFieldsDict:f};return c;},__isDateObject:function(c){if((c instanceof Date)&&(!isNaN(c.getTime()))){return true;}this.__logger.error("Invalid Date Object;",c);return false;},__convertFieldValue:function(c,f){switch(f){case"date":if(!c){return c;
}var e=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseGMTDate(c);if(this.__isDateObject(e)){e.setHours(0,0,0);}return e;case"datetime":if(!c){return c;}var e=com.servicemax.client.lib.datetimeutils.DatetimeUtil.parseGMTDate(c);this.__isDateObject(e);return e;case"boolean":return c==="true"||c===true;case"double":case"percent":case"currency":if(typeof c==="string"){return Number(c);}else{return c;}default:return c;}},__processSectionListToRemoveEntryCriteriaUnQualifiedSections:function(e){var k=[];var d=[];for(var i=0;i<e.length;i++){k.push(e[i].ruleInfo.bizRule[SVMX.OrgNamespace+"__SM_Section__c"]);}var c=this.__request.deliveryEngine.getPageMetaData().getRawPageMetaData();if(c&&c.page&&c.page.header&&c.page.header.sections&&c.page.header.sections.length>0){for(var f=c.page.header.sections.length-1;f>=0;f--){section=c.page.header.sections[f];if(section&&section.sectionDetail&&section.sectionDetail.Id&&section.sectionDetail.Id.length>0){if(k.indexOf(section.sectionDetail.Id)>-1){section.sectionDetail[SVMX.OrgNamespace+"__Entry_Criteria__c"]=true;for(var h=0;h<section.fields.length;h++){var g=section.fields[h].fieldDetail;if(g){var j=SVMX.toObject(g[SVMX.OrgNamespace+"__QuestionInfoJSON__c"]);d.push(j.question.questionID);}}}}}}return d;},deleteRulesofDeletedQuestions:function(d,c){var f=d._data.page.businessRules;for(var g=f.length-1;g>=0;g--){var e=f[g];if(e.ruleInfo&&e.ruleInfo.bizRuleDetails&&c.indexOf(e.ruleInfo.bizRuleDetails[0][SVMX.OrgNamespace+"__Field_Name__c"])>-1){f.splice(g,1);}}}},{});a.Class("ChecklistExitCriteria",com.servicemax.client.mvc.api.CommandWithResponder,{__request:null,__responder:null,__logger:null,__constructor:function(){this.__base();this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-EVALUATE_CHECKLIST_EXIT_CRITERIA");this.__businessRuleValidator=SVMX.create("com.servicemax.client.sfmbizrules.impl.BusinessRuleValidator");},executeAsync:function(d,c){this.__request=d;this.__responder=c;this.__executeExitCriteriaBusinessRules(d,c);},__executeExitCriteriaBusinessRules:function(h,f){var j=h.deliveryEngine.__page.getEntryExitCriteriaBusinessRuleHash(h);var g=null;if(j.header.rules.length>0){var d=h.deliveryEngine.__page.getFieldTypes();var c=h.deliveryEngine.getTargetData().getData();var e=c.getRawValues();var i=h.deliveryEngine.getPageMetaData().__recordTypesMap;g=this.__businessRuleValidator.evaluateBusinessRules({rules:j,data:e,fields:d,pageModel:c,recordTypeMaps:i});}this.__responder.result(g?g.errors:[]);}},{});a.Class("GetNextStepInfo",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_NEXTSTEPINFO"});}},{});a.Class("InvokeEvents",com.servicemax.client.mvc.api.CommandWithResponder,{__currentEventIndex:0,__allEvents:null,__responder:null,__request:null,__logger:null,__constructor:function(){this.__base();this.__logger=SVMX.getLoggingService().getLogger("SFMDELIVERY-COMMAND-INVOKE_EVENTS");},executeAsync:function(e,c){if(e.deliveryEngine.getRoot()){e.deliveryEngine.getRoot().doBeforeSave();}if(e.deliveryEngine.getRoot()){e.deliveryEngine.getRoot().hideErrorUI(true,true);}this.__allEvents=e.events;this.__currentEventIndex=-1;this.__request=e;this.__responder=c;if(!e.bypassSave&&e.deliveryEngine){var d=e.deliveryEngine.saveToModel();if(!d.canContinue){return;}}else{SVMX.getLoggingService().getLogger().warning("Ignoring saveToModel() because either request.bypassSave is true OR deliveryEngine instance is missing");}this.__invokeNextEvent();},__invokeNextEvent:function(){this.__currentEventIndex++;var c=this.__allEvents[this.__currentEventIndex];this.__logger.info("Invoking event => "+SVMX.toJSON(c));this._executeOperationAsync({event:c,data:this.__request.data,metadata:this.__request.metadata,additionalInfo:this.__request.additionalInfo},this,{operationId:"SFMDELIVERY.INVOKE_EVENT"});},result:function(c){if(this.__currentEventIndex==(this.__allEvents.length-1)){this.__responder.result();}else{this.__invokeNextEvent();}},fault:function(c){}},{});a.Class("AddRecords",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.ADD_RECORDS"});}},{});a.Class("DeleteRecords",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.DELETE_RECORDS"});}},{});a.Class("GetBubbleData",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_BUBBLEDATA"});}},{});a.Class("GetDetailMappedInfo",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_DETAIL_MAPPEDINFO"});}},{});a.Class("LookupItemSelected",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();
},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.LOOKUP_ITEM_SELECTED"});}},{});a.Class("ChangeApplicationState",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){if(d.deliveryEngine){d.deliveryEngine.changeApplicationState(d.state);}else{var e=SVMX.getCurrentApplication().getApplicationStateHandler();e.changeApplicationState(d.state);}}},{});a.Class("NotifyApplicationError",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(e,d){if(e.deliveryEngine){e.deliveryEngine.notifyApplicationError(e);}else{var c=SVMX.getCurrentApplication().getApplicationErrorHandler();c.notifyApplicationError(e);}}},{});a.Class("NotifyQuickMessage",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(e,c){if(e.deliveryEngine){e.deliveryEngine.showQuickMessage(e.state);}else{var d=SVMX.getCurrentApplication().getApplicationQuickMessageHandler();d.showQuickMessage(e.message,e.duration,e.type);}}},{});a.Class("GetProductHistory",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_PRODUCT_HISTORY"});}},{});a.Class("GetOnlineProductHistory",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_ONLINE_PRODUCT_HISTORY"});}},{});a.Class("GetAccountHistory",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_ACCOUNT_HISTORY"});}},{});a.Class("GetOnlineAccountHistory",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_ONLINE_ACCOUNT_HISTORY"});}},{});a.Class("DownloadRecordOnDemand",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.DOWNLOAD_RECORD_ON_DEMAND"});}},{});a.Class("ListAttachments",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.LIST_ATTACHMENTS"});}},{});a.Class("ListOutputDocAttachments",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.LIST_OUTPUTDOC_ATTACHMENTS"});}},{});a.Class("EditAttachment",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.EDIT_ATTACHMENT"});}},{});a.Class("DeleteAttachments",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.DELETE_ATTACHMENTS"});}},{});a.Class("AttachFile",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.ATTACH_FILE"});}},{});a.Class("OpenAttachment",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.OPEN_FILE"});}},{});a.Class("ShareAttachments",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.SHARE_ATTACHMENTS"});}},{});a.Class("OpenBrowser",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.OPEN_BROWSER"});}},{});a.Class("GetUrlAndParameters",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.GET_URL_AND_PARAMETERS"});}},{});a.Class("OpenTelephone",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.OPEN_TELEPHONE"});}},{});a.Class("OpenSMS",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.OPEN_SMS"});}},{});a.Class("OpenEmail",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.OPEN_EMAIL"});}},{});a.Class("CheckIfConflict",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.CHECK_IF_CONFLICT"});
}},{});a.Class("IsDodRecord",com.servicemax.client.mvc.api.Command,{__constructor:function(){this.__base();},executeAsync:function(d,c){this._executeOperationAsync(d,c,{operationId:"SFMDELIVERY.IS_DOD_RECORD"});}},{});};})();