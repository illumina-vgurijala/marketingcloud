var MapHandle=MapHandle||{};!function(){Array.prototype.foreach=function(e){for(var t=0;t<this.length;t++)e(this[t])},Array.prototype.some=function(e){return!1},window.openRecord=function(e){var t=document.location.protocol+"//"+document.location.host+"/"+e+"?isdtp=mn";window.open(encodeURI(t),"_blank","width=800,height=600,resizable=1,status=0,scrollbars=1")};var e,t,a,n,o,i,l,r,s,c,d,u,p,g,h,m,f,v,x,y,C,b,w,T,E,M,L,k=!1,D={},I=0,R=null,O=!1,N=0,S=[],P=[],A=["#1B7DBC","#C53922","#02AF5B","#D75500","#923BB0","#2B3D51","#EB8000","#7E8C8D","#2595DF","#ED4C32","#01A185","#F79F00"],_="M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0 M-5,20 L0,35 L5,20 Z",V="M-14,-8 L14,-8 L14,8 L-14,8  M0,-20 L14,-8 Z M0,-20 L-14,-8 L14,-8",B="M11.7756487,4 C7.14289509,6.52840598 4,11.443911 4,17.0934786 C4,25.326123 10.673877,32 18.9065214,32 C24.556089,32 29.471594,28.8571049 32,24.2243513 C29.8818288,25.3803785 27.4522062,26.0373914 24.86913,26.0373914 C16.6364856,26.0373914 9.96260858,19.3635144 9.96260858,11.13087 C9.96260858,8.54779378 10.6196215,6.11817116 11.7756505,3.99999902 Z",H=0,Y=!0,F=!1,G=0,U=!1,W={},z=null,K=[],j=null,Z=null,q=0,Q={PREVIOUS:"prev",NEXT:"next",TECHNICIAN:"Tech",TEAM:"Team",WORKORDER:"WO",BALLOON_URL:"https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=",PLOT_CENTER_ICON:"https://www.google.com/mapfiles/arrow.png"},X={},J={"DD/MM/YYYY":"d/m/Y","DD.MM.YYYY":"d.m.Y","DD-MM-YYYY":"d-m-Y","MM/DD/YYYY":"m/d/Y","MM.DD.YYYY":"m.d.Y","MM-DD-YYYY":"m-d-Y","YYYY/MM/DD":"Y/m/d","YYYY.MM.DD":"Y.m.d","YYYY-MM-DD":"Y-m-d","YYYY. MM. DD":"Y.m.d","DD.MM.YYYY.":"d.m.Y"};function $(){1==r.closed?(clearTimeout(t),alert(i.tags.TAG365),window.close()):t=setTimeout($,1e3)}function ee(){var t=null,a=null,n=null,o=80,l=null,r=null,s=null,c=null,d={},p=Ext.create("Ext.Panel",{id:"svmx_map_dcviews_panel",height:290,width:"100%",listeners:{resize:function(e,t,n,i,l,r){a&&a.setHeight(n-(o+20))}}});function h(e,t){var a=parseInt(e.value);isNaN(a)&&(a=parseInt(t)),F=!0,isNaN(a)||(a<=2e3?y():(e.setValue(2e3),y()))}function m(t){var a=v(t);if(a)for(var n=0;n<a.length;n++)a[n].setMap(e)}function f(e){var t=v(e);if(t)for(var a=0;a<t.length;a++)t[a].setMap(null)}function v(e){var t=e.get("value1");return d[t]}var x=0;function y(){if(l.isValid()&&r.isValid()&&!U){var t=l.getValue();F=!0;var a=r.getValue();t||(t=n.defaultRadius,U=!0,l.setValue(t),U=!1),a||(a=n.defaultRecordCount,r.setValue(a));var o=E(),c=C(),d=new google.maps.LatLng(c.lat,c.lng);k(d),function(t){L();var a=l.getValue()||1;j=new Qe(e,t,G=a,i.mapUnitText,"mile","#FF0000",2,.8,"#FF0000",.35),google.maps.event.addListener(j,"click",function(e){k(e.latLng)})}(d);var u=c.lat,p=c.lng;if(a&&o&&0!=o.length){T(!0),s.setDisabled(!0),b(!0);var g,h={};x=o.length;for(var m=0;m<x;m++)(g=o[m]).item.data.objectName=g.name,h[g.name]=h[g.name]||[],h[g.name].push(g.item.data);for(var f in h)ae({radius:t,mapUnit:n.mapUnit,selectedItems:h[f],numOfRecs:a,apiName:n.apiNames[f],lat:u,lng:p})}}}function C(){var t=0,a=0;if(null==z){var n=new google.maps.OverlayView,o=null;n.draw=function(){},n.setMap(e);try{var i=c.style;function l(e){return e=e||"0px",parseInt(e.substring(0,e.length-1))}var r=l(i.width)/2,s=l(i.height)/2;t=(o=n.getProjection().fromContainerPixelToLatLng(new google.maps.Point(r,s))).lat(),a=o.lng(),z=o}catch(e){}n.setMap(null)}else t=z.lat(),a=z.lng();return{lat:t,lng:a}}function b(e){w||(w=new Ext.LoadMask(Ext.getCmp("mapContainer"),{useMsg:!1})).on("show",function(){var e=Ext.query(".x-mask")[0];e&&(e.style.cursor="progress")},w,{single:!0}),e?w.show():w.hide()}function T(e){null,d={},function(){var e,t=K.length;for(e=0;e<t;e++)K[e].setMap(null);K=[]}(),e||(L(),M(),a.items.each(function(e,t,a){e.getSelectionModel().deselectAll(!0)}),U=!0,l.setValue(n.defaultRadius),U=!1,H=n.defaultRadius,r.setValue(n.defaultRecordCount))}function E(){var e=[],t=0,n=0,o=null,i=null;return a.items.each(function(a,l,r){for(o=a.dataObject.name,i=a.getSelectionModel().getSelection()||[],n=i.length,t=0;t<n;t++)e.push({name:o,item:i[t]})}),e}function M(){Z&&Z.setMap(null),z=null,Z=null}function L(){j&&(j.remove(),j.setMap(null)),j=null}function k(t){M(),z=t;var a={url:Q.PLOT_CENTER_ICON,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(13,30)};de(Z=ce(z,n.tags.TAG335,a));var o="<div style='text-align:left;'><B>"+n.tags.TAG335+"</B><br/><br/><B>"+n.tags.TAG336+"</B>: "+z.lat()+"<br/><B>"+n.tags.TAG337+"</B>: "+z.lng()+"<br/><B>"+n.tags.TAG017+"</B>: "+G+"&nbsp;"+n.mapUnitText+"</div>",i=new google.maps.InfoWindow({content:o,pixelOffset:new google.maps.Size(0,-15)});google.maps.event.addListener(Z,"mouseover",function(){i.open(e,Z)})}function D(){p.hide();try{le()}catch(e){}}function R(){p.show()}this.getUI=function(){return p},this.show=R,this.hide=D,this.toggle=function(){p.isVisible()?(D(),le()):R()},this.render=function(e,c){(n=e||{}).tags=n.tags||{};var d,u=0,g=(t=[{name:"workorder",title:n.tags.TAG092,items:n.viewListForWO},{name:"account",title:n.tags.TAG329,items:n.viewListForAccount},{name:"location",title:n.tags.TAG330,items:n.viewListForLocation}]).length,v=[];for(u=0;u<g;u++)(d=t[u]).dataStore=Ext.create("Ext.data.Store",{fields:["value","value1"],data:{items:d.items},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),d.grid=Ext.create("Ext.grid.Panel",{title:d.title,autoScroll:!0,dataObject:d,selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,listeners:{select:function(e,t,a,n){m(t)},deselect:function(e,t,a,n){f(t)}}}),store:d.dataStore,columns:[{text:"<B>"+n.tags.TAG331+"</B>",dataIndex:"value",flex:1}],height:"100%"}),v.push(d.grid);a=Ext.create("Ext.tab.Panel",{id:"tabpanel",items:v}),s=Ext.create("Ext.Button",{text:n.tags.TAG334,cls:"x-grey-btn",id:"PlotButtonId",handler:function(){y()}}),toolb=Ext.create("Ext.Toolbar",{dock:"bottom",height:33,items:["->",s,{text:n.tags.TAG333,cls:"x-grey-btn",handler:function(){ye()}},"->"]}),l=Ext.create("Ext.form.field.ComboBox",{queryMode:"local",store:new Ext.data.Store({fields:["value"],data:[{value:25},{value:50},{value:75},{value:100}]}),valueField:"value",displayField:"value",width:140,margin:"0 5 0 0",maskRe:/[0-9]/,value:n.defaultRadius,listConfig:{minWidth:50,style:{marginLeft:"0px"}},labelWidth:80,fieldLabel:n.tags.TAG017+"("+n.mapUnitText+")",listeners:{change:h,expand:function(e){Ve(e)}}}),r=Ext.create("Ext.form.field.Number",{minValue:1,maxValue:100,value:n.defaultRecordCount,width:150,margin:"0 0 0 5",labelWidth:90,fieldLabel:n.tags.TAG332,listeners:{render:function(e){e&&(e.bodyEl.dom.style.verticalAlign="middle")}},maxText:i.tags.TAG371+" {0}"});var x=Ext.create("Ext.Panel",{frame:!0,dock:"bottom",height:o,items:[l,r],layout:{type:"hbox",pack:"center",align:"middle"},dockedItems:[toolb]});p.addDocked(x),p.add(a)},this.getViewDataToPlotHandler=function(t){(function(e){var t,a,o,i=e.items||[],l=i.length,r=null,s=null,c=(a=e.context,"workorder"==(o=a.objectName)?n.woIcon:"location"==o?n.locIcon:n.accIcon);for(d[e.context.value1]=[],t=0;t<l;t++)(r=i[t]).Id=r.id,r.hoverInfo=r.hoverInfo||"",r.hoverInfo=r.hoverInfo.replace(new RegExp("\\n","g"),"<br/>"),r.hoverInfo="<div style='text-align:left;'>"+r.hoverInfo+"</div>",s=new google.maps.LatLng(r.lat,r.lng),marker=ce(s,"",c),marker.info=r,de(marker),K.push(marker),d[e.context.value1].push(marker),google.maps.event.addListener(marker,"mouseover",Be)})(t),0==--x&&(s.setDisabled(!1),b(!1),z&&(e.getBounds().contains(z)||0!=I||u||g||setTimeout(function(){e.setCenter(z)},500)))},this.mapRendered=function(t){c=t,C(),google.maps.event.addListener(e,"click",function(e){k(e.latLng)})},this.clearPlot=T,this.selectedViews=function(){for(var e=E(),t=0;t<e.length;t++){var a=e[t];a.viewIndex=a.item.index,delete a.item}return e},this.getRadiusValue=function(){return l?l.getValue():NaN},this.getRecCountValue=function(){return r?r.getValue():NaN},this.setContext=function(e){e&&(e.hasOwnProperty("selectedViews")&&function(e){if(e){var t=null,n=0,o={};for(n=0;n<e.length;n++)t=e[n],o.hasOwnProperty(t.name)||(o[t.name]=[]),o[t.name].push(t.viewIndex);a.items.each(function(e,t,i){var l=e.dataObject.name;if(o.hasOwnProperty(l)){var r=o[l];for(e.getSelectionModel().deselectAll(),n=0;n<r.length;n++)e.rendered?e.getSelectionModel().select(r[n],!0):(a.setActiveTab(e),e.getSelectionModel().select(r[n],!0))}}),a.setActiveTab(0)}}(e.selectedViews),e.radiusValue&&(U=!0,l.setValue(e.radiusValue),U=!1),e.recCountValue&&r.setValue(e.recCountValue),e.plotNearByLatLng&&k(z=new google.maps.LatLng(e.plotNearByLatLng.lat,e.plotNearByLatLng.lng)),e.plotViews&&y())}}var te=null;function ae(e){qe().getViewDataToPlot(e)}function ne(t,a){if(!k){i=t,te.render(i);var l=oe();return a&&(a,e=new google.maps.Map(a,l),k=!0,f=function(){var e=document.createElement("div"),t=e.style;t.overflow="hidden",t.textAlign="center";try{t.border="1px solid rgba(0, 0, 0, 0.15)"}catch(e){t.border="#666 1px solid"}return t.fontFamily="Roboto,Arial,sans-serif",t.fontSize="11px",t.boxShadow="0px 1px 4px -1px rgba(0, 0, 0, 0.3)",t.padding="1px 6px",t.backgroundColor="rgb(255, 255, 255)",t.MozUserSelect="none",t.cursor="pointer",t.backgroundClip="padding-box",t.margin="0px 5px 0px 0px",e.innerHTML=i.tags.TAG369,e}(),e.controls[google.maps.ControlPosition.RIGHT_TOP].push(f),google.maps.event.addDomListener(f,"click",ie),m||(m=new google.maps.TrafficLayer),Ext.tip.QuickTipManager.init(!1,{style:{textAlign:"center"},minWidth:75}),r||(Re(),Pe(),Ee())),o=new google.maps.DirectionsService,(n=new google.maps.DirectionsRenderer).setOptions({suppressMarkers:!0,suppressPolylines:!0}),n.setMap(e),te.mapRendered(a),e}}function oe(){var e=i,t=google.maps.MapTypeId.ROADMAP,a=e.defaultZoomLevel;return c&&(t=c),d&&(a=d),{center:new google.maps.LatLng(e.defaultLat,e.defaultLng),zoom:a,mapTypeId:t,mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP,style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR},panControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP,style:google.maps.ZoomControlStyle.SMALL}}}function ie(){m.getMap()?(m.setMap(null),this.style.backgroundColor="#FFFFFF"):(m.setMap(e),this.style.backgroundColor="#E8E8E8")}function le(){google.maps.event.trigger(e,"resize"),e.setZoom(e.getZoom())}function re(t){if(c){var a={mapTypeId:c,zoom:d};e.setOptions(a)}I>0&&we(),g&&Fe(g.teams,g.selectedWO),u&&(H=t.selectedRadius,Y=t.isRadiusModeOn,Ge(u.technicians,u.selectedWO)),Ext.getCmp("tabpanel").setActiveTab(t.isTabModeIndex),r||te.getUI().hidden?(te.getUI().on("afterlayout",function(){te.setContext(t.plotnearby)},this,{single:!0,delay:100}),te.show()):te.setContext(t.plotnearby),1==t.plotnearby.active?te.show():te.hide()}function se(e,t,a,n,o,i,l,r,s,c,d){var u=a;"string"==typeof u&&(u={url:a});var p,g=l,h=r,m=o,f=i,v="";g&&(v=String(g).substring(0,1)),h&&(v=h&&g?String(g).substring(0,1)+String(h).substring(0,1):String(h).substring(0,1)),(p=t.split(" ")).length>0&&(g||(v=String(p[0]).substring(0,1))),p.length>1&&(h||(v=String(p[0]).substring(0,1)+String(p[1]).substring(0,1)));var x=new google.maps.Marker({position:e,title:"",label:{text:v,color:"#FFFFFF"},icon:u,address:n,anchorPoint:new google.maps.Point(0,0)});if(!0===c){var y={};y.url=a,x.icon=y,"Home"===m&&(x.icon={path:V,fillColor:f,fillOpacity:1,scale:1,strokeColor:"black",strokeWeight:0,anchorPoint:new google.maps.Point(0,0)},x.scale=.3),"Current"===m&&(x.icon={path:_,fillColor:f,fillOpacity:1,scale:.6,strokeColor:"black",strokeWeight:0,anchor:new google.maps.Point(0,0)},x.scale=.3)}return x.Name=t,x.type=d,x.FirstName=l,x.LastName=r,x.SmallPhotoUrl=s,x.initial=v,x}function ce(e,t,a,n,o,i){var l=a;"string"==typeof l&&(l={url:a});var r=new google.maps.Marker({position:e,title:"",icon:l,address:n,anchorPoint:new google.maps.Point(0,0)});if(!0===o){var s={};s.url=a,r.icon=s}return r.Name=t,r.type=i,r}function de(t){if(!t)return!1;var n=!1;if(t.position)t.setMap(e),l&&l.extend(t.position),n=!0;else if(X.hasOwnProperty(t.info.Id)){var o=X[t.info.Id];t.position=new google.maps.LatLng(o.lat,o.lng),t.setMap(e),t.info.lat=o.lat,t.info.lng=o.lng,l&&l.extend(t.position),n=!0}else if(t.address)!function(t){a||(a=new google.maps.Geocoder);var n={address:t.address};a.geocode(n,function(a,n){if(n==google.maps.GeocoderStatus.OK){var o=a[0].geometry.location;t.position=o,X[t.info.Id]={lat:o.lat(),lng:o.lng()},t.info.lat=o.lat(),t.info.lng=o.lng(),t.wayPoint&&(t.wayPoint.location=o),N--,function(t){t&&t.position&&(t.setMap(e),l&&(l.extend(t.position),e.setCenter(l.getCenter())))}(t)}else n==google.maps.GeocoderStatus.ZERO_RESULTS?(N--,t.info.WOId?P.push({Name:t.Name,type:t.type,Id:t.info.WOId}):P.push({Name:t.Name,type:t.type})):n==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(N--,console.log("You are over your quota"),Ze("Too many Google Geocoding API requests per second")):n==google.maps.GeocoderStatus.REQUEST_DENIED?(N--,console.log("Request denied due to lack of a sensor parameter")):n==google.maps.GeocoderStatus.UNKNOWN_ERROR&&(N--,console.log("A request could not be processed due to a server error. The request may succeed if you try again"));if(0==N&&S&&S.length>0)for(;0!=S.length;){var i=S.pop();i.callBack()}}),N++}(t);else{var i=t.info.hasOwnProperty("WOId")?t.info.WOId:t.info.Id;P.push({Name:t.Name,type:t.type,Id:i}),n=!0}return n}function ue(t){t&&t.setMap(e)}function pe(){var e=null,t=null,a=null,n=null;for(e in D)t=(n=D[e]).routeMarkers||[],a=n.routePolylines||[],t&&t.foreach(function(e){e.setMap(null)}),a&&a.foreach(function(e){e.setMap(null)});var o=D;return D={},R=null,I=0,Le(!1),o}function ge(){h&&(h.foreach(function(e){e.setMap(null)}),h=null),g=null}function he(){p&&(p.foreach(function(e){e.setMap(null)}),p=null),u=null}function me(e){T&&(T.remove(),T.setMap(null)),T=null,1==e&&(H=i.defaultRadius)}function fe(){m&&(m.setMap(null),f.style.backgroundColor="#FFFFFF")}function ve(e){x&&x.foreach(function(t){t.setVisible(e)})}function xe(e){x&&x.foreach(function(t){"datefield"!=t.xtype&&"button"!=t.xtype||t.setDisabled(!e)})}function ye(){pe(),he(),ge(),me(!0),fe(),ve(!1),Ae(!1),Le(!1,!0),P=[],te.clearPlot(),E=null,M=null,L=null,r&&r.MapHandle.a(),Y=!0}function Ce(){ye(),E=null,M=null,L=null,r&&r.MapHandle.a(),Y=!0}function be(){window.DCHandle&&window.DCHandle.popoutMap()}function we(e){if(0!=I){var t=R.routeData,a=new Date(t.currentDateInMilliSeconds),n=new Date(t.ganttStartDateInMilliSeconds),o=new Date(t.ganttEndDateInMilliSeconds),i=new Date(a.getTime());e==Q.PREVIOUS?i.setDate(a.getDate()-1):e==Q.NEXT&&i.setDate(a.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i.getTime()>o.getTime()||i.getTime()<n.getTime()||Te(i)}}function Te(e){if(e&&Ext.isDate(e)){e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);var t=qe();if(t){var a=pe(),n=null,o=null;for(o in q=0,xe(!1),a)n={currentDateInMilliSeconds:e.getTime(),Id:a[o].routeData.technician.Id},q++,t.drawTechRouteForDay(n)}}}function Ee(){if(!v){var e=(v=document.createElement("div")).style;e.height="21px",e.overflow="hidden",e.fontSize="12px",e.boxShadow="0px 1px 4px -1px rgba(0, 0, 0, 0.3)",e.backgroundColor="rgb(255, 255, 255)",e.paddingTop="2px",e.paddingLeft="2px",e.fontFamily="Roboto,Arial,sans-serif",e.fontSize="11px",e.display="none";var t=document.createElement("input");t.type="radio",t.id="home_loc",t.value="home_loc",t.checked="true",t.name="base",v.appendChild(t);var a=document.createElement("B"),n=document.createTextNode(i.tags.TAG470);a.style.paddingLeft="2px",a.style.paddingRight="5px",a.style.fontSize="12px",a.appendChild(n),v.appendChild(a);var o=document.createElement("input");o.type="radio",o.id="current_loc",o.value="current_loc",o.name="base","current"==i.locationBase&&(t.checked="false",o.checked="true"),v.appendChild(o);var l=document.createElement("B"),r=document.createTextNode(i.tags.TAG471);l.style.paddingLeft="2px",l.style.paddingRight="5px",l.style.fontSize="12px",l.appendChild(r),v.appendChild(l);var s=document.createElement("input");s.type="radio",s.id="both_loc",s.value="both_loc",s.name="base","both"==i.locationBase&&(t.checked="false",o.checked="false",s.checked="false"),v.appendChild(s);var c=document.createElement("B"),d=document.createTextNode(i.tags.TAG472);c.style.paddingLeft="2px",c.style.paddingRight="5px",c.style.fontSize="12px",c.appendChild(d),v.appendChild(c),google.maps.event.addDomListener(t,"click",function(){document.getElementById("current_loc").checked=!1,document.getElementById("both_loc").checked=!1,De(E),Ge(M,L),Me()}),google.maps.event.addDomListener(o,"click",function(){document.getElementById("both_loc").checked=!1,document.getElementById("home_loc").checked=!1,De(E),Ge(M,L),Me()}),google.maps.event.addDomListener(s,"click",function(){document.getElementById("current_loc").checked=!1,document.getElementById("home_loc").checked=!1,De(E),Ge(M,L),Me()})}}function Me(){qe().locationBaseRadioClick()}function Le(e,t){v&&(v.style.display=e?"block":"none",e&&le(),1==t&&("home"==i.locationBase?Ext.getCmp("home_loc").checked=!0:"current"==i.locationBase?Ext.getCmp("current_loc").checked=!0:"both"==i.locationBase&&(Ext.getCmp("both_loc").checked=!0)))}function ke(e,t,a,n){var o,l,r;"undefined"!==e.lat&&(o=Number(e.lat)),"undefined"!==e.lng&&(l=Number(e.lng)),"undefined"!==e.lat&&"undefined"!==e.lng&&(r=new google.maps.LatLng(o,l));i.techIcon;var s=t;n==Q.TEAM?i.teamIcon:n==Q.WORKORDER&&Q.BALLOON_URL;var c=e.address,d=e.subject;return n==Q.TECHNICIAN&&(c=""),function(e,t,a,n,o,i,l,r,s,c,d,u){var p=new google.maps.Marker({position:e,title:"",icon:window.getResourcePath()+"resources/themes/images/svmx-dc-map/custom/crescent_dark_28.png",address:n,anchorPoint:new google.maps.Point(0,0)});return p.icon={path:B,fillColor:l,fillOpacity:1,scale:1,strokeColor:"black",anchor:new google.maps.Point(20,33),strokeWeight:1},p.scale=.3,p.Name=t,p.type="Overnight",p.address=n,p.subject=o,p}(r,e.Name,0,c,d,0,s,e.FirstName,e.LastName,e.SmallPhotoUrl)}function De(t){if(t&&t.technician){var a,n,o,r,s,c,d,u,p,g,h,m;Le(!0),E=t;var f,v,x,y,b=[],w=!1,T=[],M=!0,L=t;c=L.technician,g=L.pastOverNightStayEvent,p=L.futureOverNightStayEvent,d=L.eventsForWorkOrders,f=new Date(L.currentDateInMilliSeconds),v=new Date(L.currentTimeMarkerInMillis),y=L.viewAllEventsForToday,l=new google.maps.LatLngBounds;var k=je(c.Id);r=We(c,k,!0,Q.TECHNICIAN),g.length>0?(s=ke(g[0],k,0,Q.TECHNICIAN)).info=c:(s=ze(c,k,!0,Q.TECHNICIAN)).info=c,r.info=c,1!=Ext.getCmp("current_loc").checked&&1!=Ext.getCmp("both_loc").checked||(M=de(r)),1!=Ext.getCmp("home_loc").checked&&1!=Ext.getCmp("both_loc").checked||(M=de(s)),M||(w=!0),google.maps.event.addListener(r,"mouseover",Be),google.maps.event.addListener(s,"mouseover",Be);var N=[];N.push(r),function(e){if(e&&D.hasOwnProperty(e)){var t=null,a=null,n=D[e];t=n.routeMarkers||[],a=n.routePolylines||[],t&&t.foreach(function(e){e.setMap(null)}),a&&a.foreach(function(e){e.setMap(null)})}}(L.technician.Id);var P={routeMarkers:N,routeData:L};for(var A in D[L.technician.Id]=P,I=0,D)++I;if(R=P,1==Ext.getCmp("home_loc").checked||1==Ext.getCmp("both_loc").checked){var _=s;if(p.length>0){V=h=ke(p[0],k,0,Q.TECHNICIAN),h.info=c,M=de(h),google.maps.event.addListener(h,"mouseover",Be)}else V=m=ze(c,k,!0,Q.TECHNICIAN),m.info=c,M=de(m),google.maps.event.addListener(m,"mouseover",Be)}if(1==Ext.getCmp("current_loc").checked){_=r;var V=r}if(d){var B=[];if(Array.prototype.foreach.call(d,function(e){!function(e,t,a,n){var o=!0;if(!e&&!t)return o;var i=new Date(e.startTime.time),l=new Date(e.endTime.time);i.toDateString(),t.toDateString();He(t)&&l.getTime()<a.getTime()&&0==n?o=!1:!He(t)&&t.toDateString()==a.toDateString()&&l.getTime()<a.getTime()&&0==n&&(o=!1);!He(t)&&i.toDateString()!=t.toDateString()&&(l.toDateString()==t.toDateString()||l.getTime()>t.getTime())&&(o=!0);return o}(e,f,v,y)?T.push(e):B.push(e),e.Id=e.id,e.startTime.time<v.getTime()&&e.endTime.time>v.getTime()&&(x=e)}),!x&&T.length>0){var H=T[T.length-1],Y=new Date(H.endTime.time);Y.toDateString()==v.toDateString()&&Y.toDateString()==f.toDateString()&&0==y&&(B.unshift(H),1==Ext.getCmp("current_loc").checked&&(_=null))}else x&&1==Ext.getCmp("current_loc").checked&&(_=null);M=!0;for(var F=0,G=1;F<B.length;F++){a=void 0,n=void 0,o=null;var U=B[F];U.lat&&(a=Number(U.lat)),U.lng&&(n=Number(U.lng)),null!=a&&null!=n&&(o=new google.maps.LatLng(a,n));var W=je(c.Id);W&&(W=W.substring(1,W.length));var z=Q.BALLOON_URL+G+++"|"+W+"|000000";(u=ce(o,U.Name,z,U.address,!1,Q.WORKORDER)).info=U,(M=de(u))&&(u.position||""==u.address)||(w=!0),google.maps.event.addListener(u,"mouseover",Be),N.push(u);var K={location:o||U.address};b.push(K),u.wayPoint=K}}N.push(s),1!=Ext.getCmp("home_loc").checked&&1!=Ext.getCmp("both_loc").checked||(p.length>0?N.push(h):N.push(m)),null==_&&b.length>0&&(b.shift(),_=N[1]),w?function(e,t,a,n){S.push({callBackFor:"drawTechnicianRoute",callBack:function(){Ie(e,t,a,n),Ze()}})}(P,_,V,b):(Ie(P,_,V,b),Ze()),0==w&&(null!=s.position&&l.contains(s.position)&&e.setCenter(l.getCenter()),null!=r.position&&l.contains(r.position)&&e.setCenter(l.getCenter())),function(){if(0==I)return;var e=R.routeData,t=Ext.getCmp("techTxt");t.isHidden()&&ve(!0);t.setText(i.tags.TAG116+" "+e.technician.Name);var a=C.getEl().dom;Ext.tip.QuickTipManager.unregister("techTxt"),Ext.tip.QuickTipManager.register({target:"techTxt",text:e.technician.Name}),-1==e.technician.Name.search(" ")&&e.technician.Name.length>15?t.getEl().dom.style.wordBreak="break-all":t.getEl().dom.style.wordBreak="initial";a.scrollWidth>a.offsetWidth&&(t.getEl().dom.style.width="140px",t.getEl().dom.style.whiteSpace="normal",C.doComponentLayout());var n=Ext.getCmp("dateTxt");n.setMinValue(new Date(e.ganttStartDateInMilliSeconds)),n.setMaxValue(new Date(e.ganttEndDateInMilliSeconds)),O=!0,n.setValue(e.currentDateInUserFormat),O=!1}()}}function Ie(t,a,i,l){if(a||i||l){for(var r=a.position?a.position:a.address,s=i.position?i.position:i.address,c=0;c<l.length;c++){l[c].location||(l.splice(c,1),c--)}var d={origin:r,destination:s,travelMode:google.maps.TravelMode.DRIVING,waypoints:l};o.route(d,function(a,o){if(o==google.maps.DirectionsStatus.OK){for(var c=a.routes[0],d=c.legs,u=[],p=0;p<d.length;p++){var g=d[p].steps,h={},m="#24A2C1";i.info&&(m=je(i.info.Id)),h.strokeColor=m,h.path=[],h.strokeOpacity=1,h.strokeWeight=4;for(var f=0;f<g.length;f++){var v=g[f].path;h.path=h.path.concat(v)}var x=(y=h,new google.maps.Polyline(y));ue(x),u.push(x)}if(t.routePolylines=u,l.length>0||r!=s)n.setDirections(a);else c.bounds}else o==google.maps.DirectionsStatus.NOT_FOUND||(o==google.maps.DirectionsStatus.ZERO_RESULTS?(Ze("TAG367"),e.setCenter(s)):o==google.maps.DirectionsStatus.UNKNOWN_ERROR&&Ze("TAG368"));var y;xe(--q<=0)})}}function Re(){if(!C){var e={border:"0",items:[{xtype:"button",height:"30",scope:this,id:"mapPin",text:"Plot",style:"color:#333333!important;background-color:transparent!important",tooltip:i.tags.TAG370,iconCls:Ext.baseCSSPrefix+"tbar-page-prev1",cls:"my-btn",handler:function(){ee.getInstance().toggle()}},{text:"Search Radius",height:30,arrowCls:"",style:"color:#333333!important;background-color:transparent!important",cls:"my-btn",icon:window.getResourcePath()+"resources/themes/images/svmx-dc-map/custom/Radius.png",handler:function(){},menu:{scope:this,xtype:"menu",id:"RadiusMenuId",plain:!0,cls:"dispatch-map-search-radius-menu",items:[{text:"5 "+i.mapUnitText,value:5,handler:Oe},{text:"10 "+i.mapUnitText,value:10,handler:Oe},{text:"15 "+i.mapUnitText,value:15,handler:Oe},{text:"20 "+i.mapUnitText,value:20,handler:Oe},{text:"25 "+i.mapUnitText,value:25,handler:Oe},{text:"30 "+i.mapUnitText,value:30,handler:Oe},{text:"40 "+i.mapUnitText,value:40,handler:Oe},{text:"50 "+i.mapUnitText,value:50,handler:Oe},{text:"Enter Value",hideOnClick:!1,menu:{plain:!0,cls:"my-menu",items:[{text:"Search Radius",disabled:"true",style:{color:"#333333!important"}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",id:"entervalue1",maskRe:/[0-9]/,maxLength:4,enforceMaxLength:!0,width:90,height:25,fieldStyle:"text-align:right;"},{xtype:"button",text:"OK",width:50,height:25,margin:"0 2 5 8",cls:"x-grey-btn",listeners:{click:function(){!function(){var e=Ext.getCmp("entervalue1");if(""!=e.getValue()){var t=e.getValue();H=t>2e3?2e3:e.getValue(),e.setValue(""),_e(H)}Ext.getCmp("RadiusMenuId").hide()}()}}}]}]}},{text:"No Limit",value:0,handler:Oe}]}}]},t=Ext.getCmp("mapContainer");0==H&&(H=i.defaultRadius),r?C=Ext.create("Ext.toolbar.Toolbar",e):(e.overflowX="auto",C=Ext.create("Ext.toolbar.Toolbar",e)),t.add(C),t.move(1,0),x||(x=[]),x.push(C.add({xtype:"label",text:"Show",id:"showlabelid",hidden:!0})),a={xtype:"radiogroup",hidden:!0,id:"radiobutton",width:250,items:[{xtype:"radiofield",boxLabel:i.tags.TAG471,name:"framework",id:"current_loc",checked:"current"==i.locationBase,inputValue:i.tags.TAG471},{xtype:"radiofield",boxLabel:i.tags.TAG470,name:"framework",id:"home_loc",checked:"home"==i.locationBase,inputValue:i.tags.TAG470},{xtype:"radiofield",boxLabel:i.tags.TAG472,name:"framework",id:"both_loc",checked:"both"==i.locationBase,inputValue:i.tags.TAG472}],listeners:{change:function(e,t){t.inputValue==i.tags.TAG470?(Ext.getCmp("home_loc").checked=!0,Ext.getCmp("current_loc").checked=!1,Ext.getCmp("both_loc").checked=!1):t.inputValue==i.tags.TAG471?(Ext.getCmp("home_loc").checked=!1,Ext.getCmp("current_loc").checked=!0,Ext.getCmp("both_loc").checked=!1):t.inputValue==i.tags.TAG472&&(Ext.getCmp("home_loc").checked=!1,Ext.getCmp("current_loc").checked=!1,Ext.getCmp("both_loc").checked=!0),De(E),Ge(M,L),Me()}}},x.push(C.add(a)),console.log(a);var a={xtype:"tbtext",id:"techTxt",text:"",margin:"0 3 0 2",hidden:!0,maxHeight:33};x.push(C.add(a)),x.push(C.add({xtype:"tbseparator",hidden:!0})),a={scope:this,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",handler:function(){we(Q.PREVIOUS)},hidden:!0},x.push(C.add(a)),a={xtype:"datefield",id:"dateTxt",text:"",width:104,format:J[i.userDateFormat],showIcon:!1,fieldStyle:{fontSize:"16px",fontFamily:"OpenSans"},listeners:{change:Se},hidden:!0,invalidText:i.tags.TAG372+" {0} "+i.tags.TAG373+" "+i.userDateFormat},x.push(C.add(a)),a={scope:this,iconCls:Ext.baseCSSPrefix+"tbar-page-next",handler:function(){we(Q.NEXT)},hidden:!0},x.push(C.add(a)),x.push(C.add({xtype:"tbseparator",hidden:!0})),C.add("->"),C.add({xtype:"button",height:"30",scope:this,id:"mapRefresh",tooltip:i.tags.TAG333,handler:Ce,style:"color:#333333!important;background-color:transparent!important",iconCls:Ext.baseCSSPrefix+"tbar-page-prev2",cls:"my-btn",text:"Reset"}),r||C.add({scope:this,id:"mapPopOut",tooltip:i.tags.TAG475,handler:be,iconCls:"map-popout",ui:"icon-btn"})}}function Oe(e){0!=e.value?(H=e.value,Y=!0,_e(H)):u&&(Y=!1,Ne())}function Ne(){me(!1),p&&p.foreach(function(t){t.type!=Q.WORKORDER&&t.setMap(e)})}function Se(e,t,a){e.isValid()&&!O&&(Ext.isDate(t)&&new Date(R.currentDateInMilliSeconds).toDateString()!=t.toDateString()&&Te(t))}function Pe(){if(!b){var t={hidden:!0,border:"1 0 1 0",height:30,items:[{xtype:"checkboxfield",id:"radiusChk",boxLabel:i.tags.TAG316,boxLabelCls:"x-toolbar-text",fieldBodyCls:"",checked:!0,margin:"0 0 0 4",handler:function(t){!function(t){if(!y||!t)return;if(y.forEach(function(e){"checkboxfield"!=e.xtype&&e.setVisible(t.checked)}),0==t.checked)me(!1),p&&p.foreach(function(t){t.type!=Q.WORKORDER&&t.setMap(e)});else{var a=Ext.getCmp("radiusComp");a&&_e(a.getValue())}}(t)}},{xtype:"tbtext",id:"radiusTxt",text:i.tags.TAG017},{id:"radiusComp",xtype:"combo",queryMode:"local",store:new Ext.data.Store({fields:["value"],data:[{value:25},{value:50},{value:75},{value:100}]}),valueField:"value",displayField:"value",width:60,maskRe:/[0-9]/,value:i.defaultRadius,listConfig:{minWidth:50,style:{marginLeft:"0px"}},listeners:{change:function(e,t){!function(e,t){if(!e)return;if(e.value&&isNaN(e.value)||t&&isNaN(t))return void e.markInvalid("Please enter a valid number");e.clearInvalid();var a=parseInt(e.value);isNaN(a)&&(a=parseInt(t));isNaN(a)||(a<=2e3?_e(a):(e.setValue(2e3),_e(2e3)))}(e,t)},expand:function(e){Ve(e)}}},{xtype:"tbtext",id:"unitTxt",text:i.mapUnitText}]},a=Ext.getCmp("mapContainer");r?(y||(y=[]),y.push(C.add({xtype:"tbseparator",hidden:!0})),t.items.foreach(function(e){e.hidden=!0,y.push(C.add(e))})):(b=Ext.create("Ext.toolbar.Toolbar",t),a.add(b),a.move(2,1),y=b.items.items)}}function Ae(e){1!=e&&0!=e||(r&&y.foreach(function(e){}),1==e&&x.foreach(function(t){"radiobutton"!=t.id&&"showlabelid"!=t.id||t.setVisible(e)}))}function _e(t){if(u){var a=u.selectedWO;me();var n=p;n&&n.foreach(function(e){e.type!=Q.WORKORDER&&e.setMap(null)});var o;new google.maps.LatLng(a.lat,a.lng);o=F?t:H;var l=new google.maps.LatLng(a.lat,a.lng);T=new Qe(e,l,o,i.mapUnitText,"mile","#6EA6E5",1,1,"#6EA6E5",.35),"miles"==i.mapUnit&&(t*=1.60934),t=1*t*1e3,n&&n.foreach(function(n){n.type!=Q.WORKORDER&&function(e,t,a){if(!e||!t)return;var n=e.getPosition(),o=new google.maps.LatLng(t.lat,t.lng);if(void 0!==n)var i=google.maps.geometry.spherical.computeDistanceBetween(n,o);return i<=a}(n,a,t)&&n.setMap(e)})}}function Ve(e){if(e)return e.isValid()?void 0:(e.collapse(),!1)}function Be(){if(!s||s.anchor!==this){var t=this.info.hoverInfo;t||(t=this.address),"Overnight"===this.type&&(t=void 0===this.address?this.subject:this.subject+" , "+this.address);this.FirstName,this.LastName;var a,n,o,i=this.SmallPhotoUrl,l=this.initial;i?(n=i,(o=new Image).src=n,a=o.width>0&&o.height>0?"<img src="+i+" alt="+l+' class="circular-image" style="vertical-align:middle">':"<img src="+(i=window.getResourcePath()+"resources/themes/images/svmx-dc-map/custom/Technician25.png")+" alt="+l+' class="circular-image" style="vertical-align:middle">'):a="<img src="+(i=window.getResourcePath()+"resources/themes/images/svmx-dc-map/custom/Technician25.png")+" alt="+l+' class="circular-image" style="vertical-align:middle">';var r=this.type;"WO"!=r&&"Team"!=r&&"Overnight"!==this.type||(a=""),"Overnight"===this.type&&(this.Name="Overnight Stay Event");var c,d=window.getResourcePath()+"resources/themes/images/svmx-dc-map/custom/info_icon.png",u="openRecord('"+(this.info.WOId?this.info.WOId:this.info.Id)+"')";c="Overnight"===this.type?'<div id="content" style="width:230px;line-height:1.35;overflow:hidden;text-align:left;margin:0px;">'+a+"<b>"+this.Name+'</b><p style="word-break: break-all;margin-right:17px">'+t+"</p></div>":'<div id="content" style="width:230px;line-height:1.35;overflow:hidden;text-align:left;margin:0px;">'+a+"<b>"+this.Name+'</b><p style="word-break: break-all;margin-right:17px">'+t+'</p><img src="'+d+'" style="position:absolute;top:0px;right:22px;height:15px;width:15px;cursor:pointer" onclick="'+u+'"/></div>',s||(s=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(0,-15)})),s.open(e,this),s.setContent(c),google.maps.event.addListener(s,"closeclick",function(){s.setContent(""),s.close()})}}function He(e){return e.toDateString()==(new Date).toDateString()}function Ye(){if(!e)return null;var t=new Object;for(var a in t.selectedMapTypeId=e.getMapTypeId(),t.zoomLevel=e.getZoom(),t.routeData={},D){var n=D[a];t.routeData[a]={routeData:n.routeData}}t.totalRoutesPlotted=I,R&&(t.lastPlottedRoute={},t.lastPlottedRoute.routeData=R.routeData),t.searchTeamData=g,t.searchTechData=u,t.techColorMap=W,t.latLngMap=X,t.showTrafficOverlay=!1,u&&(t.isRadiusModeOn=Y,t.selectedRadius=H),t.plotnearby={},t.plotnearby.active=te.getUI().isVisible(),t.plotnearby.radiusValue=te.getRadiusValue(),t.plotnearby.recCountValue=te.getRecCountValue();var o,i,l=te.selectedViews();return l.length>0&&(t.plotnearby.selectedViews=l),z&&(t.plotnearby.plotNearByLatLng={lat:z.lat(),lng:z.lng()}),t.plotnearby.plotViews=!1,j&&(t.plotnearby.plotViews=!0),m&&null!=m.getMap()&&(t.showTrafficOverlay=!0),t.selectedLocationBase=(o="",1==Ext.getCmp("home_loc").checked&&(o="home_loc"),1==Ext.getCmp("current_loc").checked&&(o="current_loc"),1==Ext.getCmp("both_loc").checked&&(o="both_loc"),o),t.isTabModeIndex=(i=Ext.getCmp("tabpanel").getActiveTab(),Ext.getCmp("tabpanel").items.indexOf(i)),t}function Fe(t,a){if(t&&t.length||a){var n=!1;ge(),g={teams:t,selectedWO:a},h||(h=[]),a&&(woMarker=Ue(a,!1,Q.WORKORDER),woMarker.info=a,de(woMarker)||(n=!0),google.maps.event.addListener(woMarker,"mouseover",Be),h.push(woMarker));for(var o=0;o<t.length;o++){var i=t[o];teamMarker=Ue(i,!1,Q.TEAM),teamMarker.info=i,de(teamMarker)||(n=!0),google.maps.event.addListener(teamMarker,"mouseover",Be),h.push(teamMarker)}var l=null;if(n){S.push({callBackFor:"drawSearchedTeams",callBack:function(){(l=Ke(h))&&e.panTo(l.position),Ze()}})}else(l=Ke(h))&&e.panTo(l.position),Ze()}}function Ge(t,a){if(t&&t.length||a){var n,o,i;F=!1,M=t,L=a,Le(!0);var l=!1,r=!0;he(),u={technicians:t,selectedWO:a},p||(p=[]),a&&((i=Ue(a,!1,Q.WORKORDER)).info=a,(r=de(i))||(l=!0),google.maps.event.addListener(i,"mouseover",Be),p.push(i));for(var s=0;s<t.length;s++){var c=t[s],d=je(c.Id);(n=We(c,d,!0,Q.TECHNICIAN)).info=c,(o=ze(c,d,!0,Q.TECHNICIAN)).info=c,1==Ext.getCmp("current_loc").checked&&(r=de(n)),1==Ext.getCmp("home_loc").checked&&(r=de(o)),1==Ext.getCmp("both_loc").checked&&(r=de(o),r=de(n)),r||(l=!0),google.maps.event.addListener(n,"mouseover",Be),google.maps.event.addListener(o,"mouseover",Be),1==Ext.getCmp("home_loc").checked&&p.push(o),1==Ext.getCmp("current_loc").checked&&p.push(n),1==Ext.getCmp("both_loc").checked&&(p.push(o),p.push(n))}var g=null;if(l){S.push({callBackFor:"drawSearchedTechnicians",callBack:function(){(g=Ke(p))&&e.panTo(g.position),a&&P&&-1==P.indexOf(i)&&(Ae(!0),Y?_e(H):Ne()),Ze()}})}else(g=Ke(p))&&e.panTo(g.position),a&&P&&-1==P.indexOf(i)&&(Ae(!0),Y?_e(H):Ne()),Ze()}}function Ue(e,t,a){var n,o,l;e.lat&&(n=Number(e.lat)),e.lng&&(o=Number(e.lng)),null!=n&&null!=o&&(l=new google.maps.LatLng(n,o));var r=i.techIcon;a==Q.TEAM?r=i.teamIcon:a==Q.WORKORDER&&(r=i.woIcon);var s=e.address;return a==Q.TECHNICIAN&&(s=""),ce(l,e.Name,r,s,t,a)}function We(e,t,a,n){var o,l,r;e.lat&&(o=Number(e.lat)),e.lng&&(l=Number(e.lng)),null!=o&&null!=l&&(r=new google.maps.LatLng(o,l));var s=i.techIcon,c=t;n==Q.TEAM?s=i.teamIcon:n==Q.WORKORDER&&(s=Q.BALLOON_URL);var d=e.address;return n==Q.TECHNICIAN&&(d=""),se(r,e.Name,s,d,"Current",c,e.FirstName,e.LastName,e.SmallPhotoUrl,a,n)}function ze(e,t,a,n){var o,l,r;e.homeLat&&(o=Number(e.homeLat)),e.homeLng&&(l=Number(e.homeLng)),null!=o&&null!=l&&(r=new google.maps.LatLng(o,l));var s=i.techHomeIcon,c=t;return se(r,e.Name,s,e.homeAddress,"Home",c,e.FirstName,e.LastName,e.SmallPhotoUrl,a,n)}function Ke(e){if(e&&0!=e.length){for(var t=null,a=0;a<e.length;a++){if(e[a].position)return!0,t=e[a]}return t}}function je(e){var t="";return je.hasOwnProperty("colorCounter")||(je.colorCounter=0),W[e]?t=W[e]:(t=A[je.colorCounter++],W[e]=t,je.colorCounter==A.length&&(je.colorCounter=0)),t}function Ze(e){var t={};t.invalidMarkers=0==P.length?null:P,e&&(t.message=e);var a=qe();if(a){if(r&&t.invalidMarkers){var n=new r.Array;t.invalidMarkers.foreach(function(e){n.push(e)}),t.invalidMarkers=n}a.displayErrorInDC(t),P=[]}}function qe(){var e=null;return window.DCHandle?e=window.DCHandle:r&&(e=r.DCHandle),e}function Qe(e,t,a,n,o,i,l,r,s,c,d){this.map=e,this.setMap(e),this.latLng=t,this.radius=a,this.strokeColor=i,this.strokeWidth=l,this.strokeOpacity=r,this.fillColor=s,this.fillOpacity=c,this.div_=null,this.mapUnit=n,this.mapValue=o,this.numPoints=void 0===d?45:d}ee.getInstance=function(){return te||(te=new ee),te},Qe.prototype=new google.maps.OverlayView,Qe.prototype.clear=function(){null!=this.polygon&&null!=this.map&&this.polygon.setMap(null)},Qe.prototype.draw=function(e){var t=Math.PI/180;customcircleLatLngs=new Array;for(var a,n=0,o=(a=this.mapUnit==this.mapValue?.014483*this.radius:.621371192*this.radius*.014483)/Math.cos(this.latLng.lat()*t),i=0;i<this.numPoints+1;i++){var l=Math.PI*(i/(this.numPoints/2)),r=this.latLng.lat()+a*Math.sin(l),s=this.latLng.lng()+o*Math.cos(l),c=new google.maps.LatLng(r,s);customcircleLatLngs.push(c);var d=this.getProjection().fromLatLngToDivPixel(this.latLng),u=this.getProjection().fromLatLngToDivPixel(c),p={x:d.x,y:d.y-Math.sqrt(Math.abs(u.x-d.x)*Math.abs(u.x-d.x)+Math.abs(u.y-u.y)*Math.abs(u.y-u.y))},g=(2*Math.atan2(u.y-p.y,u.x-p.x)*180/Math.PI).toFixed(0);g>=-200&&g<=0&&(n=i)}this.clear(),this.polygon=new google.maps.Polygon({paths:[customcircleLatLngs],strokeColor:this.strokeColor,strokeWeight:this.strokeWidth,strokeOpacity:this.strokeOpacity,fillColor:this.fillColor,fillOpacity:this.fillOpacity}),this.polygon.setMap(this.map);var h=this;google.maps.event.addDomListener(this.polygon,"click",function(e){google.maps.event.trigger(h,"click",e)});var m=this.div;if(!m){(m=this.div=document.createElement("div")).className="marker",m.style.position="absolute",m.style.background=this.fillColor;var f=this.span_=document.createElement("span");f.style.cssText="color:#ffffff;fontSize:9px",m.appendChild(f),this.span_.innerHTML=this.radius+" "+this.mapUnit,this.getPanes().overlayImage.appendChild(m)}(u=this.getProjection().fromLatLngToDivPixel(customcircleLatLngs[n]))&&(m.style.left=u.x-10+"px",m.style.top=u.y-5+"px")},Qe.prototype.remove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null),this.clear()},Qe.prototype.getPosition=function(){return this.latlng},Qe.prototype.containsLatLng=function(e){if(this.polygon.containsLatLng)return this.polygon.containsLatLng(e)},Qe.prototype.setRadius=function(e){this.radius=e},Qe.prototype.setLatLng=function(e){this.latLng=e},MapHandle.setDCContextAndRenderMap=function(){if(window.opener){var t=(r=window.opener).MapHandle.getDefaultMapConfig(),a=r.MapHandle.getCurrentContext();a&&(a.selectedMapTypeId&&(c=a.selectedMapTypeId),a.zoomLevel&&(d=a.zoomLevel),d||(d=0),a.routeData&&(D=a.routeData),I=a.totalRoutesPlotted,a.lastPlottedRoute&&(R=a.lastPlottedRoute),a.searchTeamData&&(g=a.searchTeamData),a.searchTechData&&(u=a.searchTechData),a.techColorMap&&(W=a.techColorMap),a.latLngMap&&(X=a.latLngMap)),function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientheight,t=Ext.create("Ext.Panel",{id:"map",flex:1,height:"100%"});(te=ee.getInstance()).hide();var a=Ext.create("Ext.Panel",{layout:{type:"vbox",align:"stretch"},items:[te.getUI(),t],frame:!1,flex:1}),n=Ext.create("Ext.Panel",{id:"mapContainer",layout:{type:"vbox",align:"stretch"},items:[a],frame:!1,flex:1,height:e,renderTo:Ext.getDom("DCMap")});Ext.EventManager.onWindowResize(function(){e=window.innerHeight||document.documentElement.clientHeight||document.body.clientheight,n.height=e,n.doComponentLayout(),n.doLayout(),le()})}(),ne(t,Ext.getDom("map")),Ext.getCmp("mapContainer").on("afterlayout",function(t){var a=e.getCenter();google.maps.event.trigger(e,"resize"),e.setCenter(a)},{}),a&&1==a.showTrafficOverlay&&m&&ie.call(f),setTimeout(function(){le(),Re(),Pe(),Ee(),a.selectedLocationBase&&(Ext.getCmp(a.selectedLocationBase).checked=!0),a&&re(a)},1e3),$(),window.onbeforeunload=function(e){var t=Ye();r.DCHandle.mapPopupContext=t?r.Ext.JSON.encode(t):null,r.DCHandle.cMW()}}},MapHandle.renderMap=ne,MapHandle.setDefaultMapConfig=function(e){return!!(e&&e.hasOwnProperty("defaultLat")&&e.hasOwnProperty("defaultLng"))&&(i=e,!0)},MapHandle.getDefaultMapConfig=function(){return i},MapHandle.drawTechnicianRoute=De,MapHandle.getCurrentContext=Ye,MapHandle.resetMapToDefaultConfig=function(){e&&(ye(),c=null,d=null,Y=!0,function(){if(e){var t=oe();e.setOptions(t)}}(),l=null)},MapHandle.loadContextFromPopupMap=function(e){e&&(e.selectedMapTypeId&&(c=e.selectedMapTypeId),e.zoomLevel&&(d=e.zoomLevel),d||(d=0),e.routeData&&(pe(),D=e.routeData),I=e.totalRoutesPlotted,e.lastPlottedRoute&&(R=e.lastPlottedRoute),e.searchData&&(searchData=e.searchData),e.searchTeamData&&(g=e.searchTeamData),e.searchTechData&&(u=e.searchTechData),e.techColorMap&&(W=e.techColorMap),e.latLngMap&&(X=e.latLngMap),m&&(1==e.showTrafficOverlay&&null==m.getMap()?ie.call(f):0==e.showTrafficOverlay&&fe()),e.selectedLocationBase&&Ext.getCmp(e.selectedLocationBase).setValue(!0),re(e))},MapHandle.drawSearchedTeams=Fe,MapHandle.drawSearchedTechnicians=Ge,MapHandle.clearRoute=pe,MapHandle.a=ye,MapHandle.getSelectedDateForRoute=function(){var e=0;if(0!=I){var t=Ext.getCmp("dateTxt");if(t&&t.isVisible()&&t.isValid()){var a=t.getValue();a&&Ext.isDate(a)&&(e=a.getTime())}}return e},MapHandle.getViewDataToPlotHandler=function(e){te.getViewDataToPlotHandler(e)},MapHandle.getLocationBase=function(){var e="";return Ext.getCmp("home_loc").checked?e="home":Ext.getCmp("current_loc").checked?e="current":Ext.getCmp("both_loc").checked&&(e="both"),e&&(i.locationBase=e),e},MapHandle.locationBaseRadioClick=Me,window.DCViewsPanel=ee}();