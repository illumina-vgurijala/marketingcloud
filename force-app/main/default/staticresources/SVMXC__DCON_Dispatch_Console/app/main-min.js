var DCHandle=DCHandle||{};!function(){function e(e){if(!I){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientheight,a=Ext.create("Ext.Panel",{id:"dcContainer",flex:3,height:"100%",region:"center",minWidth:919}),n=Ext.create("Ext.Panel",{id:"parentContainer",layout:"border",items:[a],frame:!1,flex:1,height:t,renderTo:Ext.getDom("DC"),defaults:{collapsible:!1,split:!0}});o(e),Ext.EventManager.onWindowResize(function(){t=window.innerHeight||document.documentElement.clientHeight||document.body.clientheight,n.height=t,n.doComponentLayout(),n.doLayout()}),I=!0}}function t(e){var t=MapHandle.setDefaultMapConfig(e);1==t&&(T=e)}function a(e){var t=Ext.getCmp("parentContainer");if(t&&(!Ext.getCmp("mapContainer")||!b)){W=DCViewsPanel.getInstance(),W.hide();var a=Ext.create("Ext.container.Container",{id:"mapDiv",flex:1});t.on("afterlayout",function(){var e=u();e&&e.reloadDefaultCalendarDuration()},this,{single:!0,delay:500});var o=Ext.create("Ext.Panel",{layout:{type:"vbox",align:"stretch"},items:[W.getUI(),a],frame:!1,flex:1}),l={id:"mapContainer",flex:1,height:"100%",region:"east",layout:{type:"vbox",align:"stretch"},items:[o]};e.mapWidth&&(delete l.flex,l.width=e.mapWidth);var r=Ext.create("Ext.Panel",l);t.add(r),i(e),T=e;var d=Ext.getCmp("dcContainer");d.on("afterlayout",n,this);var c=0,s=0;google.maps.event.addListener(b,"idle",function(e){1==s&&(c=1),s=1}),google.maps.event.addListener(b,"mouseout",function(e){var t=b.getCenter(),a=b.getZoom(),n=u();if(n){var o={};o.lat=t.lat(),o.lng=t.lng(),o.zoom=a,1==c&&(n.autoSaveMap(o),c=0)}})}}function n(e){var t=Ext.getCmp("dcContainer"),a=Ext.getCmp("mapContainer"),n={};if(a&&0==a.hidden&&!P){n.dcWidth=t.getWidth(),n.mapWidth=a.getWidth();var o=u();o&&o.updateDCDimensions(n)}var i=b.getCenter();google.maps.event.trigger(b,"resize"),b.setCenter(i)}function o(e){var t="10.0.0",a="playerProductInstall.swf",n={};n.quality="high",n.bgcolor="#869ca7",n.allowscriptaccess="sameDomain",n.allowfullscreen="true";var o={};o.id="DispatchConsole",o.name="DispatchConsole",o.align="left",swfobject.embedSWF(e.url,"dcContainer-body","100%","100%",t,a,e.flashvars,n,o),swfobject.createCSS("#dcContainer-body","display:block;text-align:left;")}function i(e){var t=document.getElementById("mapDiv");b=MapHandle.renderMap(e,t)}function l(e){var t=Ext.getCmp("mapContainer");if(t)if(e===!0){var a=b.getCenter(),n=new google.maps.LatLng(T.defaultLat,T.defaultLng);t.show(),a.equals(n)&&b.setCenter(a)}else t.hide()}function r(e){if(!P){l(!1),P=window.open(e,"_blank","width=800,height=600,resizable=1,status=0,scrollbars=1");var t=function(){P&&1==P.closed?c(null):P&&!P.MapHandle&&setTimeout(t,100,null)};setTimeout(t,100,null)}}function d(){if(P&&1==P.closed){clearTimeout(S);var e=DCHandle.mapPopupContext?Ext.JSON.decode(DCHandle.mapPopupContext):null;c(e)}else P&&(S=setTimeout(function(){d()},1e3))}function c(e){var t,a=u();a&&(t=a.enableMap()),1==t&&(l(!0),Ext.callback(function(){a&&a.restoreEndDateForGantt()},null,null,200)),e&&1==t&&MapHandle.loadContextFromPopupMap(e),P=null}function u(){var e=-1!=navigator.appName.indexOf("Microsoft")?document.getElementById("DispatchConsole"):document.DispatchConsole;return e}function s(){var e=!1,t=Ext.getCmp("mapContainer");return(t||P)&&(e=!0),e}function f(){var e=null,t=Ext.getCmp("mapContainer");return t&&t.isVisible()?e=MapHandle:P&&(e=P.MapHandle),e}function p(e){if(s()){var t=f();t&&t.drawTechnicianRoute(e)}}function C(e){var t=u();t&&t.drawTechRouteForDay(e)}function g(e,t){if(s()){var a=f();a&&a.drawSearchedTeams(e,t)}}function m(e,t){if(s()){var a=f();a&&a.drawSearchedTechnicians(e,t)}}function h(){if(s()){var e=f();e&&e.clearRoute()}}function v(){s()&&(MapHandle.resetMapToDefaultConfig(),P&&P.MapHandle.resetMapToDefaultConfig())}function D(){if(s()){var e=f(),t=0;return e&&(t=e.getSelectedDateForRoute()),t}}function H(e){if(!(e.selectedItems instanceof Array)){for(var t=[],a=0;a<e.selectedItems.length;a++)t[a]=e.selectedItems[a];e.selectedItems=t}var n=u();n.getViewDataToPlot(e)}function x(e){var t=f();t.getViewDataToPlotHandler(e)}function w(){var e=u();e&&e.openMapWindow()}function E(){var e=f();return e.getLocationBase()}function M(){var e=u();e&&e.autoSaveLocationBase()}function y(e){if(e){var t=u();t.showErrorInDC(e)}}var b,T,P,S,W=null,I=!1;DCHandle.initialize=e,DCHandle.initializeMap=a,DCHandle.setDefaultMapConfig=t,DCHandle.setMapVisibility=l,DCHandle.openMapWindow=r,DCHandle.drawTechnicianRoute=p,DCHandle.drawTechRouteForDay=C,DCHandle.resetMap=v,DCHandle.clearRoute=h,DCHandle.drawSearchedTeams=g,DCHandle.drawSearchedTechnicians=m,DCHandle.displayErrorInDC=y,DCHandle.cMW=d,DCHandle.getViewDataToPlot=H,DCHandle.getViewDataToPlotHandler=x,DCHandle.getSelectedDateForRoute=D,DCHandle.popoutMap=w,DCHandle.getLocationBase=E,DCHandle.locationBaseRadioClick=M}();