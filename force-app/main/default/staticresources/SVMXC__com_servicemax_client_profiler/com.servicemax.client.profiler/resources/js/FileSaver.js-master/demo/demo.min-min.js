/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/demo/demo.js */
(function(M){var H=M.document,T=function(a){return H.getElementById(a);},Y=M.sessionStorage,C=function(){return M.Blob;},U=T("canvas"),I=T("canvas-options"),B=T("canvas-filename"),K=T("canvas-clear"),J=T("text"),G=T("text-options"),S=T("text-filename"),N=T("html"),V=T("html-options"),R=T("html-filename"),F=U.getContext("2d"),A=false,Z=Y.x_points||[],L=Y.y_points||[],W=Y.drag_points||[],Q=function(a,b,c){Z.push(a);L.push(b);W.push(c);},O=function(){U.width=U.width;F.lineWidth=6;F.lineJoin="round";F.strokeStyle="#000000";var b=0,a=Z.length;for(;b<a;b++){F.beginPath();if(b&&W[b]){F.moveTo(Z[b-1],L[b-1]);}else{F.moveTo(Z[b]-1,L[b]);}F.lineTo(Z[b],L[b]);F.closePath();F.stroke();}},X=function(){A=false;},D=function(d){var e="h6 h5 h4 h3 h2 h1".split(" "),f=e.length,c,b;while(f--){c=d.getElementsByTagName(e[f]);for(var g=0,a=c.length;g<a;g++){b=c[g].textContent.trim();if(b){return b;}}}},E=H.implementation,P=function(a){var c=E.createDocumentType("html",null,null),f=E.createDocument("http://www.w3.org/1999/xhtml","html",c),d=f.documentElement,h=d.appendChild(f.createElement("head")),e=h.appendChild(f.createElement("meta")),g=h.appendChild(f.createElement("title")),k=d.appendChild(f.createElement("body")),b=0,i=a.childNodes.length;e.setAttribute("charset",a.ownerDocument.characterSet);for(;b<i;b++){k.appendChild(f.importNode(a.childNodes.item(b),true));}var j=D(f);if(j){g.appendChild(f.createTextNode(j));}return f;};U.width=500;U.height=300;if(typeof Z==="string"){Z=JSON.parse(Z);}if(typeof L==="string"){L=JSON.parse(L);}if(typeof W==="string"){W=JSON.parse(W);}if(Y.canvas_filename){B.value=Y.canvas_filename;}if(Y.text){J.value=Y.text;}if(Y.text_filename){S.value=Y.text_filename;}if(Y.html){N.innerHTML=Y.html;}if(Y.html_filename){R.value=Y.html_filename;}A=true;O();A=false;K.addEventListener("click",function(){U.width=U.width;Z.length=L.length=W.length=0;},false);U.addEventListener("mousedown",function(a){a.preventDefault();A=true;Q(a.pageX-U.offsetLeft,a.pageY-U.offsetTop,false);O();},false);U.addEventListener("mousemove",function(a){if(A){Q(a.pageX-U.offsetLeft,a.pageY-U.offsetTop,true);O();}},false);U.addEventListener("mouseup",X,false);U.addEventListener("mouseout",X,false);I.addEventListener("submit",function(a){a.preventDefault();U.toBlob(function(b){saveAs(b,(B.value||B.placeholder)+".png");},"image/png");},false);G.addEventListener("submit",function(a){a.preventDefault();var b=C();saveAs(new b([J.value||J.placeholder],{type:"text/plain;charset="+H.characterSet}),(S.value||S.placeholder)+".txt");},false);V.addEventListener("submit",function(d){d.preventDefault();var b=C(),a=new XMLSerializer,c=P(N);saveAs(new b([a.serializeToString(c)],{type:"application/xhtml+xml;charset="+H.characterSet}),(R.value||R.placeholder)+".xhtml");},false);M.addEventListener("unload",function(){Y.x_points=JSON.stringify(Z);Y.y_points=JSON.stringify(L);Y.drag_points=JSON.stringify(W);Y.canvas_filename=B.value;Y.text=J.value;Y.text_filename=S.value;Y.html=N.innerHTML;Y.html_filename=R.value;},false);}(self));