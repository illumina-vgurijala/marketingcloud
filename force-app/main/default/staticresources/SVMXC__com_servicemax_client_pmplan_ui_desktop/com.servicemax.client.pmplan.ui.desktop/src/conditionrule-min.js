(function(){var a=SVMX.Package("com.servicemax.client.pmplan.ui.desktop.api.conditionrule");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("PMPLAN");Ext.define("com.servicemax.client.pmplan.ui.desktop.api.ConditionrulePanel",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXWindow",layout:"anchor",height:"100%",border:false,header:{titleAlign:"center",height:40,},style:"background-color: #FFFFFF;",hidden:true,width:"65%",height:"80%",layout:"anchor",closable:false,closeAction:"hide",resizable:false,autoScroll:true,cls:"pmplan-window-container",id:"conditionrule",listeners:{hide:function(d,c){d.hide();d.__parent.enable();}},constructor:function(c){this.callParent([c]);},initComponent:function(){this.callParent(arguments);var m=this;var o=Ext.create("Ext.data.Store",{storeId:"field_list_store",fields:["fieldApiName","fieldLabel","dataType","category","attributeType"],groupField:"category",});var n=Ext.create("Ext.data.Store",{storeId:"Field_List_Store_CB",fields:["fieldApiName","fieldLabel","dataType","category","attributeType"],groupField:"category",});var i=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXLabel",{html:"<span>"+b.T("TAG064","Condition Rule:")+"</span>",style:"position: relative; top: 10px; margin: 10px 10px 0px 12px",padding:"5 5 5 4",cls:"pmplan-grid-title"});m.add(i);this.__conditionRulegrid=SVMX.create("com.servicemax.client.pmplan.ui.desktop.conditionRule.ConditionRuleGrid",{__fieldStore:o});this.add(this.__conditionRulegrid);this.__conditionRulegridCB=SVMX.create("com.servicemax.client.pmplan.ui.desktop.conditionRule.ConditionRuleGridCriteria",{__fieldStore:n});this.add(this.__conditionRulegridCB);var h=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXText",{id:"advExp",name:"advExp",labelAlign:"top",fieldLabel:b.T("TAG030","Advanced Expression"),labelSeparator:"",margin:"0 15 10 15",width:"calc(100% - 30px)",});m.add(h);var e=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXLabel",{html:"<span>"+b.T("TAG065",'If you have defined new conditions or changed existing ones, please click "Run schedule" to regenerate schedules for the updated conditions.')+"</span>",margin:"0 15 0",});m.add(e);var k=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXSection",{layout:"hbox",collapsible:false,border:false,header:false,id:"scheduleSec",cls:"img-header-default",});var j=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXLabel",{html:"<span>"+b.T("TAG066","Scheduled Output:")+"</span>",cls:"pmplan-grid-title"});var g=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG067","Run Schedule"),cls:"pmplan-schedule-link",disabled:true,id:"scheduleLink",style:"top: 14px !important",handler:function(x,y){var C=SVMX.getClient().getApplicationParameter("svmx-pmplan-userinfo");var z={};z.conditionRuleList=[];z.coverageId=Ext.getCmp("conditionrule").__covergaeId;z.runScheduleCoverageId=Ext.getCmp("conditionrule").__runScheduleCoverageId;var B=[];z.conditionRuleList=m.validateConditionRule();z.pmPlanRecord={};z.pmPlanRecord.conditionType=Ext.getCmp("conditionTypeCombo").getValue();var q=Ext.getCmp("startDate").getValue();var w=Ext.getCmp("endDate").getValue();var v=Ext.getCmp("conditionrule");if(q!=null){z.pmPlanRecord.startDate=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(Ext.getCmp("startDate").getValue(),C.TimezoneOffset,false);}if(w!=null){z.pmPlanRecord.endDate=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(Ext.getCmp("endDate").getValue(),C.TimezoneOffset,false);}z.advancedExpression=Ext.getCmp("advExp").getValue();if(z.conditionRuleList!=null&&z.conditionRuleList.length>0&&(z.advancedExpression==""||z.advancedExpression==null)){z.advancedExpression=m.__parent.advancedExp(z.conditionRuleList.length);}z.workOrderPurposeId=Ext.getCmp("WOPurpose").getValue();z.pmPlanRecord.pmTemplateDetail={};z.pmPlanRecord.pmTemplateDetail.conditionRuleList=z.conditionRuleList;if(z.pmPlanRecord.conditionType==="Criteria_Comparison"&&z.conditionRuleList!=null&&z.conditionRuleList.length>0){var A=Ext.data.StoreManager.lookup("Field_List_Store_CB");for(var s=0;s<z.conditionRuleList.length;s++){var u=z.conditionRuleList[s].selectedField;var r=A.findRecord("fieldApiName",u,0,false,true,true);var t=r.getData().fieldLabel;z.conditionRuleList[s].selectedFieldLabel=t;}}if(z.conditionRuleList!=null&&z.conditionRuleList!=""){var p={};p.conditionRuleList=z.conditionRuleList;p.advancedExpression=z.advancedExpression;m.__engine.validateExpression(p,function(D){if(D.success){v.__engine.getCoverageScheduleData(z,function(F){if(F.success){var E=F.scheduleList;var G=Ext.getStore("schedule_op_store");G.loadData(E);Ext.getCmp("advExp").setValue(p.advancedExpression);}else{SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(F.messageList[0],7000,"success");
}});}else{SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(D.messageList[0],7000,"success");}});}}});k.add(j);k.add(g);m.add(k);this.__scheduleGrid=SVMX.create("com.servicemax.client.pmplan.ui.desktop.conditionRule.ScheduleGrid",{});m.add(this.__scheduleGrid);var d=SVMX.create("com.servicemax.client.ui.components.composites.impl.SVMXToolbar",{width:"100%",dock:"bottom",style:"margin-top: 20px",border:false,});var c=SVMX.create("Ext.Toolbar.Fill",{});d.add(c);var l=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG022","Cancel"),scale:"medium",height:30,cls:"pmplan-cancel-btn",handler:function(){m.cancelAction();}});var f=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXButton",{text:b.T("TAG023","Save"),scale:"medium",margin:"0 10 0 10",height:30,id:"saveConditionRuleBtn",cls:"pmplan-save-btn",handler:function(q,u){var p=m.validateConditionRule();var v=m.__scheduleGrid.getStore().data.items;var t=Ext.getCmp("coverageGrid");var s=[];v.forEach(function(x,w){s.push(x.data);});if(p!=null&&p!=""){var r={};r.conditionRuleList=p;r.advancedExpression=Ext.getCmp("advExp").getValue();if(r.advancedExpression==""||r.advancedExpression==null){r.advancedExpression=m.__parent.advancedExp(p.length);}m.__engine.validateExpression(r,function(w){if(w.success){if(s&&s.length===0){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG081","No PM Schedules have been generated for this coverage. This may be due to an issue with the Condition Rules. Please Review."),7000,"success");}else{t.getStore().data.items[m.__recordIndex].data.conditionRuleList=p;t.getStore().data.items[m.__recordIndex].data.scheduleList=s;t.getStore().data.items[m.__recordIndex].data.advancedExpression=r.advancedExpression;if(p!=null&&p!=""&&p.length>0){var x=t.getNode(m.__recordIndex).childNodes[0].getAttribute("class");if(x.indexOf("make-cell-dirty-lt")!=-1){t.getNode(m.__recordIndex).childNodes[0].setAttribute("class",x.replace("make-cell-dirty-lt","").trim());t.getNode(m.__recordIndex).childNodes[0].removeAttribute("data-errorqtip");}}var y=Ext.getCmp("conditionTypeCombo").getValue();m.__parent.__changeevent=true;if(y==="Usage_Frequency"){m.__conditionRulegrid.getStore().removeAll();Ext.getCmp("addRowButton").setDisabled(false);}else{if(y==="Criteria_Comparison"){m.__conditionRulegridCB.getStore().removeAll();Ext.getCmp("addRowButton_CB").setDisabled(false);}}Ext.getCmp("scheduleLink").setDisabled(true);Ext.getCmp("conditionTypeCombo").setReadOnly(true);m.hide();m.__parent.enable();}}else{SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(w.messageList[0],7000,"success");}});}else{SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG072","Add conditions to save the coverage."),7000,"success");}}});d.add(l);d.add(f);m.add(d);},loadStore:function(u,p,l,B){this.__conditionRuleGridOldVal=u;var A=B;var d=[];for(var y=0;y<A.length;y++){var v=A[y].key;var o=A[y].lstOfKeyValue;for(var x=0;x<o.length;x++){var e=SVMX.sanitizeHTML(o[x].value);var f={fieldApiName:o[x].key,fieldLabel:e,dataType:o[x].dataType,category:v,attributeType:o[x].attrType};d.push(f);}}var h=Ext.getCmp("conditionTypeCombo").getValue();var s;if(h===""||h==="Usage_Frequency"){var w=Ext.getStore("field_list_store");s=Ext.getStore("condition_rule_store");if(u!=null&&u.length>0){var r=u;var q=r.length;for(var y=0;y<r.length;y++){var k;var t=r[y].selectedFreqUnit;var g=r[y].selectedField;if(t==="Count"){k=g;}else{k=t;}r[y].selectedField=k;if(k==="Weeks"||k==="Months"||k==="Years"){if(r[y].startAt!==null&&r[y].startAt!==""){var z=r[y].startAt.split("-");r[y].startAt=new Date(z[0],parseInt(z[1])-1,z[2]);}if(r[y].stopAt!==null&&r[y].stopAt!==""){z=r[y].stopAt.split("-");r[y].stopAt=new Date(z[0],parseInt(z[1])-1,z[2]);}}r[y].isRowHasError=false;}if(q>=5){Ext.getCmp("addRowButton").setDisabled(true);}}w.loadData(d);this.__conditionRulegrid.setVisible(true);this.__conditionRulegridCB.setVisible(false);Ext.getCmp("scheduleOPGrid").columns[3].setVisible(true);}else{if(h==="Criteria_Comparison"){s=Ext.getStore("Condition_Rule_Store_CB");var q=u.length;for(var y=0;y<q;y++){u[y].isRowHasError=false;}if(q>=5){Ext.getCmp("addRowButton_CB").setDisabled(true);}this.__conditionRulegrid.setVisible(false);this.__conditionRulegridCB.setVisible(true);Ext.getCmp("scheduleOPGrid").columns[3].setVisible(false);}}s.loadData(u);if(u.length>0){Ext.getCmp("scheduleLink").setDisabled(false);}var n=Ext.getStore("schedule_op_store");n.loadData(p);var c=Ext.getStore("workOrderPurposeStore");c.loadData(this.__engine.__pmplanData.pmPlanRecord.woPurposeList);var m=Ext.getCmp("advExp");m.setValue(l);},loadAttributeStoreForCriteria:function(h){var n=h;var p=[];var q=[];for(var g=0;g<n.length;g++){var c=n[g].key;var d=n[g].lstOfKeyValue;for(var f=0;f<d.length;f++){var m={fieldApiName:d[f].key,fieldLabel:d[f].value,dataType:d[f].dataType,category:c,attributeType:d[f].attrType};
q.push(m);if(d[f].dataType.toUpperCase()==="PICKLIST"){var o=d[f].lstValues||[];for(var e=0;e<o.length;e++){var l={fieldApiName:d[f].key,label:o[e].label,value:o[e].value};p.push(l);}}}}Ext.getStore("Field_List_Store_CB").loadData(q);Ext.getStore("TA_PA_Store").loadData(p);},validateConditionRule:function(){var d=false;var u=false;var r=false;var j=SVMX.getClient().getApplicationParameter("svmx-pmplan-userinfo");var e=[];var f=Ext.getCmp("conditionTypeCombo").getValue();if(f==="Usage_Frequency"){var p=this.__conditionRulegrid.getStore().data.items;var q=Ext.getStore("field_list_store");for(var t=0;t<p.length;t++){if(!d){if(p[t].data.isRowHasError===true||p[t].data.isRowHasError===""){d=true;}}if(!u){var l=p[t].data.selectedField;if(l!=null&&l!=""){var c=q.findExact("fieldApiName",l);if(c===-1){u=true;}}}if(!r){var l=p[t].data.selectedField;var m=p[t].data.selectedOperator;var g=p[t].data.frequency;if(l===null||l===""){r=true;}else{if(m===null||m===""){r=true;}else{if(g===null||g===""){r=true;}}}}}if(u){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG031","There is a mismatch between the product and attribute chosen. Please choose the correct attribute and save."),7000,"success");return;}else{if(r){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG032","Please fill the values for the following columns in Condition Rule list: Field, Operator and Frequency"),7000,"success");return;}else{if(d){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG033","One or more conditions is invalid. Please review the conditions and save"),7000,"success");return;}}}for(var t=0;t<p.length;t++){var s=JSON.parse(JSON.stringify(p[t].data));var l=p[t].data.selectedField;var o;var h;if(l==="Weeks"||l==="Months"||l==="Years"){h="";o=l;s.fieldDataType="Date";}else{h=l;o="Count";}var k=q.findRecord("fieldApiName",h,0,false,true,true);s.selectedField=h;s.selectedFreqUnit=o;if(k!=null){s.fieldAttType=k.getData().attributeType;s.fieldDataType=k.getData().dataType;}if(o==="Count"){s.startAt=p[t].data.startAt;s.stopAt=p[t].data.stopAt;}else{if(p[t].data.startAt!=null&&p[t].data.startAt!=""){s.startAt=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(p[t].data.startAt,j.TimezoneOffset,false).substring(0,10);}if(p[t].data.stopAt!=null&&p[t].data.stopAt!=""){s.stopAt=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(p[t].data.stopAt,j.TimezoneOffset,false).substring(0,10);}}e.push(s);}}else{if(f==="Criteria_Comparison"){var p=this.__conditionRulegridCB.getStore().data.items;var n=Ext.data.StoreManager.lookup("Field_List_Store_CB");var u=false;var r=false;for(var t=0;t<p.length;t++){if(!u){var l=p[t].data.selectedField;if(l!=null&&l!=""){var c=n.findExact("fieldApiName",l);if(c===-1){u=true;}}}if(!r){var l=p[t].data.selectedField;var m=p[t].data.selectedOperator;var g=p[t].data.value;if(l===null||l===""){r=true;}else{if(m===null||m===""){r=true;}else{if(g===null||g===""){r=true;}}}}}if(u){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG031","There is a mismatch between the product and attribute chosen. Please choose the correct attribute and save."),7000,"success");return;}else{if(r){SVMX.getCurrentApplication().getApplicationQuickMessageHandler().showQuickMessage(b.T("TAG076","Please fill values for the following columns in Condition Rule : Attribute, Operator and Value"),7000,"success");return;}}for(var t=0;t<p.length;t++){var s=JSON.parse(JSON.stringify(p[t].data));var h=p[t].data.selectedField;var k=n.findRecord("fieldApiName",h,0,false,true,true);s.selectedField=h;s.fieldAttType=k.getData().attributeType;s.fieldDataType=k.getData().dataType;if(s.fieldDataType==="DATE"){if(p[t].data.value!=null&&p[t].data.value!=""){s.value=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(p[t].data.value,j.TimezoneOffset,false).substring(0,10);}}e.push(s);}}}return e;},cancelAction:function(){var c=this.__conditionRuleGridOldVal;var l=SVMX.getClient().getApplicationParameter("svmx-pmplan-userinfo");var g=Ext.getCmp("conditionTypeCombo").getValue();if(g==="Usage_Frequency"){for(var f=0;f<c.length;f++){if(c[f].selectedFreqUnit!="Count"){if(c[f].startAt!=null&&c[f].startAt!=""){c[f].startAt=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(c[f].startAt,l.TimezoneOffset,false).substring(0,10);}if(c[f].stopAt!=null&&c[f].stopAt!=""){c[f].stopAt=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(c[f].stopAt,l.TimezoneOffset,false).substring(0,10);}}}this.__conditionRulegrid.getStore().removeAll();Ext.getCmp("addRowButton").setDisabled(false);}else{if(g==="Criteria_Comparison"){var j=Ext.data.StoreManager.lookup("Field_List_Store_CB");for(var f=0;f<c.length;f++){var h=c[f].selectedField;var d=j.findRecord("fieldApiName",h,0,false,true,true);var k=d.getData().dataType;if(k==="DATE"){if(c[f].value!=null&&c[f].value!=""){c[f].value=com.servicemax.client.lib.datetimeutils.DatetimeUtil.convertToTimezone(c[f].value,l.TimezoneOffset,false).substring(0,10);
}}}this.__conditionRulegridCB.getStore().removeAll();Ext.getCmp("addRowButton_CB").setDisabled(false);}}var e=Ext.getCmp("coverageGrid");if(e.getStore().data.items[this.__recordIndex].data.conditionRuleList!=null&&e.getStore().data.items[this.__recordIndex].data.conditionRuleList.length>0){e.getStore().data.items[this.__recordIndex].data.conditionRuleList=c;}else{e.getStore().data.items[this.__recordIndex].data.conditionRuleList=null;}Ext.getCmp("scheduleLink").setDisabled(true);this.hide();this.__parent.enable();}});Ext.define("com.servicemax.client.pmplan.ui.desktop.conditionRule.GroupComboBox",{extend:"com.servicemax.client.ui.components.controls.impl.SVMXPicklist",groupField:"group",listConfig:{cls:"grouped-list",getInnerTpl:function(c){return"{[Ext.String.htmlEncode(values."+c+")]}";}},initComponent:function(){var c=this;c.tpl=new Ext.XTemplate(["{[this.currentGroup = null]}",'<tpl for=".">','   <tpl if="this.shouldShowHeader('+c.groupField+')">','       <div class="group-header">{[this.showHeader(values.'+c.groupField+")]}</div>","   </tpl>",'   <div class="svmx-boundlist-item">{'+c.displayField+"}</div>","</tpl>",{shouldShowHeader:function(d){return this.currentGroup!=d;},showHeader:function(d){this.currentGroup=d;return d;}}]);c.callParent(arguments);}});Ext.define("com.servicemax.client.pmplan.ui.desktop.conditionRule.ConditionRuleGrid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",frame:true,__fieldStore:null,__rowData:null,viewConfig:{markDirty:false},initComponent:function(){this.fieldCombo=new SVMX.create("com.servicemax.client.pmplan.ui.desktop.conditionRule.GroupComboBox",{id:"fieldComboCmp",typeAhead:true,queryMode:"local",triggerAction:"all",selectOnTab:true,store:this.__fieldStore,displayField:"fieldLabel",valueField:"fieldApiName",groupField:"category",editable:false});var c=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("TAG034","Every"),value:"EYI",type:"Date"},{label:b.T("TAG035","Every decrement"),value:"EYD",type:"Number"}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.operatorCombo=new Ext.form.field.ComboBox({id:"operatorComboCmp",typeAhead:true,triggerAction:"all",queryMode:"local",selectOnTab:true,displayField:"label",valueField:"value",editable:false,store:c,listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}},__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){if(e==="Months"||e==="Weeks"||e==="Years"){f.store.filter("type","Date");}}}}});this.adjustmentTypeCombo=new Ext.form.field.ComboBox({typeAhead:true,triggerAction:"all",selectOnTab:true,editable:false,queryMode:"local",store:[["None",b.T("COMM_TAG004","--None--")],["Actual",b.T("TAG036","Actual")],["Fixed",b.T("TAG037","Fixed")]],listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}},});var d=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("TAG038","Days"),value:"Days",type:"Date"},{label:b.T("TAG039","Count"),value:"Count",type:"Number"}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.adjustmentUnitCombo=new Ext.form.field.ComboBox({id:"adjustmentUnitComboCmp",displayField:"label",valueField:"value",queryMode:"local",typeAhead:true,triggerAction:"all",selectOnTab:true,editable:false,store:d,listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}},__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){if(e==="Months"||e==="Weeks"||e==="Years"){f.store.filter("type","Date");}else{f.store.filter("type","Number");}}}}});this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,__parent:this,listeners:{beforeedit:function(g,h){this.__parent.__rowData=h.record.data;var i=Ext.getCmp("adjustmentUnitComboCmp");i.store.clearFilter();var f=Ext.getCmp("operatorComboCmp");f.store.clearFilter();},edit:function(m,n){if(n.field==="selectedAdjustmentType"&&(n.value==="None")&&(n.value!==n.originalValue)){n.record.set("minAdjustment","");n.record.set("maxAdjustment","");n.record.set("adjustmentVal","");n.record.set("selectedAdjustedUnit","");}if(n.field==="selectedAdjustmentType"&&(n.value==="Actual")&&(n.value!==n.originalValue)){n.record.set("adjustmentVal","");}if(n.field==="selectedField"){if((n.value==="Weeks"||n.value==="Months"||n.value==="Years")&&(n.originalValue!==""&&n.originalValue!=="Weeks"&&n.originalValue!=="Months"&&n.originalValue!=="Years")){n.record.set("startAt","");n.record.set("stopAt","");n.record.set("threshold","");n.record.set("frequency","");n.record.set("selectedOperator","");n.record.set("selectedAdjustedUnit","");}else{if((n.value!=="Weeks"&&n.value!=="Months"&&n.value!=="Years")&&(n.originalValue!==""&&(n.originalValue==="Weeks"||n.originalValue==="Months"||n.originalValue==="Years"))){n.record.set("startAt","");n.record.set("stopAt","");n.record.set("frequency","");
n.record.set("selectedOperator","");n.record.set("selectedAdjustedUnit","");}}}if(n.record.data.selectedOperator=="EYI"&&(n.record.data.stopAt===""||n.record.data.stopAt===null)){var i=n.row.childNodes[7];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",f+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG040","This is a required field."));}}if(n.record.data.selectedOperator=="EYD"&&(n.record.data.startAt===""||n.record.data.startAt===null)){var i=n.row.childNodes[5];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",f+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG040","This is a required field."));}}if(n.record.data.selectedAdjustmentType==="Fixed"&&(n.record.data.adjustmentVal===""||n.record.data.adjustmentVal===null)){var i=n.row.childNodes[11];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",f+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG040","This is a required field."));}}else{if(n.record.data.selectedAdjustmentType!=="Fixed"){var i=n.row.childNodes[11];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")!==-1){i.firstChild.setAttribute("class",f.replace("make-cell-dirty","").trim());}}}if(n.record.data.selectedOperator=="EYI"&&(n.record.data.startAt!==""&&n.record.data.startAt!==null)&&(n.record.data.stopAt!==""&&n.record.data.stopAt!==null)){var k=false;if((n.record.data.selectedField==="Months"||n.record.data.selectedField==="Weeks"||n.record.data.selectedField==="Years")&&n.record.data.stopAt<n.record.data.startAt){k=true;}else{if((n.record.data.selectedField!=="Months"&&n.record.data.selectedField!=="Weeks"&&n.record.data.selectedField!=="Years")&&parseFloat(n.record.data.stopAt)<parseFloat(n.record.data.startAt)){k=true;}}if(k){var i=n.row.childNodes[7];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",f+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG041","Stop At cannot be less than Start At."));}}}if((n.record.data.selectedField!=="Months"&&n.record.data.selectedField!=="Weeks"&&n.record.data.selectedField!=="Years")&&n.record.data.selectedOperator=="EYD"&&(n.record.data.startAt!==""&&n.record.data.startAt!==null)&&(n.record.data.stopAt!==""&&n.record.data.stopAt!==null)&&parseFloat(n.record.data.stopAt)>parseFloat(n.record.data.startAt)){var i=n.row.childNodes[5];var f=i.firstChild.getAttribute("class");if(f.indexOf("make-cell-dirty")===-1){i.firstChild.setAttribute("class",f+" make-cell-dirty ");i.firstChild.setAttribute("data-qtip",b.T("TAG041","Start At cannot be less than Stop At."));}}if(n.record.data.selectedField!==null&&n.record.data.selectedField!==""){var i=n.row.childNodes[7];var f=i.firstChild.getAttribute("class");var s=i.firstChild.getAttribute("data-qtip");if(f.indexOf("make-cell-dirty")===-1&&s!==null&&s.length>0){i.firstChild.removeAttribute("data-qtip");}}if(n.record.data.selectedField!=="Weeks"&&n.record.data.selectedField!=="Months"&&n.record.data.selectedField!=="Years"){var i=n.row.childNodes[5];var f=i.firstChild.getAttribute("class");var s=i.firstChild.getAttribute("data-qtip");if(f.indexOf("make-cell-dirty")===-1&&s!==null&&s.length>0){i.firstChild.removeAttribute("data-qtip");}}if(n.record.data.selectedAdjustmentType==="Fixed"&&(n.record.data.adjustmentVal!==""&&n.record.data.adjustmentVal!==null)){var i=n.row.childNodes[11];var f=i.firstChild.getAttribute("class");var s=i.firstChild.getAttribute("data-qtip");if(f.indexOf("make-cell-dirty")===-1&&s!==null&&s.length>0){i.firstChild.removeAttribute("data-qtip");}}var t;var l;var j=false;var h=n.row.childNodes[5];var u=h.firstChild.getAttribute("class");if(u.indexOf("make-cell-dirty")!==-1){j=true;t=h;l=u;}var g=n.row.childNodes[7];var p=g.firstChild.getAttribute("class");if(p.indexOf("make-cell-dirty")!==-1){j=true;t=g;l=p;}var r=n.row.childNodes[11];var o=r.firstChild.getAttribute("class");if(o.indexOf("make-cell-dirty")!==-1){j=true;t=r;l=o;}if(j){n.record.set("isRowHasError",true);t.firstChild.setAttribute("class",l.replace("make-cell-dirty","").trim());t.firstChild.setAttribute("class",t.firstChild.getAttribute("class")+" make-cell-dirty ");var q=n.row.childNodes[0];var v=q.firstChild.getAttribute("class");if(v.indexOf("make-cell-dirty")===-1){q.firstChild.setAttribute("class",v+" make-cell-dirty ");q.firstChild.setAttribute("data-qtip",b.T("TAG042","This row has one or more issues. Please correct before proceeding"));}}else{n.record.set("isRowHasError",false);var q=n.row.childNodes[0];var v=q.firstChild.getAttribute("class");var s=q.firstChild.getAttribute("data-qtip");if(v.indexOf("make-cell-dirty")!==-1&&s!==null&&s.length>0){q.firstChild.removeAttribute("data-qtip");q.firstChild.setAttribute("class",v.replace("make-cell-dirty","").trim());}}}}});this.comboBoxRenderer=function(e){return function(g){var f=e.store.find(e.valueField,g);
var h=e.store.getAt(f);return((h===null||h===undefined)?"":h.get(e.displayField));};};Ext.apply(this,{width:"60%",autoScroll:true,maxHeight:450,id:"conditionRuleGrid",margin:"10 10 30",plugins:[this.cellEditing],store:new Ext.data.Store({storeId:"condition_rule_store",fields:["isRowHasError","conditionRuleId","sequence","selectedField","selectedOperator","frequency","startAt","threshold","stopAt","selectedAdjustmentType","minAdjustment","maxAdjustment","adjustmentVal","selectedAdjustedUnit","fieldAttType","fieldDataType","selectedFreqUnit",]}),columns:[{xtype:"actioncolumn",width:40,height:40,align:"center",sortable:false,menuDisabled:true,items:[{iconCls:"pmplan-delete-row-icon",tooltip:b.T("TAG043","Delete"),scope:this,height:40,handler:this.onRemoveClick}]},{header:b.T("TAG044","Sequence"),dataIndex:"sequence",width:80,height:40,align:"center"},{header:b.T("TAG045","Field"),dataIndex:"selectedField",width:150,height:40,align:"center",sortable:false,menuDisabled:true,editor:this.fieldCombo,renderer:this.comboBoxRenderer(this.fieldCombo)},{header:b.T("TAG046","Operator"),dataIndex:"selectedOperator",width:120,height:40,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.operatorCombo),__parent:this,getEditor:function(e){var f=e.data.selectedField;if(f!==null&&f!==""){return this.__parent.operatorCombo;}}},{header:b.T("TAG047","Frequency"),dataIndex:"frequency",width:100,height:40,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedField;if(f!==null&&f!==""){if(f==="Weeks"||f==="Months"||f==="Years"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:1,allowDecimals:false,nanText:b.T("TAG080","Enter a valid number"),})});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0.1,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}}},{header:b.T("TAG048","Start At"),dataIndex:"startAt",width:120,height:40,align:"center",sortable:false,menuDisabled:true,renderer:function(l,e,i,f,h,m){if(l!=null&&l!=""&&(i.data.selectedField==="Weeks"||i.data.selectedField==="Months"||i.data.selectedField==="Years")){var g=new Date(l);var j=("0"+(g.getMonth()+1)).slice(-2);var k=("0"+g.getDate()).slice(-2);return[j,k,g.getFullYear()].join("-");}else{return l;}},getEditor:function(e){var g=e.data.selectedField;if(g==="Weeks"||g==="Months"||g==="Years"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.startAt,"m-d-Y"),invalidText:b.T("TAG079","Enter a valid date")});return Ext.create("Ext.grid.CellEditor",{field:f});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(j,i){var h=j.getValue();if(!Ext.isEmpty(h)){if(/\.\d{2,}/.test(h)){i.stopEvent();}}}}})});}}},{header:b.T("TAG049","Threshold %"),dataIndex:"threshold",width:100,height:40,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedField;if(f!=="Weeks"&&f!=="Months"&&f!=="Years"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,allowDecimals:false,nanText:b.T("TAG080","Enter a valid number"),})});}}},{header:b.T("TAG050","Stop At"),dataIndex:"stopAt",width:120,height:40,align:"center",sortable:false,menuDisabled:true,renderer:function(l,e,i,f,h,m){if(l!=null&&l!=""&&(i.data.selectedField==="Weeks"||i.data.selectedField==="Months"||i.data.selectedField==="Years")){var g=new Date(l);var j=("0"+(g.getMonth()+1)).slice(-2);var k=("0"+g.getDate()).slice(-2);return[j,k,g.getFullYear()].join("-");}else{return l;}},getEditor:function(e){var g=e.data.selectedField;if(g==="Weeks"||g==="Months"||g==="Years"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.stopAt,"m-d-Y"),invalidText:b.T("TAG079","Enter a valid date")});return Ext.create("Ext.grid.CellEditor",{field:f});}else{return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(j,i){var h=j.getValue();if(!Ext.isEmpty(h)){if(/\.\d{2,}/.test(h)){i.stopEvent();}}}}})});}}},{header:b.T("TAG051","Adjustment Type"),dataIndex:"selectedAdjustmentType",width:110,align:"center",sortable:false,menuDisabled:true,editor:this.adjustmentTypeCombo,renderer:this.comboBoxRenderer(this.adjustmentTypeCombo)},{header:b.T("TAG052","Minimum Adjustment"),dataIndex:"minAdjustment",width:120,height:40,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;if(f!==null&&f!==""&&f!=="None"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();
if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG053","Maximum Adjustment"),dataIndex:"maxAdjustment",width:120,height:40,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;if(f!==null&&f!==""&&f!=="None"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG054","Adjustment Value"),dataIndex:"adjustmentVal",width:120,height:40,align:"center",sortable:false,menuDisabled:true,getEditor:function(e){var f=e.data.selectedAdjustmentType;if(f==="Fixed"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(i,h){var g=i.getValue();if(!Ext.isEmpty(g)){if(/\.\d{2,}/.test(g)){h.stopEvent();}}}}})});}}},{header:b.T("TAG055","Adjustment Unit"),dataIndex:"selectedAdjustedUnit",width:120,height:40,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.adjustmentUnitCombo),__parent:this,getEditor:function(e){var g=e.data.selectedAdjustmentType;var f=e.data.selectedField;if(g!==null&&g!==""&&g!=="None"&&f!==null&&f!==""){return this.__parent.adjustmentUnitCombo;}}}],selModel:{selType:"cellmodel"},bbar:[{text:"+ "+b.T("TAG056","Add Row"),id:"addRowButton",scope:this,handler:this.onAddClick,cls:"pmplan-blue-link"}]});this.callParent();},onAddClick:function(d){var c=this.getStore().getCount();var e={sequence:c+1,isRowHasError:false};if(c<5){this.getStore().insert(c,e);if(c==4){d.setDisabled(true);}}if(this.getStore().getCount()>0){Ext.getCmp("scheduleLink").setDisabled(false);}else{Ext.getCmp("scheduleLink").setDisabled(true);}},onRemoveClick:function(d,h,c,g){var k=this.getStore();k.removeAt(h);var l=k.getCount();for(var f=h;f<l;f++){var e=k.getAt(f);e.set("sequence",f+1);}var j=Ext.getCmp("addRowButton");if(l<5&&j.isDisabled()){j.setDisabled(false);}if(this.getStore().getCount()>0){Ext.getCmp("scheduleLink").setDisabled(false);}else{Ext.getCmp("scheduleLink").setDisabled(true);}}});Ext.define("com.servicemax.client.pmplan.ui.desktop.conditionRule.ScheduleGrid",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",emptyText:b.T("TAG057","No Schedules to display"),frame:true,viewConfig:{markDirty:false},initComponent:function(){this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,});var c=SVMX.create("Ext.data.Store",{fields:[{name:"Id"},{name:"name"}],id:"workOrderPurposeStore",proxy:{type:"memory"}});this.workOrderPuproseTemplate=new Ext.form.field.ComboBox({typeAhead:true,triggerAction:"all",displayField:"name",valueField:"Id",queryMode:"local",typeAhead:true,triggerAction:"all",selectOnTab:true,store:c,listConfig:{getInnerTpl:function(d){return"{[Ext.String.htmlEncode(values."+d+")]}";}},});this.picklistRenderer=function(d){return function(f){var e=d.store.find(d.valueField,f);var g=d.store.getAt(e);return((g===null||g===undefined)?"":Ext.String.htmlEncode(g.get(d.displayField)));};};Ext.apply(this,{width:"60%",autoScroll:true,margin:"0 10 30 10",plugins:[this.cellEditing],id:"scheduleOPGrid",cls:"pmplan-schedule-grid",emptyText:b.T("TAG057","No Schedules to display"),viewConfig:{deferEmptyText:false,},store:new Ext.data.Store({storeId:"schedule_op_store",fields:["internalExpression","scheduleId","scheduleName","selectedWOPurpose","sequence","status","statusLabel","actualOpName","advancedExpression","actualOpExpression"],data:[],sorters:{field:"sequence",direction:"ASC"}}),columns:[{flex:1,text:b.T("TAG058","Sequence"),dataIndex:"sequence",align:"left",resizable:true,readOnly:true,hidden:true},{flex:1,text:b.T("TAG059","PM Schedule Output"),dataIndex:"scheduleName",align:"left",resizable:true,readOnly:true,renderer:function(e,d){d.style="white-space: normal;";return Ext.String.htmlEncode(e);}},{flex:1,text:b.T("TAG060","Status"),dataIndex:"statusLabel",align:"left",resizable:true,readOnly:true,renderer:function(d){return Ext.String.htmlEncode(d);}},{flex:1,text:b.T("TAG061","Actual Output"),dataIndex:"actualOpName",align:"left",resizable:true,readOnly:true,renderer:function(d){return Ext.String.htmlEncode(d);}},{flex:1,text:b.T("TAG062","Work Order Purpose"),dataIndex:"selectedWOPurpose",align:"left",resizable:true,readOnly:true,editor:this.workOrderPuproseTemplate,renderer:this.picklistRenderer(this.workOrderPuproseTemplate)},],selModel:{selType:"cellmodel"},});this.callParent();},});Ext.define("com.servicemax.client.pmplan.ui.desktop.conditionRule.ConditionRuleGridCriteria",{extend:"com.servicemax.client.ui.components.composites.impl.SVMXListComposite",xtype:"cell-editing",frame:true,__fieldStore:null,__rowData:null,viewConfig:{markDirty:false},initComponent:function(){this.fieldCombo=new SVMX.create("com.servicemax.client.pmplan.ui.desktop.conditionRule.GroupComboBox",{id:"fieldComboCmp_CB",typeAhead:true,queryMode:"local",triggerAction:"all",selectOnTab:true,store:this.__fieldStore,displayField:"fieldLabel",valueField:"fieldApiName",groupField:"category",editable:false});
var c=Ext.create("Ext.data.Store",{fields:["label","value","type"],data:{items:[{label:b.T("COMM_TAG006","Equals"),value:"eq",type:"TEXT_PICKLIST"},{label:b.T("COMM_TAG008","Greater Than"),value:"gt",type:""},{label:b.T("COMM_TAG010","Less Than"),value:"lt",type:""}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}});this.operatorCombo=new Ext.form.field.ComboBox({id:"operatorComboCmp_CB",typeAhead:true,triggerAction:"all",queryMode:"local",selectOnTab:true,displayField:"label",store:c,listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}},valueField:"value",editable:false,__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;var h=Ext.getStore("Field_List_Store_CB");var i=h.findRecord("fieldApiName",e,0,false,true,true);var g=i&&i.getData().dataType.toUpperCase();if(e!==null&&e!==""){if(g==="TEXT"||g==="PICKLIST"){f.store.filter("type","TEXT_PICKLIST");}}}}});var d=Ext.create("Ext.data.Store",{storeId:"TA_PA_Store",fields:["fieldApiName","label","value"]});this.TA_PA_Combo=SVMX.create("com.servicemax.client.ui.components.controls.impl.SVMXPicklist",{id:"TA_PA_ComboCmp",store:d,queryMode:"local",displayField:"label",valueField:"value",editable:false,listConfig:{getInnerTpl:function(e){return"{[Ext.String.htmlEncode(values."+e+")]}";}},__parent:this,listeners:{expand:function(f){var e=f.__parent.__rowData.selectedField;if(e!==null&&e!==""){f.store.filter("fieldApiName",e);}}}});this.cellEditing=new Ext.grid.plugin.CellEditing({clicksToEdit:1,__parent:this,listeners:{beforeedit:function(g,i){this.__parent.__rowData=i.record.data;var f=Ext.getCmp("operatorComboCmp_CB");f.store.clearFilter();var h=Ext.getCmp("TA_PA_ComboCmp");h.store.clearFilter();},edit:function(h,j){if(j.field==="selectedField"){var i=j.value;var g=j.originalValue;var f="";var l="";var k=Ext.getStore("Field_List_Store_CB");var m=k.findRecord("fieldApiName",i,0,false,true,true);var l=m&&m.getData().dataType.toUpperCase();if(g!==""&&g!==null){m=k.findRecord("fieldApiName",g,0,false,true,true);f=m&&m.getData().dataType.toUpperCase();}if((l==="TEXT"||l==="PICKLIST")&&(f!==""&&(f==="NUMBER"||f==="DATE"))){j.record.set("selectedOperator","");}else{if((l==="NUMBER"||l==="DATE")&&(f!==""&&(f==="TEXT"||f==="PICKLIST"))){j.record.set("selectedOperator","");}}if(f!==""&&(l!==f)){j.record.set("value","");}else{if(l==="PICKLIST"&&f!==""&&(l===f)&&(i!==g)){j.record.set("value","");}}}}}});this.comboBoxRenderer=function(e){return function(g){var f=e.store.find(e.valueField,g);var h=e.store.getAt(f);return((h===null||h===undefined)?"":h.get(e.displayField));};};Ext.apply(this,{width:"60%",autoScroll:true,maxHeight:450,id:"conditionRuleGridCB",margin:"10 10 30",plugins:[this.cellEditing],store:new Ext.data.Store({storeId:"Condition_Rule_Store_CB",fields:["isRowHasError","conditionRuleId","sequence","selectedField","selectedOperator","value"]}),columns:[{xtype:"actioncolumn",width:40,align:"center",sortable:false,menuDisabled:true,items:[{iconCls:"pmplan-delete-row-icon",tooltip:b.T("TAG043","Delete"),scope:this,handler:this.onRemoveClick}]},{header:b.T("TAG044","Sequence"),dataIndex:"sequence",width:70,sortable:false,menuDisabled:true,align:"center"},{header:b.T("TAG075","Attribute"),dataIndex:"selectedField",width:270,align:"center",sortable:false,menuDisabled:true,editor:this.fieldCombo,renderer:this.comboBoxRenderer(this.fieldCombo)},{header:b.T("TAG046","Operator"),dataIndex:"selectedOperator",width:180,align:"center",sortable:false,menuDisabled:true,renderer:this.comboBoxRenderer(this.operatorCombo),__parent:this,getEditor:function(e){var f=e.data.selectedField;if(f!==null&&f!==""){return this.__parent.operatorCombo;}}},{header:b.T("TAG073","Value"),dataIndex:"value",width:400,align:"center",sortable:false,menuDisabled:true,__parent:this,renderer:function(p,e,l,h,k,q){if(p!=null&&p!=""){var g=l.data.selectedField;var f=Ext.getStore("Field_List_Store_CB");var j=f.findRecord("fieldApiName",g,0,false,true,true);var m=j&&j.getData().dataType.toUpperCase();if(m==="DATE"){var i=new Date(p);var n=("0"+(i.getMonth()+1)).slice(-2);var o=("0"+i.getDate()).slice(-2);return[n,o,i.getFullYear()].join("-");}else{return Ext.String.htmlEncode(p);}}else{return p;}},getEditor:function(e){var g=e.data.selectedField;var i=Ext.getStore("Field_List_Store_CB");var j=i.findRecord("fieldApiName",g,0,false,true,true);var h=j&&j.getData().dataType.toUpperCase();if(h!==null&&h!==""){if(h==="DATE"){var f=Ext.create("Ext.form.field.Date",{format:"m-d-Y",value:Ext.Date.dateFormat(e.data.value,"m-d-Y"),invalidText:b.T("TAG079","Enter a valid date"),});return Ext.create("Ext.grid.CellEditor",{field:f});}else{if(h==="TEXT"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Text",{})});}else{if(h==="NUMBER"){return Ext.create("Ext.grid.CellEditor",{field:Ext.create("Ext.form.field.Number",{minValue:0.1,enableKeyEvents:true,nanText:b.T("TAG080","Enter a valid number"),listeners:{keypress:function(m,l){var k=m.getValue();
if(!Ext.isEmpty(k)){if(/\.\d{2,}/.test(k)){l.stopEvent();}}}}})});}else{if(h==="PICKLIST"){return Ext.create("Ext.grid.CellEditor",{field:this.__parent.TA_PA_Combo});}}}}}}}],selModel:{selType:"cellmodel"},bbar:[{text:"+ "+b.T("TAG056","Add row"),id:"addRowButton_CB",scope:this,handler:this.onAddClick,cls:"pmplan-blue-link"}]});this.callParent();},onAddClick:function(d){var c=this.getStore().getCount();var e={sequence:c+1,isRowHasError:false};if(c<5){this.getStore().insert(c,e);if(c==4){d.setDisabled(true);}}if(this.getStore().getCount()>0){Ext.getCmp("scheduleLink").setDisabled(false);}else{Ext.getCmp("scheduleLink").setDisabled(true);}},onRemoveClick:function(d,h,c,g){var k=this.getStore();k.removeAt(h);var l=k.getCount();for(var f=h;f<l;f++){var e=k.getAt(f);e.set("sequence",f+1);}var j=Ext.getCmp("addRowButton_CB");if(l<5&&j.isDisabled()){j.setDisabled(false);}if(this.getStore().getCount()>0){Ext.getCmp("scheduleLink").setDisabled(false);}else{Ext.getCmp("scheduleLink").setDisabled(true);}}});};})();