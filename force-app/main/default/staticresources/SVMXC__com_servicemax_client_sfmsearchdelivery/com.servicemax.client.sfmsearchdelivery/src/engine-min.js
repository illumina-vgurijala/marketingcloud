(function(){var a=SVMX.Package("com.servicemax.client.sfmsearchdelivery.engine");a.init=function(){var b=SVMX.getClient().getServiceRegistry().getServiceInstance("com.servicemax.client.translation").getDictionary("FSA");a.Class("DeliveryEngineImpl",com.servicemax.client.sfmconsole.api.AbstractDeliveryEngine,{__searchMetamodel:null,__searchRoot:null,__loadMask:null,__isContainerExternal:null,__parent:null,__translation:null,__view:null,searchResultsMaxCount:null,defaultResultsMaxCount:null,__constructor:function(){this.__base();this.__isContainerExternal=false;com.servicemax.client.lib.datetimeutils.DatetimeUtil.setAmPmText(b.T("FSA016_TAG005","AM"),b.T("FSA016_TAG006","PM"));},initAsync:function(c){var d=SVMX.getClient().getServiceRegistry().getService("com.servicemax.client.niservice").getInstance();this.__eventBus=SVMX.create("com.servicemax.client.sfmsearchdelivery.impl.SFMSearchDeliveryEngineEventBus",{});d.createNamedInstanceAsync("CONTROLLER",{handler:function(e){d.createNamedInstanceAsync("MODEL",{handler:function(f){e.setModel(f);d.createNamedInstanceAsync("SFMSEARCHDELIVERY.VIEW",{handler:function(g){this.__view=g;c.handler.call(c.context);},context:this,additionalParams:{eventBus:this.getEventBus()}});},context:this});},context:this,additionalParams:{eventBus:this.__eventBus}});},getEventBus:function(){return this.__eventBus;},translate:function(c){return b.T(c);},getAllTranslation:function(){return this.__translation;},__appCurrentState:"",changeApplicationState:function(c){if(this.__appCurrentState===c){return;}this.__appCurrentState=c;if(c=="block"){if(!this.__loadMask){this.__loadMask=new com.servicemax.client.ui.components.utils.LoadMask({parent:this.__searchRoot});}this.__loadMask.show({});this.__loadMask.setZIndex(50000);}else{if(c=="unblock"&&this.__loadMask!==null){if(this.__loadMask!==null){this.__loadMask.hide();}}}},reset:function(){this.getRoot().destroy();this.__searchRoot=null;this.__searchMetamodel.destroy();this.__searchMetamodel=null;this.run(this.options);},run:function(d){this.options=d||{};var c=SVMX.create("com.servicemax.client.sfmconsole.utils.EventCollection",this.getEventBus(),[SVMX.create("com.servicemax.client.lib.api.Event","SFMSEARCHDELIVERY.GET_SEARCH_INFO",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","SFMSEARCHDELIVERY.GET_USERINFO",this,{request:{}}),SVMX.create("com.servicemax.client.lib.api.Event","SFMSEARCHDELIVERY.GET_SEARCH_RESULT_LIMIT_SETTINGS",this,{request:{}})]);c.triggerAll(function(k){var e=k.items(),h=e.length,g;for(g=0;g<h;g++){var j=e[g];if(j.type()=="SFMSEARCHDELIVERY.GET_SEARCH_INFO"){this.onGetSearchInfoCompleted(j.response);}if(j.type()=="SFMSEARCHDELIVERY.GET_USERINFO"){this.onGetUserInfoCompleted(j.response);}if(j.type()=="SFMSEARCHDELIVERY.GET_SEARCH_RESULT_LIMIT_SETTINGS"){this.onGetSearchResultLimitSettingsCompleted(j.response);}}this.__searchMetamodel.initialize();this.__searchRoot=this.__view.createComponent("ROOTCONTAINER",{metamodel:this.__searchMetamodel,deliveryEngine:this,consoleAppInstance:d.consoleAppInstance});SVMX.getCurrentApplication().defaultSearchInstance=this;var m=SVMX.getUrlParameter("SVMX_keyWord"),l=SVMX.getUrlParameter("SVMX_SearchName"),f=SVMX.getUrlParameter("SVMX_SearchId");if(this.__searchRoot){this.__searchRoot.run({keyWord:m,processId:l,processObjectId:f});this.__searchRoot.render(SVMX.getDisplayRootId(),this.__isContainerExternal);}if(this.options.onReady){this.options.onReady.handler.call(this.options.onReady.context||this);}},this);},getRoot:function(){return this.__searchRoot;},getSearchType:function(){return"SFMSEARCHDELIVERY";},onGetSearchInfoCompleted:function(c){this.__searchMetamodel=SVMX.create("com.servicemax.client.sfmsearchdelivery.engine.SFMSearchMetaModel",this,c);},onGetUserInfoCompleted:function(d){var c=SVMX.getClient();var e=SVMX.create("com.servicemax.client.lib.api.Event","GLOBAL.HANDLE_USER_INFO",this,d);c.triggerEvent(e);},getMetaModel:function(){return this.__searchMetamodel.searchInfo;},onGetSearchResultLimitSettingsCompleted:function(c){var e=c.maxLimit;var d=c.defaultLimit;this.searchResultsMaxCount=e;this.defaultResultsMaxCount=d;},onResize:function(c){this.getRoot().resize(c);}},{});a.Class("SFMSearchMetaModel",com.servicemax.client.lib.api.Object,{__parent:null,__data:null,searchInfo:null,defaultSearchOperator:null,__constructor:function(c,d){this.__parent=c;this.__data=d;this.searchInfo=[];},initialize:function(){var e=this.__data.lstSearchInfo||[],d,c=e.length,f;this.defaultSearchOperator=this.__extractDefaultSearchOperator();for(d=0;d<c;d++){f=SVMX.create("com.servicemax.client.sfmsearchdelivery.engine.SFMSearchProcessMetaModel",this,e[d]);f.initialize();this.searchInfo.push(f);}},__extractDefaultSearchOperator:function(){var f=this.__data.stringMap||[],e,c=f.length,d="Contains";for(e=0;e<c;e++){if(f[e].key=="SEARCH_OPERATOR"){d=f[e].value;break;}}return d;},getSearchInfoFor:function(g){var f=this.searchInfo||[],e,c=f.length,d=null;for(e=0;e<c;e++){if(f[e].processObjectId==g){d=f[e];
break;}}return d;},destroy:function(){SVMX.array.forEach(this.searchInfo,function(c){c.destroy();});delete this.seachInfo;this.__parent=null;this.__data=null;this.searchInfo=null;}},{});a.Class("SFMSearchProcessMetaModel",com.servicemax.client.lib.api.Object,{__parent:null,__data:null,name:null,description:null,processId:null,isDefault:false,processObjectId:null,searchDetails:null,__constructor:function(c,d){this.__parent=c;this.__data=d;},initialize:function(){this.name=this.__data.searchDef[SVMX.OrgNamespace+"__Name__c"];this.processId=this.__data.searchDef[SVMX.OrgNamespace+"__ProcessID__c"];this.processObjectId=this.__data.searchDef.Id;this.description=this.__data.searchDef[SVMX.OrgNamespace+"__Description__c"];this.isDefault=this.__data.searchDef[SVMX.OrgNamespace+"__IsDefault__c"];this.searchDetails=[];var c=this.__data.searchDetails||[],f,d=c.length,g;for(f=0;f<d;f++){g=SVMX.create("com.servicemax.client.sfmsearchdelivery.engine.SFMSearchDetailMetaModel",this,c[f]);g.initialize();this.searchDetails.push(g);}this.searchDetails=this.searchDetails.sort(function e(i,h){return i.objectDisplaySequence-h.objectDisplaySequence;});},destroy:function(){SVMX.array.forEach(this.searchDetails,function(c){c.destroy();});this.__parent=null;this.__data=null;delete this.searchDetails;}},{});a.Class("SFMSearchDetailMetaModel",com.servicemax.client.lib.api.Object,{__parent:null,__data:null,targetObjectName:null,targetObjectLabel:null,objectDisplaySequence:null,fields:null,detailObjectId:null,__constructor:function(c,d){this.__parent=c;this.__data=d;},initialize:function(){this.targetObjectLabel=this.__data.objectLable;this.targetObjectName=this.__data.objectDetails[SVMX.OrgNamespace+"__Target_Object_Name__c"];this.detailObjectId=this.__data.objectDetails.Id;this.objectDisplaySequence=this.__data.objectDetails[SVMX.OrgNamespace+"__Sequence__c"];this.fields=[];var f=this.__data.fields||[],e,c=f.length,d;for(e=0;e<c;e++){d=SVMX.create("com.servicemax.client.sfmsearchdelivery.engine.SFMSearchDetailFieldMetaModel",this,f[e]);d.initialize(this.__data.fieldsLable);this.fields.push(d);}this.fields=SVMX.sort(this.fields,"sequence");},destroy:function(){SVMX.array.forEach(this.fields,function(c){c.destroy();});delete this.fields;this.__parent=null;this.__data=null;}},{});a.Class("SFMSearchDetailFieldMetaModel",com.servicemax.client.lib.api.Object,{__parent:null,__data:null,fieldName:null,displayType:null,sequence:0,fieldLabel:null,__constructor:function(c,d){this.__parent=c;this.__data=d;},initialize:function(e){this.fieldName=this.__data[SVMX.OrgNamespace+"__Field_Name__c"];this.displayType=this.__data[SVMX.OrgNamespace+"__Display_Type__c"];this.sequence=this.__data[SVMX.OrgNamespace+"__Sequence__c"];this.parentName=this.__data[SVMX.OrgNamespace+"__Object_Name2__c"];this.parentReferenceName=this.__data[SVMX.OrgNamespace+"__Lookup_Field_API_Name__c"];var d,c=e.length;for(d=0;d<c;d++){if(e[d].value1==this.getId()){this.fieldLabel=e[d].value;break;}}},getId:function(){return this.__data.Id;},getFullFieldName:function(){return this.parentName&&this.parentName!=this.__parent.targetObjectName?this.parentReferenceName+"-"+this.fieldName:this.fieldName;},getObjectApiName:function(){return this.__parent.targetObjectName;},getReferenceFieldObjectApiName:function(){return this.__data[SVMX.OrgNamespace+"__Object_Name__c"];},destroy:function(){this.__parent=null;this.__data=null;}},{});};})();